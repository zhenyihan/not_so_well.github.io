<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: 學校課程 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/學校課程/page/7/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-lesson/hw-multiprocess-and-multithread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/hw-multiprocess-and-multithread/" class="article-date">
  <time datetime="2014-05-25T12:15:47.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/hw-multiprocess-and-multithread/">作業系統 multiprocess &amp; multithread 作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/" data-id="cimum6q1y01v0h3xc5febd0eb" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multiprocess/">multiprocess</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multithread/">multithread</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="A-班程式要求"><a href="#A-班程式要求" class="headerlink" title="A 班程式要求"></a>A 班程式要求</h1><p>請使用所熟悉的程式開發環境設計單一行程產生子行程 ( Child Process ) 與 多執行緒 ( Multi-Thread) 的程式，意即完成下列傳統 for loop 之列印工作，將其改寫成多行程與多執行緒，由不同的行程與執行緒列印不同 i 值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"output i = %d\n"</span>, i);</span><br></pre></td></tr></table></figure>
<h1 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h1><ul>
<li><strong> 嚴禁從網路抄襲作業 </strong>。每份程式作業將被程式比對軟體檢查，一旦發現抄襲，該份作業以零分計，並且這學期作業系統作業成績以零分計。</li>
<li>後略</li>
</ul>
<blockquote>
<p>這種作業不抄來抄去也難。但是作業格式不清楚，所以也有不同理解方式就是了。</p>
</blockquote>
<h1 id="開始動手"><a href="#開始動手" class="headerlink" title="開始動手"></a>開始動手</h1><p>對於將 for 迴圈改寫，我們必須認知到幾項</p>
<ul>
<li>是否要按照順序輸出？</li>
<li>平台 M$, Linux, or Max OS？</li>
</ul>
<blockquote>
<p>此篇假設目標是一模一樣的輸出</p>
</blockquote>
<h2 id="multiprocess"><a href="#multiprocess" class="headerlink" title="multiprocess"></a>multiprocess</h2><p><code>child process</code> 屬於 multiprocess 中的一種方式。為什麼這麼說呢？multiprocess 只是要求一個 CPU 中有多個工作同時在進行，藉由排程器去進行工作分配。</p>
<p>先不管這些，要實作 <code>child process</code> 看起來只有走向 <code>fork()</code> 一途。而之前 inker 大神則是走非 child process 使用類似 <code>./nachos -e ../test/test1 -e ../test/test1</code> 的方式去運行。</p>
<p>為了實作按照順序輸出，我們需要 process 共同擁有的 shared memory，這個 shared memory 將要紀錄原本 for 裡面的 <code>i</code> 值和一個 <code>sem_t</code>，來保證 process 和 process 之間不會同時搶先動作，<code>sem_t</code> 也許是不需要的，這裡留給實驗者去測試。</p>
<p>為了使輸出一致，在 <code>fork()</code> 完之後，使用 <code>wait()</code> 來等待所有子程序結束。這樣會造成當 for loop 需要跑 n 次，就會總共 n 個 process，也就是一整條鏈下去。</p>
<ul>
<li>思考 <code>wait()</code> 和 <code>sem_t</code> 都不是這麼必要？// 這個要看寫法</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  MAP_ANONYMOUS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  MAP_ANON</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAP_ANONYMOUS MAP_ANON</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> *glob_var;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">32</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    glob_var = (<span class="keyword">int</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span> *glob_var, PROT_READ | PROT_WRITE,</span><br><span class="line">                    MAP_SHARED | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">sem_t</span> *sema = (<span class="keyword">sem_t</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(sema),</span><br><span class="line">                       PROT_READ |PROT_WRITE,MAP_SHARED|MAP_ANONYMOUS,</span><br><span class="line">                       <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    sem_init(sema, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    *glob_var = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (*glob_var &lt; n) &#123;</span><br><span class="line">        sem_wait(sema);</span><br><span class="line">        <span class="keyword">int</span> pid = fork();</span><br><span class="line">        <span class="keyword">int</span> output = (*glob_var)++;</span><br><span class="line">        <span class="keyword">if</span> (output &lt; n)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d, pid = %d\n"</span>, output, pid);</span><br><span class="line">        sem_post(sema);</span><br><span class="line">        <span class="keyword">int</span> wpid, status = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((wpid = wait(&amp;status)) &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//printf("Exit status of %d was %d (%s)\n", (int)wpid, status, (status &gt; 0) ? "accept" : "reject");</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    munmap(glob_var, <span class="keyword">sizeof</span> *glob_var);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="multithread"><a href="#multithread" class="headerlink" title="multithread"></a>multithread</h2><p>Thread 就相當簡單，因為它們是共用同一個記憶體區段，因此沒有 share memory 的問題。<br>雖然使用 <code>sem_wait(&amp;sem)</code> 和 <code>sem_post(&amp;sem)</code> 來保證區域內的代碼不會同時有多個 thread 在運行，但仍遇到 <code>i = 0</code> 同時在多個 Thread 噴出的情況，這一點百思不得其解，為了解決這一切問題，使用課本提到的 <code>Producer–consumer problem</code> 寫法。</p>
<p>希望能從代碼中看懂。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;semaphore.h&gt;</span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line">int i = 0, n = 16;</span><br><span class="line">int count = 0;</span><br><span class="line">sem_t sem;</span><br><span class="line">const int MAX_THREAD = 4;</span><br><span class="line">void *Producer(void *arg) &#123;</span><br><span class="line">    for(int i = 0; i &lt; n;) &#123;</span><br><span class="line">        sem_wait(&amp;sem);</span><br><span class="line">        if(count == 1) &#123;</span><br><span class="line">            sem_post(&amp;sem);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        // printf("\nProducer is :%d\n", count);</span><br><span class="line">        sem_post(&amp;sem);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">&#125;</span><br><span class="line">void *runPrint(void *arg) &#123;</span><br><span class="line">    int id = *((int *) arg);</span><br><span class="line">    for (; i &lt; n ;) &#123;</span><br><span class="line">        sem_wait(&amp;sem);</span><br><span class="line">        if (count == 0) &#123;</span><br><span class="line">            sem_post(&amp;sem);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        count--;</span><br><span class="line">        i++;</span><br><span class="line">        printf("loop i = %d, thread id %d\n", i, id);</span><br><span class="line">        sem_post(&amp;sem);</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    pthread_t *threads;</span><br><span class="line">    sem_init(&amp;sem, 0, 0);</span><br><span class="line">    threads = (pthread_t *) malloc(MAX_THREAD * sizeof(pthread_t));</span><br><span class="line">    for (int i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        int *p = (int *) malloc(sizeof(int));</span><br><span class="line">        *p = i;</span><br><span class="line">        pthread_create(&amp;threads[i], NULL, runPrint, (void *)(p));</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_t producer;</span><br><span class="line">    int *p = (int *) malloc(sizeof(int));</span><br><span class="line">    *p = -1;</span><br><span class="line">    pthread_create(&amp;producer, NULL, Producer, (void *)(p));</span><br><span class="line">    for (i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        pthread_join(threads[i], NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    sem_destroy(&amp;sem);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="後記"><a href="#後記" class="headerlink" title="後記"></a>後記</h2><p>代碼沒有寫得很完整，也就是能達到輸出相同且用符合需求，這一點是有很多漏洞的，前人也是鑽漏洞交作業的。相較之下，我們 B 班的作業略顯兇殘，但是網路上資料還真是少呢，雖然還是找地方抄和理解。</p>
<p>測試的時候，為了保證輸出是穩定的，記得得多測試幾次，並且把數字範圍作變調，當然能不能讓一個 create thread 跑完整個迴圈呢？畢竟加上 main thread 就算是 multithread？haha</p>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><h2 id="編譯"><a href="#編譯" class="headerlink" title="編譯"></a>編譯</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre><h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2></li>
<li><p>Linux &amp; Max OSX</p>
<pre><code>$ ./x
</code></pre></li>
</ul>
<h1 id="Mac-運行問題"><a href="#Mac-運行問題" class="headerlink" title="Mac 運行問題"></a>Mac 運行問題</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifndef  MAP_ANONYMOUS</span><br><span class="line">#ifdef  MAP_ANON</span><br><span class="line">#define MAP_ANONYMOUS MAP_ANON</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>不知道為什麼 clang 中沒有定義 <code>MAP_ANONYMOUS</code>，增加上述代碼後正確運行。</p>
<h1 id="其他作業"><a href="#其他作業" class="headerlink" title="其他作業"></a>其他作業</h1><p><a href="http://morris821028.github.io/2014/05/18/operating-system-hw-thread/">B 班程式作業 1</a><br><a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">B 班程式作業 2</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-item-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/consumption-item-1/" class="article-date">
  <time datetime="2014-05-25T06:22:22.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/sungirl3.jpg" rel="gallery_cimum6pzy01toh3xch599erqm">
        <img src="/img/sungirl3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/consumption-item-1/">當代消費文化與社會 (2)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/" data-id="cimum6pzy01toh3xch599erqm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="母親節篇"><a href="#母親節篇" class="headerlink" title="母親節篇"></a>母親節篇</h2><ol>
<li>請簡述母親節與消費文化的關聯性 ?<br>母親節與消費文化原本是扯不上邊的，後來商人們藉由這些推銷的活動，給予不知道母親節要怎麼犒勞養育辛勞的兒女們一項消費選擇，因此提供了相關的優惠活動方便消費者，母親節就逐漸跟情人節送禮一樣的氣氛。</li>
<li>舉例說明母親節有哪些消費現象 ?<br>相關女性用品優惠，對於餐飲業而言就是雙人、多人套餐，而觀光景點就是帶著母親出遊享優惠 … 等等。</li>
<li>您決定購買什麼禮物送媽媽及其理由 ?<br>身為一個程序猿，買禮物卻沒有思路，寫卡片卻沒有語言，在這樣的情況下，按照自己最常做的事情下手設計，但最近還有其他程序要趕，大概是趕不上這個母親節專案了。</li>
</ol>
<h2 id="血色月灣"><a href="#血色月灣" class="headerlink" title="血色月灣"></a>血色月灣</h2><div class="video-container"><iframe src="//www.youtube.com/embed/ypeW6lSeUFc" frameborder="0" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ypeW6lSeUFc" target="_blank" rel="external">Youtube</a></p>
<p>在這場被隱藏的殺戮中，繼上次壽司造成的魚類問題，沒想到日本又在海洋造成了更大的傷害，不管是不是海豚，也許有人會因為海豚可愛而在這一次的血色海灣而保護它，在我們不喜歡的動物上，說不定也有類似的問題。</p>
<p>最令人訝異的是，即使在國際會議中，也有隱瞞事實的大人物在，果然要執行某些事情，不是會議或者是組織所為，而是來自個人的發起。這句話有額外的啟發，為了背後國民的飯碗或支持，這些代表人物不得不說謊的情境，假使一開始錯了，他們便會一直錯下去，這樣的情況令人相當惋惜。</p>
<p>海豚的確很有靈性，在他們受到如此的遭遇，難免會感受到如新世界中，那些因為外表被看成不同種的情況，而受到摧殘的可能，對於靈性的動物，在受到傷害，我們給予同情，在其他情況下則沒有這麼強烈的反應。</p>
<h2 id="消費型科技商品"><a href="#消費型科技商品" class="headerlink" title="消費型科技商品"></a>消費型科技商品</h2><p>現在出門一定有 GPS 衛星導航的裝置，才能穿梭於大街小巷，這些裝置給我們相當大的便利，不用攜帶大量的地圖資訊出門，不會迷路、不用煩惱就可以輕鬆出門。</p>
<p>科技所帶來的便利，使得停下來思考的機會少了，也不會看看四周的景色，追求更快速地抵達目的地，目的地以外的機緣就越來越少了。比起問人，問機器更來得有信任感，這也表示著相信別人給的知識也不是那麼重要。根據新聞的研究報導，也許我們正在改變記憶方式，開始不擅長記繁瑣的事物，而開始擅長去哪裡找資料、如何使用資料。</p>
<p>因此，也常發生因衛星導航所造成的交通事故，被引導到錯誤地方或者是進入不合適的地點。這也反應使用者即使發現了不合理之處，最後仍相信訊息給的答案。假使衛星給了錯誤訊息，或者被惡意修改成錯誤訊息，很容易造就嚴重事故，我們已經被訓練得無法自己處理這些資訊。</p>
<p>也許老師會問我「那你認為到底要不要買衛星導航？」這一點還真的是要看需求，身為宅的人們不喜歡出門呢。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/24/lesson/hw-nachos4/" class="article-date">
  <time datetime="2014-05-24T00:14:43.000Z" itemprop="datePublished">2014-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/24/lesson/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/" data-id="cimum6q2m01vbh3xcuovd77te" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="關於-NachOS-4-0"><a href="#關於-NachOS-4-0" class="headerlink" title="關於 NachOS 4.0"></a>關於 NachOS 4.0</h1><p>作為教學用作業系統，需要實現簡單並且儘量縮小與實際作業系統之間的差距，所以我們採用 Nachos 作為作業系統課程的教學實踐平臺。Nachos 是美國加州大學伯克萊分校在作業系統課程中已多次使用的作業系統課程設計平臺，在美國很多大學中得到了應用，它在作業系統教學方面具有一下幾個突出的優點：</p>
<ul>
<li>採用通用虛擬機器</li>
<li>簡單而易於擴展    </li>
<li>物件導向性</li>
<li>… 略</li>
</ul>
<blockquote>
<p>簡單地來說，就是一個模擬作業系統的軟體</p>
</blockquote>
<h1 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h1><p>課程頁面：<a href="http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download" target="_blank" rel="external">http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download</a></p>
<ul>
<li>Platform: Linux or Linux over VMware <pre><code>RedHat Linux 9.0 
</code></pre>  在 Ubuntu 上面運行無法</li>
<li>Install steps<ul>
<li>Get NachOS-4.0<pre><code>wget ../nachos-4.0.tar.gz
</code></pre></li>
<li>Get Cross Compiler<pre><code>wget ../mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Move Cross Compiler to /<pre><code>mv ./mips-decstation.linux-xgcc.tgz /
</code></pre></li>
<li>Untar Cross Compiler<pre><code>tar zxvf ./mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Untar NachOS-4.0<pre><code>tar zxvf ./nachos-4.0.tar.gz
</code></pre></li>
<li>Make NachOS-4.0<pre><code>cd ./nachos-4.0/code
make
</code></pre></li>
<li>Test if installation is succeeded<pre><code>cd ./userprog
./nachos -e ../test/test1
./nachos -e ../test/test2
</code></pre></li>
</ul>
</li>
</ul>
<p>預期運行結果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Total threads number is 1</span><br><span class="line">Thread ../test/test1 is executing.</span><br><span class="line">Print integer:9</span><br><span class="line">Print integer:8</span><br><span class="line">Print integer:7</span><br><span class="line">Print integer:6</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line">                                                                                </span><br><span class="line">Ticks: total 200, idle 66, system 40, user 94</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br><span class="line"></span><br><span class="line">Total threads number is 1</span><br><span class="line">Thread ../test/test2 is executing.</span><br><span class="line">Print integer:20</span><br><span class="line">Print integer:21</span><br><span class="line">Print integer:22</span><br><span class="line">Print integer:23</span><br><span class="line">Print integer:24</span><br><span class="line">Print integer:25</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line"></span><br><span class="line">Ticks: total 200, idle 32, system 40, user 128</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br></pre></td></tr></table></figure></p>
<h1 id="作業階段"><a href="#作業階段" class="headerlink" title="作業階段"></a>作業階段</h1><h2 id="Multiprogramming"><a href="#Multiprogramming" class="headerlink" title="Multiprogramming"></a>Multiprogramming</h2><p>執行下述指令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nachos –e ../test/test1 –e ../test/test2</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><figcaption><span>test1.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n=<span class="number">9</span>;n&gt;<span class="number">5</span>;n--)</span><br><span class="line">        PrintInt(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>test2.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n=<span class="number">20</span>;n&lt;=<span class="number">25</span>;n++)</span><br><span class="line">        PrintInt(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在開始動工前，發現在 Multithread 操作會有錯誤，test1 程序會遞減輸出，而 test2 程序會遞增輸出，但是根據運行結果，兩個程式都會遞增輸出。</p>
<p>目標運行結果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Total threads number is 2</span><br><span class="line">Thread ../test/test1 is executing.</span><br><span class="line">Thread ../test/test2 is executing.</span><br><span class="line">Print integer:9</span><br><span class="line">Print integer:8</span><br><span class="line">Print integer:7</span><br><span class="line">Print integer:20</span><br><span class="line">Print integer:21</span><br><span class="line">Print integer:22</span><br><span class="line">Print integer:23</span><br><span class="line">Print integer:24</span><br><span class="line">Print integer:6</span><br><span class="line">return value:0</span><br><span class="line">Print integer:25</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line"> </span><br><span class="line">Ticks: total 300, idle 8, system 70, user 222</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br></pre></td></tr></table></figure></p>
<ul>
<li>為什麼兩個程式都會遞增輸出？<br>明顯地是兩個程式匯入時，操作到相同區域的 code segment。如果發現各別遞增和遞減，但是輸出 <code>n</code> 的結果錯誤，則可以想到是 <code>context-switch</code> 上發生問題。</li>
</ul>
<h3 id="解決"><a href="#解決" class="headerlink" title="解決"></a>解決</h3><p>需要為 physical address 做標記，這個 physical address 就是在 main memory 裡面的位置。而每一個 process 都會有一個 AddrSpace，然後紀錄 logical address 所對應在 physical address，也就是 <code>pageTable</code> 對應到 <code>pageTable[i].physicalPage</code>。</p>
<p>也就是說，當要執行 process 某一頁的程序，則將會去找 pageTable 所對應的 physicalPage，然後去運行。在作業一開始給的代碼中，會發現所有程序的 physicalPage 都共用，如此一來當然會執行到同一份 code。</p>
<p>首先，我們需要一個全局的標記，來記錄 main memory page 的情況。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> AddrSpace &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> usedPhyPage[NumPhysPages];</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接著，在 addrspace.cc 宣告實體，並且初始化是 <code>0</code>，表示全部都還沒有用過。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"copyright.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"main.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"addrspace.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"machine.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"noff.h"</span></span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">bool</span> AddrSpace::usedPhyPage[NumPhysPages] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>當 process 執行成功後，將會釋放資源。此時將要把標記使用的 page 設回未使用。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AddrSpace::~AddrSpace()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numPages; i++)</span><br><span class="line">        AddrSpace::usedPhyPage[pageTable[i].physicalPage] = <span class="literal">false</span>;</span><br><span class="line">   <span class="keyword">delete</span> pageTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最後，就是稍微麻煩的地方，當將程序載入記憶體時，要去填入 <code>pageTable[]</code> 對應的 <code>physicalPage</code>，這裡使用線性時間去搜索第一個未使用的 page 進行填入。</p>
<p>載入確定後，便要開始執行，執行的時候要去算程序進入點，進入點的位置即是 main memory address。</p>
<p><code>mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]</code></p>
<p>首先算出第幾頁，然後乘上 <code>PageSize</code> 就是 page base，而 page offset 則是 <code>code.address mod PageSize</code>。</p>
<p>最後，<code>page base + page offset</code> 就是我們所需要的程序進入點。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> AddrSpace::Load(<span class="keyword">char</span> *fileName) &#123;</span><br><span class="line">    OpenFile *executable = kernel-&gt;fileSystem-&gt;Open(fileName);</span><br><span class="line">    NoffHeader noffH;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executable == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Unable to open file "</span> &lt;&lt; fileName &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    executable-&gt;ReadAt((<span class="keyword">char</span> *)&amp;noffH, <span class="keyword">sizeof</span>(noffH), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((noffH.noffMagic != NOFFMAGIC) &amp;&amp; </span><br><span class="line">        (WordToHost(noffH.noffMagic) == NOFFMAGIC))</span><br><span class="line">    	SwapHeader(&amp;noffH);</span><br><span class="line">    ASSERT(noffH.noffMagic == NOFFMAGIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// how big is address space?</span></span><br><span class="line">    size = noffH.code.size + noffH.initData.size + noffH.uninitData.size </span><br><span class="line">            + UserStackSize;	<span class="comment">// we need to increase the size</span></span><br><span class="line">                        <span class="comment">// to leave room for the stack</span></span><br><span class="line">    numPages = divRoundUp(size, PageSize);</span><br><span class="line"><span class="comment">//	cout &lt;&lt; "number of pages of " &lt;&lt; fileName&lt;&lt; " is "&lt;&lt; numPages &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">    pageTable = <span class="keyword">new</span> TranslationEntry[numPages];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; numPages; i++) &#123;</span><br><span class="line">        pageTable[i].virtualPage = i;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; NumPhysPages &amp;&amp; AddrSpace::usedPhyPage[j] == <span class="literal">true</span>)</span><br><span class="line">            j++;</span><br><span class="line">        AddrSpace::usedPhyPage[j] = <span class="literal">true</span>;</span><br><span class="line">        pageTable[i].physicalPage = j;</span><br><span class="line">        pageTable[i].valid = <span class="literal">true</span>;</span><br><span class="line">        pageTable[i].use = <span class="literal">false</span>;</span><br><span class="line">        pageTable[i].dirty = <span class="literal">false</span>;</span><br><span class="line">        pageTable[i].readOnly = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    size = numPages * PageSize;</span><br><span class="line"></span><br><span class="line">    ASSERT(numPages &lt;= NumPhysPages);		<span class="comment">// check we're not trying</span></span><br><span class="line">                        <span class="comment">// to run anything too big --</span></span><br><span class="line">                        <span class="comment">// at least until we have</span></span><br><span class="line">                        <span class="comment">// virtual memory</span></span><br><span class="line"></span><br><span class="line">    DEBUG(dbgAddr, <span class="string">"Initializing address space: "</span> &lt;&lt; numPages &lt;&lt; <span class="string">", "</span> &lt;&lt; size);</span><br><span class="line"></span><br><span class="line"><span class="comment">// then, copy in the code and data segments into memory</span></span><br><span class="line">    <span class="keyword">if</span> (noffH.code.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        DEBUG(dbgAddr, <span class="string">"Initializing code segment."</span>);</span><br><span class="line">    DEBUG(dbgAddr, noffH.code.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.code.size);</span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">        	executable-&gt;ReadAt(</span><br><span class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]), </span><br><span class="line">            noffH.code.size, noffH.code.inFileAddr);</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (noffH.initData.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        DEBUG(dbgAddr, <span class="string">"Initializing data segment."</span>);</span><br><span class="line">    DEBUG(dbgAddr, noffH.initData.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.initData.size);</span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">        executable-&gt;ReadAt(</span><br><span class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.initData.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]),</span><br><span class="line">            noffH.initData.size, noffH.initData.inFileAddr);</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> executable;			<span class="comment">// close file</span></span><br><span class="line">    <span class="keyword">return</span> TRUE;			<span class="comment">// success</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Sleep-System-call"><a href="#Sleep-System-call" class="headerlink" title="Sleep() System call"></a>Sleep() System call</h2><p>撰寫自己的 Sleep function，將該 Thread 進入休眠。</p>
<h3 id="測試檔案"><a href="#測試檔案" class="headerlink" title="測試檔案"></a>測試檔案</h3><p>與一開始的 <code>test1.c</code> 很像，這裡先做個簡單測試。<br><figure class="highlight cpp"><figcaption><span>/code/test/sleep.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        Sleep(<span class="number">10000000</span>);</span><br><span class="line">        PrintInt(<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>因為整個測試檔案是要能在 nachOS 上面跑，所以不能使用一般的編譯方式？所以把這些訊息寫入 <code>Makefile</code> 中，之後下 <code>$ make</code> 產出 <code>sleep</code> 即可。<br><figure class="highlight cpp"><figcaption><span>/code/test/Makefile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">all: halt shell matmult sort test1 test2 sleep</span><br><span class="line">...</span><br><span class="line">sleep: sleep.o start.o</span><br><span class="line">    $(LD) $(LDFLAGS) start.o sleep.o -o sleep.coff</span><br><span class="line">    ../bin/coff2noff sleep.coff sleep</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如果無法在 <code>/code/test</code> 下 <code>$ make</code> 順利產出，則請參照 <strong> 其他指令 </strong>，將原本下載的 <code>mips-decstation.linux-xgcc.gz</code> 解壓縮產生的 <code>/usr</code> 移動到正確位置。</p>
</blockquote>
<h3 id="解決-1"><a href="#解決-1" class="headerlink" title="解決"></a>解決</h3><p>首先，要模仿 <code>PrintInt()</code>，找到切入的宣告位置。努力地尾隨前人。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/syscall.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_PrintInt	11</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_Sleep	12</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInt</span><span class="params">(<span class="keyword">int</span> number)</span></span>;	<span class="comment">//my System Call</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sleep</span><span class="params">(<span class="keyword">int</span> number)</span></span>;         <span class="comment">// morris add</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>接著，找一下 ASM。<br>以下部分就不得而知了，為什麼會出現在 <code>/code/test</code> 目錄下。<br><figure class="highlight cpp"><figcaption><span>/code/test/start.s</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    ...</span><br><span class="line">PrintInt:</span><br><span class="line">    addiu   $<span class="number">2</span>,$<span class="number">0</span>,SC_PrintInt</span><br><span class="line">    syscall</span><br><span class="line">    j       $<span class="number">31</span></span><br><span class="line">    .end    PrintInt</span><br><span class="line"></span><br><span class="line">    .globl  Sleep</span><br><span class="line">    .ent	Sleep</span><br><span class="line">Sleep:</span><br><span class="line">    addiu   $<span class="number">2</span>,$<span class="number">0</span>,SC_Sleep</span><br><span class="line">    syscall</span><br><span class="line">    j	$<span class="number">31</span></span><br><span class="line">    .end	Sleep</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<p>最後，確定 nachOS 會處理我們的例外操作。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/exception.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    ...</span><br><span class="line"><span class="keyword">case</span> SC_PrintInt:</span><br><span class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Print integer:"</span> &lt;&lt; val &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">case</span> SC_Sleep:</span><br><span class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Sleep Time "</span> &lt;&lt; val &lt;&lt; <span class="string">"(ms) "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    kernel-&gt;alarm-&gt;WaitUntil(val);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>到這裡需要喘口氣，剛找了一陣子的代碼。接著才是重頭戲，因為你看到了 <code>kernel-&gt;alarm-&gt;WaitUntil(val);</code> 出現了。沒錯！我們需要撰寫那邊的代碼。</p>
</blockquote>
<p>既然 kernel 存有 <code>alarm</code>，也就是說每隔固定一段間，就會呼叫 <code>Alarm::CallBack()</code>，因此，對於這個鬧鐘來個累加器 <code>Bedroom::_current_interrupt</code>，全局去記數，當作毫秒 (ms) 看待就可以，每加一次就相當於過了 1 毫秒 (ms)。</p>
<p>假設現在某一個 <code>time = _current_interrupt</code> 呼叫 <code>Sleep(x)</code> 後，將 <code>(Thread address, _current_interrupt + x)</code> 丟入 List，則期望在 <code>_current_interrupt + x</code> 的時候甦醒。因此，每當 _current_interrupt++ 就去檢查 List 中，誰的預期時間小於 _current_interrupt，就將其從 List 中清除。</p>
<blockquote>
<p>這裡先不考慮 _current_interrupt Overflow 的問題，根據電腦效率，可能在 5 ~ 10 秒內就發生一次，此時會造成所有 Thread 沉眠很久。若察覺 Sleep 太久，則是發生 Overflow。</p>
</blockquote>
<ul>
<li>當有程序呼叫 <code>Sleep()</code> 時，會呼叫 <code>WaitUntil()</code>，然後將其丟入 <code>Bedroom</code> 安眠。</li>
<li>然後在 <code>CallBlack()</code> 被呼叫時，來去 <code>Bedroom</code> 檢查誰該醒來了。</li>
</ul>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"copyright.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"utility.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"callback.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"timer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"thread.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Bedroom &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        Bedroom():_current_interrupt(<span class="number">0</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PutToBed</span><span class="params">(Thread *t, <span class="keyword">int</span> x)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">MorningCall</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">class</span> Bed &#123;</span><br><span class="line">            <span class="keyword">public</span>:</span><br><span class="line">                Bed(Thread* t, <span class="keyword">int</span> x):</span><br><span class="line">                    sleeper(t), when(x) &#123;&#125;;</span><br><span class="line">                Thread* sleeper;</span><br><span class="line">                <span class="keyword">int</span> when;</span><br><span class="line">        &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> _current_interrupt;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt; _beds;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The following class defines a software alarm clock. </span></span><br><span class="line"><span class="keyword">class</span> Alarm : <span class="keyword">public</span> CallBackObj &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Alarm(<span class="keyword">bool</span> doRandomYield);	<span class="comment">// Initialize the timer, and callback </span></span><br><span class="line">                <span class="comment">// to "toCall" every time slice.</span></span><br><span class="line">    ~Alarm() &#123; <span class="keyword">delete</span> timer; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">WaitUntil</span><span class="params">(<span class="keyword">int</span> x)</span></span>;	<span class="comment">// suspend execution until time &gt; now + x</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    Timer *timer;		<span class="comment">// the hardware timer device</span></span><br><span class="line">    Bedroom _bedroom;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallBack</span><span class="params">()</span></span>;		<span class="comment">// called when the hardware</span></span><br><span class="line">                <span class="comment">// timer generates an interrupt</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>確定有哪些 method 就可以開始實作了。</p>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Alarm::CallBack() &#123;</span><br><span class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</span><br><span class="line">    MachineStatus status = interrupt-&gt;getStatus();</span><br><span class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></span><br><span class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</span><br><span class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></span><br><span class="line">    interrupt-&gt;YieldOnReturn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</span><br><span class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</span><br><span class="line">    Thread* t = kernel-&gt;currentThread;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    _bedroom.PutToBed(t, x);</span><br><span class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Bedroom::IsEmpty() &#123;</span><br><span class="line">    <span class="keyword">return</span> _beds.size() == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Bedroom::PutToBed(Thread*t, <span class="keyword">int</span> x) &#123;</span><br><span class="line">    ASSERT(kernel-&gt;interrupt-&gt;getLevel() == IntOff);</span><br><span class="line">    _beds.push_back(Bed(t, _current_interrupt + x));</span><br><span class="line">    t-&gt;Sleep(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Bedroom::MorningCall() &#123;</span><br><span class="line">    <span class="keyword">bool</span> woken = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    _current_interrupt ++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt;::iterator it = _beds.begin(); </span><br><span class="line">        it != _beds.end(); ) &#123;</span><br><span class="line">        <span class="keyword">if</span>(_current_interrupt &gt;= it-&gt;when) &#123;</span><br><span class="line">            woken = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"Bedroom::MorningCall Thread woken"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            kernel-&gt;scheduler-&gt;ReadyToRun(it-&gt;sleeper);</span><br><span class="line">            it = _beds.erase(it);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            it++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> woken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到這裡我們就完成 <code>Sleep()</code> 製作。</p>
<p>在下一階段，將要加入排程的製作。</p>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><p>目標完成 SJF, RR, FIFO。<br>請參閱 “向 NachOS 4.0 作業進發 (2)”</p>
<h1 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h1><ul>
<li><p>打包轉移 // 交作業前，將檔案包出傳送，此指令不是壓縮用途</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar cvf FileName.tar DirName</span><br></pre></td></tr></table></figure>
</li>
<li><p>複製資料夾 // 將 nachos gcc library 搬移至 <code>/usr/local/nachos ...</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp -a DirName TARGET_PATH</span><br></pre></td></tr></table></figure>
</li>
<li><p>轉移至 root 權限 // 如果指令權限不夠，需要下達此指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="備忘"><a href="#備忘" class="headerlink" title="備忘"></a>備忘</h1><ul>
<li>網路上有幾個 Java 版本的 NachOS，架構稍微不同，如果發現文章說明有點怪怪的，請看一下他是用 JAVA 版本還是 C++ 版本。</li>
<li>至於怎麼將檔案從 Red Hat，這有點惱人，可以想辦法安裝其他瀏覽器，然後開 e-mail 送出，或者使用 terminal 上的 wget 安裝 … 一堆辦法。最後我自己用 nodejs 寫一個簡單的 upload server 傳出來。</li>
</ul>
<h1 id="代碼下載"><a href="#代碼下載" class="headerlink" title="代碼下載"></a>代碼下載</h1><p><a href="https://github.com/morris821028/hw-nachos-4.0" target="_blank" rel="external">Github</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-computational-intelligence" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/19/lesson/hw-computational-intelligence/" class="article-date">
  <time datetime="2014-05-19T11:47:28.000Z" itemprop="datePublished">2014-05-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/19/lesson/hw-computational-intelligence/">計算型智慧 程式作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/" data-id="cimum6q2e01v7h3xcgzk5z2o3" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fuzzy-System/">Fuzzy System</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GA/">GA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PSO/">PSO</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="Computational-Intelligence-計算型智慧"><a href="#Computational-Intelligence-計算型智慧" class="headerlink" title="Computational Intelligence 計算型智慧"></a>Computational Intelligence 計算型智慧</h1><p>本課程將會有三階段程式，將三個算法依序加入程式中，為了要實作這些算法，必須先作出模擬器。</p>
<h2 id="Lv-0-模擬器"><a href="#Lv-0-模擬器" class="headerlink" title="Lv. 0 模擬器"></a>Lv. 0 模擬器</h2><p>在一個 2D 平面中，以一個圓形當作車子，道路為線段的方式進行描述。為了在隨後的擴充，將地圖內容物分成可行區域多邊形和障礙物多邊形。</p>
<ul>
<li>要支持車子下一秒的擺角，並且按下推動鍵會根據方程式進行移動。</li>
<li>可以將車子兩側的感測器進行角度調整，並且可以根據感測器角度進行距離計算。</li>
<li>並且在呈現 2D 平面時，附加顯示座標軸的比例。</li>
</ul>
<p><img src="/img/hw-ci-0.PNG" alt="完成圖"></p>
<p>由於私心，有一些額外產物。</p>
<ul>
<li>完成可以自動置中的設定</li>
<li>提供地圖縮放和讀取操作</li>
<li>製作地圖產生器 (other project)</li>
<li>模擬器的彈木遊戲番外篇 (other project)</li>
<li>提供運行欄位的縮起</li>
</ul>
<h2 id="Lv-1-模糊系統"><a href="#Lv-1-模糊系統" class="headerlink" title="Lv. 1 模糊系統"></a>Lv. 1 模糊系統</h2><p>車子運行公式</p>
<p><img src="/img/hw-ci-1.PNG" alt="運行公式"></p>
<p>其中 Φ(t) 是模型車與水平軸的角度，b 是模型車的長度，x 與 y 是模型車的座標位置， Θ(t) 是模型車方向盤所打的角度，我們對模擬的輸入輸出變數限制如下：</p>
<p><code>-40 deg &lt;= Θ(t) &lt;= 40 deg</code></p>
<p>寫一個程式使用模糊系統、理論模擬車子行徑，並且想辦法最佳化。</p>
<ul>
<li>考慮擴充性，以後車子的運行公式可能會替換，因此建造一個 <code>Engine class</code>。</li>
<li>模糊系統的幾個特性拆分成數個 method，並且使用不同的數學計算採用繼承關係。</li>
<li>最困難得地方在於計算函數交集，採用離散取點是最後的手段</li>
</ul>
<h3 id="函數實驗"><a href="#函數實驗" class="headerlink" title="函數實驗"></a>函數實驗</h3><ol>
<li>經過實驗，三個感測器分別坐落於前方 (90度)、左右各偏轉 50 度左右的夾角比左右 90 度更好。用以應付多變的轉角彎度，防止模稜兩可的擺動。</li>
<li>不管哪裡種去模糊化系統，由於題目限制擺角於 [-40, 40] 度之間，因此很容易在加權平均、質心、離散化而導致邊界擺角的機率甚低，當越多函數則稀釋程度越高。因此函數定義可以超過限制擺角，只需要在去模糊化時，約束至條件內即可。</li>
<li>設計函數時，要討論向其中一個方向偏轉，也就是不能設計過於對稱的圖形，否則將會在死胡同裡打轉。</li>
</ol>
<h3 id="函數設計"><a href="#函數設計" class="headerlink" title="函數設計"></a>函數設計</h3><p>d1 為前方感測器，d2 為右方感測器，d3 為左方感測器。</p>
<ol>
<li>d1 歸屬函數為<br><img src="/img/hw-ci-2.PNG" alt="d1 歸屬函數"><br>d2, d3 歸屬函數為<br><img src="/img/hw-ci-3.PNG" alt="d2, d3 歸屬函數">    </li>
<li>函數式加權平均<pre><code>If d3 large, θ = 55
If d2 large, θ = -55
If d2 medium, θ = -40
If d3 medium, θ = 40
If d1 large and d2 small, θ = -30
If d1 large and d3 small, θ = 30
If d1 small, θ = -60
</code></pre>規則如上述七條，以最簡單的常數關係。測試結果還算不錯。<br><code>if condition, then statement</code>，statement 中的變數不存在於 condition 去做調整，後來發現由於太複雜去討論而一直失敗。</li>
<li><p>重心法、最大平均法、修正型最大平均法、中心平均法<br>為了方便計算連續函數，採用離散取點，間隔 0.1 抓取 [-60, 60] 之間的點座標。對於以下四種方法討論於簡單彎道的過程記錄：<br><code>If d3 large</code><br><img src="/img/hw-ci-4.png" alt="If d3 large"><br>If d2 large<br><img src="/img/hw-ci-5.png" alt="If d2 large"><br>If d2 medium<br><img src="/img/hw-ci-6.png" alt="If d2 medium"><br>If d3 medium<br><img src="/img/hw-ci-7.png" alt="If d3 medium"><br>If d1 large and d2 small<br><img src="/img/hw-ci-8.png" alt="If d1 large and d2 small"><br>If d1 large and d3 small<br><img src="/img/hw-ci-9.png" alt="If d1 large and d3 small"><br>If d1 small, θ = -60<br><img src="/img/hw-ci-10.png" alt="If d1 small"></p>
<ul>
<li>重心法<br>當中表現最為穩健，而且路徑平滑。</li>
<li>最大平均法<br>由於定義的函數較為簡單，而且大多都是以梯形的方式存在，雖然能在機率高的情況下走完全程，路徑中會呈現左右擺盪情況。並且大多都已極值的方式出現。</li>
<li>修正型最大平均法<br>情況會稍微好一些，但是對於並沒有向重心法一樣的圓滑曲線，仍是因為原先的函數設計所惹的問題。</li>
</ul>
<p>對於某一種方法而去定義相關的函數進行測較好，而在最大平均法的部分，必須使用較具有變化性的曲線，否則很容易在極值狀況下擺動。</p>
</li>
</ol>
<hr>
<h2 id="Lv-2-GA"><a href="#Lv-2-GA" class="headerlink" title="Lv 2. GA"></a>Lv 2. GA</h2><p><img src="/img/hw-ci-RBF.PNG" alt="RBF"></p>
<p>「放射狀基底函數網路 RBF」，基本上，其網路架構如圖1所示，為兩層的網路；假設輸入維度是p ，以及隱藏層類神經元的數目是J ，那麼網路的輸入可以表示成：<br><img src="/img/hw-ci-RBF-f1.PNG" alt=""><br>其中選用高斯型基底函數：<br><img src="/img/hw-ci-RBF-f2.PNG" alt=""><br>其中 x = (x1,x2,…,xp) 、mj = (mj1,mj2,…,mjp) 、||  || 代表向量絕對值<br>適應函數為：<br><img src="/img/hw-ci-RBF-f3.PNG" alt=""></p>
<p>請用實數型基因演算法，找出wj , mj , σj，在不同的數字J下，最好的基因向量 (例如J為9、輸入x為3維向量，則表示基因向量是1+9+3x9+9=46維度的向量，請注意這裡不是指族群數；又例如J為7、輸入x為3維向量，則表示基因向量是1+7+3x7+7=36維度的向量)下，評估函數E(式1)為越小越好。其中基因向量維度公式為 1+J + p<em>J+J = (p+2)</em>J+1維向量( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ)。</p>
<p>參數說明 : </p>
<ul>
<li>N 作業1產生的N筆成功到達目的訓練資料(換不同起始點)</li>
<li>y<sub>n</sub> 表示訓練資料的方向盤期望輸出值 P.s.如果配合wj值的範圍為0~1之間，在此則必須把yn由-40~+40度正規化到 0~1之間；如果不想正規化  就必須把 wj的值範圍調整到 -40~40之間 範圍為0~1之間</li>
<li>W<sub>j</sub> 範圍為 0~1 (或是-40~40)之間 P.s.此需配合訓練集的yn跟F(n)值範圍，所以皆需正規化到0~1之間；若不正規化，wj的值範圍為 -40~40之間</li>
<li>m<sub>j</sub> 範圍跟X範圍一樣，如以提供的範例檔則為 0~30</li>
<li>σ<sub>j</sub> 範圍為0~10之間；也可以設定更大的範圍做探討。</li>
</ul>
<blockquote>
<p><strong> 實作概要 </strong>：<br>把參數編碼成 DNA，使用 GA 算法改變 DNA，然後用之前的模糊系統的結果，讓 RBF 接近之前定義的模糊系統。需要拿模糊系統的一些測資當作訓練資料，收集之後餵給 GA 做訓練。</p>
</blockquote>
<h3 id="實驗方法"><a href="#實驗方法" class="headerlink" title="實驗方法"></a>實驗方法</h3><ol>
<li>核心代碼，對於每次迭代，著手適應、選擇、交配、突變。</li>
<li>細部 “交配” 代碼，採用實數型的分離和聚集兩種情況。</li>
<li>細部 “突變” 代碼，採用微量雜訊，唯一不同的地方在於，這個微量雜訊會根據當前數值的比例有關，為了避免大數字對於微量雜訊的干擾不夠強烈。</li>
</ol>
<h3 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h3><ol>
<li>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.163568 0.851471 1.594151 1.379580 13.092824 0.000505 12.611789 30.000000 0.000368 18.715240 0.000850 2.708967 30.000000 6.307677 7.584529 10.000000)</li>
<li>訓練數據為 “map2” 走一圈的訓練資訊，約為 500 筆。因為 “map0” (即本次作業給的地圖) 的複雜度不夠以至於無法充分表達原本設計的模糊系統。也就是根據當初模糊系統設計，收集的數據的多樣性和連續性不足。</li>
</ol>
<h3 id="實驗分析"><a href="#實驗分析" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>根據 RBF 的神經元，這裡可以越少越好，在程式中，神經元個數(J) 設置 3 個。運行時採用輪盤式選擇，讓適應能力好的，具有較高的機會繁殖，採用一個隨機變數去挑選。而在基因方面使用實數型基因的形式。</p>
<ol>
<li>運行時，突變機率和突變比例相當重要，由於相同適應能力好的物種量很多，只保留其中一部分即可，因此可以將突變機率0.5 左右，太低則會造成進化速度太慢，太高則容易失去原本適應好的物種，導致整體適應度的震盪。</li>
<li>另外設置突變的比例，也就是該段實數值上下調整的比例。<br><code>g.getDNA()[i] = g.getDNA()[i] + ratio * Math.random() * g.getDNA()[i];</code><br>藉由上述的式子，將 ratio 設置成一個調變比例，來製造爆炸效應的規模。而在運行時，突變效果還能接受。</li>
<li>原本運行時，只將 DNA 片段的值任意放置，並且約束在不會超出函數的定義域，在收斂速度上有明顯加速。但為了符合作業需求，將每個參數約束在指定範圍內，在收斂速度慢了一截，在預期結果並沒有很好。</li>
<li>在不同地圖收集的預期資訊，會針對不同車子感測器的角度有所差異，因此不能拿不同型的感測數據，訓練出來的 RBF 不能給另外一台車子來使用，除非使用的感測器角度相當接近。</li>
<li>對於死路的轉彎，在神經元個數(J) 等於 2 的時候，運行結果較為不佳，但是在本次作業中，並不會有這種數據的出現，也不用考慮這種情況。但是當神經元個數少時，GA 算法的運行速度是相當快的。</li>
</ol>
<hr>
<h2 id="Lv-3-PSO"><a href="#Lv-3-PSO" class="headerlink" title="Lv. 3 PSO"></a>Lv. 3 PSO</h2><p>請利用Particle swarm optimization替換掉 GA 部分。</p>
<ul>
<li>AgentNum(粒子數)</li>
<li>IterationNum(疊代數),</li>
<li>MaxV(最大速度),</li>
<li>MaxX(最大值範圍),</li>
<li>Weights(兩個權重),</li>
<li>Convergent_Error(停止條件)</li>
<li>並畫出 fitness function 曲線變化 (每一次疊代的最佳fitness值)，最後訓練完成的F(x)當作規則 請跑出車子軌跡。</li>
</ul>
<h3 id="實驗分析-1"><a href="#實驗分析-1" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>一開始參數為<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> sandSize = <span class="number">512</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxVelocity = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxXposition = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfCognition = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfSocial = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> nearRatio = <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/hw-ci-11.png" alt="PSO 1"></p>
<p><img src="/img/hw-ci-12.png" alt="PSO 2"></p>
<ul>
<li><p>基本上 <code>maxXposition</code> 沒有用到，調整其他比例可以發現端倪。</p>
</li>
<li><p>從圖 <code>PSO 2</code> 中可以發現到，PSO 與 GA 最大的不同在於，如果 GA 調用部分突變的情況下，很高的機率會發現適應曲線是嚴格遞減的，但是在 PSO 由於會飛來飛去，有可能會來回震盪。</p>
</li>
<li><p>當所有粒子逼近最佳解時，仍會以原本的速度繼續飛行，而原本屬於最佳位置的點也會開始模仿其他粒子飛行，如此一來就會造成震盪。</p>
</li>
</ul>
<p><img src="/img/hw-ci-14.png" alt="PSO 3"></p>
<ul>
<li><p>其震盪的高低決定於鄰近模仿的權重，如果鄰近的粒子效果不好，模仿的權重高的時候，會導致整個最佳解有嚴重的偏離。由 <code>PSO 3</code> 中可以驗證這個震盪問題。</p>
</li>
<li><p>如果對於全局模仿權重調高，很容易造成處於群聚粒子不容易分離，也就是很難在早到其他的區域最佳解，會在很快的時間內進入某一個區域最佳解，從這一點中可以發現 PSO 真的具有快速收斂的性質。</p>
</li>
<li><p>設定 <code>maxVelocity</code> 是將整個向量長度 (歐幾里得距離) 壓縮，這將可以控制查找的精密度，如果設定太小會導致收斂速度明顯下降。將 <code>maxVelocity = 10</code> 時，適應函數看起來會有比較高的進展，由於會將每個參數約束，只要速度不是太小影響就不大。</p>
</li>
<li><p>當速度上限增加時，粒子碰到牆的機會也會上升，由於搜索範圍的可能性涵蓋邊界的情況增加，如果最佳解在邊界，在這樣的情況就會更好。</p>
</li>
<li><p>在代碼中，鄰近的定義為最近粒子中排名前 20% 的最佳解。如果採用對於常數長度，這種情況上不容易觀察，也就是說不能直接找到鄰近模仿的規模該定義在何處。</p>
</li>
<li><p>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.117271 1.270048 0.000000 0.805823 15.845525 0.000000 21.613452 13.509075 0.000000 0.000000 30.000000 0.000000 10.505934 10.000000 10.000000 5.238101)</p>
</li>
</ul>
<h1 id="Github-Download"><a href="#Github-Download" class="headerlink" title="Github Download"></a>Github Download</h1><p><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">Download</a></p>
<p><a href="http://morris821028.github.io/2014/05/19/hw-computational-intelligence/">Blog</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/operating-system-hw-thread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/18/lesson/operating-system-hw-thread/" class="article-date">
  <time datetime="2014-05-18T06:58:10.000Z" itemprop="datePublished">2014-05-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/18/lesson/operating-system-hw-thread/">作業系統 Thread 程式作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/" data-id="cimum6q3r01vuh3xc6h0stuwf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Thread/">Thread</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/matrix/">matrix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="C-Thread-練習"><a href="#C-Thread-練習" class="headerlink" title="C++ Thread 練習"></a>C++ Thread 練習</h1><h2 id="作業要求"><a href="#作業要求" class="headerlink" title="作業要求"></a>作業要求</h2><blockquote>
<p>作業一:應用 Thread 撰寫任意程式(語言不限)，繳交方式 FTP:140.115.155.192(選擇自己學號的資料夾上傳) 帳:os2014 密碼不知道者請再問助教，檔案名稱: “作業一<em>學號</em>姓名_第幾版” ex:”作業一<em>10252200x</em>林大乖_v1” 繳交內容:壓縮檔(報告word 以及 程式碼,執行檔)，截止日期:2014/05/25(日)23:59</p>
</blockquote>
<h2 id="程式功能"><a href="#程式功能" class="headerlink" title="程式功能"></a>程式功能</h2><p>兩個 <code>n*n</code> 矩陣相乘，在最基礎的 <code>O(n^3)</code> 效能上，使用 Thread 等相關技巧使其加速。</p>
<h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre></li>
</ul>
<h2 id="測試效率"><a href="#測試效率" class="headerlink" title="測試效率"></a>測試效率</h2><ul>
<li>Mac OSX and Linux<pre><code>$ time ./a.out
</code></pre></li>
</ul>
<h2 id="測試結果"><a href="#測試結果" class="headerlink" title="測試結果"></a>測試結果</h2><p>測試環境為 2013 Mac Air 1.3 GHz Intel Core i5 上對 <code>1024 x 1024</code> 的矩陣進行相乘的統計結果。</p>
<ul>
<li><code>matrix.cpp</code><br>最原始的一般寫法，直接使用 <code>O(n^3)</code> 。運行時間約在 20 秒左右完成。</li>
<li><code>matrix[v2].cpp</code><br>使用轉置矩陣後，在進行運算，這種方式是加快作業系統中的快取層，速度提升至約在 4 秒左右完成。</li>
<li><code>matrix[v3].cpp</code><br>建立在 <code>matrix[v2].cpp</code> 的基礎上，使用 4 條 thread，分別對處理的 column 進行分割操作，速度約在 2 秒內完成。</li>
<li>matrix[v4].cpp<br>與 <code>matrix[v3].cpp</code> 類似，調整 thread 的數量，查看效率變化，但是速度沒有更快的趨勢。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>Thread 多不代表會比較快，而是該程式佔有 CPU 的機會比較高，使用的資源就會比較多。在整個作業系統中，Thread 多上下文切換的次數就會上升，對於作業系統整體效率是下降的，但是又不能沒有 Thread，看起來像是所有程式同時在運行，也要防止落入死機無法動彈的情況。</p>
<p>而在 thread 上面會發現，當數量達到一定程度後，速度就不會上升，有一部分是因為 CPU 超頻運作。</p>
<blockquote>
<p>超頻（英語：Overclocking）是把一個電子配件的時脈速度提升至高於廠方所定的速度運作，從而提升性能的方法，但此舉有可能導致該配件穩定性下降。</p>
</blockquote>
<p>可能是長時間閒置的 CPU 發現有大規模的工作運行，把時脈速度升起。</p>
<h1 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h1><h2 id="matrix-cpp"><a href="#matrix-cpp" class="headerlink" title="matrix.cpp"></a>matrix.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></span><br><span class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[k][j];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//clock_t start, finish;</span></span><br><span class="line">    <span class="comment">//start = clock(); // start time clock</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    multiply(A, B, C);</span><br><span class="line">    <span class="comment">//finish = clock(); // finish time clock</span></span><br><span class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="matrix-v2-cpp"><a href="#matrix-v2-cpp" class="headerlink" title="matrix[v2].cpp"></a>matrix[v2].cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></span><br><span class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trans</span><span class="params">(<span class="keyword">double</span> A[][MAX_N])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            swap(A[i][j], A[j][i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</span><br><span class="line">    trans(B);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//clock_t start, finish;</span></span><br><span class="line">    <span class="comment">//start = clock(); // start time clock</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    multiply(A, B, C);</span><br><span class="line">    <span class="comment">//finish = clock(); // finish time clock</span></span><br><span class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="matrix-v3-c"><a href="#matrix-v3-c" class="headerlink" title="matrix[v3].c"></a>matrix[v3].c</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_N 1024</span><br><span class="line">double A[MAX_N][MAX_N];</span><br><span class="line">double B[MAX_N][MAX_N];</span><br><span class="line">double C[MAX_N][MAX_N];</span><br><span class="line">void trans(double A[][MAX_N]) &#123;</span><br><span class="line">    double x;</span><br><span class="line">    int i, j;</span><br><span class="line">    for (i = 0; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        for (j = i+1; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            x = A[i][j];</span><br><span class="line">            A[i][j] = A[j][i];</span><br><span class="line">            A[j][i] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#define MAX_THREAD 4</span><br><span class="line">void *multiply(void *arg) &#123;</span><br><span class="line">    int id = *((int *)arg);</span><br><span class="line">    int st = id * MAX_N / MAX_THREAD;</span><br><span class="line">    int ed = (id + 1) * MAX_N / MAX_THREAD - 1;</span><br><span class="line">    int i, j, k;</span><br><span class="line">    for (i = st; i &lt;= ed; i++) &#123;</span><br><span class="line">        for (j = 0; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            double sum = 0;</span><br><span class="line">            for (k = 0; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return NULL;</span><br><span class="line">&#125;</span><br><span class="line">int main(void) &#123;</span><br><span class="line">    puts("Thread version");</span><br><span class="line">    //clock_t start, finish;</span><br><span class="line">    //start = clock(); // start time clock</span><br><span class="line">    int i, j;</span><br><span class="line">    for (i = 0; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        for (j = 0; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    trans(B);</span><br><span class="line">    </span><br><span class="line">    pthread_t *threads;</span><br><span class="line">    threads = (pthread_t *) malloc(MAX_THREAD * sizeof(pthread_t));</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        int *p = (int *) malloc(sizeof(int));</span><br><span class="line">        *p = i;</span><br><span class="line">        pthread_create(&amp;threads[i], NULL, multiply, (void *)(p));</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        pthread_join(threads[i], NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    //finish = clock(); // finish time clock</span><br><span class="line">    //printf("Time: %lf\n", (double)(finish - start)/1000);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>雖然作業可以有其他語言的相關 Thread，在 Java 作品方面可以查看 Github。</p>
<ul>
<li><a href="https://github.com/morris821028/hw-ChatRoom" target="_blank" rel="external">聊天室 Chart Room</a></li>
<li><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">演化模擬</a></li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-agile-paper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/14/lesson/hw-agile-paper/" class="article-date">
  <time datetime="2014-05-14T13:36:45.000Z" itemprop="datePublished">2014-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1399146778408.gif" rel="gallery_cimum6q1i01ush3xcvn4rqqk0">
        <img src="/img/1399146778408.gif" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/14/lesson/hw-agile-paper/">論文選讀 Agile Development and User Experience Design ... </a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/14/lesson/hw-agile-paper/" data-id="cimum6q1i01ush3xcvn4rqqk0" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/14/lesson/hw-agile-paper/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/軟體開發/">軟體開發</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="課程論文心得"><a href="#課程論文心得" class="headerlink" title="課程論文心得"></a>課程論文心得</h1><p>首先，所讀這一篇的論文名稱為『Agile Development and User Experience Design Integration as an Ongoing Achievement in Practice』 所以著重點在于用戶體驗設計要怎麼融入敏捷開發的探討。</p>
<p>什麼是用戶體驗？先說說 UX Designer 做些什麼嗎</p>
<p><a href="https://www.facebook.com/notes/kit-lin/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BD%89ux-designer%E5%B0%B1%E4%B8%8A%E6%89%8B%E4%B8%8A/10152088295236310" target="_blank" rel="external">第一次轉UX Designer就上手（上）</a></p>
<p><a href="https://www.facebook.com/notes/kit-lin/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BD%89ux-designer%E5%B0%B1%E4%B8%8A%E6%89%8B%E4%B8%8B/10152088337196310" target="_blank" rel="external">第一次轉UX Designer就上手（下）</a></p>
<p>看完內容後，總之 UX Designer 算是一種設計師，與理工背景的開發人員可是天差地遠，</p>
<p>他們比起宅宅開發者來說，要與用戶產生關係，繪畫、表達、心理學、與現實溝通，開發人員擁有技術並且完成目標，但是行為卻不是一般使用者，最簡單的說法是『為什麼做出來的軟體只有開發者會用？』如果在軟體的需求面向是開發者們的話，這也許還不是問題，但是要做出給一般人使用的軟體，這樣是行不同的。但是開發者的邏輯古怪到自己都不明白的機率是挺高的，因此會有 UX Designer。</p>
<p>借由 UX design，軟體將會有耐用性、易上手、輕便化 … 等，這讓我突然想到總是會開發出根本用不著的功能，或者是相當難操作的功能。</p>
<p>但是要把 UX design 完全融入是有困難的，因為邏輯思維不同的人，是很難協調的，又或者會互相侵蝕。</p>
<h2 id="開始談談論文的內容"><a href="#開始談談論文的內容" class="headerlink" title="開始談談論文的內容"></a>開始談談論文的內容</h2><p>這一篇論文，主要是 <strong> 觀察 </strong>，也沒有觀察到所有目前的運行方式。換句話說，不會存在唯一一個好的開發方式，根據組織的規模和文化背景，所適用的運行方式也會有所不同，在理論上百分之百照抄別人的做法運用在自己的發開方式，但是可以藉由論文中觀察的幾點來學習我們的開發方式大概需要的是哪些面向需求。</p>
<p>而當開發人員是怎麼樣類型的人，就可能需要運用哪些方式，這些都是需要去探討的。外國也許按照它們的方式走成功，但並不代表按照一樣的作法一樣會成功，這就所謂 <strong> 新方法論 </strong>。新方法論沒有絕對的方法，說來有點玄，也就是沒有固定方法就是方法！</p>
<p>由於組織規模不同，彼此部門又要互相協調，在設計與開發之間的不同在於時間的週期不同，工作類型的方式不同，如果是大規模組織，『提高內聚力，降低耦合度』因此專業分工的類型將會在 Study 1 中被提及，這麼考量是有它的原因在的。</p>
<p>而文藝復興時期的全才－達文西類型，則可以在 Study 2 中被提及，每一個人都必須學習一點別人的領域的項目，這樣可以互相考量、共同承擔，來分散思考風險。但這樣對於一般人是相當困難的，如果是菁英組織的運行，大概就是長得這樣。</p>
<p>在最後的 Study 3 中，雖然使用傳統的瀑布式開發，這種神祕的設計大於開發組合相當異常，但也許是一種新的導向。在往後的時代中，當技術相對成熟穩定時，面對的將會是設計需求大於開發需求。</p>
<hr>
<h1 id="RESEARCH-METHOD"><a href="#RESEARCH-METHOD" class="headerlink" title="RESEARCH METHOD"></a>RESEARCH METHOD</h1><p>這裡提供三種 Ethnography (社會學的一種寫作文本，中文翻譯：民族誌) 來探討敏捷開發人員和用戶體驗設計師的配置方式。</p>
<h2 id="A-In-the-field"><a href="#A-In-the-field" class="headerlink" title="A. In the field"></a>A. In the field</h2><p>(田野調查的區域，民族誌運用田野工作來提供人類社會學的描述研究)</p>
<p>總共有三個組織中，四個團隊參與本次研究，參與研究的團隊中正在進行 UX 設計，而我們主要的工作是觀察他們的工作運行情況。</p>
<p>共計在三種情況進行觀察。</p>
<ul>
<li>Study 1: 觀察時間為兩個星期</li>
<li>Study 2: 觀察時間為六天</li>
<li>Study 3: 觀察時間為兩天</li>
</ul>
<p>其中 Study 1, 2 過程中會涵蓋 Sprint 會議，而 Study 3 則只有涵蓋開發人員和設計師共處一室。</p>
<h2 id="B-Thematic-analysis"><a href="#B-Thematic-analysis" class="headerlink" title="B. Thematic analysis"></a>B. Thematic analysis</h2><p>(專題分析)</p>
<h2 id="C-Study-participants"><a href="#C-Study-participants" class="headerlink" title="C. Study participants"></a>C. Study participants</h2><p>(研究參與者)</p>
<h1 id="ACCOUNTS-OF-THE-DAY-TO-DAY-INTEGARTION-WORK"><a href="#ACCOUNTS-OF-THE-DAY-TO-DAY-INTEGARTION-WORK" class="headerlink" title="ACCOUNTS OF  THE DAY-TO-DAY INTEGARTION WORK"></a>ACCOUNTS OF  THE DAY-TO-DAY INTEGARTION WORK</h1><h2 id="Study-1"><a href="#Study-1" class="headerlink" title="Study 1"></a>Study 1</h2><p>這項研究在 14 位 developer 和 2 位 UX designer，這兩位 UX designer 並不屬於 developer team，而是屬於該公司的 UX design team，因此他們並沒有參與 Sprint meeting、Standup、Retrospective，當然開發人員也沒有參與 design meeting，developer team 和 design team 在不同樓層工作。</p>
<p>開發人員描述道『將 UX design 與 agile develop 分開，是基於管理層面。』這很大的原因在於要將 UX 創造力發揮到極限，不能讓軟體工程的問題阻擋他們思考。</p>
<p>而在 Sprint meeting 中觀察到，UX designer 會提供一個 UX design 在 sprint meeting 前送達。但在隨後的 UX design 版本則是偶爾送到 developer 手上，直到 sprint 的最後一天仍持續修改，這表示著 developer 無法依靠 UX design 考慮相關的實作項目，所以大多數的關於 UX 工作將會分配在最後幾個小時來完成。</p>
<p>然而如果詢問 UX designer 是否已經意識到自己時間分配所造成的影響，則他們會回答說『沒有』。但事實上，在發送 UX design 時就已經造成相當多的問題。</p>
<blockquote>
<p>[UX designer]: “That was never explicitly said to me … I thinks there was and still is visibility issues to do with what they’re doing and what their timeline are.”<br>這表示 UX designer 從來不知道這些事情，也從來沒有直接地被告知這項問題，也是因為不知道 developer 的運行工作和時程表。</p>
</blockquote>
<p>當要澄清或者是修改 UX design 時，develop 會將問題寫下，並且要求 UX designer 在他們的 feedback meeting 中討論。</p>
<blockquote>
<p>[senior UX designer]: “The visual designs are pretty much parallel to the wireframes … what kind of feedback do you want to give ?”<br>資深 UX designer 表示道：所有的視覺設計都是在線框 (wireframe) 的基礎上完成的，能有什麼樣的反饋？</p>
</blockquote>
<p>developer 並不完全了解 UX design，只能依靠 UX designer 的批准和重構，這 “批准” 主要是對於敏捷開發中的維護和支持的組成用途，但是當 developer 向 designer 發問時，往往是溝通失敗的。</p>
<blockquote>
<p>2pm: There is some problem with the visual design from UX [hadn’t arrived yet]. Project manager’s been trying to get in touch with the interaction designer, however can not get in contact - mobile switched off. Project manager has heard that UX are moving desks (not all the visual designs have been delivered since the developer feedback session). </p>
</blockquote>
<p>上述內容看得不明白，難道是就是單純 PM 得不到完整的 visual design，因此也就不能向互動工程師聯繫嗎？</p>
<h2 id="Study-2"><a href="#Study-2" class="headerlink" title="Study 2"></a>Study 2</h2><p>小型手機軟件開發的公司，這一間公司有兩支團隊，每一隊有 5 名 developer 和 1 名 UX designer。其中 UX designer 設計非功能性描述和 screen mock-ups，這幾個項目將可以幫助 developer 參考進行開發。</p>
<pre><code>mock-ups 相當於一種 prototype 可以支持動作的描述，通常會帶有基礎的 action code，關於 mock-ups 的相關工具有很多，但是通常價格不菲，邊設計還能自動幫忙產生代碼是不容易的工作。網路上找不到相關的解釋，就先這樣頂替了，相較於一般手繪製圖和文件描述，這樣的方式更為容易了解。
</code></pre><p>在他們會議中，每一個角色(QA, scrum master, product owner, UX designer, developer) 都參與討論會議，創造共同意識和共享決策責任。</p>
<blockquote>
<p>9:30 [developer]: How should tabs appear, is ad always right-most tab ? … UX designer tells the developer what whould happen: As new chats come in ad tab moves over to right-most tab.</p>
</blockquote>
<p>開發人員: 分頁到底該如何呈現，而廣告要固定在最右側的分頁嗎？ … UX designer 告訴我們應該「當新的聊天訊息進來時，廣告要移動到最右邊的分頁嗎？」</p>
<blockquote>
<p>[Product owner]: Still waiting on response for some questions from the client.</p>
</blockquote>
<p>Product owner: 這仍然在等待顧客的回報訊息</p>
<blockquote>
<p>[QA]: Kind of hard to do QA if we don’t have the answer … wayry of starting stories without behaviours which means we might have to change thins and that wastes time.</p>
</blockquote>
<p>QA: 這件事情很難做確認，如果我們沒有接收到回報，做的任何修改也許只是浪費時間，無法確定品質。</p>
<blockquote>
<p>[UX designer]: Do them anyway, they might need to go through a number of iterations before they agree this is what they want … it’s better of they see something working as soon as posssible.</p>
</blockquote>
<p>UX designer: 先把這問題放一旁，這需要多次迭代才能確定這是他們想要的 … 如果他們需要高效工作，則這個方式可能比較好。</p>
<blockquote>
<p>[QA]: What if an ad coes in at exactly the same time as a chat ?</p>
</blockquote>
<p>QA: 那如果廣告作為一個新的聊天訊息出場的話呢？</p>
<blockquote>
<p>[UX designer]: That’s extreme edge case and probably very hard to test. So leave it. QA agrees.</p>
</blockquote>
<p>UX designer: 這是一個相當極端的方式，非常難測試，所以先不要管這個。</p>
<p>這些對話通常在每一天的工作中進行，詢問另外一個團隊問題，而另外的團隊注意這些問題。</p>
<blockquote>
<p>[UX designer]: “… if developers come up with issues, these are discussed on a case-by-case basis as they come up … There are lots of small things which are easily worked out on a day-to-day basis”</p>
</blockquote>
<p>UX designer: 如果 developer 在每一個 case 基礎上想出了問題，這些小問題很容易在每日解決。</p>
<p>從會議過程中，主要，我們可以發現的每一個角色都參與了 UX design，同時也在職權外貢獻了他們的想法 - 例如 UX designer 建議在極端情況忽略 QA testing，而在 QA 沒有指責 UX designer 所做的 QA 決策，他們接受這項意見並沒有發出任何評論。其次，在這個 UX design 討論議題中也一起討論了 non-UX 的問題(如這個 QA testing 問題)。</p>
<p>這次的會議的下一步行動，包括實現解決方案和傳達問題給客戶。所有的角色參與討論導致決策同時考慮的設計價值和技術考量。</p>
<p>而在會議中，有 developer 向其他人簡單說明，他在網路空間上有一些之前專案製作時替換視覺設計的文件可以參考，這可以讓 UI designer 可以接受這些更改的項目，增加信服力。</p>
<blockquote>
<p>[UX designer]: Sometimes the developers’ decisions are better, as they are much closer to the implementation. 有時候開發者的決策會更好，因為他們更接近實作。</p>
</blockquote>
<h2 id="Study-3"><a href="#Study-3" class="headerlink" title="Study 3"></a>Study 3</h2><p>在非常小的公司進行，有 1 名 developer 和 2 名 UX designer，他們擅長瀑布形式的開發，在開發過程中 developer 和 UX designer 在同一間辦公室工作，目標是使得設計和開發更接近。正如 Study 1 的時候，發現 developer 會根據 UX designer 設計的線框 (wireframe) 和 visual design 努力地工作。</p>
<p>觀察兩天後的結果如下:</p>
<p>在一般的情況下，UX designer 通常和 developer 在不同樓層工作，developer 也表示他們很少去找 designer 討論遭遇的問題。</p>
<blockquote>
<p>[developer]: We often find things that don’t work, but we don’t go back to design. We just do our best. 我們常發現很多事情並不會 work，但是並沒有回去檢討設計，單純盡力而為。</p>
</blockquote>
<p>在這種共同工作的情況下，designer 給予了一些回應。</p>
<blockquote>
<p>[UX designer]: This style of working means we can collaborate in order to get our points across, rather than dictate because there’s no communication going on. 這種工作方式可以讓我們的觀點交換，而不是因為沒有通通合作的命令。</p>
<p>[Head of UX]: And when we first met with the client, the first thing they did was to present to us the findings of that initial research. So we can then go and propose what would bee the next step, which is quite different from any other type of work we’ve been invited to get involved in.</p>
</blockquote>
<p>在大多數的情況，不確定性，設計師在現場談話的記錄:</p>
<blockquote>
<p>[visual designer]: I just feel like I’m not getting any-where.</p>
<p>[IA]: I also feel that way.</p>
</blockquote>
<p>但是對於另一個情況下</p>
<blockquote>
<p>[developer]: Just cover the site map.</p>
</blockquote>
<p>developer 和 designer 共同工作</p>
<ul>
<li>可以相互討論跟顧客對談時的內容 (當時在場的感受不同)</li>
<li>目標計劃做些什麼，訊息可以提前知道。(想要做第二個版本)</li>
<li>「這個設計會不會很難實作？」這些問題將會很快被反應出來。</li>
</ul>
<blockquote>
<p>[developer]: It would probably be just as easy.</p>
</blockquote>
<hr>
<h1 id="THEME-FOR-ACHIEVING-INTEGRATION"><a href="#THEME-FOR-ACHIEVING-INTEGRATION" class="headerlink" title="THEME FOR ACHIEVING INTEGRATION"></a>THEME FOR ACHIEVING INTEGRATION</h1><h2 id="A-Integration-as-expectations-about-acceptable-behaviour"><a href="#A-Integration-as-expectations-about-acceptable-behaviour" class="headerlink" title="A. Integration as expectations about acceptable behaviour"></a>A. Integration as expectations about acceptable behaviour</h2><p>在 Study 1 中可以發現，如果將兩者隔離，很容易造成規劃的浪費和開發者在最後期限前超時工作。UX designer 同時跨越多個專案進行設計，丟出設計之後就沒有可接收開發者的反饋，只有等到 sprint meeting 的反應才重新設計，這時可能已經為期已晚。</p>
<p>在 Study 2 中可以發現，頻繁確保兩者之間有相互支持，並且在 UX design 和代碼之間可以互相溝通，相較于 Study 1 上，溝通性有上升，但這些遭遇的問題將會在每個人參與討論會議的過程中的一部份。</p>
<p>在 Study 3 中，每一個成員都有機會被其他角色問到自己領域的問題，同時也可以在與客戶討論中的觀察，在隨後討論。這都歸因于他們在同一間辦公室工作。</p>
<h2 id="B-Integration-as-mutual-awareness"><a href="#B-Integration-as-mutual-awareness" class="headerlink" title="B. Integration as mutual awareness"></a>B. Integration as mutual awareness</h2><p>相對于 Study 1 中，Study 2, 3 擁有了共同享有決策的責任，同時提高了互動上的認識。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/compiler-clg-ll(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/11/lesson/compiler-clg-ll(1)/" class="article-date">
  <time datetime="2014-05-11T14:36:41.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/編譯器/">編譯器</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/11/lesson/compiler-clg-ll(1)/">編譯器 Compiler CFG LL(1)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/" data-id="cimum6q1f01uph3xcm7kbknqm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CFG/">CFG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/First-Set/">First Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Follow-Set/">Follow Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LL-1/">LL(1)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/編譯器/">編譯器</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="序文"><a href="#序文" class="headerlink" title="序文"></a>序文</h1><p>相較於其他技術而言，編譯器的確不是什麼有趣的課程，在這一門領域專研的人也變少了，所以專精的人越少，將會越有機會。易見地，也越來越少大學開設這門編譯器的課程，不過在一些公司，編譯器的技術將成為私囊秘寶，如何將代碼更加地優化快速，這就是相當令人感到為之一驚的地方。</p>
<h1 id="DFA-NFA-Regular-expression"><a href="#DFA-NFA-Regular-expression" class="headerlink" title="DFA, NFA, Regular expression"></a>DFA, NFA, Regular expression</h1><p>在討論所有語法前，要明白正規表達式 ( Regular expression = RegExp ) 的運作，RegExp 運作上涵蓋的語法集合是最小的，對於一個 RegExp 來說，可以轉換成具有 n 個狀態的 NFA，而這台 NFA 可以轉換成 2<sup>n</sup> 狀態的 DFA。</p>
<p>NFA 和 DFA 最大的不同在於轉移狀態時，考慮的路徑情況，NFA 可以在不考慮輸入進行轉移，或者在相同情況下可以有很多轉移選擇。 DFA 則必須在一個輸入唯一一個轉移情況下運作。</p>
<img src="/img/500px-DFAexample.svg.png" title="DFA">
<p>如上圖 DFA 所示，邊上的內容就是根據輸入的情況進行轉移。</p>
<img src="/img/423px-NFASimpleExample.svg.png" title="NFA">
<p>如上圖 NFA 所示，會發現狀態 <code>p</code> 對於輸入 <code>1</code> 有 2 種轉移可能 (<code>p-&gt;p</code> or <code>p-&gt;q</code>)。</p>
<p>最後可以得到一個 RegExp 一定會有一台 DFA 辨識它。而一台 DFA 也一定會有一個 RegExp，這句話的含意將可以在 <code>計算理論</code> 這門課中學到如何藉由類似 <code>Floyd Algorithm</code> 內點性質依序推出 DFA 對應的 RegExp。</p>
<h1 id="CFG-Context-free-grammar"><a href="#CFG-Context-free-grammar" class="headerlink" title="CFG (Context-free grammar)"></a>CFG (Context-free grammar)</h1><p>A context-free grammar is a formal system that describes a language by specifying how any legal string (i.e., sequence of tokens) can be derived from a start symbol. It consists of a set of productions, each of which states that a given symbol can be replaced by a given sequence of symbols. </p>
<p>另一個類似的語言是 <code>Context-sensitive grammar</code>，等價性質的兄弟是 <code>Chomsky normal form</code>。</p>
<ul>
<li><p>CFG <code>G = (Vt, Vn, S, P)</code></p>
<ul>
<li>Vt: 有限的 terminal 字符集</li>
<li>Vn: 有限的 nonterminal 字符集</li>
<li>S: 一開始出發的 start symbol</li>
<li>P: 轉換的規則 (production)</li>
<li><p>來個例子</p>
<pre><code>LHS (left-hand side) -&gt; RHS (right-hand side)

&lt;E&gt;         -&gt; &lt;Prefix&gt; ( &lt;E&gt; )
&lt;E&gt;         -&gt; V &lt;Tail&gt;
&lt;Prefix&gt;    -&gt; F
&lt;Prefix&gt;    -&gt; l
&lt;Tail&gt;      -&gt; + &lt;E&gt;
&lt;Tail&gt;      -&gt; l
</code></pre><p>明顯地</p>
<ul>
<li><code>Vt = {(, ), V, F, l, +}</code></li>
<li><code>Vn = {&lt;E&gt;, &lt;Prefix&gt;, &lt;Tail&gt;}</code></li>
<li><code>S = &lt;E&gt;</code></li>
<li><code>P</code> 就是給定那六條規規則</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>名詞<ul>
<li><em>Sentential form</em><br>  If S =&gt;<sup>*</sup> β, β then is said to be <em>sentential form</em> of the CFG<br>  簡單來說，所有從 start symbol 過程中替換出來的句子都稱為 sentential form。</li>
<li><em>Handle</em> of a sentential form<br>  The handle of a sentential form is the left-most simple phrase.<br>  <img src="/img/ch07-tree-1.png" alt="img"><br>  簡單來說，就是將一個 nonterminal 根據 production 轉換成 RHS (right-hand side) 的一個步驟。</li>
</ul>
</li>
</ul>
<ul>
<li>什麼是 CFG (上下文無關語法)？<br>  簡單來說，還真的是上下文無關，例如 <code>S -&gt; AB</code> 可以見到 S 轉換時，不會因為前文或後文是什麼內容而影響，而在 <code>Context-sensitive grammar</code> (上下文敏感) 可以見到 <code>aSb -&gt; AB</code> 會因為前面跟後面所受到的影響。</li>
</ul>
<blockquote>
<p>這裡使用大寫為 nontermainl，其他字符為 terminal。</p>
</blockquote>
<h2 id="First-Set"><a href="#First-Set" class="headerlink" title="First Set"></a>First Set</h2><ul>
<li>First(A)<ul>
<li>The set of all the <em>terminal</em> symbols that can <em>begin</em> a sentential form <em>derivable from</em> A. <code>A =&gt;* aB</code><pre><code>First(A) = {
    a in Vt | A =&gt;* aB, and
    Λ in Vt | A =&gt;* Λ
}
</code></pre></li>
<li>簡單地說，從這個 nonterminal 開始，第一個不能被替換的 terminal 就會在 First set 中。</li>
</ul>
</li>
<li>計算 <code>First(A)</code> 前，必須先建出這個 nonterminal 有沒有可能推出 Λ，即 <code>A =&gt;* Λ</code>。<br>這邊相當有意思，使用迭代更新，如果發現 <code>B =&gt;* Λ</code> 和 <code>C =&gt;* Λ</code> 則對於 Production <code>A =&gt; BC</code> 來說，可以得到 <code>A =&gt;* Λ</code> 就這麼依序推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
<li>計算 <code>First(A)</code> 時，掃描規則 <code>LHS =&gt; RHS</code>，找到 <code>First(RHS)</code> 並且 <code>First(LHS).insert(First(RHS))</code>，依樣使用迭代更新推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
</ul>
<h2 id="Follow-Set"><a href="#Follow-Set" class="headerlink" title="Follow Set"></a>Follow Set</h2><ul>
<li>Follow(A)<ul>
<li><em>A</em> is any nonterminal</li>
<li>Follow(A) is <em>the set of terminals</em> that may follow <em>A</em> in some sentential form. <code>S =&gt;* ... Aabc ...</code>follow set。<pre><code>Follow(A) = {
    a in Vt | S =&gt;* ... Aa ..., and
    Λ in Vt | S =&gt;* aA
}
</code></pre></li>
<li>請切記，一定要從 start symbol 開始替換的所有句子，而在這個 nonterminal 隨後可能跟著的 termainl 就會屬於它的。</li>
</ul>
</li>
<li>計算 <code>Follow(A)</code> 前，請先把 First set 都算完，接著也是用迭代更新，掃描規則 <code>A -&gt; a B b</code><br>對於 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if Λ not in First(b)</span><br><span class="line">    Follow(B).insert(First(b))</span><br><span class="line">else</span><br><span class="line">    Follow(B).insert(First(b) - Λ)</span><br><span class="line">    Follow(B).insert(Follow(A))</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">## Predict Set ##</span><br><span class="line"></span><br><span class="line">* Given the productions</span><br><span class="line">* During a (leftmost) derivation, Deciding which production to match, Using lookahead symbols</span><br><span class="line">* 相較於 First set 和 Follow set，Predict Set 是根據 Production 產生的，也就是說一條 production 會有一個對應的 predict set，而 First set 和 Follow set 都是根據 nonterminal 產生一對一對應的集合，用來預測這一條規則的第一個 terminal 會有哪些。</span><br><span class="line"></span><br><span class="line">對於 production : `A -&gt; X1 X2 ... Xm`</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>if Λ in First(X1 X2 … Xm)<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm) - Λ);<br>    Predict(A -&gt; X1 X2 … Xm).insert(Follow(A));<br>else<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">對於第一判斷情況在于 `... AE = ... X1 X2 ... Xm E`，明顯地可以從 `Follow(A)` 得到第一個字符為何。</span><br><span class="line"></span><br><span class="line">## LL(1) Table ##</span><br><span class="line">&gt; 尚未撰寫</span><br><span class="line"></span><br><span class="line">C++ code</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">## 資料規格 ##</span><br><span class="line"></span><br><span class="line">以下代碼實作 CFG 的 First Set, Follow Set, Predict Set 和 LL(1) Table。</span><br><span class="line"></span><br><span class="line">用字符 `l` 代替 lambda</span><br><span class="line"></span><br><span class="line">## 資料範例 ##</span><br><span class="line"></span><br><span class="line">* 本課程簡易範例輸入</span><br></pre></td></tr></table></figure></p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>A-&gt;BaAb<br>A-&gt;cC<br>B-&gt;d<br>B-&gt;l<br>C-&gt;eA<br>C-&gt;l</p>
<p>A-&gt;aAd<br>A-&gt;B<br>B-&gt;bBd<br>B-&gt;C<br>C-&gt;cCd<br>C-&gt;l</p>
<p>E-&gt;TX<br>X-&gt;+E<br>X-&gt;#<br>T-&gt;(E)<br>T-&gt;intY<br>Y-&gt;*T<br>Y-&gt;#</p>
<p>E-&gt;P(E)<br>E-&gt;vT<br>P-&gt;f<br>P-&gt;l<br>T-&gt;+E<br>T-&gt;l</p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>S-&gt;ABc<br>A-&gt;a<br>A-&gt;l<br>B-&gt;b<br>B-&gt;l</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 本課程簡易範例輸出</span><br></pre></td></tr></table></figure>
<p>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,c,d<br>B:d,l<br>C:e,l<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,b,c,l<br>B:b,c,l<br>C:c,l<br>a:a<br>b:b<br>c:c<br>d:d</p>
<p>#:#<br>(:(<br>):)<br><em>:</em><br>+:+<br>E:(,i<br>T:(,i<br>X:#,+<br>Y:#,*<br>i:i<br>n:n<br>t:t<br>(:(<br>):)<br>+:+<br>E:(,f,v<br>P:f,l<br>T:+,l<br>f:f<br>v:v<br>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,l<br>B:b,l<br>S:a,b,c<br>a:a<br>b:b<br>c:c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- - - - -</span><br><span class="line"></span><br><span class="line">* HTML 格式範例輸入</span><br></pre></td></tr></table></figure></p>
<p> <program>            -&gt; begin <statement_list> end<br> <statement_list>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; l<br> <statement>        -&gt; ID := <expression> ;<br> <statement>        -&gt; read ( <id_list> ) ;<br> <statement>        -&gt; write ( <expr_list> ) ;<br> <id_list>            -&gt; ID <id_tail><br> <id_tail>            -&gt; , ID <id_tail><br> <id_tail>            -&gt; l<br> <expr_list>        -&gt; <expression> <expr_tail><br> <expr_tail>        -&gt; , <expression> <expr_tail><br> <expr_tail>        -&gt; l<br> <expression>        -&gt; <primary> <primary_tail><br> <primary_tail>        -&gt; <add_op>    <primary> <primary_tail><br> <primary_tail>        -&gt; l<br> <primary>            -&gt; ( <expression> )<br> <primary>            -&gt; ID<br> <primary>            -&gt; INTLIT<br> <add_op>            -&gt; +<br> <add_op>            -&gt; -<br> <system_goal>        -&gt; <program> $</program></system_goal></add_op></add_op></primary></primary></expression></primary></primary_tail></primary_tail></primary></add_op></primary_tail></primary_tail></primary></expression></expr_tail></expr_tail></expression></expr_tail></expr_tail></expression></expr_list></id_tail></id_tail></id_tail></id_tail></id_list></expr_list></statement></id_list></statement></expression></statement></statement_tail></statement_tail></statement></statement_tail></statement_tail></statement></statement_list></statement_list></program></p>
<p> begin ID := ID - INTLIT + ID ; end $<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* HTML 格式範例輸出</span><br></pre></td></tr></table></figure></p>
<p>+—————-+—– First set —–+<br>|$               | { $ }<br>|(               | { ( }<br>|)               | { ) }<br>|+               | { + }<br>|,               | { , }<br>|-               | { - }<br>|:=              | { := }<br>|;               | { ; }<br>|<add_op>        | { + - }<br>|<expr_list>     | { ( ID INTLIT }<br>|<expr_tail>     | { , l }<br>|<expression>    | { ( ID INTLIT }<br>|<id_list>       | { ID }<br>|<id_tail>       | { , l }<br>|<primary>       | { ( ID INTLIT }<br>|<primary_tail>  | { + - l }<br>|<program>       | { begin }<br>|<statement>     | { ID read write }<br>|<statement_list>| { ID read write }<br>|<statement_tail>| { ID l read write }<br>|<system_goal>   | { begin }<br>|ID              | { ID }<br>|INTLIT          | { INTLIT }<br>|begin           | { begin }<br>|end             | { end }<br>|read            | { read }<br>|write           | { write }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– Follow set —–+<br>|<add_op>        | { ( ID INTLIT }<br>|<expr_list>     | { ) }<br>|<expr_tail>     | { ) }<br>|<expression>    | { ) , ; }<br>|<id_list>       | { ) }<br>|<id_tail>       | { ) }<br>|<primary>       | { ) + , - ; }<br>|<primary_tail>  | { ) , ; }<br>|<program>       | { $ }<br>|<statement>     | { ID end read write }<br>|<statement_list>| { end }<br>|<statement_tail>| { end }<br>|<system_goal>   | { l }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– LL(1) table —–+<br>|                |     $|     (|     )|     +|     ,|     -|    :=|     ;|    ID|INTLIT| begin|   end|  read| write|<br>|<add_op>        |      |      |      |    20|      |    21|      |      |      |      |      |      |      |      |<br>|<expr_list>     |      |    11|      |      |      |      |      |      |    11|    11|      |      |      |      |<br>|<expr_tail>     |      |      |    13|      |    12|      |      |      |      |      |      |      |      |      |<br>|<expression>    |      |    14|      |      |      |      |      |      |    14|    14|      |      |      |      |<br>|<id_list>       |      |      |      |      |      |      |      |      |     8|      |      |      |      |      |<br>|<id_tail>       |      |      |    10|      |     9|      |      |      |      |      |      |      |      |      |<br>|<primary>       |      |    17|      |      |      |      |      |      |    18|    19|      |      |      |      |<br>|<primary_tail>  |      |      |    16|    15|    16|    15|      |    16|      |      |      |      |      |      |<br>|<program>       |      |      |      |      |      |      |      |      |      |      |     1|      |      |      |<br>|<statement>     |      |      |      |      |      |      |      |      |     5|      |      |      |     6|     7|<br>|<statement_list>|      |      |      |      |      |      |      |      |     2|      |      |      |     2|     2|<br>|<statement_tail>|      |      |      |      |      |      |      |      |     3|      |      |     4|     3|     3|<br>|<system_goal>   |      |      |      |      |      |      |      |      |      |      |    22|      |      |      |<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>Process syntax accept</p>
<p>```</p>
<h2 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h2><p>2014/6/1 修正 parsing 時的 lambda 問題。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt; </span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;map&gt;</span><br><span class="line">#include &lt;set&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;stack&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">#define HTMLProduction</span><br><span class="line"></span><br><span class="line">class Production &#123;</span><br><span class="line">    public:</span><br><span class="line">        string 			LHS;</span><br><span class="line">        vector&lt;string&gt; 	RHS;</span><br><span class="line">        int 			label;</span><br><span class="line">        </span><br><span class="line">        Production(string L = "", vector&lt;string&gt; R = vector&lt;string&gt;()) &#123;</span><br><span class="line">            LHS = L;</span><br><span class="line">            RHS = R;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        void print() &#123;</span><br><span class="line">            printf("%s -&gt; ", LHS.c_str());</span><br><span class="line">            for(size_t i = 0; i &lt; RHS.size(); i++)</span><br><span class="line">                printf("%s", RHS[i].c_str());</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line">class Grammar &#123;</span><br><span class="line">    public:</span><br><span class="line">        static const string 		lambda;</span><br><span class="line">        string 						start_symbol;</span><br><span class="line">        vector&lt;Production&gt; 			rules;</span><br><span class="line">        map&lt;string, set&lt;string&gt; &gt; 	first_set;</span><br><span class="line">        map&lt;string, set&lt;string&gt; &gt; 	follow_set;</span><br><span class="line">        map&lt;string, bool&gt; 			derives_lambda;</span><br><span class="line">        map&lt;string, map&lt;string, Production&gt; &gt;	lltable;</span><br><span class="line">        </span><br><span class="line">        map&lt;string, bool&gt; mark_lambda();</span><br><span class="line">        void fill_first_set();</span><br><span class="line">        void fill_follow_set();</span><br><span class="line">        bool isNonterminal(string token);</span><br><span class="line">        set&lt;string&gt; compute_first(vector&lt;string&gt; rhs);</span><br><span class="line">        set&lt;string&gt; get_predict_set(Production p);</span><br><span class="line">        void fill_lltable();</span><br><span class="line">        void lldriver(queue&lt;string&gt; tokens);</span><br><span class="line">&#125;;</span><br><span class="line">const string Grammar::lambda("l");</span><br><span class="line"></span><br><span class="line">set&lt;string&gt; Grammar::compute_first(vector&lt;string&gt; rhs) &#123;</span><br><span class="line">    set&lt;string&gt; result;</span><br><span class="line">    size_t i;</span><br><span class="line">    </span><br><span class="line">    if(rhs.size() == 0 || rhs[0] == Grammar::lambda) &#123;</span><br><span class="line">        result.insert(Grammar::lambda);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        result = first_set[rhs[0]];</span><br><span class="line">        for(i = 1; i &lt; rhs.size() &amp;&amp; </span><br><span class="line">            first_set[rhs[i-1]].find(Grammar::lambda) != first_set[rhs[i-1]].end(); i++) &#123;</span><br><span class="line">            set&lt;string&gt; f = first_set[rhs[i]];</span><br><span class="line">            f.erase(Grammar::lambda);</span><br><span class="line">            result.insert(f.begin(), f.end());	</span><br><span class="line">        &#125;</span><br><span class="line">        if(i == rhs.size() </span><br><span class="line">            &amp;&amp; first_set[rhs[i-1]].find(Grammar::lambda) != first_set[rhs[i-1]].end()) &#123;</span><br><span class="line">            result.insert(Grammar::lambda);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            result.erase(Grammar::lambda);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125; </span><br><span class="line">/*</span><br><span class="line"> * please call get_predict_set() after fill_follow_set() and fill_first_set()</span><br><span class="line"> */</span><br><span class="line">set&lt;string&gt; Grammar::get_predict_set(Production p) &#123;</span><br><span class="line">    set&lt;string&gt; result;</span><br><span class="line">    set&lt;string&gt; rfirst;</span><br><span class="line">    </span><br><span class="line">    rfirst = compute_first(p.RHS);</span><br><span class="line">    if(rfirst.find(Grammar::lambda) != rfirst.end()) &#123;</span><br><span class="line">        rfirst.erase(Grammar::lambda);</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">        rfirst = follow_set[p.LHS];</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">void Grammar::fill_lltable() &#123;</span><br><span class="line">    string		A; // nonterminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        p = rules[i];</span><br><span class="line">        A = p.LHS;</span><br><span class="line">        set&lt;string&gt; predict_set = get_predict_set(p);</span><br><span class="line">        </span><br><span class="line">        for(set&lt;string&gt;::iterator it = predict_set.begin();</span><br><span class="line">            it != predict_set.end(); it++) &#123;</span><br><span class="line">            assert(lltable[A].find(*it) == lltable[A].end());</span><br><span class="line">            lltable[A][*it] = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">bool Grammar::isNonterminal(string token) &#123;</span><br><span class="line"></span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">    if(token == Grammar::lambda)</span><br><span class="line">        return false;</span><br><span class="line">    if(token[0] == '&lt;' &amp;&amp; token[token.length() - 1] == '&gt;')</span><br><span class="line">        return true;</span><br><span class="line">    return false;</span><br><span class="line">#else</span><br><span class="line">    if(token == Grammar::lambda)</span><br><span class="line">        return false;</span><br><span class="line">    for(size_t i = 0; i &lt; token.length(); i++) &#123;</span><br><span class="line">        if(isupper(token[i]))</span><br><span class="line">            return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br><span class="line">map&lt;string, bool&gt; Grammar::mark_lambda() &#123;</span><br><span class="line">    bool 				rhs_derives_lambda;</span><br><span class="line">    bool 				changes;</span><br><span class="line">    Production 			p;</span><br><span class="line">    </span><br><span class="line">    derives_lambda.clear();</span><br><span class="line">    </span><br><span class="line">    /* initially, nothing is marked. */</span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        derives_lambda[rules[i].LHS] = false;</span><br><span class="line">    &#125;</span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            p = rules[i];</span><br><span class="line">            if(!derives_lambda[p.LHS]) &#123;</span><br><span class="line">                if(p.RHS.size() == 0 || p.RHS[0] == Grammar::lambda) &#123;</span><br><span class="line">                    changes = derives_lambda[p.LHS] = true;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                /* does each part of RHS derive lambda ? */</span><br><span class="line">                rhs_derives_lambda = derives_lambda[string(p.RHS[0])];</span><br><span class="line">                for(size_t j = 1; j &lt; p.RHS.size(); j++) &#123;</span><br><span class="line">                    rhs_derives_lambda &amp;= derives_lambda[p.RHS[j]];</span><br><span class="line">                &#125;</span><br><span class="line">                if(rhs_derives_lambda) &#123;</span><br><span class="line">                    changes = true;</span><br><span class="line">                    derives_lambda[p.LHS] = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">    return derives_lambda;</span><br><span class="line">&#125;</span><br><span class="line">void Grammar::fill_first_set() &#123;</span><br><span class="line">    </span><br><span class="line">    string 		A; // nonterminal</span><br><span class="line">    string 		a; // terminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    bool 		changes;</span><br><span class="line">        </span><br><span class="line">    mark_lambda();</span><br><span class="line">    first_set.clear();</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        A = rules[i].LHS;</span><br><span class="line">        if(derives_lambda[A])</span><br><span class="line">            first_set[A].insert(Grammar::lambda);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        for(size_t j = 0; j &lt; rules[i].RHS.size(); j++) &#123;</span><br><span class="line">            a = rules[i].RHS[j];</span><br><span class="line">            if(!isNonterminal(a)) &#123;</span><br><span class="line">                if(a != Grammar::lambda)</span><br><span class="line">                    first_set[a].insert(a);</span><br><span class="line">                if(j == 0) &#123; // A -&gt; aXX</span><br><span class="line">                    first_set[rules[i].LHS].insert(a);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            p = rules[i];</span><br><span class="line">            set&lt;string&gt; rfirst = compute_first(p.RHS);</span><br><span class="line">            size_t oldsize = first_set[p.LHS].size();</span><br><span class="line">            first_set[p.LHS].insert(rfirst.begin(), rfirst.end());</span><br><span class="line">            size_t newsize = first_set[p.LHS].size();</span><br><span class="line">            if(oldsize != newsize)</span><br><span class="line">                changes = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">void Grammar::fill_follow_set() &#123;</span><br><span class="line">    string 	A, B; // nonterminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    bool 	changes;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        A = rules[i].LHS;</span><br><span class="line">        follow_set[A].clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    follow_set[start_symbol].insert(Grammar::lambda);</span><br><span class="line">        </span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            /* A -&gt; a B b</span><br><span class="line">             * I.e. for each production and each occurrence</span><br><span class="line">             * of a nonterminal in its right-hand side. </span><br><span class="line">             */</span><br><span class="line">            p = rules[i];</span><br><span class="line">            A = p.LHS;</span><br><span class="line">            for(size_t j = 0; j &lt; p.RHS.size(); j++) &#123;</span><br><span class="line">                B = p.RHS[j];</span><br><span class="line">                if(isNonterminal(B)) &#123;</span><br><span class="line">                    vector&lt;string&gt; beta(p.RHS.begin() + j + 1, p.RHS.end());</span><br><span class="line">                    set&lt;string&gt; rfirst = compute_first(beta);</span><br><span class="line">                    size_t oldsize = follow_set[B].size();</span><br><span class="line">                    </span><br><span class="line">                    if(rfirst.find(Grammar::lambda) == rfirst.end()) &#123;</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        rfirst.erase(Grammar::lambda);</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</span><br><span class="line">                        rfirst = follow_set[A];</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());</span><br><span class="line">                    &#125;</span><br><span class="line">                    size_t newsize = follow_set[B].size();			</span><br><span class="line">                    if(oldsize != newsize)</span><br><span class="line">                        changes = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Grammar::lldriver(queue&lt;string&gt; tokens) &#123;</span><br><span class="line">    stack&lt;string&gt; 	stk;</span><br><span class="line">    string 			X;</span><br><span class="line">    string			a;</span><br><span class="line">    Production		p;</span><br><span class="line">    /* Push the Start Symbol onto an empty stack */</span><br><span class="line">    stk.push(start_symbol);</span><br><span class="line">    </span><br><span class="line">    while(!stk.empty() &amp;&amp; !tokens.empty()) &#123;</span><br><span class="line">        X = stk.top();</span><br><span class="line">        a = tokens.front();</span><br><span class="line">        // cout &lt;&lt; X &lt;&lt; " " &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">        if(isNonterminal(X) &amp;&amp; lltable[X].find(a) != lltable[X].end()) &#123;</span><br><span class="line">            p = lltable[X][a];</span><br><span class="line">            stk.pop();</span><br><span class="line">            for(int i = p.RHS.size() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">                if(p.RHS[i] == Grammar::lambda)</span><br><span class="line">                    continue;</span><br><span class="line">                stk.push(p.RHS[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if(X == a) &#123;</span><br><span class="line">            stk.pop();</span><br><span class="line">            tokens.pop();</span><br><span class="line">        &#125; else if(lltable[X].find(Grammar::lambda) != lltable[X].end()) &#123;</span><br><span class="line">            stk.pop();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            /* Process syntax error. */</span><br><span class="line">            puts("Bad!");</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while(!stk.empty()) &#123;</span><br><span class="line">        X = stk.top();</span><br><span class="line">        if(lltable[X].find(Grammar::lambda) != lltable[X].end())</span><br><span class="line">            stk.pop();</span><br><span class="line">        else</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(tokens.size() == 0 &amp;&amp; stk.size() == 0)</span><br><span class="line">        puts("Good");</span><br><span class="line">    else</span><br><span class="line">        puts("Bad!");</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">queue&lt;string&gt; getTokens(char s[]) &#123;</span><br><span class="line">    stringstream 	sin(s);</span><br><span class="line">    queue&lt;string&gt; 	tokens;</span><br><span class="line">    string			token;</span><br><span class="line">    while(sin &gt;&gt; token)</span><br><span class="line">        tokens.push(token);</span><br><span class="line">    return tokens;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void parsingProduction(string r, Grammar &amp;g) &#123;</span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">    static int 		production_label = 0;</span><br><span class="line">    stringstream 	sin(r);</span><br><span class="line">    string 			lhs, foo;</span><br><span class="line">    vector&lt;string&gt; 	tokens;</span><br><span class="line">    sin &gt;&gt; lhs &gt;&gt; foo;</span><br><span class="line">    while(sin &gt;&gt; foo)</span><br><span class="line">        tokens.push_back(foo);</span><br><span class="line">    Production p(lhs, tokens);</span><br><span class="line">    p.label = ++production_label;</span><br><span class="line">    g.rules.push_back(p);</span><br><span class="line">#else</span><br><span class="line">    string div("-&gt;");</span><br><span class="line">    size_t found = r.find(div);</span><br><span class="line">    if(found != std::string::npos) &#123;</span><br><span class="line">        string rhs = r.substr(found + div.length());</span><br><span class="line">        vector&lt;string&gt; tokens;</span><br><span class="line">        for(size_t i = 0; i &lt; rhs.size(); i++)</span><br><span class="line">            tokens.push_back(rhs.substr(i, 1));</span><br><span class="line">        Production p(r.substr(0, found), tokens);</span><br><span class="line">        g.rules.push_back(p);</span><br><span class="line">    &#125;</span><br><span class="line">#endif</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    </span><br><span class="line">    //freopen("input.txt", "r+t", stdin);</span><br><span class="line">    //freopen("output.txt", "w+t", stdout); </span><br><span class="line">    </span><br><span class="line">    char in[1024];</span><br><span class="line">    while(gets(in)) &#123;</span><br><span class="line">        Grammar g;</span><br><span class="line">        parsingProduction(in, g);</span><br><span class="line">        while(gets(in) &amp;&amp; in[0] != '\0') &#123;</span><br><span class="line">            parsingProduction(in, g);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">        g.start_symbol = "&lt;system_goal&gt;";</span><br><span class="line">#else</span><br><span class="line">        g.start_symbol = "S";</span><br><span class="line">#endif</span><br><span class="line">        </span><br><span class="line">        g.fill_first_set();</span><br><span class="line">        g.fill_follow_set();</span><br><span class="line">        g.fill_lltable();</span><br><span class="line">        </span><br><span class="line">        puts("+----------------+----- First set -----+");</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator it = g.first_set.begin();</span><br><span class="line">            it != g.first_set.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s| &#123;", it-&gt;first.c_str());</span><br><span class="line">            for(set&lt;string&gt;::iterator jt = it-&gt;second.begin();</span><br><span class="line">                jt != it-&gt;second.end(); jt++) &#123;</span><br><span class="line">                cout &lt;&lt; " " &lt;&lt; *jt;</span><br><span class="line">            &#125;</span><br><span class="line">            puts(" &#125;");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">        puts("+----------------+----- Follow set -----+");</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator it = g.follow_set.begin();</span><br><span class="line">            it != g.follow_set.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s| &#123;", it-&gt;first.c_str());</span><br><span class="line">            for(set&lt;string&gt;::iterator jt = it-&gt;second.begin();</span><br><span class="line">                jt != it-&gt;second.end(); jt++) &#123;</span><br><span class="line">                cout &lt;&lt; " " &lt;&lt; *jt;</span><br><span class="line">            &#125;</span><br><span class="line">            puts(" &#125;");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">        puts("+----------------+----- LL(1) table -----+");</span><br><span class="line">        printf("|%-16s|", "");			</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator jt = g.first_set.begin();</span><br><span class="line">                jt != g.first_set.end(); jt++) &#123;</span><br><span class="line">            string A = jt-&gt;first;</span><br><span class="line">            if(g.isNonterminal(A))</span><br><span class="line">                continue;</span><br><span class="line">            printf("%6s|", A.c_str());</span><br><span class="line">        &#125;</span><br><span class="line">        puts("");</span><br><span class="line">        for(map&lt;string, map&lt;string, Production&gt; &gt;::iterator it = g.lltable.begin();</span><br><span class="line">            it != g.lltable.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s|", it-&gt;first.c_str());</span><br><span class="line">            for(map&lt;string, set&lt;string&gt; &gt;::iterator jt = g.first_set.begin();</span><br><span class="line">                jt != g.first_set.end(); jt++) &#123;</span><br><span class="line">                string A = jt-&gt;first;</span><br><span class="line">                if(g.isNonterminal(A))</span><br><span class="line">                    continue;</span><br><span class="line">                if(it-&gt;second.find(A) == it-&gt;second.end()) </span><br><span class="line">                    printf("%6s|", "");</span><br><span class="line">                else</span><br><span class="line">                    printf("%6d|", it-&gt;second[A].label);</span><br><span class="line">            &#125;</span><br><span class="line">            puts("");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">        gets(in);</span><br><span class="line">        g.lldriver(getTokens(in));</span><br><span class="line">#endif</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h1><p>要學會更多，請修 <code>計算理論</code> 這門課程。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/new-methodology" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/04/21/lesson/new-methodology/" class="article-date">
  <time datetime="2014-04-21T08:09:04.000Z" itemprop="datePublished">2014-04-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/21/lesson/new-methodology/">軟體開發方法論(翻譯部分內容)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/04/21/lesson/new-methodology/" data-id="cimum6q2t01vfh3xcoxwto7x3" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/04/21/lesson/new-methodology/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/軟體開發/">軟體開發</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="長篇大論"><a href="#長篇大論" class="headerlink" title="長篇大論"></a>長篇大論</h1><p>只求軟體開發的工程方法，最近上敏捷方法，教授開始講到了始祖 …</p>
<p>於是上演了輪番翻譯的戲碼，讓各種同學參與這份大型工程，關於翻譯的同時，深刻地理解到這也是為什麼無法接觸國外的最新資訊啊，曲解、誤解、亂解 …</p>
<blockquote>
<p>我的語言記憶體如此小，卻搭載世界最複雜的語言。</p>
</blockquote>
<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><blockquote><p>In the past few years there’s been a blossoming of a new style of software methodology - referred to as agile methods. Alternatively characterized as an antidote to bureaucracy or a license to hack they’ve stirred up interest all over the software landscape. In this essay I explore the reasons for agile methods, focusing not so much on their weight but on their adaptive nature and their people-first orientation. </p>
<footer><strong>Martin Fowler</strong><cite><a href="http://www.martinfowler.com/articles/newMethodology.html" target="_blank" rel="external">The New Methodology</a></cite></footer></blockquote>
<p>Probably the most noticeable change to software process thinking in the last few years has been the appearance of the word ‘agile’. We talk of agile software methods, of how to introduce agility into a development team, or of how to resist the impending storm of agilists determined to change well-established practices.</p>
<p>也許在這過去幾年最引人注目對軟件過程的思考的改變 - “敏捷 agile” 一詞的出現。我們將談論如何將敏捷軟體方法(agile software method)引入到開發團隊，或者如何抗拒即將到來的敏捷提倡者所帶來的風暴，這風暴將改變原先建立的好的業界實踐方法。</p>
<p>This new movement grew out of the efforts of various people who dealt with software process in the 1990s, found them wanting, and looked for a new approach to software process. Most of the ideas were not new, indeed many people believed that much successful software had been built that way for a long time. There was, however, a view that these ideas had been stifled and not been treated seriously enough, particularly by people interested in software process.</p>
<p>這新運動來自于 1990 年起不同人對於軟體程序的努力，他們發現和找到一個新的軟體程序。大多數敏捷方法的想法並不新，大多數人認為很多成功的軟件本來就有內置這種方式很久了，的確是有的，然而有一觀點指出，這些想法對於對軟體過程感興趣的人眼中並沒有受到重視，甚至被受到抑制。</p>
<p>This essay was originally part of this movement. I originally published it in July 2000. I wrote it, like most of my essays, as part of trying to understand the topic. At that time I’d used Extreme Programming for several years after I was lucky enough to work with Kent Beck, Ron Jeffries, Don Wells, and above all the rest of the Chrysler C3 team in 1996. I had since had conversations and read books from other people who had similar ideas about software process, but had not necessarily wanted to take the same path as Extreme Programming. So in the essay I wanted to explore what were the similarities and differences between these methodologies.</p>
<p>這篇文章也是新運動的起源一部份，最初發表于 2000 年 7 月。作為嘗試了解這文章一部份，您必須知曉這篇文章的風格如同其他大多數我寫的文章。在很幸運地與 Kent Beck, Ron Jeffries, Don Wells 共事後，我已經使用極限編程 (Extreme Programming) 好幾年。從 1996 年的 Chrysler C3 team 那時。我有機會與別人互相交流資訊和書籍來得到他們對於軟體過程中的類似想法，但即使是極限編程 (Extreme Programming) 也沒有一定要採用一樣的走法，所以在這篇文章中，我想要探索這些方法間的異同。</p>
<p>My conclusion then, which I still believe now, is that there were some fundamental principles that united these methodologies, and these principles were a notable contrast from the assumptions of the established methodologies.</p>
<p>以我的話來說，我至今仍相信那些方法一定有一些共同的基本原則，這些原則可能會從原本既有的(主流)方法假設中有明顯地對比。</p>
<p>This essay has continued to be one of the most popular essays on my website, which means I feel somewhat bidden to keep it up to date. In its original form the essay both explored these differences in principles and provided a survey of agile methods as I then understood them. Too much has happened with agile methods since for me to keep up with the survey part, although I do provide some links to continue your explorations. The differences in principles still remain, and this discussion I’ve kept.</p>
<p>這篇文章將會一直是一篇這個網站最熱門的文章，也意味者我會感到使命去保持這篇文章的更新。在文章原始架構中，會探討我所了解的這些原則的差異和提供敏捷方法的調查。當我在調查的同時，敏捷方法已經發生了變動，但仍我也提供一些鏈結供您探索，這些原則的差異和討論內容仍會保留在這篇文章中。</p>
<p>Most software development is a chaotic activity, often characterized by the phrase “code and fix”. The software is written without much of an underlying plan, and the design of the system is cobbled together from many short term decisions. This actually works pretty well as the system is small, but as the system grows it becomes increasingly difficult to add new features to the system. Furthermore bugs become increasingly prevalent and increasingly difficult to fix. A typical sign of such a system is a long test phase after the system is “feature complete”. Such a long test phase plays havoc with schedules as testing and debugging is impossible to schedule. </p>
<p>大多數軟體開發是一個混亂的開始，常常以一句話代以概括 ”撰寫！修復！“，這些軟體在撰寫時不用事先有基礎的計劃，也不用系統架構，將由短期項目討論就可以拼湊起來。這確切在系統很小時可以運作，但當系統越大時將會變得相當困難去增加新的功能。此外，BUG 也會越來越普遍見到，且越來越難除錯。這典型系統是在功能齊備後，才經由長時間的測試階段。這麼長時間的測試階段將嚴重破壞測試和除錯的行程，使得行程根本無法安排。試階段起著嚴重破壞的時間表為測試和調試是不可能的安排。</p>
<p>The original movement to try to change this introduced the notion of methodology. These methodologies impose a disciplined process upon software development with the aim of making software development more predictable and more efficient. They do this by developing a detailed process with a strong emphasis on planning inspired by other engineering disciplines - which is why I like to refer to them as engineering methodologies (another widely used term for them is plan-driven methodologies). </p>
<p>起源運動將要改變這種方法的概念，這些方法論所施加的紀律，將協助軟體開發變得更可預測和更有效率。他們將透過製定詳細的過程，這些過程特別強調設計，靈感來自于其他工程學門- 這就是為什麼我喜歡稱呼它們為 ”工程方法 enginerring methodologies“ (對於他們來說，另一個廣泛使用的術語為 “計劃驅動方法 plan-driven methodologies”)</p>
<p>Engineering methodologies have been around for a long time. They’ve not been noticeable for being terribly successful. They are even less noted for being popular. The most frequent criticism of these methodologies is that they are bureaucratic. There’s so much stuff to do to follow the methodology that the whole pace of development slows down. </p>
<p>工程方法已經存有一段歷史，它們都沒有被注目那背後可怕的成功，它們相當少被認為是受流行的，常見的批評為 ”它們是官僚政治的“ // 相當死板的 ？ 。有相當多的項目都遵循這套方法論使用緩慢的發展步伐。</p>
<p><strong> Agile methodologies </strong> developed as a reaction to these methodologies. For many people the appeal of these agile methodologies is their reaction to the bureaucracy of the engineering methodologies. These new methods attempt a useful compromise between no process and too much process, providing just enough process to gain a reasonable payoff. </p>
<p>敏捷方法的發展就是反映這些工程方法論，對于大多數的人而言，敏捷方法的吸引力是反映出工程方法的官僚主義，這些新方法是在沒有進展和太多進展中的折衷妥協方案，提供一種恰當的過程來獲得合理回饋。</p>
<p>The result of all of this is that agile methods have some significant changes in emphasis from engineering methods. The most immediate difference is that they are less document-oriented, usually emphasizing a smaller amount of documentation for a given task. In many ways they are rather code-oriented: following a route that says that the key part of documentation is source code. </p>
<p>這一切的結過是，敏捷方法從工程方法中有顯的改變。最明顯的差異是少寫文件(文件導向)，通常強調少量文件的工作，在許多說法上，它們更偏向代碼導向(code-oriented: 文件的關鍵部分是源代碼 source code)</p>
<h1 id="糟透的軟體開發"><a href="#糟透的軟體開發" class="headerlink" title="糟透的軟體開發"></a>糟透的軟體開發</h1><p>在土木工程中，建造一個橋來說，通常在設計草圖完成後，即使換了別的公司繼續接按下去做，一樣能按照這個設計草圖完成。如果在施工過程中遇到問題，通常問題也不會太難，而且非常容易被解決。</p>
<p>在了解這些設計草圖後，可以發現勞心者和勞力者的工作是分開的，設計由專家耗費心力完成，而實作能由工人來按照草圖，因此這些設計草圖是確保工人們能看得懂，但是在軟體工程中，大部分都是勞心者和勞力者集一人之中。</p>
<p>施工是一個相當耗費成本的工作，在早期的軟體工程開發專家，希望能將土木工程的方法轉移到軟體工程上。讓專家進行設計，再讓低成本的工作人員來完成實作，設計費用通常比實作費用來的低，工程師仍有高低薪之分，新一代的低薪工程師呢！</p>
<p>專家寫出來的設計草圖，要讓 programmer 看得懂，通常是非常困難的。即使是 UML 圖，雖然在紙(草圖)上看起來相當不錯，但是實作上的問題卻相當多，土木工程的設計圖可以經過數學模型去測試，但是軟體工程的設計圖只能由人腦去找到邏輯BUG，即使是設計熟練的專家，要設計出不會有實作問題的草圖也是常發生的。</p>
<p>接續著剛剛討論的造橋問題，設計費用只占了全部花費的十分之一，按照草圖寫 code 是相當簡單的，根據 McConnell 調查大型專案，只有 15% 的成本進行程式撰寫和測試(這裡我們需要勞力成本比例越高越好)。即使把其他成本混在一起，設計仍占了 50% 的成本比例。軟體工程只是工程分枝中之一，這其中一定有蹊蹺。</p>
<p>結論</p>
<ul>
<li>軟體的建造相當便宜，甚至於免費(只淤需要電腦和編譯器，沒有實體。)</li>
<li>軟體受設計影響，因此需要有創造力和有天賦的人。</li>
<li>俱有創新的程序不容易去規劃，可預測的性質甚至變成不可能。</li>
<li>我們需要不同於傳統工程的方法，來解決這詭異的軟體工程的開發程序。</li>
</ul>
<p>常常有開發者收到客戶不斷地改變需求，但是改變需求是常態，但是對於開發者而言卻是想不透的謎。這表示當初需求並沒有弄完整，但是也不能說像客戶簽訂契約——表示在軟體完成前，需求都不會改變。需求改變是很正常的，這客戶來說這個契約反而不合理。</p>
<p>按需求收費，加什麼功能要多少錢？估算收費也是不好量化，也會根據產品使用的方式和使用者有關，因此品質的水準與費用是不好預估。客戶以為“軟”體容易修改，但並不是每個需求都容易修改，通常會耗費大量的時間去滿足客戶的需求。</p>
<p>如果需求不穩定，就得不到可預測的計劃去完成軟體。</p>
<h1 id="真的不可預測？"><a href="#真的不可預測？" class="headerlink" title="真的不可預測？"></a>真的不可預測？</h1><p>在 NASA 太空軟體開發中，他們的計劃是可以預測的，但這也只是一個特別的例子，主要原因是長期時間，龐大的團隊，穩定的需求。</p>
<p>更可怕的是，如果客戶需求不穩定，卻告知有可預測的計劃，這樣自欺欺人的行為相當令人詬病。</p>
<p>”可預測“是令人相當渴望的，這導致一開始擬定的計劃越飄越遠，最後計劃將會分崩離析。</p>
<p>按照方法論運行總是美好的，但是在軟體開發上必須要捨棄掉，但這樣的舉動相當困難，要捨棄一直以來處理事情的方式，但也並不是讓事情處理變得無法控制的混沌，捨棄“預測”吧！</p>
<h1 id="控制-“不可預測”程序"><a href="#控制-“不可預測”程序" class="headerlink" title="控制 “不可預測”程序"></a>控制 “不可預測”程序</h1><p>使用迭代方式，並且將計劃越短越好，看起來就是多方面失敗的開始，但卻有機會看來進步的地方，當計劃越短，就能越早知道反饋(feedback)。</p>
<p>文件可以隱藏缺失，沒有經過測試將會有更多的缺失。</p>
<p>XP 一周或兩周，SCRUM 一個月之類的，越熟練則會越短時間。</p>
<p>=====</p>
<p>並不是每個工程師都像零件，換個人就可以繼續運行。</p>
<p>不可更換的人零件都跑了，也就是最有創意的人力都走了，可更換的人卻留下了。</p>
<h1 id="Programmer-是有責任的專業人員？"><a href="#Programmer-是有責任的專業人員？" class="headerlink" title="Programmer 是有責任的專業人員？"></a>Programmer 是有責任的專業人員？</h1><p>早期是工廠的運行模式，希望能讓工人多做一點事情，來讓成本降低。</p>
<p>每個 programmer 是獨特的，產出的代碼也都不同，每一個人的創意不同，把人當資源就錯了。</p>
<p>施工和設計能不能分開？施工只是由編譯器來，因此軟體全是文創業，算是設計類型的職業。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-mid-item-report" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/04/19/lesson/consumption-mid-item-report/" class="article-date">
  <time datetime="2014-04-19T09:53:51.000Z" itemprop="datePublished">2014-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/10263492_10201085618622191_1102770277_o.jpg" rel="gallery_cimum6q1701uih3xcorw3916q">
        <img src="/img/10263492_10201085618622191_1102770277_o.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/19/lesson/consumption-mid-item-report/">《刺激消費，我是主角》心得</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/04/19/lesson/consumption-mid-item-report/" data-id="cimum6q1701uih3xcorw3916q" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/04/19/lesson/consumption-mid-item-report/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="當代消費文化與社會-期中報告"><a href="#當代消費文化與社會-期中報告" class="headerlink" title="當代消費文化與社會 期中報告"></a>當代消費文化與社會 期中報告</h1><p>閱讀書名：《刺激消費，我是主角》<br>書目作者：日野佳惠子</p>
<p>對於當今社會物質富裕已經為大多數人的基礎，因此消費行為也越來越特異化，從注重環保以及各種責任意義，消費的著重點也有所不同。</p>
<p>如何聰明消費？或者說消費出聰明的價值？的確有一股取向，有錢人的消費模式在於大批購買，而我們這種一般人對於聰明的消費是相當自豪的，聰明消費能夠展現自己能在低價購入高品質的產品，這裡的低價就不單單只是低消費額，是一個相對於產品應有的價值之下。在這股潮流之下，依賴情報消費真的很重要，因此也易受於口碑品牌的影響。就如比特幣剛出時，大批人覺得是一個未來重要的貨幣商品而大量購買 … 等。</p>
<p>如果徵才也是互動型的消費，文中說明消費者若有貢獻出一己之力的機會，將會更容易讓其主動消費，例如廣告為『我們想像身為家庭主婦的您，購買做家事的能力與烹飪能力』比起『時薪 OO 徵才』好太多了，文中所提的例子相當有感，能對別人有所助益，即使中間的過程是消費的一環，也是相當具有自願性的行為。不單單只是為了個人去購買商品，同時也是為了其他外界因素而進行消費。如同當初 Firefox 打擊微軟的 IE 手法，提供開源代碼的方式，希望其他人參與這場攻防戰，願意幫助這個軟體更完善，在不花一毛錢的情況下，這個組織靠著消費者活到了至今。</p>
<p>模仿身邊的人進行消費，如果這個商品是對於土豪們為取向，那麼消費族群也總是那一群，需要靠身邊親朋好友的消費習慣來渲染自己，如果身邊沒有人這麼消費，那要成為第一個購買者的機會是相當低的，因此企業常會用親民的代表人物來推銷自己的商品。我相信在相同處境下，需求是彼此靠攏的。這有點粒子群聚算法的感覺。</p>
<p>『對於不懂得使用方法的人，不了解真正含義的人，無法因商品獲得快樂的人而言，即使技術再進步，一切都是毫無意義。』看到這一句話，越來越明白消費的同時也是在教導，如果單純只是想要擴張客源，沒有好好教導消費者如何使用也是不行的。</p>
<p>『消費者也是加工者，開創低價商品交給消費者加工，並且銷售宣傳』由於消費者不喜歡與別人相同，又想要做出自己的風格，低價商品的拓展性就變得相當高了，低價商品通常有著量多便宜的特性，譬喻成大自然的元素也不為過。想到這一點，有人開發出有前景的軟硬體，通常會湧出一批人去購買，並且修正或運用然後進行傳播，這影響力堪稱指數擴張。這也應對消費者也是企業的助手，一群消費者就是一大群的應援團，將與企業或產品一同發展。</p>
<p>『不消費的智慧』雖然使得商品沒有利益，但是這也表示新的消費可能再也不是利益，而是商品後頭的智慧，看著越來越多的消費手法，沒有智慧學習的商品，除了一般生活所需外，在未來可能很難遍及市場，娛樂市場又是另外一回事。</p>
<p>『把整個環境一同賣給你』即使商品單獨具有高性能，沒有環境展現其性能事件很糟糕的事情，就如蘋果電腦和軟體總是整包出售，兩項缺一不可。而最近微軟最近正有著附上環境出售的趨勢，不過搭配性不強，跟裸機差不多。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/operating-system-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/04/16/lesson/operating-system-notes/" class="article-date">
  <time datetime="2014-04-16T09:55:38.000Z" itemprop="datePublished">2014-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/test.jpg" rel="gallery_cimum6q3k01vqh3xcsypf3s9t">
        <img src="/img/test.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/16/lesson/operating-system-notes/">作業系統 筆記 (1)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/04/16/lesson/operating-system-notes/" data-id="cimum6q3k01vqh3xcsypf3s9t" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/04/16/lesson/operating-system-notes/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="讀物"><a href="#讀物" class="headerlink" title="讀物"></a>讀物</h1><p>現在恐龍書不知道第幾版了，而且中文翻譯有點慘。看英文原文又太慢的情況，剛好查到聯合大學陳士杰教授寫的 ppt。繁體中文的說明，採用恐龍書第七版的內容。</p>
<p>下附章節簡報和課後習題解答。</p>
<p>稍微看過每一章的內容後，就可以著手看習題解答。</p>
<p><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_1.pdf" target="_blank" rel="external">CH 1</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_2.pdf" target="_blank" rel="external">CH 2</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_3.pdf" target="_blank" rel="external">CH 3</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_4.pdf" target="_blank" rel="external">CH 4</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_5.pdf" target="_blank" rel="external">CH 5</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_6.pdf" target="_blank" rel="external">CH 6</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_7.pdf" target="_blank" rel="external">CH 7</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_8.pdf" target="_blank" rel="external">CH 8</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_9.pdf" target="_blank" rel="external">CH 9</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_10.pdf" target="_blank" rel="external">CH 10</a></p>
<p><a href="/file/os.zip">恐龍書課後習題解答</a> 感謝大大的提供</p>
<p>之前也有好幾次參照教授寫的中文簡報，相當有助益。</p>
<h1 id="可能遭遇的問題"><a href="#可能遭遇的問題" class="headerlink" title="可能遭遇的問題"></a>可能遭遇的問題</h1><p><strong> 個人拙見，請自行過濾 </strong></p>
<h2 id="Round-Robin-Scheduling"><a href="#Round-Robin-Scheduling" class="headerlink" title="Round-Robin Scheduling"></a>Round-Robin Scheduling</h2><ul>
<li>這個問題在寫考題的時候，略顯著的疑惑。</li>
<li>對於 Round-Robin Scheduling 的部分<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">queue Q</span><br><span class="line">while(true) &#123;</span><br><span class="line">    w = Q.front()</span><br><span class="line">    w = work(w)</span><br><span class="line">    if(hasProcess())</span><br><span class="line">        Q.push(nextPorcess())</span><br><span class="line">    if(w != null)</span><br><span class="line">        Q.push(w)</span><br><span class="line">    time++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
詳見代碼後，由於超過時限後，還要將變數存起來，所以丟入 queue 的時間會晚一點，也就是說在同一時刻會慢於新抵達的 process。之後的程序就按照 queue 的順序去運行。</li>
</ul>
<h1 id="考古題-課本後習題"><a href="#考古題-課本後習題" class="headerlink" title="考古題(課本後習題)"></a>考古題(課本後習題)</h1><p>(=ﾟωﾟ)= <strong> 下附解答僅個人拙見，請勿隨意採信，請發揮您的善心，救救笨蛋 </strong></p>
<h2 id="95-期中考"><a href="#95-期中考" class="headerlink" title="95 期中考"></a>95 期中考</h2><ul>
<li><p>What is multiprogramming ? what is time-sharing ?(10%)</p>
<ul>
<li><p>Multiprogramming(多重程式)：</p>
<ul>
<li>定義：<br>內存有多個 processs 同時執行，一般電腦的運行方式。透過 CPU scheduling 將發生中斷 (eg. wait for I/O complete, resource not available, etc.) 的行程切換給可執行的運作。</li>
<li>特色：<br>可以避免 CPU idle，提高 CPU utilization(使用率)</li>
<li>其他：<ol>
<li>Multiprogramming Degree：系統內存在執行的 process 數目</li>
<li>通常 Multiprogramming Degree 越高，則 CPU utilization 越高(p.s. ch7 Thrashing 除外)</li>
<li>多個 process 同時執行，mode 有兩種 Concurrent(並行)、Parallel(平行)</li>
</ol>
</li>
</ul>
</li>
<li><p>Time-sharing:</p>
<ul>
<li>定義：<br>Multiprogramming 的一種，在 CPU 排班法則方面，其使用 RR(Round-Robin) 法則。<br>// RR 法則－CPU time quantum，若 process 在取得 CPU 後，未能於 quantum<br>// 內完成工作，則必須被迫放棄 CPU，等待下一次輪迴。</li>
<li>特色：<br>對每個 user 皆是公平的，適用在 user interactive 且 response time (反應時間)要求較短的系統環境，透過 resource sharing 技術(eg. CPU scheduling, memory sharing, spooling 達到 I/O Device 共享)，使得每個user皆認為有專屬的系統存在。</li>
</ul>
</li>
</ul>
</li>
<li><p>Describe the differences between symmetric and asymmetric multiprocessing. What are three advantages and one disadvantage of multiprocessor systems ?<br>  In Distributed System - Multiprocessor - Tightly-Coupled System(different from Loosely-Coupled Distributed System)</p>
<ul>
<li>Symmetric Multiprocessors (SMP) 對稱式多處理器 <ul>
<li>定義：<br>每個 processor 的能力皆相同，即可負責的功能完全一樣。萬一某個 processor 壞了，其上工作可由其他processor 接手，系統不會整個 crash，只是整體效能下降而已。</li>
<li>特色：<br>Reliability (可靠性)大幅提升，強調 load balancing (負載平衡)(每個CPU的工作負擔相同)</li>
</ul>
</li>
<li>Asymmetric Multiprocessors (ASMP) 非對稱式多處理器 <ul>
<li>定義：<br>不同(群)顆的 processor，其負擔的功能不盡相同，在此架構下，通常含有一個Master CPU，負責工作的分派與協調，其他 CPUs 稱為 Slave CPU (稱為 Master-Slave Architecture)</li>
<li>特色：<br>效能通常較SMP高，但可靠度較差 </li>
</ul>
</li>
</ul>
</li>
<li>What are the differences between a trap and an interrupt? What is the use of each function ?<ul>
<li>Trap:<br>軟體產生 system call<br>an exception in a user process.<br>ex. system call (software divide-by-zero)</li>
<li>Interrupt:<br>硬體產生 signal<br>something generated by the hardware.<br>ex. IO-complete interrupt (hardware generated)</li>
<li>兩者相同之處<br>從 User Mode 切換到 Kernel Mode。<br>兩者都算是 interrupt 中斷指令。</li>
</ul>
</li>
<li>What is the purpose of system calls?<br>  System calls allow user-level processes to request services of the operating system.<br>  System calls 提供 <strong> 使用者級別 </strong> 的程序來請求作業系統給的服務。<br>  // process control, file Management, device management, information maintenance, communication</li>
<li>Describe the differences among short-term, medium-term, and long-term scheduling.<ul>
<li>short-term (CPU scheduler) —<br>CPU 工作排程<br>selects from jobs in memory those jobs that are ready to execute and allocates the CPU to them.</li>
<li>medium-term —<br>常用於分時系統的排程器。當記憶體不夠的時候，需要暫時將部分的執行程序搬出，將新來的程序載入，置換機制被建置用來移除部份在記憶體執行中及恢復那些被暫時移除的程式。<br>used especially with time-sharing systems as an intermediate scheduling level. A swapping scheme is implemented to remove partially run programs from memory and reinstate them later to continue where they left off.</li>
<li>long-term (job scheduler) —<br>將 job 變成 process 的工作排程，將工作從硬碟載入到主記憶體中。<br>determines which jobs are brought into memory for processing.</li>
</ul>
</li>
<li>Can a multithreaded solution using multiple user-level threads achieve better performance on a multiprocessor system than on a single-processor system? Why?<ul>
<li>A multithreaded system comprising of multiple user-level threads cannot make use of the different processors in a multiprocessor system simultaneously. The operating system sees only a single process and will not schedule the different threads of the process on separate processors. Consequently, there is no performance benefit associated with executing multiple user-level threads on a multiprocessor system.</li>
<li>以 user-level hreads 實現 multithread 的程式，在多處理器系統中不能比在單處理機系統中有更好的效率， 因在多處理機系統中之作業系統不會將多個 CPU 同時分配給該 user-level multithread 程式。</li>
</ul>
</li>
<li><p>Consider the following set of processes, with the length of the CPU-burst time given in milliseconds:</p>
<pre><code>Process           Burst Time         Priority
  P1                 10                  3
  P2                  1                  1
  P3                  2                  3
  P4                  1                  4
  P5                  5                  2
</code></pre><p>The processes are assumed to have arrived in the order P1,P2,P3,P4,P5, all at time 0.</p>
<ul>
<li>(a) Draw four Gantt charts illustrating the execution of these processes using FCFS, SJF, a nonpreempitive priority(a small priority number implies a higher priority), and RR(quantum = 1) scheduling.(5%)</li>
<li>(b) What is the turnaround time of each process for each of the scheduling algorithms in part(a).(5%)</li>
<li>(c) What is the waiting time of each process for each of the scheduling algorithms in part(a).(5%)</li>
<li><p>(d) Which of the schedules in part (a) results in the minimal average waiting time(over all processes)? (5%)</p>
<pre><code>請參照上附的習題解法。
</code></pre><p><img src="/img/operation-system-5.12sol.PNG" alt="5.12 solution"></p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="96-期中考"><a href="#96-期中考" class="headerlink" title="96 期中考"></a>96 期中考</h2><ul>
<li><p>FCFS, SJF, Priority, Round-Robin and Multilevel Queue<br>Which can be preemptive ? (5%)</p>
<ul>
<li>preemptive 可搶先<br>SRTF (剩餘最短優先)、Priority (優先權優先)、Multilevel Queue (多層佇列)、RR</li>
<li>non-preemptive 不可搶先<br>FCFS (先到先服務)、SJF (最短工作優先)、Priority (優先權優先)</li>
<li>Priority (優先權優先) 屬於可搶先跟不可搶先。</li>
<li>可搶先的定義為非自願性被踢出 CPU。</li>
</ul>
</li>
<li><p>What are the four main purposes of an operating system ? (10%)</p>
<ul>
<li>Managing programs</li>
<li>Managing Memory</li>
<li>Handling input and output</li>
<li>User Interface</li>
</ul>
</li>
<li><p>Please give a detail description on the differences among the terms multiprocessing, multitasking and multithreading. (15%)</p>
<ul>
<li>multiprocessing<br>具有多個處理器，在同一時間可以在各自處理器上運行程序。</li>
<li>multitasking<br>執行單一使用者的多個行程，利用排程器讓每一個行程都在平均時間內解決。</li>
<li>multithreading<br>可以將程序切成好幾個執行緒，若硬體可以同時執行多個執行緒，效率將會上升，如果不能，由於速度夠快看起來也很像多個執行緒同時運行。</li>
</ul>
</li>
<li><p>What are the differences between a trap and an interrupt ? What is the use if each function ? (20%)</p>
<ul>
<li>Trap:<br>軟體產生 system call<br>an exception in a user process.<br>ex. system call (software divide-by-zero)</li>
<li>Interrupt:<br>硬體產生 signal<br>something generated by the hardware.<br>ex. IO-complete interrupt (hardware generated)</li>
<li>兩者相同之處<br>從 User Mode 切換到 Kernel Mode。<br>兩者都算是 interrupt 中斷指令。</li>
</ul>
</li>
<li><p>What is the purpose of system calls, Please describe three general methods that be used to pass parameters to the operating system. (10%).</p>
<ul>
<li>System call 由作業系統提供 API interface 給 user program，可以藉由 system call 向作業系統請求服務，作業系統接收到請求後，執行完報告結果給 user program。</li>
<li>[方法1] Registers<br>  利用Registers ( 暫存器 )儲存這些參數<br>  優：速度快<br>  (∵不用作記憶體的存取 )<br>  缺：不適用於參數個數多的情況</li>
<li>[方法2] Memory<br>  將參數利用 Table 或 Block 的方式儲存在 Memory 中，同時利用一個 Register 記錄此 Table 或 Block 的起始位址，並傳給O.S.<br>  優：適用於參數個數較多的情況<br>  缺：速度慢</li>
<li>[方法3] Stack<br>  利用System Stack (堆疊 )。要存放參數時，將之Push 到Stack Stack， 再由O.S.從Stack中Pop 取出參數 。<br>  Stack在系統中比Register多一些(可用Mem. 或其它硬體(如：Register)來實作此Stack)</li>
</ul>
</li>
<li><p>What is a process ? Draw the diagram of Process State. And describe every state. (15%)<br><img src="/img/ProcessState.PNG" alt="process state"></p>
</li>
<li><p>What are the differences between thread and process ? Why do threads have much shorter context switching times ? (10%)</p>
<pre><code>|        Thread                   |      Process              |
|---------------------------------|---------------------------|
| Light Weight Process            | Heavy Weight Process      |
|                                 |                           |
| 同一個Task (或 Process ) 內的   |  不同的Process之間無共享的| 
| Threads可以共享 Code Section,   |  Address Space，互為獨立。|
| Data Section, 及O.S. Resources  |                           |
|                                 |
| Context Switching 負擔輕        |  負擔重
|                                 |
| Thread的管理(Management)成本低  |  成本高
| (管理項目： Creation,           |
| Scheduling, Context, Switching  |
| Switching…etc.)                 |
|                                 |
| 一個Task內有多條Threads存在     |  一個Task內只有一條Thread
|  Process (Task) 內的某 Thread   |
| 被 Block，則可切到其它Thread    |
| 執行。此時，若 Process 內只要還有
| Thread 在執行，則 Process 不會被 Block
</code></pre></li>
<li><p>What is Multilevel Feedback-Queue scheduling ? (5%)</p>
<pre><code>定義：
與Multilevel Queue的定義相似，差別在於允許 Process 在各佇列之間移動 ，以避免Starvation 的情況。
* 採取類似 “Aging” 技術，毎隔一段時間就將 Process 往上提升到上一層 Queue 中。∴在經過有限時間後，在 Lower Priority Queue 中的 Process 會被置於 Highest Priority Queue 中。故無 Starvation。
* 亦可配合降級之動作。當上層 Queue 中的 Process 取得 CPU 後，若未能在 Quantum 內完成工作，則此 Process 在放棄 CPU 後，會被置於較下層的 Queue 中。
</code></pre></li>
<li><p>Please draw the Gantt charts for the following processes for the problems shown below.<br>  (a) Round-Robinm time quantum = 1 (5%)<br>  (b) Shortest-remaining-time-first (Preemptive SJF) (5%)</p>
<pre><code>            Arrival Time    Brust Time

    P1      0               4
    P2      1               2
    P3      2               3
    P4      5               4
    P5      6               3

(a) Time : 0
    Queue: P1

    0   1
    +---+
      P1

    先丟入 P2, P1 因為超時丟入，此時執行 P2
    Time : 1
    Queue: P2, P1

    0   1   2
    +---+---+
     P1  P2

    丟入 P3, P2 因為超時丟入，此時執行 P1
    Time : 2
    Queue: P1, P3, P2

    0   1   2   3
    +---+---+---+
     P1  P2  P1

    P1 因為超時丟入，此時執行 P3
    Time : 3
    Queue: P3, P2, P1

    0   1   2   3   4
    +---+---+---+---+
     P1  P2  P1  P3

    P3 因為超時丟入，此時執行 P2
    Time : 4
    Queue: P2, P1, P3

    0   1   2   3   4   5
    +---+---+---+---+---+
     P1  P2  P1  P3  P2

    P2 完成，P4 抵達丟入，此時執行 P1
    Time : 5
    Queue: P1, P3, P4

    0   1   2   3   4   5   6
    +---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1

    P5 抵達丟入，P1 超時丟入，此時執行 P3
    Time : 6
    Queue: P3, P4, P5, P1

    0   1   2   3   4   5   6   7
    +---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3

    P3 超時丟入，此時執行 P4
    Time : 7
    Queue: P4, P5, P1, P3

    0   1   2   3   4   5   6   7   8
    +---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4

    P4 超時丟入，此時執行 P5
    Time : 8
    Queue: P5, P1, P3, P4

    0   1   2   3   4   5   6   7   8   9
    +---+---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4  P5

    P5 超時丟入，此時執行 P1
    Time : 6
    Queue: P1, P3, P4, P5

    0   1   2   3   4   5   6   7   8   9  10
    +---+---+---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4  P5  P1

    P1 完成，此時執行 P3
    Time : 10
    Queue: P3, P4, P5

    0   1   2   3   4   5   6   7   8   9  10  11
    +---+---+---+---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4  P5  P1  P3

    P3 完成，此時執行 P4
    Time : 11
    Queue: P4, P5

    0   1   2   3   4   5   6   7   8   9  10  11  12
    +---+---+---+---+---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4  P5  P1  P3  P4

    ...

    0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16
    +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
     P1  P2  P1  P3  P2  P1  P3  P4  P5  P1  P3  P4  P5  P4  P5  P4
</code></pre></li>
</ul>
<hr>
<h1 id="課本習題快取區"><a href="#課本習題快取區" class="headerlink" title="課本習題快取區"></a>課本習題快取區</h1><h2 id="ch-5"><a href="#ch-5" class="headerlink" title="ch 5"></a>ch 5</h2><ul>
<li>5.9 Why is it important for the scheduler to distinguish I/O-bound programs<br>from CPU-bound programs?<br>為什麼排程器需要需分 <strong> IO 密集程式 </strong> 和 <strong> CPU 綁定程式 </strong> ?</li>
</ul>
<blockquote><p>Answer: I/O-bound programs have the property of performing only a small amount of computation before performing I/O. Such programs typically do not use up their entire CPU quantum. CPU-bound programs, on the other hand, use their entire quantum without performing any blocking I/O operations. Consequently, one could make better use of the computer’s resouces by giving higher priority to I/O-bound programs and allow them to execute ahead of the CPU-bound programs.<br>IO 密集程式占用 CPU 的時間比較少，大部分時間等在等待 IO。相反地 CPU 綁定程式則會大幅度占用 CPU 的時候，因為沒有 IO 操作的堵塞。</p>
<p>而 CPU bound 的程序因此而得到了很多調度機會並且每次都能把CPU run完。故在這樣的系統裡要給 I/O bound 的程序更高的優先級使其能被調度得更多些。</p>
</blockquote>
<ul>
<li>5.10 Discuss how the following pairs of scheduling criteria conflict in certain<br>settings.<br>a. CPU utilization and response time // CPU 使用率 和 回應時間 的比較<br>b. Average turnaround time and maximum waiting time // 平均運轉時間 和 最大等待時間 的比較<br>c. I/O device utilization and CPU utilization // IO 裝置使用率 和 CPU 使用率 的比較</li>
</ul>
<blockquote><p>Answer:<br>a. CPU utilization and response time: CPU utilization is increased if the overheads associatedwith context switching isminimized. The context switching overheads could be lowered by performing context switches infrequently. This could, however, result in increasing<br>the response time for processes.<br>CPU 的使用率(utilization)上升時，切換工作的次數(context-switches)就會少，由於切換次數少，則回應時間(response time)就會上升。</p>
<p>b. Average turnaround time and maximum waiting time: Average turnaround time is minimized by executing the shortest tasks first. Such a scheduling policy could, however, starve long-running tasks and thereby increase their waiting time.<br>平均運作時間(average turnaround time) 的最小化可以藉由最短工作優先的方式，但是這將會使得長工作飢餓，如此會增加最大等待時間。</p>
<p>c. I/O device utilization and CPU utilization: CPU utilization is maximized by running long-running CPU-bound tasks without performing context switches. I/O device utilization is maximized by scheduling I/O-bound jobs as soon as they become ready to run, thereby incurring the overheads of context switches.<br>CPU 使用率的上升盡可能讓 CPU 密集工作長時間運行 (減少 IO 或者其他的中斷所引發的上下文切換)，IO 裝置使用率的上升靠的是讓排入的 IO 密集工作立即地運行，但這會增加上下文切換的開銷。</p>
</blockquote>
<ul>
<li>5.11 Consider the exponential average formula used to predict the length of the next CPU burst.What are the implications of assigning the following values to the parameters used by the algorithm?<br>使用指數平均公式去預測下一次的 CPU burst。 t0 預估時間。<br>a. a = 0 and t0 = 100 milliseconds<br>b. a = 0.99 and t0 = 10 milliseconds</li>
</ul>
<blockquote><p>Answer: When a = 0 and t0 = 100 milliseconds, the formula always makes a prediction of 100 milliseconds for the next CPU burst. When a = 0.99 and t0 = 10 milliseconds, themost recent behavior of the process is given much higher weight than the past history associated with the process. Consequently, the scheduling algorithm is almost memoryless, and simply predicts the length of the previous burst for the next quantum of CPU execution.<br>當 a = 0 時，預測的時間總會是 100 milliseconds，而當 a = 0.99 時，將會高度依賴近期幾次的結果，而對於歷史關聯只有較輕的權重。<br>// t(n+1) = a * 上一次實際時間 + (1 - a) * t(n)</p>
</blockquote>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://www.ptt.cc/bbs/b97902HW/M.1267018497.A.3B1.html" target="_blank" rel="external">Kernel Mode 與 User Mode 的概念</a><br><a href="http://sjchen.im.nuu.edu.tw/OS/97Spring/Ch_4.pdf" target="_blank" rel="external">恐龍書中文 ppt 介紹 聯合大學 陳士杰</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/學校課程/page/6/">&laquo; Prev</a><a class="page-number" href="/categories/學校課程/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/學校課程/page/5/">5</a><a class="page-number" href="/categories/學校課程/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/categories/學校課程/page/8/">8</a><a class="extend next" rel="next" href="/categories/學校課程/page/8/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">599</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">463</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">37</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/04/10/2016-google-code-jam-qr/">
              
                <i class="icon-file-o"></i> 
              
            2016 Google Code Jam Round QR</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/23/parallel-skill-interval-partitioning/">
              
                <i class="icon-file-o"></i> 
              
            數據分割 區間分塊小技巧</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/16/jg-10085/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10085. Parallel Count (debug)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/16/jg-10084/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10084. Prefix Sum (pthread)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13006/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13006 - Cake cut</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13010/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13010 - Galactic taxes</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13014/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13014 - Keep it energized</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/08/uva-13054/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13054 - Hippo Circus</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/08/uva-13032/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13032 - Marbles in Jars</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/02/uva-13038/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13038 - Directed Forest</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div>

<!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
</body>
</html>