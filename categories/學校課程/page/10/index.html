<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 學校課程 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/學校課程/page/10/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-lesson/visual-lesson-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/11/lesson/visual-lesson-note/" class="article-date">
  <time datetime="2014-07-11T02:14:57.000Z" itemprop="datePublished">2014-07-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/大學專題/">大學專題</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/11/lesson/visual-lesson-note/">[筆記] 虛擬化技術</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/07/11/lesson/visual-lesson-note/" data-id="ciq8w97v102bc9yxcbndqeb9r" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/07/11/lesson/visual-lesson-note/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前提概要"><a href="#前提概要" class="headerlink" title="前提概要"></a>前提概要</h2><p>本課程為暑期開課，產學合作的課程。暑期上課各種虐待，反人類行為。</p>
<h2 id="Day-1-虛擬機技術簡介"><a href="#Day-1-虛擬機技術簡介" class="headerlink" title="Day 1 虛擬機技術簡介"></a>Day 1 虛擬機技術簡介</h2><p>虛擬化不外乎就是在同一個硬體執行環境下，同時模擬出多個的執行環境，當然不外乎模擬的行為都是間接對機器硬體執行，因此許多指令需要被轉譯，或者是多好幾個步驟來做轉換，因此效率上一定會慢許多。</p>
<p>虛擬化的好處在於，根據硬體的汰換率在維護的費用，每隔固定一段時間就必須增加硬體來服務新的需求，如此一來必須要有更大的空間和電費來部屬伺服器。而且每一台伺服器的功率沒有一直維持高效佔有 (即使 CPU 使用率不高，用電量也不會下降多少，貌似 10% 不到，可以說是少得可憐)。倒不如來整合硬體，根據需求進行分配，同時可以讓需要的空間縮小、電費下降，做到整合到同一台機器上運行，就需要虛擬化的技術。</p>
<p>虛擬化技術分很多層面，最常見的就是在 Host OS 上開始虛擬化的軟體，如 VMware workstation, xen 之類的，在上面可以掛載很多不同的作業系統 Guest OS 執行。在全虛擬化的情況 (如上述)，與一般使用個人電腦沒有什麼差別，所以非常容易入手。半虛擬化效率上又比全虛擬化來得高，在硬體需求上部分不使透過軟體進行，可以在高效率的情況下接軌。</p>
<p>在虛擬化的另一個最常見的就是 JVM，這是在 Application 面向的虛擬化，Java visual machine，提供跨平台等服務，這麼看起來虛擬化無所不在。</p>
<p>虛擬化有幾個困難之處，從經濟面向來看，一開始的轉移到虛擬階段和虛擬化的授權費用太高，畢竟不是所有虛擬化的技術都是 open source。從技術層面來看，虛擬化必須針對硬體做銜接，因此有時候必須靠有限的資源進行組合，才能完成虛擬化的單一功能，因此在初步階段，還必須看 Intel 等硬體架構，是否有考慮虛擬化的設計。在現今，已經有根據虛擬化進行設計，虛擬化也更為普及。</p>
<p>在周邊設備上，虛擬化的架構設計也相當重要，因此部份廠商也搭配他們的驅動程式 driver 進行修改和開源，來方便虛擬化的製作。</p>
<p>但也不是所有情況都適合虛擬化</p>
<ul>
<li>大量計算程序</li>
<li>本身的 CPU 就一直維持滿載</li>
<li>大量 I/O 的程序</li>
<li>原本的執行環境沒有辦法虛擬化 (虛擬化廠商沒有針對其設備)</li>
</ul>
<p>虛擬化還必須搭載四個主要的功能：</p>
<ul>
<li>多工</li>
<li>狀態儲存</li>
<li>狀態復原</li>
<li>狀態遷徙 (無延遲服務)</li>
</ul>
<p>虛擬化技術仍有安全疑慮，如何確保資訊安全和風險保證？</p>
<blockquote>
<p>平常 VMware workstation 開啟就佔了相當記憶體資源 Orz</p>
</blockquote>
<h2 id="Day-2-軟體測試與-VM-測試"><a href="#Day-2-軟體測試與-VM-測試" class="headerlink" title="Day 2 軟體測試與 VM 測試"></a>Day 2 軟體測試與 VM 測試</h2><blockquote>
<p>用 code coverage 來決定測試好壞，是否能逆向找到 code coverage 的測試情況。</p>
</blockquote>
<p>這一天的內容已經在做專題的時候，由指導教授講了好幾次，概念上差不多能理解一大半。</p>
<p>重點為軟體工程的運行面向</p>
<ul>
<li>debug</li>
<li>test-driven develop</li>
<li>continuous integration</li>
</ul>
<p>正常大學不會教這些軟工概念，因此在大學畢業進入職場，挺多公司還是會給一段時間來訓練這些運行模式。來教導開發方式和其價值所在，催促人做事必須先教導其價值。</p>
<p>debug 技術而言，從海森堡 BUG、薛丁格 BUG … 等，都是相當有意思的。<a href="http://www.vaikan.com/types-of-bugs/" target="_blank" rel="external">《BUG 的類型》</a>，知道 BUG 也不見得能修好，這就是現在的情況，而有些 BUG 只會在高階 (過度) 使用者身上才會見到，軟體公司甚至不會想去修 (看看邪惡的微軟便是如此)。從 <code>printf()</code> 開始抓 BUG 的初學技巧，演化到加入中斷點來程序慢慢清除，用 <code>assert()</code> 來防止不符合規格的輸入，用 <code>#ifdef DEBUG</code> 使用 b2g system program 來查閱狀況，雖然不太善用這些技巧，但是 <code>assert()</code> 和 <code>#ifdef DEBUG</code> 偶爾在無法一次掛載在腦部的時候就會採用。</p>
<blockquote>
<p>很慶幸，在大學畢業前還有用過這些技巧來 DEBUG，雖然只是在單純的 ACM 解題上使用。</p>
</blockquote>
<p>test-driven develop (測試驅動)，這在敏捷開發這套軟工方法中談到。比起程式代碼，測試資料更令人可貴，這也是為什麼挺多大學的開發團隊會藉由參加大型比賽測試資料，來拿不容易收集到的測試資料，單純只是為了測試資料而參加比賽，當然最後主辦單位最後改階段式比賽來發送資料，以免選手罷賽拿資料。</p>
<p>continuout integration (連續整合)，從一部分一部分的代碼中，階段式完成並且測試，確保每一步都是對的，相關的工具很多，來知道每次整合遇到了什麼問題、現在改善什麼 BUG，歷史情況是如何 … 等。</p>
<blockquote>
<p>詳見敏捷開發</p>
</blockquote>
<h2 id="Day-3-工業電腦虛擬化技術簡介"><a href="#Day-3-工業電腦虛擬化技術簡介" class="headerlink" title="Day 3 工業電腦虛擬化技術簡介"></a>Day 3 工業電腦虛擬化技術簡介</h2><p>這一天內容與 Day 1 類似，不過更詳細說明這門課程如何運行，不過看似就會活不下去， 3 人一組在 2 個星期後期中考、4 個星期後期末考，必須要完成的 Final project。</p>
<p>升大四修碩班課程果然還有點落差，問題在於資源上沒有實驗室的協助，要怎麼將實習課所需要的虛擬機器的伺服器弄出來？助教講得很輕鬆，真正有資源來完成要求的人卻很少呢。</p>
<blockquote>
<ol>
<li>Github 使用</li>
<li>RedMine 協助</li>
</ol>
</blockquote>
<p>第一點有在用，但是不專精，對我來說目前只當作是垃圾倉庫使用中。還真是慘不忍睹。</p>
<h2 id="Day-4-軟體容錯-與-NCU-FTVM"><a href="#Day-4-軟體容錯-與-NCU-FTVM" class="headerlink" title="Day 4 軟體容錯 與 NCU - FTVM"></a>Day 4 軟體容錯 與 NCU - FTVM</h2><blockquote>
<ol>
<li>虛擬容錯的處理器環境要相同，是否是相當嚴苛的條件，而這個容錯只在於軟體掛點的時候，轉移狀態給另外一台虛擬機進行程序接手，在存取空間是共用的，因是為存取空間的備份不容易完成嗎？</li>
<li>由於容錯功能不能與許多功能兼容，是否會造成無法長時間處於容錯狀態？</li>
</ol>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/operating-system-notes-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/15/lesson/operating-system-notes-2/" class="article-date">
  <time datetime="2014-06-15T01:35:35.000Z" itemprop="datePublished">2014-06-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/15/lesson/operating-system-notes-2/">作業系統 筆記 (2)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/15/lesson/operating-system-notes-2/" data-id="ciq8w97tt02as9yxcq85xcihd" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/15/lesson/operating-system-notes-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote>
<p>精簡</p>
</blockquote>
<h2 id="Page-replacement-algorithm"><a href="#Page-replacement-algorithm" class="headerlink" title="Page-replacement algorithm"></a>Page-replacement algorithm</h2><ul>
<li>FIFO Algorithm<br>最先載入的 Page (即：Loading Time最小者)，優先視為 Victim Page。</li>
<li>Optimal Algorithm(OPT)<br>以 “將來長期不會使用的 Page Page” 視為Victim Page。</li>
<li>Least Recently Used Algorithm (LRU)<br>以 “最近不常使用的 Page Page” 視為Victim Page。<ul>
<li>緣由：LRU製作成本過高</li>
<li>作法：<ul>
<li>Second econd Chance ( 二次機會法則 )</li>
<li>Enhance nhance Second Chance ( 加強式二次機會法則 )</li>
</ul>
</li>
<li>有可能退化成 FIFO FIFO，會遇到 Belady 異常情況</li>
</ul>
</li>
<li>Second Chance (二次機會法則)<br>以 FIFO 法則為基礎，搭配 Reference Bit 使用，參照過兩次以上的 page 將不會被置換出去，除非全部都是參照兩次以上，將會退化成 FIFO。</li>
<li>Enhance Second Chance (加強式二次機會法則)<br>使用(Reference Bit Bit, Modification Bit Bit) 配對值作為挑選 Victim Page 的依據。對於沒有沒修改的 page 優先被置換，減少置換的成本。</li>
<li>Belady’s anomaly 當 Process 分配到較多的 Frame 數量，有時其 Page Fault Ratio 卻不降反升。</li>
</ul>
<table>
<thead>
<tr>
<th>Rank</th>
<th>Algorithm</th>
<th>Suffer from Belady’s anomaly</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Optimal</td>
<td>no</td>
</tr>
<tr>
<td>2</td>
<td>LRU</td>
<td>no</td>
</tr>
<tr>
<td>3</td>
<td>Second-chance</td>
<td>yes</td>
</tr>
<tr>
<td>4</td>
<td>FIFO</td>
<td>yes</td>
</tr>
</tbody>
</table>
<h2 id="Thrashing-振盪"><a href="#Thrashing-振盪" class="headerlink" title="Thrashing(振盪)"></a>Thrashing(振盪)</h2><p>當 CPU 效能低時，系統會想引入更多的 process 讓 CPU 盡可能地工作。但當存有太多 process 時，大部分的工作將會花費在 page fault 造成的 Page Replacement，致使 CPU 效率下降，最後造成 CPU 的效能越來越低。</p>
<h3 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h3><ul>
<li>[方法 1]<br>降低 Multiprogramming Degree。</li>
<li>[方法 2]<br>利用 Page Fault Frequency (Ratio) 控制來防止 Thrashing。</li>
<li>[方法 3]<br>利用 Working Set Model “預估 ” 各 Process 在不同執行時期所需的頁框數，並依此提供足夠的頁框數，以防止 Thrashing。<ul>
<li>作法<br>OS 設定一個Working Set Window (工作集視窗；Δ) 大小，以Δ 次記憶體存取中，所存取到的不同Page之集合，此一集合稱為 Working Set 。而Working Set中的Process個數，稱為 Working Set Size ( 工作集大小； WSS) 。</li>
</ul>
</li>
</ul>
<h2 id="Page"><a href="#Page" class="headerlink" title="Page"></a>Page</h2><ul>
<li>Page Size 愈小<ul>
<li>缺點<ul>
<li>Page fault ratio愈高</li>
<li>Page Table Size愈大</li>
<li>I/O Time (執行整個Process的I/O Time) 愈大</li>
</ul>
</li>
<li>優點<ul>
<li>內部碎裂愈小</li>
<li>Total I/O Time (單一Page的Transfer Time) 愈小</li>
<li>Locality愈集中</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Fragmentation"><a href="#Fragmentation" class="headerlink" title="Fragmentation"></a>Fragmentation</h2><p>分成外部和內部碎裂 External &amp; Internal Fragmentation</p>
<h2 id="Deadlock-死結"><a href="#Deadlock-死結" class="headerlink" title="Deadlock(死結)"></a>Deadlock(死結)</h2><ul>
<li>成因<ol>
<li>mutual exclusion 資源互斥<br>一個資源只能分配給一個 process，不能同時分配給多個 process 同時使用。</li>
<li>hold-and-wait 擁有並等待<br>擁有部分請求的資源，同時等待別的 process 所擁有資源</li>
<li>no preemption 不可搶先<br>不可搶奪別的 process 已經擁有的資源</li>
<li>circular wait 循環等待<br>存有循環等待的情況  </li>
</ol>
</li>
</ul>
<h3 id="解決方法-1"><a href="#解決方法-1" class="headerlink" title="解決方法"></a>解決方法</h3><ul>
<li>Dead Lock Prevention<br>不會存有死結成因四條中的任何一條。</li>
<li>Dead Lock Avoidance<br>對運行的情況做模擬，找一個簡單的算法查看是否有解死結，但這算法可能會導致可解的情況，歸屬在不可解的情況。<ul>
<li>Use a. to get: <span>$\sum Need + \sum Allocation &lt; m + n$</span><!-- Has MathJax -->  </li>
<li>Use c. to get: <span>$\sum Need_{i} + m &lt; m + n$</span><!-- Has MathJax --> </li>
<li>Rewrite to get: <span>$\sum Need_{i} &lt; n$</span><!-- Has MathJax --> </li>
</ul>
</li>
<li>Dead Lock Detection &amp; Recovery<br>Recovery 成本太高</li>
</ul>
<h2 id="小問題"><a href="#小問題" class="headerlink" title="小問題"></a>小問題</h2><ul>
<li><blockquote>
<p>Propose two approaches to protect files in a file system.<br>檔案系統如何保護檔案？請提供兩種方式。</p>
</blockquote>
<p>  對檔案做加密動作，或者將檔案藏起－不可讀取。</p>
</li>
<li><blockquote>
<p>The system will enter deadlock if you cannot find a safe sequence for<br>  it, YES or NO? Please draw a diagram to explain your answer.<br>  如果找不到一個安全序列，是否就代表系統進入死結？</p>
</blockquote>
<p>  不會，因為找尋安全序列的方式通常是精心設計的通則，也就是說每個程序要求資源的方式都是可預期的運作，但實際上並不是如此，而且順序和運作都是各自獨立且不可預期，有可能途中就會釋放資源。</p>
</li>
<li><blockquote>
<p>spinlock mutex semaphore 三者的區分？</p>
</blockquote>
<p>  spinlock(自旋鎖)是一種佔有 CPU 效能的一種 busy waiting，而 mutex 和 semaphore 是一種根據一個資料物件來達到互斥的效果。</p>
<p>  就以 spinlock 來說，比較適合鎖較短的指令。相反地，mutex 和 semaphore 用於鎖住區域 (critical section) 的指令代碼。</p>
<p>  回過頭看 mutex 和 semaphore，mutex 只能限制單一程序進入 critical section，而 semaphore 可以自訂有多少程序可以進度 critical section，就以 binary semaphore 來說，其功能效應等同於 mutex。</p>
</li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-final" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/10/lesson/consumption-final/" class="article-date">
  <time datetime="2014-06-10T00:31:53.000Z" itemprop="datePublished">2014-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1402224448094.jpg" rel="gallery_ciq8w97r602979yxcdumqu520">
        <img src="/img/1402224448094.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/10/lesson/consumption-final/">當代消費文化與社會 (3)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/10/lesson/consumption-final/" data-id="ciq8w97r602979yxcdumqu520" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/10/lesson/consumption-final/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <blockquote><p>作文本文：</p>
<p>看到今年作文的題目：人只有站著世界才屬於他，這使我突然想起一個中國的近代作家的墓誌銘：我死後請將我站著埋葬，因為我活著的時候一直都跪著。</p>
<p>這是一個生在新中國，長在紅旗下的作家，他直到臨死的時候才發出這樣的哀鳴，可見他還是人性未泯，知道跪著的屈辱和站著的不宜。的確，半個世紀以來，中國 人中並不缺少想站著活的人，但他們無一例外成為了“杯具”，我記得其中幾個人的名字：林紹，為了站著說出真理，她被子彈打爆了纖弱的頭顱，並且，他的親人 還要再花上5毛錢來購買奪取親人生命的那顆子彈。楊佳，為了站著討要一個說法，他同樣是被子彈打碎了心臟，唯一和林紹不同的是，他的親人不需要再花錢購買 那顆子彈，這也算是一種時代的進步吧。夏俊峰，僅僅為了站著擺個養家糊口的小攤，他被注射執行了死刑，留了個全屍，感謝黨國的恩典啊！</p>
<p>襯托著以上想站著活著的許多“悲劇”，許多跪著活著的“喜劇”卻不斷挑逗著我們的神經：余秋雨，一個本來才氣橫溢的文化人，為了幾斗米而折腰，留下了“含 淚勸告災民書”這樣的令所有文化人蒙羞的文章。王兆山，一個高居省作協主席的所謂詩人，一首“黨疼國愛，縱做鬼也幸福”的神詩，創造了馬屁文章的又一個巔 峰。胡錫進，環球時報總編，一個堅持論證屎比肉香的報人。他們雖然拋棄了站著活的尊嚴，卻換來了榮華富貴。</p>
<p>今日之中國，“夢”是一個牛逼的不能再牛逼的字詞了，本來最最簡單的站著活著，怎麼就成為了中國人最遙不可及的夢想了呢？如果不是，今天的作文題目就不可 能是這樣的一個題目，在一個正常的社會，站著活著是一個再正常不過的事情了，能夠站著，這個世界上沒有人願意跪著。出題的老師想必也為此困惑，本來是教書 育人的老師，現在成了應試教育這輛戰車上的一個道具或者說是幫兇，學習的目的早已經不是學習知識造福人類這麼單純了，老師的榮譽與收入都和升學率捆綁在了 一起，為了升學率與收入，老師都跪下了，跪在了現實的利益與權力面前。但是，你們既然已經跪下了，為什麼還用這種趙構指鹿為馬的二逼遊戲來挑逗你們的學生 們呢？學生如果站著寫這篇作文，零分估計是跑不掉的，但是，跪著寫站著的讚歌，你們不覺得這樣很殘忍嗎？</p>
<p>我深深地知道，我今天坐在這裡來作這樣一篇作文，我所背負的責任，這是我十二年的寒窗苦讀的艱辛，這是我農民工父母縮衣節食，望子成龍的殷切期盼。這是我 的未來是在工地上搬磚頭還是坐到有空調的寫字樓裡瀟灑最關鍵的時刻。以我的文采，如果你們出一道風花雪月的文章，我劃拉幾筆就對付了，可是，既然你們出了 這樣一個嚴肅的題目，我今天就豁出去得零分大聲地對全世界說：在今天的中國，站著相比於跪著，意味著高考作文得零分，未來只有去搬磚頭。意味著活著艱難甚 至失去生命，如夏俊峰。老師如果站著教書育人，就會失去心愛的講堂，因為這樣會影響升學率。醫生如果站著救死扶傷，他就會被其他收受醫藥廠家回扣的醫生排 擠而失去醫生的工作。員警如果站著執法如山，他就會被貪贓枉法的上司“休假式治療”。在中國，站著不但不能擁有整個世界，恰恰相反，你將失去整個世界，包 括愛你的親人和朋友</p>
<p>也許在很久以後的未來，我們的孩子的孩子們的時代了，那時候自由之光普照大地，每一個站著的人們，或面朝大海，或面朝松濤，能夠大聲地發出沒有強權脅迫的聲音，這聲音，比擁有整個世界還令人期待，令人嚮往！！！</p>
<p>老師：有站著的自由，難道不比擁有整個世界更重要嗎？</p>
<footer><strong>中國高考傳出零分作文︰「自由比擁有世界更重要」</strong><cite><a href="http://news.ltn.com.tw/news/world/breakingnews/1026779" target="_blank" rel="external">news.ltn.com.tw/news/world/breakingnews/1026779</a></cite></footer></blockquote>
<h1 id="此篇要點"><a href="#此篇要點" class="headerlink" title="此篇要點"></a>此篇要點</h1><ul>
<li>期末要繳交本課程學期心得，採以小組繳交。</li>
<li>詳細不明，所以可以個別心得知後彙整？還是著手類似報告書的方式進行？</li>
<li>講得再多、心得再多，通通只不過是理論、理想層面。這些對於我們的反思並沒有任何意義，充其量就是知道，然仍不會去實踐的現實，處事圓滑就是這麼回事。</li>
<li>乃屬反社會化一派</li>
</ul>
<h1 id="課程收錄"><a href="#課程收錄" class="headerlink" title="課程收錄"></a>課程收錄</h1><h2 id="第-1-週-課程簡介簡報"><a href="#第-1-週-課程簡介簡報" class="headerlink" title="第 1 週 課程簡介簡報"></a>第 1 週 課程簡介簡報</h2><blockquote>
<p>所有企業都是誘拐犯，</p>
</blockquote>
<p>企業製造商品，開始讓我們這些生活在這個世代的人不知不覺地習慣它，不知不覺地在任何情況下被催眠去購買。在這樣的情況下，很多文化節日中，什麼節日要過什麼樣的活動、要買什麼樣的禮物早已是商人們的目標所在，很多項目早已「被消費」而我們對於發自自己的想法就越來越少，接受商人們的建議，忘了自己想要做得事情，最後就認為自己根本沒有必要去做那些事情。</p>
<blockquote>
<p>「便利即是一切，大家都這麼做，為什麼要與他人相異？」</p>
</blockquote>
<h2 id="第-2-週-當代消費社會的來臨簡報"><a href="#第-2-週-當代消費社會的來臨簡報" class="headerlink" title="第 2 週 當代消費社會的來臨簡報"></a>第 2 週 當代消費社會的來臨簡報</h2><p>在我眼前所見，這一切都是在催眠，「正因為我們更容易見到彼此，使得我們更在乎彼此。」這一個弱點被商人們抓得死死，逐漸地商品不只有生活基礎所需，需要一個突顯自我的代號，而效果最為顯著的就是使用的物品。</p>
<p>一個人使用什麼商品、習慣參與或在哪一個環境，將成為一個人的特徵，如果沒有這些特徵，對於自我存在的認同就會迷失。在過往的人類中，忙碌使得他們少有時間去思考這些問題，因此將會自然地演化出他們的特徵，而在現今就不同，我們具有額外的時間來裝扮自己，但是裝扮則是由別人來決定，而我們則是選擇消費。這表示著什麼？－將不具有特徵，只是個複製。</p>
<blockquote>
<p>即使包裝地再好，但我們卻沒有擁有自己。</p>
</blockquote>
<h2 id="第-3-週-消費社會學的理論介紹簡報"><a href="#第-3-週-消費社會學的理論介紹簡報" class="headerlink" title="第 3 週 消費社會學的理論介紹簡報"></a>第 3 週 消費社會學的理論介紹簡報</h2><p>「認同」是行為的最終目標，消費則是在行為過程中的描述，而消費使否能體現於現實？這並不全然。如果為追求理想而產出的理念，中間歷經的辛苦算是消費嗎？我們的理念也是需要被認同的！但是這卻不算是消費行為，「努力」一詞難道就是在消費以外的存在。</p>
<blockquote>
<p>我就是那麼一個異教徒，因為堅信別人不認同的理念。</p>
</blockquote>
<p>炫耀性消費這的確令人討厭，這一切的價值觀全都錯亂，「擁有的確令人忌妒，沒有仍可令人輕鬆。」但是我們都是受虐狂，不斷地想要擁有，更增添了自己的憂愁。天生沒有憂愁感測器的人也是存在於世的，這與生長背景有關，通常是生活富裕或者沒有經歷過巨大挫折者。</p>
<h2 id="第-4-週-商品、符號象徵與廣告簡報"><a href="#第-4-週-商品、符號象徵與廣告簡報" class="headerlink" title="第 4 週 商品、符號象徵與廣告簡報"></a>第 4 週 商品、符號象徵與廣告簡報</h2><p>對於一個人的第一印象，如果從「他/她個性很好、思考很機靈 …」到「他/她有 XXX 商品、用什麼、穿什麼 …」那明顯地，我們將開始利用商品來聯想到一個人。</p>
<p>廣告是企業推銷產品的唯一手法，即使是老字號的商品，雖然不用多新奇的廣告內容，但仍需要一段時間就出來宣傳一下 (通常是很長一段時間)。因為廣告效果在世代繼承方面沒有顯著的效果，在每一個世代所偏好的內容不同，因此廣告也必須跟著世代掛勾，這也是為什麼廣告層不窮地想要抓住新的世代來購買他們的商品。</p>
<p>廣告面相不斷地針對年輕族群，甚至對小孩下手，這些在短時間內看不出影響所在，但是長期對於價值觀培養是有一定影響，這可怕之處只有成年人才明白，新的廣告便對成年人的影響力並不高，但是只要從小還是培養 (調教) 將可以終生受用，這是一場可怕的催眠實驗。</p>
<blockquote>
<p>如果人類是有智慧的生物，那小孩到底算不算人類。</p>
</blockquote>
<h2 id="第-5-週-消費者、文化資本與生活風格簡報"><a href="#第-5-週-消費者、文化資本與生活風格簡報" class="headerlink" title="第 5 週 消費者、文化資本與生活風格簡報"></a>第 5 週 消費者、文化資本與生活風格簡報</h2><p>講到情感消費，可謂是情有獨鍾，又或者是曾經因為人生歷史事件而去接觸商品，讓人流連忘返的回憶，而標記物恰好是商品。那種浪漫的事情是多麼崇高啊！一生所追尋得就是這一類型的事情，當然指得並不是黑歷史。</p>
<p>一個人的品味到底有多重要？品味將會反映在生活周遭，買什麼用什麼、會交到什麼朋友 … 等，這一切會從品味著手，而也會有想要轉移目標而改變自己品味的情況，那種契機同時也是消費手段，因此企業也會嘗試將大眾的願景改變，來達到商品推銷。</p>
<h2 id="第-6-週-日本-kawaii-流行文化與消費簡報李世暉"><a href="#第-6-週-日本-kawaii-流行文化與消費簡報李世暉" class="headerlink" title="第 6 週 日本 kawaii 流行文化與消費簡報李世暉"></a>第 6 週 日本 kawaii 流行文化與消費簡報李世暉</h2><h2 id="第-7-週-全球化、跨國公司與消費簡報"><a href="#第-7-週-全球化、跨國公司與消費簡報" class="headerlink" title="第 7 週 全球化、跨國公司與消費簡報"></a>第 7 週 全球化、跨國公司與消費簡報</h2><h2 id="對課程的心得反思"><a href="#對課程的心得反思" class="headerlink" title="對課程的心得反思"></a>對課程的心得反思</h2><p>以上只是部分的課堂筆記，看著其他人寫的心得，我想這應該是要寫對於這門課的心得。我選這門課的原因既不是因為學分不夠，也不是提升學期排名推研究所用途。如果事實如此，這門課就成為被消費的對象，無緣無故地，我們被學校催眠要修這些課程，學校企業也是很可怕的象徵。會有這樣的想法是在修這門課之前就有，而在修這門課又有更加地加深信心，這一切的看法只是單純來自於一個反社會化的怪人，不能大聲說出任何課程的好壞，但增加的是經驗與觀感，必須保有自己的看法，增加思考突變性，否則就只是被世間催眠的對象。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-ci-paper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/09/lesson/hw-ci-paper/" class="article-date">
  <time datetime="2014-06-09T00:58:48.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1402224682465.jpg" rel="gallery_ciq8w97ta02ah9yxchgx1ivx2">
        <img src="/img/1402224682465.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/lesson/hw-ci-paper/">論文選讀 Building optimal regression tree by ant colony system ...</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/09/lesson/hw-ci-paper/" data-id="ciq8w97ta02ah9yxchgx1ivx2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/09/lesson/hw-ci-paper/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/螞蟻算法/">螞蟻算法</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="前文"><a href="#前文" class="headerlink" title="前文"></a>前文</h1><p>課程 <strong> 計算型智慧 </strong> 報告，這是一門碩班課程，因此聽了許多學長的報告，雖然有難有易，牽扯的領域相當繁雜且艱深，例如影像分析、電機、醫學領域 … 等，很多都是有聽沒有懂，但是多少能明白一些些道理，即使後來挑選幾個進行實作，發現自己根本沒有理解，或者只是單純實作能力不足。</p>
<p>其中最常見到的報告內容是 B*-tree with floor plan，對於電子電路的配置擺放，要求最小化面積的操作。當然其中也有幾個跟我報告的預測性有關。對於影響分析就不多述了，其中也有幾個電費電流調控也挺有意思的，總之報告內容相當多元。</p>
<p>報告的時候，教授就在台下緊盯，而我剛好是在教授開會的時候報告，這學期僅我一個在教授不在的情況下報告。</p>
<ul>
<li>One Exam: 30%<br>只有一次期中考，而且還是人腦仿電腦考試，但是題目沒有講清楚，考炸了不少，題目理解上把常數搞錯意思，但是這不影響廣義型算法，希望助教給點分！例如：在基因算法中交配的兩兩交配，難道就不能與自己交配嗎？而在粒子算法中，只給兩個參數，難道就不能只模仿全局最佳點和自己嗎？如果只有兩個參數，而且加總為一，您叫我如何模仿鄰居和自己，看來只能二選一。</li>
<li>Homework: 40% (3 programs)</li>
<li>Presentation: 30%<br>教授不在的情況下仍可以報告，所以成績是由助教評定嗎？</li>
<li>Questions: 3<br>本課程一定要問三個問題，否則視如無效修課，但是問題我總是在課堂中發問，對於學長報告的內容有點作噁不明白。</li>
</ul>
<p>論文挑選為「Building optimal regression tree by ant colony system – genetic algorithm Application to modeling of melting points」這是一篇化學期刊上的運用，不是在計算機領域的論文。</p>
<h1 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h1><h2 id="從一個最簡單的應用開始"><a href="#從一個最簡單的應用開始" class="headerlink" title="從一個最簡單的應用開始"></a>從一個最簡單的應用開始</h2><p>在二十個問題內，能猜出心中想的目標角色。這一類的遊戲相當多，在很多遊戲或者是心理測驗中都會用到，用來預測你大概會是哪一種類型的人、或者正在想什麼。<br><a href="http://en.akinator.com/" target="_blank" rel="external">http://en.akinator.com/</a></p>
<h2 id="決策樹"><a href="#決策樹" class="headerlink" title="決策樹"></a>決策樹</h2><p>決策樹的分類</p>
<ul>
<li>Classification Tree：分類樹<br>分類，輸出 “類型”</li>
<li>Regression Tree：回歸樹<br>關係程度，輸出 “數值”</li>
<li>CART (Classification And Regression Tree) 即上述兩個的總稱</li>
</ul>
<h3 id="關於-CART"><a href="#關於-CART" class="headerlink" title="關於 CART"></a>關於 CART</h3><ul>
<li>大量數據可以快速算出結果</li>
<li>易於理解 和 解釋</li>
<li>可以用統計數據驗證模型</li>
<li>最優 CART 是 NP 問題。</li>
<li>能力有限，只能對有限數據屬性操作</li>
<li>機器學習 Machine Learning 領域常用</li>
</ul>
<h2 id="論文實驗資料"><a href="#論文實驗資料" class="headerlink" title="論文實驗資料"></a>論文實驗資料</h2><ul>
<li>4173 種化合物，分類屬性有 202 種描述方式。在 4173 種化合物中，3000 種用來訓練，1173 種用來驗證。</li>
<li>與另外一組經由 277 種藥物進行熔點預測的 CART 相比。(另外一篇論文做的結果)</li>
<li>目標預測更加準確。</li>
</ul>
<h2 id="CART–ACS–GA-理論"><a href="#CART–ACS–GA-理論" class="headerlink" title="CART–ACS–GA 理論"></a>CART–ACS–GA 理論</h2><ul>
<li>將 ACS – GA 算法，套用在 CART 的建造上。</li>
<li>先說說 <a href="#ACS-GA" title="蟻群遺傳混合算法">ACS – GA</a> 算法運作</li>
</ul>
<h2 id="ACS-GA"><a href="#ACS-GA" class="headerlink" title="ACS-GA"></a>ACS-GA</h2><p>ACS–GA 算法 (蟻群遺傳混合算法)，基於 ACS 的缺點 – 收斂慢，加入 GA 算法來加快。</p>
<ul>
<li>為什麼不單純使用 GA 算法就好？</li>
<li>對問題編碼的困難 (轉 DNA 的問題)，突變效果可能不好</li>
</ul>
<p>螞蟻基因也有好壞問題</p>
<ul>
<li>如何反應基因好壞</li>
<li>對費洛蒙決策的方式</li>
<li>對費洛蒙的敏感度 … 等</li>
</ul>
<p>換句話說，將螞蟻的能力也各自數據化，對於產生較好解的螞蟻，繁殖、交配、突變，接著談論如何運用在 CART！</p>
<h2 id="CART-建造"><a href="#CART-建造" class="headerlink" title="CART 建造"></a>CART 建造</h2><p>假解亂做前，如何隨機？CART 是一棵二分樹<br>How we do ?</p>
<ul>
<li>基於深度優先的方式，直到某個葉節點的分類種數 &lt; 30 或深度大於某個值，就退回。</li>
<li>每一層必須決定 “依據哪個屬性分類” Age ? Gender ? Last R ?</li>
<li>分類時，又要按照什麼 數值 進行分割。&lt; 30 ? &gt; 30 ? = 30 ?</li>
</ul>
<p>假設 CART 有 m 個節點，n 個分類描述。在此篇中，化合物有 202 種描述，即 n = 202。</p>
<ul>
<li>為了表示螞蟻的判斷能力，到達某個節點 i 時，採用下一個分類方式 k 的費洛蒙 M[i][k]<br>i &lt; m, k &lt; n</li>
<li>這樣可以決定分類方式。對於某個節點 i，i 可以是目前累計完成的節點個數，或者是其他。</li>
</ul>
<p>上面決定了分類方式，但沒決定分割點 ( cut point ) 的選擇方式。</p>
<ul>
<li>假設用 10 種決策方式，來對應分類到節點內有的所有項目屬性，進行統計分類。<ul>
<li>決策方式 1：平均、眾數、權重、 ID3、C4.5 (熵理論和訊息增益) … 等分割策略</li>
<li>決策方式 2 : 用 10 個常數對於屬性最大最小值 <code>f(min, max) = x0 * min + x1 * max + x2 * min * max</code></li>
<li>決策方式 3：最大最小值之間切 10 等分。</li>
</ul>
</li>
<li>費洛蒙將會有 10 × n × m，即 M[10][n][m]。</li>
</ul>
<h2 id="關於適應函數"><a href="#關於適應函數" class="headerlink" title="關於適應函數"></a>關於適應函數</h2><h3 id="對於葉節點"><a href="#對於葉節點" class="headerlink" title="對於葉節點"></a>對於葉節點</h3><p>Partial least squares method 不同於 “最小平方法”</p>
<ul>
<li>多因變數 對 多自變數 的回歸建模方法</li>
<li>對於每一個葉節點的所有資料分別做偏最小二乘法，會得到分類的相聯性，也就是 相關係數 (correlation coefficient)</li>
<li>相關係數總和大小 與 適應力高低 成正比，用 驗證集 找到相關係數。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><ul>
<li>對於下次迭代，偏向於好的切割屬性</li>
<li>對於切割屬性，可以得到好的分割點</li>
<li>排除單一分割策略的形式</li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/30/lesson/hw-nachos4-2/" class="article-date">
  <time datetime="2014-05-30T05:34:19.000Z" itemprop="datePublished">2014-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/30/lesson/hw-nachos4-2/">向 NachOS 4.0 作業進發 (2)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/30/lesson/hw-nachos4-2/" data-id="ciq8w97sz02a99yxcuf5jw4vf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/30/lesson/hw-nachos4-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="接續"><a href="#接續" class="headerlink" title="接續"></a>接續</h1><p>接續上一篇的 <a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>，我們繼續完成排程處理，在原始的 NachOS 4.0 中，基礎排程是 Round-robin，它的運作方式藉由定時呼叫 <code>threads/alarm.h</code> 中的 <code>Alarm::CallBack()</code>，而呼叫的時脈來源設定為 <code>machine/stats.h</code> 中的 <code>const int TimerTicks = 100;</code> 決定，數值越小表示呼叫頻率越高，置換的次數就會上升。</p>
<h1 id="目標-Scheduler"><a href="#目標-Scheduler" class="headerlink" title="目標 Scheduler"></a>目標 Scheduler</h1><ul>
<li>FIFO (FCFS) 先來先服務</li>
<li>SJF     最短工作優先</li>
<li>Priority 最小優先權優先</li>
<li>RR    (Round-robin)</li>
<li>multi-level queue <strong> 最後的大魔王 </strong></li>
</ul>
<h1 id="開始"><a href="#開始" class="headerlink" title="開始"></a>開始</h1><h2 id="第一步-測試"><a href="#第一步-測試" class="headerlink" title="第一步 - 測試"></a>第一步 - 測試</h2><p>先來說說怎麼測試自己的寫的代碼正確性，不然怎麼寫都只是理論腦補，雖然會動，但是不知道是否寫對。</p>
<ul>
<li><p>第一種方式為下達 </p>
<pre><code>$ ./nachos -e ../test/test1 -e ../test/test2 ... 多個
</code></pre><p>  這樣必須自己設置優先權、Burst Time，這方面撰寫方式有兩種，其一是來亂，其二是較為正式，而在 Burst Time 的計算又分成兩種，一是執行前已知、二是執行時猜測。</p>
<ul>
<li><p>其一來亂寫法，</p>
<pre><code>$ ./nachos -e ../test/test1 -e ../test/test2 ... 多個
</code></pre><p>  不改變原本的的執行方式，直接在代碼中決策 thread fork 出來時所擁有的優先權和 Burst Time。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> testPriority = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">void</span> </span><br><span class="line">Thread::Fork(VoidFunctionPtr func, <span class="keyword">void</span> *arg)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">    testPriority++;</span><br><span class="line">    <span class="keyword">if</span>(testPriority == <span class="number">1</span>)</span><br><span class="line">        setPriority(<span class="number">64</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(testPriority == <span class="number">2</span>)</span><br><span class="line">        setPriority(<span class="number">128</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        setPriority(<span class="number">64</span>);</span><br><span class="line"><span class="comment">// end morris add</span></span><br></pre></td></tr></table></figure><br>  因此，您可能會寫出以上的代碼，當然我不建議這麼寫，雖然是一種測試方式，但這並不好，一開始就這麼錯得相當離譜。</p>
</li>
<li><p>其二寫法，增加下達參數，不過這些參數格式要去查閱一下他們的參數傳遞建造，我想會寫成大概的樣子為</p>
<pre><code>$ ./nachos -e ../test/test1 -pw 64 -e ../test/test2  -pw 128 ... 
</code></pre><p>  多個為了不增加工作量，這裡就沒有親自去實作。某方面來說，可能要寫很多 small program 進行測試，並且撰寫時還要預測會跑多久，這難度會稍微提高。</p>
</li>
</ul>
</li>
<li><p>第二種方式按照軟工的寫法<br>  來寫 test code 吧！如果細心一點，就會看到相關的 <code>Class::SelfTest()</code> 在很多 class 都有的，因此我們需要把 test code 寫到 SelfTest 中被呼叫。因此，不需要有實體的 process 運行，只是單純地測試我們寫的 scheduler 的排程順序是否正確。<figure class="highlight cpp"><figcaption><span>threads/thread.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span></span><br><span class="line"><span class="title">threadBody</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread *thread = kernel-&gt;currentThread;</span><br><span class="line">    <span class="keyword">while</span> (thread-&gt;getBurstTime() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        thread-&gt;setBurstTime(thread-&gt;getBurstTime() - <span class="number">1</span>);</span><br><span class="line">        kernel-&gt;interrupt-&gt;OneTick();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s: remaining %d\n"</span>, kernel-&gt;currentThread-&gt;getName(), kernel-&gt;currentThread-&gt;getBurstTime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">Thread::SchedulingTest()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> thread_num = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">char</span> *name[thread_num] = &#123;<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> thread_priority[thread_num] = &#123;<span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> thread_burst[thread_num] = &#123;<span class="number">3</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    Thread *t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_num; i ++) &#123;</span><br><span class="line">        t = <span class="keyword">new</span> Thread(name[i]);</span><br><span class="line">        t-&gt;setPriority(thread_priority[i]);</span><br><span class="line">        t-&gt;setBurstTime(thread_burst[i]);</span><br><span class="line">        t-&gt;Fork((VoidFunctionPtr) threadBody, (<span class="keyword">void</span> *)<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    kernel-&gt;currentThread-&gt;Yield();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  請自行在 <code>class Thread</code> 增加 <code>setPriority()</code>, <code>setBurstTime()</code>, <code>SchedulingTest()</code> … 等 method header and body。<figure class="highlight cpp"><figcaption><span>threads/thread.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Thread &#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">   ...</span><br><span class="line">    <span class="comment">// morris add</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBurstTime</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;burstTime = t;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getBurstTime</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> burstTime;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setStartTime</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;startTime = t;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getStartTime</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> startTime;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> t)</span>	</span>&#123;execPriority = t;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPriority</span><span class="params">()</span>		</span>&#123;<span class="keyword">return</span> execPriority;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SchedulingTest</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// some of the private data for this class is listed above</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// morris add</span></span><br><span class="line">    <span class="keyword">int</span> burstTime;	<span class="comment">// predicted burst time</span></span><br><span class="line">    <span class="keyword">int</span> startTime;	<span class="comment">// the start time of the thread</span></span><br><span class="line">    <span class="keyword">int</span> execPriority;	<span class="comment">// the execute priority of the thread</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>  接著是需要 call testcode 加入到 ThreadedKernel 中。<figure class="highlight cpp"><figcaption><span>threads/kernel.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">ThreadedKernel::SelfTest() &#123;</span><br><span class="line">   Semaphore *semaphore;</span><br><span class="line">   SynchList&lt;<span class="keyword">int</span>&gt; *synchList;</span><br><span class="line">   </span><br><span class="line">   LibSelfTest();		<span class="comment">// test library routines</span></span><br><span class="line">   </span><br><span class="line">   currentThread-&gt;SelfTest();	<span class="comment">// test thread switching</span></span><br><span class="line">   Thread::SchedulingTest();   </span><br><span class="line">   				<span class="comment">// test semaphore operation</span></span><br><span class="line">   semaphore = <span class="keyword">new</span> Semaphore(<span class="string">"test"</span>, <span class="number">0</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  因此我們可以利用單一 module 就能進行檢查。</p>
<pre><code>$ cd code/threads
$ ./nachos
</code></pre><p>  但是這種方式，並沒有決定我們要測試哪一種類型的 scheduler，額外需要設定參數，讓其選擇建造哪一種的 <code>readyList(Thread*)</code></p>
<pre><code>$ cd code/threads
$ ./nachos FCFS
$ ./nachos SJF
$ ./nachos Priority
$ ./nachos RR
</code></pre><p>  預計要修成如上述的測試方式。<figure class="highlight cpp"><figcaption><span>threads/main.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span></span><br><span class="line"><span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    debug = <span class="keyword">new</span> Debug(debugArg);</span><br><span class="line">    </span><br><span class="line">    DEBUG(dbgThread, <span class="string">"Entering main"</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    SchedulerType type = RR;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"FCFS"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    type = FIFO;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"SJF"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    type = SJF;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"PRIORITY"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    type = Priority;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">"RR"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    type = RR;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    kernel = <span class="keyword">new</span> KernelType(argc, argv);</span><br><span class="line">    kernel-&gt;Initialize(type);</span><br><span class="line">    </span><br><span class="line">    CallOnUserAbort(Cleanup);		<span class="comment">// if user hits ctl-C</span></span><br><span class="line"></span><br><span class="line">    kernel-&gt;SelfTest();</span><br><span class="line">    kernel-&gt;Run();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<blockquote>
<p>第一步測試撰寫就這麼結束，比起撰寫新的 code，不會進行測試也是徒勞。</p>
<p>雖然這麼說，實際運作也是先寫 code 再寫 test code，因為當時還不太懂這些，所以如果已經先寫了一些也不用難過，大家都是這麼走過來的。</p>
<p>如果不知道怎麼執行，哪還有什麼撰寫的欲望，如果不知道怎麼測試，那就是在黑暗中漫步。</p>
</blockquote>
<h2 id="第二步-撰寫"><a href="#第二步-撰寫" class="headerlink" title="第二步 - 撰寫"></a>第二步 - 撰寫</h2><p>在撰寫開始前，如果使用走第一種測試方式的人，需要將實體記憶體用大一點，否則需要實作虛擬記憶體的 context-swith。</p>
<figure class="highlight cpp"><figcaption><span>machine/machine.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> NumPhysPages = <span class="number">64</span>;  <span class="comment">// morris modify, old value=32</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MemorySize = (NumPhysPages * PageSize);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> TLBSize = <span class="number">4</span>;			<span class="comment">// if there is a TLB, make it small</span></span><br></pre></td></tr></table></figure>
<p>若完成以上的修改，在 <code>/userprog</code> 下，執行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./nachos -e ../test/test1 -e ../test/test2 -e ../test/test1</span><br></pre></td></tr></table></figure></p>
<p>就不會跑出 segment fault 。<br><figure class="highlight cpp"><figcaption><span>threads/scheduler.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> SchedulerType &#123;</span><br><span class="line">        RR,     <span class="comment">// Round Robin</span></span><br><span class="line">        SJF,</span><br><span class="line">        Priority,</span><br><span class="line">        FIFO</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">class</span> Scheduler &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Scheduler();</span><br><span class="line">    Scheduler(SchedulerType type);		<span class="comment">// Initialize list of ready threads </span></span><br><span class="line">    ...</span><br><span class="line">    	<span class="comment">// morris add</span></span><br><span class="line">    <span class="function">SchedulerType <span class="title">getSchedulerType</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> schedulerType;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setSchedulerType</span><span class="params">(SchedulerType t)</span> </span>&#123;schedulerType = t;&#125;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>如果有機會查閱其他代碼，很常見會把 <code>List&lt;Thread *&gt; *readyList;</code> 改成 <code>SortedList&lt;Thread *&gt; *readyList;</code> 但是其實不用的，可以利用多形來完成，畢竟 <code>SortedList</code> 繼承 <code>List</code>。因此是不需要更動的。</p>
<p>接著，我們使用多形，在建構子中決定要用哪一種類型的排程，並且宣告相對應的 <code>compare function</code>，參照如下。<br><figure class="highlight cpp"><figcaption><span>threads/scheduler.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SJFCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a-&gt;getBurstTime() == b-&gt;getBurstTime())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> a-&gt;getBurstTime() &gt; b-&gt;getBurstTime() ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PriorityCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a-&gt;getPriority() == b-&gt;getPriority())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> a-&gt;getPriority() &gt; b-&gt;getPriority() ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FIFOCompare</span><span class="params">(Thread *a, Thread *b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Scheduler::Scheduler</span></span><br><span class="line"><span class="comment">// 	Initialize the list of ready but not running threads.</span></span><br><span class="line"><span class="comment">//	Initially, no ready threads.</span></span><br><span class="line"><span class="comment">//----------------------------------------------------------------------</span></span><br><span class="line">Scheduler::Scheduler() &#123;</span><br><span class="line">    Scheduler(RR);</span><br><span class="line">&#125;</span><br><span class="line">Scheduler::Scheduler(SchedulerType type)</span><br><span class="line">&#123;</span><br><span class="line">    schedulerType = type;</span><br><span class="line">    <span class="keyword">switch</span>(schedulerType) &#123;</span><br><span class="line">    <span class="keyword">case</span> RR:</span><br><span class="line">        readyList = <span class="keyword">new</span> List&lt;Thread *&gt;;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SJF:</span><br><span class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(SJFCompare);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Priority:</span><br><span class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(PriorityCompare);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> FIFO:</span><br><span class="line">        readyList = <span class="keyword">new</span> SortedList&lt;Thread *&gt;(FIFOCompare);</span><br><span class="line">    &#125;</span><br><span class="line">    toBeDestroyed = <span class="literal">NULL</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><br>上述的寫法是因為沒有辦法宣告 default argument value for class。</p>
<p>如果需要搶先 (Preemptive) 設計，則在 <code>Alarm::CallBack()</code> 決定是否要呼叫 <code>interrupt-&gt;YieldOnReturn()</code> 查看是否有更需要優先的 process 要執行。<br><figure class="highlight cpp"><figcaption><span>threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> </span><br><span class="line">Alarm::CallBack() </span><br><span class="line">&#123;</span><br><span class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</span><br><span class="line">    MachineStatus status = interrupt-&gt;getStatus();</span><br><span class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</span><br><span class="line"></span><br><span class="line">    kernel-&gt;currentThread-&gt;setPriority(kernel-&gt;currentThread-&gt;getPriority() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></span><br><span class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</span><br><span class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></span><br><span class="line">    <span class="keyword">if</span>(kernel-&gt;scheduler-&gt;getSchedulerType() == RR ||</span><br><span class="line">        kernel-&gt;scheduler-&gt;getSchedulerType() == Priority ) &#123;</span><br><span class="line"><span class="comment">//		interrupt-&gt;YieldOnReturn();</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"=== interrupt-&gt;YieldOnReturn ==="</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        interrupt-&gt;YieldOnReturn();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 Burst Time 計算上，如果採用運行時估計，可以在以下代碼中進行計算。<code>kernel-&gt;stats-&gt;userTicks</code> 是執行 user program 的時間累加器 (也存有一個 system program 的時間累加器，運行 thread context-free, thread scheduling … 等時間用途。)<br><figure class="highlight cpp"><figcaption><span>threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> </span><br><span class="line">Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</span><br><span class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</span><br><span class="line">    Thread* t = kernel-&gt;currentThread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// burst time</span></span><br><span class="line">    <span class="keyword">int</span> worktime = kernel-&gt;stats-&gt;userTicks - t-&gt;getStartTime();</span><br><span class="line">    t-&gt;setBurstTime(t-&gt;getBurstTime() + worktime);</span><br><span class="line">    t-&gt;setStartTime(kernel-&gt;stats-&gt;userTicks);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    _bedroom.PutToBed(t, x);</span><br><span class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其實到這裡已經完成，接下來就放幾張測試結果。</p>
<p><img src="/img/multiprogramming.png" alt="multi-programming"></p>
<p><img src="/img/FCFS-1.png" alt="FCFS(1)"><br><img src="/img/FCFS-2.png" alt="FCFS(2)"></p>
<p><img src="/img/RR-1.png" alt="RR(1)"><br><img src="/img/RR-2.png" alt="RR(2)"></p>
<p><img src="/img/SJF-1.png" alt="SJF(1)"><br><img src="/img/SJF-2.png" alt="SJF(2)"></p>
<p><img src="/img/Priority-1.png" alt="Priority(1)"><br><img src="/img/Priority-2.png" alt="Priority(1)"></p>
<h1 id="最後"><a href="#最後" class="headerlink" title="最後"></a>最後</h1><p>如果在<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd code</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure></p>
<p>編譯時發生錯誤，想必是兩個地方的 <code>Initialize()</code> 發生錯誤，所以請參照以下代碼進行修改。這問題是發生於我們在 <code>/threads</code> 下修改 main.cc 的關係，所以必須在每一個 kernel 宣告地方都給一個決定 scheduler 類型的參數。</p>
<p>其一,<br><figure class="highlight cpp"><figcaption><span>userprog/userkernel.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"../threads/scheduler.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> SynchDisk;</span><br><span class="line"><span class="keyword">class</span> UserProgKernel : <span class="keyword">public</span> ThreadedKernel &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  	...</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">()</span></span>;		<span class="comment">// initialize the kernel </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(SchedulerType type)</span></span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><br>其二,<br><figure class="highlight cpp"><figcaption><span>userprog/userkernel.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">UserProgKernel::Initialize()</span><br><span class="line">&#123;</span><br><span class="line">    Initialize(RR);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">UserProgKernel::Initialize(SchedulerType type)</span><br><span class="line">&#123;</span><br><span class="line">    ThreadedKernel::Initialize(type);	<span class="comment">// init multithreading</span></span><br><span class="line"></span><br><span class="line">    machine = <span class="keyword">new</span> Machine(debugUserProg);</span><br><span class="line">    fileSystem = <span class="keyword">new</span> FileSystem();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> FILESYS</span></span><br><span class="line">    synchDisk = <span class="keyword">new</span> SynchDisk(<span class="string">"New SynchDisk"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// FILESYS</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>其三,<br><figure class="highlight cpp"><figcaption><span>network/netkernel.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"../threads/scheduler.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> PostOfficeInput;</span><br><span class="line"><span class="keyword">class</span> PostOfficeOutput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> NetKernel : <span class="keyword">public</span> UserProgKernel &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">()</span></span>;		<span class="comment">// initialize the kernel </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(SchedulerType)</span></span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><br>其四,<br><figure class="highlight cpp"><figcaption><span>network/netkernel.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> </span><br><span class="line">NetKernel::Initialize() &#123;</span><br><span class="line">    Initialize(RR);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">NetKernel::Initialize(SchedulerType type)</span><br><span class="line">&#123;</span><br><span class="line">    UserProgKernel::Initialize(type);	<span class="comment">// init other kernel data structs</span></span><br><span class="line"></span><br><span class="line">    postOfficeIn = <span class="keyword">new</span> PostOfficeInput(<span class="number">10</span>);</span><br><span class="line">    postOfficeOut = <span class="keyword">new</span> PostOfficeOutput(reliability, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="致網路資源"><a href="#致網路資源" class="headerlink" title="致網路資源"></a>致網路資源</h1><p>感謝網路上前人們所遺留的遺產。雖然在看不懂的文字中摸索，但仍抓到了一點線索。</p>
<blockquote>
<p>我一無所有，直到見到了你們。</p>
</blockquote>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-multiprocess-and-multithread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/hw-multiprocess-and-multithread/" class="article-date">
  <time datetime="2014-05-25T12:15:47.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/hw-multiprocess-and-multithread/">作業系統 multiprocess &amp; multithread 作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/" data-id="ciq8w97st02a69yxc1unu964h" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/hw-multiprocess-and-multithread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multiprocess/">multiprocess</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/multithread/">multithread</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="A-班程式要求"><a href="#A-班程式要求" class="headerlink" title="A 班程式要求"></a>A 班程式要求</h1><p>請使用所熟悉的程式開發環境設計單一行程產生子行程 ( Child Process ) 與 多執行緒 ( Multi-Thread) 的程式，意即完成下列傳統 for loop 之列印工作，將其改寫成多行程與多執行緒，由不同的行程與執行緒列印不同 i 值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"output i = %d\n"</span>, i);</span><br></pre></td></tr></table></figure>
<h1 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h1><ul>
<li><strong> 嚴禁從網路抄襲作業 </strong>。每份程式作業將被程式比對軟體檢查，一旦發現抄襲，該份作業以零分計，並且這學期作業系統作業成績以零分計。</li>
<li>後略</li>
</ul>
<blockquote>
<p>這種作業不抄來抄去也難。但是作業格式不清楚，所以也有不同理解方式就是了。</p>
</blockquote>
<h1 id="開始動手"><a href="#開始動手" class="headerlink" title="開始動手"></a>開始動手</h1><p>對於將 for 迴圈改寫，我們必須認知到幾項</p>
<ul>
<li>是否要按照順序輸出？</li>
<li>平台 M$, Linux, or Max OS？</li>
</ul>
<blockquote>
<p>此篇假設目標是一模一樣的輸出</p>
</blockquote>
<h2 id="multiprocess"><a href="#multiprocess" class="headerlink" title="multiprocess"></a>multiprocess</h2><p><code>child process</code> 屬於 multiprocess 中的一種方式。為什麼這麼說呢？multiprocess 只是要求一個 CPU 中有多個工作同時在進行，藉由排程器去進行工作分配。</p>
<p>先不管這些，要實作 <code>child process</code> 看起來只有走向 <code>fork()</code> 一途。而之前 inker 大神則是走非 child process 使用類似 <code>./nachos -e ../test/test1 -e ../test/test1</code> 的方式去運行。</p>
<p>為了實作按照順序輸出，我們需要 process 共同擁有的 shared memory，這個 shared memory 將要紀錄原本 for 裡面的 <code>i</code> 值和一個 <code>sem_t</code>，來保證 process 和 process 之間不會同時搶先動作，<code>sem_t</code> 也許是不需要的，這裡留給實驗者去測試。</p>
<p>為了使輸出一致，在 <code>fork()</code> 完之後，使用 <code>wait()</code> 來等待所有子程序結束。這樣會造成當 for loop 需要跑 n 次，就會總共 n 個 process，也就是一整條鏈下去。</p>
<ul>
<li>思考 <code>wait()</code> 和 <code>sem_t</code> 都不是這麼必要？// 這個要看寫法</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  MAP_ANONYMOUS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  MAP_ANON</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAP_ANONYMOUS MAP_ANON</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> *glob_var;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">32</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    glob_var = (<span class="keyword">int</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span> *glob_var, PROT_READ | PROT_WRITE,</span><br><span class="line">                    MAP_SHARED | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">sem_t</span> *sema = (<span class="keyword">sem_t</span> *)mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(sema),</span><br><span class="line">                       PROT_READ |PROT_WRITE,MAP_SHARED|MAP_ANONYMOUS,</span><br><span class="line">                       <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    sem_init(sema, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    *glob_var = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (*glob_var &lt; n) &#123;</span><br><span class="line">        sem_wait(sema);</span><br><span class="line">        <span class="keyword">int</span> pid = fork();</span><br><span class="line">        <span class="keyword">int</span> output = (*glob_var)++;</span><br><span class="line">        <span class="keyword">if</span> (output &lt; n)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d, pid = %d\n"</span>, output, pid);</span><br><span class="line">        sem_post(sema);</span><br><span class="line">        <span class="keyword">int</span> wpid, status = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((wpid = wait(&amp;status)) &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//printf("Exit status of %d was %d (%s)\n", (int)wpid, status, (status &gt; 0) ? "accept" : "reject");</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    munmap(glob_var, <span class="keyword">sizeof</span> *glob_var);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="multithread"><a href="#multithread" class="headerlink" title="multithread"></a>multithread</h2><p>Thread 就相當簡單，因為它們是共用同一個記憶體區段，因此沒有 share memory 的問題。<br>雖然使用 <code>sem_wait(&amp;sem)</code> 和 <code>sem_post(&amp;sem)</code> 來保證區域內的代碼不會同時有多個 thread 在運行，但仍遇到 <code>i = 0</code> 同時在多個 Thread 噴出的情況，這一點百思不得其解，為了解決這一切問題，使用課本提到的 <code>Producer–consumer problem</code> 寫法。</p>
<p>希望能從代碼中看懂。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;semaphore.h&gt;</span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line">int i = 0, n = 16;</span><br><span class="line">int count = 0;</span><br><span class="line">sem_t sem;</span><br><span class="line">const int MAX_THREAD = 4;</span><br><span class="line">void *Producer(void *arg) &#123;</span><br><span class="line">    for(int i = 0; i &lt; n;) &#123;</span><br><span class="line">        sem_wait(&amp;sem);</span><br><span class="line">        if(count == 1) &#123;</span><br><span class="line">            sem_post(&amp;sem);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        // printf("\nProducer is :%d\n", count);</span><br><span class="line">        sem_post(&amp;sem);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">&#125;</span><br><span class="line">void *runPrint(void *arg) &#123;</span><br><span class="line">    int id = *((int *) arg);</span><br><span class="line">    for (; i &lt; n ;) &#123;</span><br><span class="line">        sem_wait(&amp;sem);</span><br><span class="line">        if (count == 0) &#123;</span><br><span class="line">            sem_post(&amp;sem);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        count--;</span><br><span class="line">        i++;</span><br><span class="line">        printf("loop i = %d, thread id %d\n", i, id);</span><br><span class="line">        sem_post(&amp;sem);</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    pthread_t *threads;</span><br><span class="line">    sem_init(&amp;sem, 0, 0);</span><br><span class="line">    threads = (pthread_t *) malloc(MAX_THREAD * sizeof(pthread_t));</span><br><span class="line">    for (int i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        int *p = (int *) malloc(sizeof(int));</span><br><span class="line">        *p = i;</span><br><span class="line">        pthread_create(&amp;threads[i], NULL, runPrint, (void *)(p));</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_t producer;</span><br><span class="line">    int *p = (int *) malloc(sizeof(int));</span><br><span class="line">    *p = -1;</span><br><span class="line">    pthread_create(&amp;producer, NULL, Producer, (void *)(p));</span><br><span class="line">    for (i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        pthread_join(threads[i], NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    sem_destroy(&amp;sem);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="後記"><a href="#後記" class="headerlink" title="後記"></a>後記</h2><p>代碼沒有寫得很完整，也就是能達到輸出相同且用符合需求，這一點是有很多漏洞的，前人也是鑽漏洞交作業的。相較之下，我們 B 班的作業略顯兇殘，但是網路上資料還真是少呢，雖然還是找地方抄和理解。</p>
<p>測試的時候，為了保證輸出是穩定的，記得得多測試幾次，並且把數字範圍作變調，當然能不能讓一個 create thread 跑完整個迴圈呢？畢竟加上 main thread 就算是 multithread？haha</p>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><h2 id="編譯"><a href="#編譯" class="headerlink" title="編譯"></a>編譯</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre><h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2></li>
<li><p>Linux &amp; Max OSX</p>
<pre><code>$ ./x
</code></pre></li>
</ul>
<h1 id="Mac-運行問題"><a href="#Mac-運行問題" class="headerlink" title="Mac 運行問題"></a>Mac 運行問題</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifndef  MAP_ANONYMOUS</span><br><span class="line">#ifdef  MAP_ANON</span><br><span class="line">#define MAP_ANONYMOUS MAP_ANON</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>不知道為什麼 clang 中沒有定義 <code>MAP_ANONYMOUS</code>，增加上述代碼後正確運行。</p>
<h1 id="其他作業"><a href="#其他作業" class="headerlink" title="其他作業"></a>其他作業</h1><p><a href="http://morris821028.github.io/2014/05/18/operating-system-hw-thread/">B 班程式作業 1</a><br><a href="http://morris821028.github.io/2014/05/24/hw-nachos4/">B 班程式作業 2</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/consumption-item-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/25/lesson/consumption-item-1/" class="article-date">
  <time datetime="2014-05-25T06:22:22.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/通識課程/">通識課程</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/sungirl3.jpg" rel="gallery_ciq8w97qf028r9yxclh9uur0s">
        <img src="/img/sungirl3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/lesson/consumption-item-1/">當代消費文化與社會 (2)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/" data-id="ciq8w97qf028r9yxclh9uur0s" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/25/lesson/consumption-item-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/通識/">通識</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="母親節篇"><a href="#母親節篇" class="headerlink" title="母親節篇"></a>母親節篇</h2><ol>
<li>請簡述母親節與消費文化的關聯性 ?<br>母親節與消費文化原本是扯不上邊的，後來商人們藉由這些推銷的活動，給予不知道母親節要怎麼犒勞養育辛勞的兒女們一項消費選擇，因此提供了相關的優惠活動方便消費者，母親節就逐漸跟情人節送禮一樣的氣氛。</li>
<li>舉例說明母親節有哪些消費現象 ?<br>相關女性用品優惠，對於餐飲業而言就是雙人、多人套餐，而觀光景點就是帶著母親出遊享優惠 … 等等。</li>
<li>您決定購買什麼禮物送媽媽及其理由 ?<br>身為一個程序猿，買禮物卻沒有思路，寫卡片卻沒有語言，在這樣的情況下，按照自己最常做的事情下手設計，但最近還有其他程序要趕，大概是趕不上這個母親節專案了。</li>
</ol>
<h2 id="血色月灣"><a href="#血色月灣" class="headerlink" title="血色月灣"></a>血色月灣</h2><div class="video-container"><iframe src="//www.youtube.com/embed/ypeW6lSeUFc" frameborder="0" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ypeW6lSeUFc" target="_blank" rel="external">Youtube</a></p>
<p>在這場被隱藏的殺戮中，繼上次壽司造成的魚類問題，沒想到日本又在海洋造成了更大的傷害，不管是不是海豚，也許有人會因為海豚可愛而在這一次的血色海灣而保護它，在我們不喜歡的動物上，說不定也有類似的問題。</p>
<p>最令人訝異的是，即使在國際會議中，也有隱瞞事實的大人物在，果然要執行某些事情，不是會議或者是組織所為，而是來自個人的發起。這句話有額外的啟發，為了背後國民的飯碗或支持，這些代表人物不得不說謊的情境，假使一開始錯了，他們便會一直錯下去，這樣的情況令人相當惋惜。</p>
<p>海豚的確很有靈性，在他們受到如此的遭遇，難免會感受到如新世界中，那些因為外表被看成不同種的情況，而受到摧殘的可能，對於靈性的動物，在受到傷害，我們給予同情，在其他情況下則沒有這麼強烈的反應。</p>
<h2 id="消費型科技商品"><a href="#消費型科技商品" class="headerlink" title="消費型科技商品"></a>消費型科技商品</h2><p>現在出門一定有 GPS 衛星導航的裝置，才能穿梭於大街小巷，這些裝置給我們相當大的便利，不用攜帶大量的地圖資訊出門，不會迷路、不用煩惱就可以輕鬆出門。</p>
<p>科技所帶來的便利，使得停下來思考的機會少了，也不會看看四周的景色，追求更快速地抵達目的地，目的地以外的機緣就越來越少了。比起問人，問機器更來得有信任感，這也表示著相信別人給的知識也不是那麼重要。根據新聞的研究報導，也許我們正在改變記憶方式，開始不擅長記繁瑣的事物，而開始擅長去哪裡找資料、如何使用資料。</p>
<p>因此，也常發生因衛星導航所造成的交通事故，被引導到錯誤地方或者是進入不合適的地點。這也反應使用者即使發現了不合理之處，最後仍相信訊息給的答案。假使衛星給了錯誤訊息，或者被惡意修改成錯誤訊息，很容易造就嚴重事故，我們已經被訓練得無法自己處理這些資訊。</p>
<p>也許老師會問我「那你認為到底要不要買衛星導航？」這一點還真的是要看需求，身為宅的人們不喜歡出門呢。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-nachos4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/24/lesson/hw-nachos4/" class="article-date">
  <time datetime="2014-05-24T00:14:43.000Z" itemprop="datePublished">2014-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/24/lesson/hw-nachos4/">向 NachOS 4.0 作業進發 (1)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/" data-id="ciq8w97u102aw9yxce3p49syj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/24/lesson/hw-nachos4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NachOS/">NachOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="關於-NachOS-4-0"><a href="#關於-NachOS-4-0" class="headerlink" title="關於 NachOS 4.0"></a>關於 NachOS 4.0</h1><p>作為教學用作業系統，需要實現簡單並且儘量縮小與實際作業系統之間的差距，所以我們採用 Nachos 作為作業系統課程的教學實踐平臺。Nachos 是美國加州大學伯克萊分校在作業系統課程中已多次使用的作業系統課程設計平臺，在美國很多大學中得到了應用，它在作業系統教學方面具有一下幾個突出的優點：</p>
<ul>
<li>採用通用虛擬機器</li>
<li>簡單而易於擴展    </li>
<li>物件導向性</li>
<li>… 略</li>
</ul>
<blockquote>
<p>簡單地來說，就是一個模擬作業系統的軟體</p>
</blockquote>
<h1 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h1><p>課程頁面：<a href="http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download" target="_blank" rel="external">http://networklab.csie.ncu.edu.tw/2014_os/osweb.html#download</a></p>
<ul>
<li>Platform: Linux or Linux over VMware <pre><code>RedHat Linux 9.0 
</code></pre>  在 Ubuntu 上面運行無法</li>
<li>Install steps<ul>
<li>Get NachOS-4.0<pre><code>wget ../nachos-4.0.tar.gz
</code></pre></li>
<li>Get Cross Compiler<pre><code>wget ../mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Move Cross Compiler to /<pre><code>mv ./mips-decstation.linux-xgcc.tgz /
</code></pre></li>
<li>Untar Cross Compiler<pre><code>tar zxvf ./mips-decstation.linux-xgcc.tgz
</code></pre></li>
<li>Untar NachOS-4.0<pre><code>tar zxvf ./nachos-4.0.tar.gz
</code></pre></li>
<li>Make NachOS-4.0<pre><code>cd ./nachos-4.0/code
make
</code></pre></li>
<li>Test if installation is succeeded<pre><code>cd ./userprog
./nachos -e ../test/test1
./nachos -e ../test/test2
</code></pre></li>
</ul>
</li>
</ul>
<p>預期運行結果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Total threads number is 1</span><br><span class="line">Thread ../test/test1 is executing.</span><br><span class="line">Print integer:9</span><br><span class="line">Print integer:8</span><br><span class="line">Print integer:7</span><br><span class="line">Print integer:6</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line">                                                                                </span><br><span class="line">Ticks: total 200, idle 66, system 40, user 94</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br><span class="line"></span><br><span class="line">Total threads number is 1</span><br><span class="line">Thread ../test/test2 is executing.</span><br><span class="line">Print integer:20</span><br><span class="line">Print integer:21</span><br><span class="line">Print integer:22</span><br><span class="line">Print integer:23</span><br><span class="line">Print integer:24</span><br><span class="line">Print integer:25</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line"></span><br><span class="line">Ticks: total 200, idle 32, system 40, user 128</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br></pre></td></tr></table></figure></p>
<h1 id="作業階段"><a href="#作業階段" class="headerlink" title="作業階段"></a>作業階段</h1><h2 id="Multiprogramming"><a href="#Multiprogramming" class="headerlink" title="Multiprogramming"></a>Multiprogramming</h2><p>執行下述指令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nachos –e ../test/test1 –e ../test/test2</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><figcaption><span>test1.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n=<span class="number">9</span>;n&gt;<span class="number">5</span>;n--)</span><br><span class="line">        PrintInt(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>test2.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n=<span class="number">20</span>;n&lt;=<span class="number">25</span>;n++)</span><br><span class="line">        PrintInt(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在開始動工前，發現在 Multithread 操作會有錯誤，test1 程序會遞減輸出，而 test2 程序會遞增輸出，但是根據運行結果，兩個程式都會遞增輸出。</p>
<p>目標運行結果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Total threads number is 2</span><br><span class="line">Thread ../test/test1 is executing.</span><br><span class="line">Thread ../test/test2 is executing.</span><br><span class="line">Print integer:9</span><br><span class="line">Print integer:8</span><br><span class="line">Print integer:7</span><br><span class="line">Print integer:20</span><br><span class="line">Print integer:21</span><br><span class="line">Print integer:22</span><br><span class="line">Print integer:23</span><br><span class="line">Print integer:24</span><br><span class="line">Print integer:6</span><br><span class="line">return value:0</span><br><span class="line">Print integer:25</span><br><span class="line">return value:0</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line"> </span><br><span class="line">Ticks: total 300, idle 8, system 70, user 222</span><br><span class="line">Disk I/O: reads 0, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br></pre></td></tr></table></figure></p>
<ul>
<li>為什麼兩個程式都會遞增輸出？<br>明顯地是兩個程式匯入時，操作到相同區域的 code segment。如果發現各別遞增和遞減，但是輸出 <code>n</code> 的結果錯誤，則可以想到是 <code>context-switch</code> 上發生問題。</li>
</ul>
<h3 id="解決"><a href="#解決" class="headerlink" title="解決"></a>解決</h3><p>需要為 physical address 做標記，這個 physical address 就是在 main memory 裡面的位置。而每一個 process 都會有一個 AddrSpace，然後紀錄 logical address 所對應在 physical address，也就是 <code>pageTable</code> 對應到 <code>pageTable[i].physicalPage</code>。</p>
<p>也就是說，當要執行 process 某一頁的程序，則將會去找 pageTable 所對應的 physicalPage，然後去運行。在作業一開始給的代碼中，會發現所有程序的 physicalPage 都共用，如此一來當然會執行到同一份 code。</p>
<p>首先，我們需要一個全局的標記，來記錄 main memory page 的情況。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> AddrSpace &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> usedPhyPage[NumPhysPages];</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接著，在 addrspace.cc 宣告實體，並且初始化是 <code>0</code>，表示全部都還沒有用過。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"copyright.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"main.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"addrspace.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"machine.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"noff.h"</span></span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">bool</span> AddrSpace::usedPhyPage[NumPhysPages] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>當 process 執行成功後，將會釋放資源。此時將要把標記使用的 page 設回未使用。<br><figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AddrSpace::~AddrSpace()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numPages; i++)</span><br><span class="line">        AddrSpace::usedPhyPage[pageTable[i].physicalPage] = <span class="literal">false</span>;</span><br><span class="line">   <span class="keyword">delete</span> pageTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最後，就是稍微麻煩的地方，當將程序載入記憶體時，要去填入 <code>pageTable[]</code> 對應的 <code>physicalPage</code>，這裡使用線性時間去搜索第一個未使用的 page 進行填入。</p>
<p>載入確定後，便要開始執行，執行的時候要去算程序進入點，進入點的位置即是 main memory address。</p>
<p><code>mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]</code></p>
<p>首先算出第幾頁，然後乘上 <code>PageSize</code> 就是 page base，而 page offset 則是 <code>code.address mod PageSize</code>。</p>
<p>最後，<code>page base + page offset</code> 就是我們所需要的程序進入點。</p>
<figure class="highlight cpp"><figcaption><span>usrprog/addrspace.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> AddrSpace::Load(<span class="keyword">char</span> *fileName) &#123;</span><br><span class="line">    OpenFile *executable = kernel-&gt;fileSystem-&gt;Open(fileName);</span><br><span class="line">    NoffHeader noffH;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (executable == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="built_in">cerr</span> &lt;&lt; <span class="string">"Unable to open file "</span> &lt;&lt; fileName &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    executable-&gt;ReadAt((<span class="keyword">char</span> *)&amp;noffH, <span class="keyword">sizeof</span>(noffH), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((noffH.noffMagic != NOFFMAGIC) &amp;&amp; </span><br><span class="line">        (WordToHost(noffH.noffMagic) == NOFFMAGIC))</span><br><span class="line">    	SwapHeader(&amp;noffH);</span><br><span class="line">    ASSERT(noffH.noffMagic == NOFFMAGIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// how big is address space?</span></span><br><span class="line">    size = noffH.code.size + noffH.initData.size + noffH.uninitData.size </span><br><span class="line">            + UserStackSize;	<span class="comment">// we need to increase the size</span></span><br><span class="line">                        <span class="comment">// to leave room for the stack</span></span><br><span class="line">    numPages = divRoundUp(size, PageSize);</span><br><span class="line"><span class="comment">//	cout &lt;&lt; "number of pages of " &lt;&lt; fileName&lt;&lt; " is "&lt;&lt; numPages &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">    pageTable = <span class="keyword">new</span> TranslationEntry[numPages];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; numPages; i++) &#123;</span><br><span class="line">        pageTable[i].virtualPage = i;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; NumPhysPages &amp;&amp; AddrSpace::usedPhyPage[j] == <span class="literal">true</span>)</span><br><span class="line">            j++;</span><br><span class="line">        AddrSpace::usedPhyPage[j] = <span class="literal">true</span>;</span><br><span class="line">        pageTable[i].physicalPage = j;</span><br><span class="line">        pageTable[i].valid = <span class="literal">true</span>;</span><br><span class="line">        pageTable[i].use = <span class="literal">false</span>;</span><br><span class="line">        pageTable[i].dirty = <span class="literal">false</span>;</span><br><span class="line">        pageTable[i].readOnly = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    size = numPages * PageSize;</span><br><span class="line"></span><br><span class="line">    ASSERT(numPages &lt;= NumPhysPages);		<span class="comment">// check we're not trying</span></span><br><span class="line">                        <span class="comment">// to run anything too big --</span></span><br><span class="line">                        <span class="comment">// at least until we have</span></span><br><span class="line">                        <span class="comment">// virtual memory</span></span><br><span class="line"></span><br><span class="line">    DEBUG(dbgAddr, <span class="string">"Initializing address space: "</span> &lt;&lt; numPages &lt;&lt; <span class="string">", "</span> &lt;&lt; size);</span><br><span class="line"></span><br><span class="line"><span class="comment">// then, copy in the code and data segments into memory</span></span><br><span class="line">    <span class="keyword">if</span> (noffH.code.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        DEBUG(dbgAddr, <span class="string">"Initializing code segment."</span>);</span><br><span class="line">    DEBUG(dbgAddr, noffH.code.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.code.size);</span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">        	executable-&gt;ReadAt(</span><br><span class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.code.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]), </span><br><span class="line">            noffH.code.size, noffH.code.inFileAddr);</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (noffH.initData.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        DEBUG(dbgAddr, <span class="string">"Initializing data segment."</span>);</span><br><span class="line">    DEBUG(dbgAddr, noffH.initData.virtualAddr &lt;&lt; <span class="string">", "</span> &lt;&lt; noffH.initData.size);</span><br><span class="line"><span class="comment">// morris add</span></span><br><span class="line">        executable-&gt;ReadAt(</span><br><span class="line">        &amp;(kernel-&gt;machine-&gt;mainMemory[pageTable[noffH.initData.virtualAddr/PageSize].physicalPage * PageSize + (noffH.code.virtualAddr%PageSize)]),</span><br><span class="line">            noffH.initData.size, noffH.initData.inFileAddr);</span><br><span class="line"><span class="comment">// end morris add</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> executable;			<span class="comment">// close file</span></span><br><span class="line">    <span class="keyword">return</span> TRUE;			<span class="comment">// success</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Sleep-System-call"><a href="#Sleep-System-call" class="headerlink" title="Sleep() System call"></a>Sleep() System call</h2><p>撰寫自己的 Sleep function，將該 Thread 進入休眠。</p>
<h3 id="測試檔案"><a href="#測試檔案" class="headerlink" title="測試檔案"></a>測試檔案</h3><p>與一開始的 <code>test1.c</code> 很像，這裡先做個簡單測試。<br><figure class="highlight cpp"><figcaption><span>/code/test/sleep.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"syscall.h"</span></span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        Sleep(<span class="number">10000000</span>);</span><br><span class="line">        PrintInt(<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>因為整個測試檔案是要能在 nachOS 上面跑，所以不能使用一般的編譯方式？所以把這些訊息寫入 <code>Makefile</code> 中，之後下 <code>$ make</code> 產出 <code>sleep</code> 即可。<br><figure class="highlight"><figcaption><span>/code/test/Makefile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">all: halt shell matmult sort test1 test2 sleep</span><br><span class="line">...</span><br><span class="line">sleep: sleep.o start.o</span><br><span class="line">    &lt;span&gt;$(LD)$&lt;/span&gt;&lt;!-- Has MathJax --&gt;(LDFLAGS) start.o sleep.o -o sleep.coff</span><br><span class="line">    ../bin/coff2noff sleep.coff sleep</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如果無法在 <code>/code/test</code> 下 <code>$ make</code> 順利產出，則請參照 <strong> 其他指令 </strong>，將原本下載的 <code>mips-decstation.linux-xgcc.gz</code> 解壓縮產生的 <code>/usr</code> 移動到正確位置。</p>
</blockquote>
<h3 id="解決-1"><a href="#解決-1" class="headerlink" title="解決"></a>解決</h3><p>首先，要模仿 <code>PrintInt()</code>，找到切入的宣告位置。努力地尾隨前人。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/syscall.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_PrintInt	11</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_Sleep	12</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInt</span><span class="params">(<span class="keyword">int</span> number)</span></span>;	<span class="comment">//my System Call</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sleep</span><span class="params">(<span class="keyword">int</span> number)</span></span>;         <span class="comment">// morris add</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>接著，找一下 ASM。<br>以下部分就不得而知了，為什麼會出現在 <code>/code/test</code> 目錄下。<br><figure class="highlight"><figcaption><span>/code/test/start.s</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    ...</span><br><span class="line">PrintInt:</span><br><span class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_PrintInt</span><br><span class="line">    syscall</span><br><span class="line">    j       $31</span><br><span class="line">    .end    PrintInt</span><br><span class="line"></span><br><span class="line">    .globl  Sleep</span><br><span class="line">    .ent	Sleep</span><br><span class="line">Sleep:</span><br><span class="line">    addiu   &lt;span&gt;$2,$&lt;/span&gt;&lt;!-- Has MathJax --&gt;0,SC_Sleep</span><br><span class="line">    syscall</span><br><span class="line">    j	$31</span><br><span class="line">    .end	Sleep</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<p>最後，確定 nachOS 會處理我們的例外操作。</p>
<figure class="highlight cpp"><figcaption><span>/code/userprog/exception.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    ...</span><br><span class="line"><span class="keyword">case</span> SC_PrintInt:</span><br><span class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Print integer:"</span> &lt;&lt; val &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">case</span> SC_Sleep:</span><br><span class="line">    val=kernel-&gt;machine-&gt;ReadRegister(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Sleep Time "</span> &lt;&lt; val &lt;&lt; <span class="string">"(ms) "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    kernel-&gt;alarm-&gt;WaitUntil(val);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>到這裡需要喘口氣，剛找了一陣子的代碼。接著才是重頭戲，因為你看到了 <code>kernel-&gt;alarm-&gt;WaitUntil(val);</code> 出現了。沒錯！我們需要撰寫那邊的代碼。</p>
</blockquote>
<p>既然 kernel 存有 <code>alarm</code>，也就是說每隔固定一段間，就會呼叫 <code>Alarm::CallBack()</code>，因此，對於這個鬧鐘來個累加器 <code>Bedroom::_current_interrupt</code>，全局去記數，當作毫秒 (ms) 看待就可以，每加一次就相當於過了 1 毫秒 (ms)。</p>
<p>假設現在某一個 <code>time = _current_interrupt</code> 呼叫 <code>Sleep(x)</code> 後，將 <code>(Thread address, _current_interrupt + x)</code> 丟入 List，則期望在 <code>_current_interrupt + x</code> 的時候甦醒。因此，每當 _current_interrupt++ 就去檢查 List 中，誰的預期時間小於 _current_interrupt，就將其從 List 中清除。</p>
<blockquote>
<p>這裡先不考慮 _current_interrupt Overflow 的問題，根據電腦效率，可能在 5 ~ 10 秒內就發生一次，此時會造成所有 Thread 沉眠很久。若察覺 Sleep 太久，則是發生 Overflow。</p>
</blockquote>
<ul>
<li>當有程序呼叫 <code>Sleep()</code> 時，會呼叫 <code>WaitUntil()</code>，然後將其丟入 <code>Bedroom</code> 安眠。</li>
<li>然後在 <code>CallBlack()</code> 被呼叫時，來去 <code>Bedroom</code> 檢查誰該醒來了。</li>
</ul>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"copyright.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"utility.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"callback.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"timer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"thread.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Bedroom &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        Bedroom():_current_interrupt(<span class="number">0</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">PutToBed</span><span class="params">(Thread *t, <span class="keyword">int</span> x)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">MorningCall</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">class</span> Bed &#123;</span><br><span class="line">            <span class="keyword">public</span>:</span><br><span class="line">                Bed(Thread* t, <span class="keyword">int</span> x):</span><br><span class="line">                    sleeper(t), when(x) &#123;&#125;;</span><br><span class="line">                Thread* sleeper;</span><br><span class="line">                <span class="keyword">int</span> when;</span><br><span class="line">        &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> _current_interrupt;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt; _beds;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The following class defines a software alarm clock. </span></span><br><span class="line"><span class="keyword">class</span> Alarm : <span class="keyword">public</span> CallBackObj &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Alarm(<span class="keyword">bool</span> doRandomYield);	<span class="comment">// Initialize the timer, and callback </span></span><br><span class="line">                <span class="comment">// to "toCall" every time slice.</span></span><br><span class="line">    ~Alarm() &#123; <span class="keyword">delete</span> timer; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">WaitUntil</span><span class="params">(<span class="keyword">int</span> x)</span></span>;	<span class="comment">// suspend execution until time &gt; now + x</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    Timer *timer;		<span class="comment">// the hardware timer device</span></span><br><span class="line">    Bedroom _bedroom;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallBack</span><span class="params">()</span></span>;		<span class="comment">// called when the hardware</span></span><br><span class="line">                <span class="comment">// timer generates an interrupt</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>確定有哪些 method 就可以開始實作了。</p>
<figure class="highlight cpp"><figcaption><span>/code/threads/alarm.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Alarm::CallBack() &#123;</span><br><span class="line">    Interrupt *interrupt = kernel-&gt;interrupt;</span><br><span class="line">    MachineStatus status = interrupt-&gt;getStatus();</span><br><span class="line">    <span class="keyword">bool</span> woken = _bedroom.MorningCall();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (status == IdleMode &amp;&amp; !woken &amp;&amp; _bedroom.IsEmpty()) &#123;<span class="comment">// is it time to quit?</span></span><br><span class="line">        <span class="keyword">if</span> (!interrupt-&gt;AnyFutureInterrupts()) &#123;</span><br><span class="line">        timer-&gt;Disable();	<span class="comment">// turn off the timer</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;			<span class="comment">// there's someone to preempt</span></span><br><span class="line">    interrupt-&gt;YieldOnReturn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Alarm::WaitUntil(<span class="keyword">int</span> x) &#123;</span><br><span class="line">    IntStatus oldLevel = kernel-&gt;interrupt-&gt;SetLevel(IntOff);</span><br><span class="line">    Thread* t = kernel-&gt;currentThread;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Alarm::WaitUntil go sleep"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    _bedroom.PutToBed(t, x);</span><br><span class="line">    kernel-&gt;interrupt-&gt;SetLevel(oldLevel);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Bedroom::IsEmpty() &#123;</span><br><span class="line">    <span class="keyword">return</span> _beds.size() == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Bedroom::PutToBed(Thread*t, <span class="keyword">int</span> x) &#123;</span><br><span class="line">    ASSERT(kernel-&gt;interrupt-&gt;getLevel() == IntOff);</span><br><span class="line">    _beds.push_back(Bed(t, _current_interrupt + x));</span><br><span class="line">    t-&gt;Sleep(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Bedroom::MorningCall() &#123;</span><br><span class="line">    <span class="keyword">bool</span> woken = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    _current_interrupt ++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">list</span>&lt;Bed&gt;::iterator it = _beds.begin(); </span><br><span class="line">        it != _beds.end(); ) &#123;</span><br><span class="line">        <span class="keyword">if</span>(_current_interrupt &gt;= it-&gt;when) &#123;</span><br><span class="line">            woken = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"Bedroom::MorningCall Thread woken"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            kernel-&gt;scheduler-&gt;ReadyToRun(it-&gt;sleeper);</span><br><span class="line">            it = _beds.erase(it);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            it++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> woken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到這裡我們就完成 <code>Sleep()</code> 製作。</p>
<p>在下一階段，將要加入排程的製作。</p>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><p>目標完成 SJF, RR, FIFO。<br>請參閱 “向 NachOS 4.0 作業進發 (2)”</p>
<h1 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h1><ul>
<li><p>打包轉移 // 交作業前，將檔案包出傳送，此指令不是壓縮用途</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar cvf FileName.tar DirName</span><br></pre></td></tr></table></figure>
</li>
<li><p>複製資料夾 // 將 nachos gcc library 搬移至 <code>/usr/local/nachos ...</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp -a DirName TARGET_PATH</span><br></pre></td></tr></table></figure>
</li>
<li><p>轉移至 root 權限 // 如果指令權限不夠，需要下達此指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="備忘"><a href="#備忘" class="headerlink" title="備忘"></a>備忘</h1><ul>
<li>網路上有幾個 Java 版本的 NachOS，架構稍微不同，如果發現文章說明有點怪怪的，請看一下他是用 JAVA 版本還是 C++ 版本。</li>
<li>至於怎麼將檔案從 Red Hat，這有點惱人，可以想辦法安裝其他瀏覽器，然後開 e-mail 送出，或者使用 terminal 上的 wget 安裝 … 一堆辦法。最後我自己用 nodejs 寫一個簡單的 upload server 傳出來。</li>
</ul>
<h1 id="代碼下載"><a href="#代碼下載" class="headerlink" title="代碼下載"></a>代碼下載</h1><p><a href="https://github.com/morris821028/hw-nachos-4.0" target="_blank" rel="external">Github</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/hw-computational-intelligence" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/19/lesson/hw-computational-intelligence/" class="article-date">
  <time datetime="2014-05-19T11:47:28.000Z" itemprop="datePublished">2014-05-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/19/lesson/hw-computational-intelligence/">計算型智慧 程式作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/" data-id="ciq8w97t602ad9yxcd4urdfyb" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/19/lesson/hw-computational-intelligence/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fuzzy-System/">Fuzzy System</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GA/">GA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PSO/">PSO</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="Computational-Intelligence-計算型智慧"><a href="#Computational-Intelligence-計算型智慧" class="headerlink" title="Computational Intelligence 計算型智慧"></a>Computational Intelligence 計算型智慧</h1><p>本課程將會有三階段程式，將三個算法依序加入程式中，為了要實作這些算法，必須先作出模擬器。</p>
<h2 id="Lv-0-模擬器"><a href="#Lv-0-模擬器" class="headerlink" title="Lv. 0 模擬器"></a>Lv. 0 模擬器</h2><p>在一個 2D 平面中，以一個圓形當作車子，道路為線段的方式進行描述。為了在隨後的擴充，將地圖內容物分成可行區域多邊形和障礙物多邊形。</p>
<ul>
<li>要支持車子下一秒的擺角，並且按下推動鍵會根據方程式進行移動。</li>
<li>可以將車子兩側的感測器進行角度調整，並且可以根據感測器角度進行距離計算。</li>
<li>並且在呈現 2D 平面時，附加顯示座標軸的比例。</li>
</ul>
<p><img src="/img/hw-ci-0.PNG" alt="完成圖"></p>
<p>由於私心，有一些額外產物。</p>
<ul>
<li>完成可以自動置中的設定</li>
<li>提供地圖縮放和讀取操作</li>
<li>製作地圖產生器 (other project)</li>
<li>模擬器的彈木遊戲番外篇 (other project)</li>
<li>提供運行欄位的縮起</li>
</ul>
<h2 id="Lv-1-模糊系統"><a href="#Lv-1-模糊系統" class="headerlink" title="Lv. 1 模糊系統"></a>Lv. 1 模糊系統</h2><p>車子運行公式</p>
<p><img src="/img/hw-ci-1.PNG" alt="運行公式"></p>
<p>其中 Φ(t) 是模型車與水平軸的角度，b 是模型車的長度，x 與 y 是模型車的座標位置， Θ(t) 是模型車方向盤所打的角度，我們對模擬的輸入輸出變數限制如下：</p>
<p><code>-40 deg &lt;= Θ(t) &lt;= 40 deg</code></p>
<p>寫一個程式使用模糊系統、理論模擬車子行徑，並且想辦法最佳化。</p>
<ul>
<li>考慮擴充性，以後車子的運行公式可能會替換，因此建造一個 <code>Engine class</code>。</li>
<li>模糊系統的幾個特性拆分成數個 method，並且使用不同的數學計算採用繼承關係。</li>
<li>最困難得地方在於計算函數交集，採用離散取點是最後的手段</li>
</ul>
<h3 id="函數實驗"><a href="#函數實驗" class="headerlink" title="函數實驗"></a>函數實驗</h3><ol>
<li>經過實驗，三個感測器分別坐落於前方 (90度)、左右各偏轉 50 度左右的夾角比左右 90 度更好。用以應付多變的轉角彎度，防止模稜兩可的擺動。</li>
<li>不管哪裡種去模糊化系統，由於題目限制擺角於 [-40, 40] 度之間，因此很容易在加權平均、質心、離散化而導致邊界擺角的機率甚低，當越多函數則稀釋程度越高。因此函數定義可以超過限制擺角，只需要在去模糊化時，約束至條件內即可。</li>
<li>設計函數時，要討論向其中一個方向偏轉，也就是不能設計過於對稱的圖形，否則將會在死胡同裡打轉。</li>
</ol>
<h3 id="函數設計"><a href="#函數設計" class="headerlink" title="函數設計"></a>函數設計</h3><p>d1 為前方感測器，d2 為右方感測器，d3 為左方感測器。</p>
<ol>
<li>d1 歸屬函數為<br><img src="/img/hw-ci-2.PNG" alt="d1 歸屬函數"><br>d2, d3 歸屬函數為<br><img src="/img/hw-ci-3.PNG" alt="d2, d3 歸屬函數">    </li>
<li>函數式加權平均<pre><code>If d3 large, θ = 55
If d2 large, θ = -55
If d2 medium, θ = -40
If d3 medium, θ = 40
If d1 large and d2 small, θ = -30
If d1 large and d3 small, θ = 30
If d1 small, θ = -60
</code></pre>規則如上述七條，以最簡單的常數關係。測試結果還算不錯。<br><code>if condition, then statement</code>，statement 中的變數不存在於 condition 去做調整，後來發現由於太複雜去討論而一直失敗。</li>
<li><p>重心法、最大平均法、修正型最大平均法、中心平均法<br>為了方便計算連續函數，採用離散取點，間隔 0.1 抓取 [-60, 60] 之間的點座標。對於以下四種方法討論於簡單彎道的過程記錄：<br><code>If d3 large</code><br><img src="/img/hw-ci-4.png" alt="If d3 large"><br>If d2 large<br><img src="/img/hw-ci-5.png" alt="If d2 large"><br>If d2 medium<br><img src="/img/hw-ci-6.png" alt="If d2 medium"><br>If d3 medium<br><img src="/img/hw-ci-7.png" alt="If d3 medium"><br>If d1 large and d2 small<br><img src="/img/hw-ci-8.png" alt="If d1 large and d2 small"><br>If d1 large and d3 small<br><img src="/img/hw-ci-9.png" alt="If d1 large and d3 small"><br>If d1 small, θ = -60<br><img src="/img/hw-ci-10.png" alt="If d1 small"></p>
<ul>
<li>重心法<br>當中表現最為穩健，而且路徑平滑。</li>
<li>最大平均法<br>由於定義的函數較為簡單，而且大多都是以梯形的方式存在，雖然能在機率高的情況下走完全程，路徑中會呈現左右擺盪情況。並且大多都已極值的方式出現。</li>
<li>修正型最大平均法<br>情況會稍微好一些，但是對於並沒有向重心法一樣的圓滑曲線，仍是因為原先的函數設計所惹的問題。</li>
</ul>
<p>對於某一種方法而去定義相關的函數進行測較好，而在最大平均法的部分，必須使用較具有變化性的曲線，否則很容易在極值狀況下擺動。</p>
</li>
</ol>
<hr>
<h2 id="Lv-2-GA"><a href="#Lv-2-GA" class="headerlink" title="Lv 2. GA"></a>Lv 2. GA</h2><p><img src="/img/hw-ci-RBF.PNG" alt="RBF"></p>
<p>「放射狀基底函數網路 RBF」，基本上，其網路架構如圖1所示，為兩層的網路；假設輸入維度是p ，以及隱藏層類神經元的數目是J ，那麼網路的輸入可以表示成：<br><img src="/img/hw-ci-RBF-f1.PNG" alt=""><br>其中選用高斯型基底函數：<br><img src="/img/hw-ci-RBF-f2.PNG" alt=""><br>其中 x = (x1,x2,…,xp) 、mj = (mj1,mj2,…,mjp) 、||  || 代表向量絕對值<br>適應函數為：<br><img src="/img/hw-ci-RBF-f3.PNG" alt=""></p>
<p>請用實數型基因演算法，找出wj , mj , σj，在不同的數字J下，最好的基因向量 (例如J為9、輸入x為3維向量，則表示基因向量是1+9+3x9+9=46維度的向量，請注意這裡不是指族群數；又例如J為7、輸入x為3維向量，則表示基因向量是1+7+3x7+7=36維度的向量)下，評估函數E(式1)為越小越好。其中基因向量維度公式為 1+J + p<em>J+J = (p+2)</em>J+1維向量( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ)。</p>
<p>參數說明 : </p>
<ul>
<li>N 作業1產生的N筆成功到達目的訓練資料(換不同起始點)</li>
<li>y<sub>n</sub> 表示訓練資料的方向盤期望輸出值 P.s.如果配合wj值的範圍為0~1之間，在此則必須把yn由-40~+40度正規化到 0~1之間；如果不想正規化  就必須把 wj的值範圍調整到 -40~40之間 範圍為0~1之間</li>
<li>W<sub>j</sub> 範圍為 0~1 (或是-40~40)之間 P.s.此需配合訓練集的yn跟F(n)值範圍，所以皆需正規化到0~1之間；若不正規化，wj的值範圍為 -40~40之間</li>
<li>m<sub>j</sub> 範圍跟X範圍一樣，如以提供的範例檔則為 0~30</li>
<li>σ<sub>j</sub> 範圍為0~10之間；也可以設定更大的範圍做探討。</li>
</ul>
<blockquote>
<p><strong> 實作概要 </strong>：<br>把參數編碼成 DNA，使用 GA 算法改變 DNA，然後用之前的模糊系統的結果，讓 RBF 接近之前定義的模糊系統。需要拿模糊系統的一些測資當作訓練資料，收集之後餵給 GA 做訓練。</p>
</blockquote>
<h3 id="實驗方法"><a href="#實驗方法" class="headerlink" title="實驗方法"></a>實驗方法</h3><ol>
<li>核心代碼，對於每次迭代，著手適應、選擇、交配、突變。</li>
<li>細部 “交配” 代碼，採用實數型的分離和聚集兩種情況。</li>
<li>細部 “突變” 代碼，採用微量雜訊，唯一不同的地方在於，這個微量雜訊會根據當前數值的比例有關，為了避免大數字對於微量雜訊的干擾不夠強烈。</li>
</ol>
<h3 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h3><ol>
<li>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.163568 0.851471 1.594151 1.379580 13.092824 0.000505 12.611789 30.000000 0.000368 18.715240 0.000850 2.708967 30.000000 6.307677 7.584529 10.000000)</li>
<li>訓練數據為 “map2” 走一圈的訓練資訊，約為 500 筆。因為 “map0” (即本次作業給的地圖) 的複雜度不夠以至於無法充分表達原本設計的模糊系統。也就是根據當初模糊系統設計，收集的數據的多樣性和連續性不足。</li>
</ol>
<h3 id="實驗分析"><a href="#實驗分析" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>根據 RBF 的神經元，這裡可以越少越好，在程式中，神經元個數(J) 設置 3 個。運行時採用輪盤式選擇，讓適應能力好的，具有較高的機會繁殖，採用一個隨機變數去挑選。而在基因方面使用實數型基因的形式。</p>
<ol>
<li>運行時，突變機率和突變比例相當重要，由於相同適應能力好的物種量很多，只保留其中一部分即可，因此可以將突變機率0.5 左右，太低則會造成進化速度太慢，太高則容易失去原本適應好的物種，導致整體適應度的震盪。</li>
<li>另外設置突變的比例，也就是該段實數值上下調整的比例。<br><code>g.getDNA()[i] = g.getDNA()[i] + ratio * Math.random() * g.getDNA()[i];</code><br>藉由上述的式子，將 ratio 設置成一個調變比例，來製造爆炸效應的規模。而在運行時，突變效果還能接受。</li>
<li>原本運行時，只將 DNA 片段的值任意放置，並且約束在不會超出函數的定義域，在收斂速度上有明顯加速。但為了符合作業需求，將每個參數約束在指定範圍內，在收斂速度慢了一截，在預期結果並沒有很好。</li>
<li>在不同地圖收集的預期資訊，會針對不同車子感測器的角度有所差異，因此不能拿不同型的感測數據，訓練出來的 RBF 不能給另外一台車子來使用，除非使用的感測器角度相當接近。</li>
<li>對於死路的轉彎，在神經元個數(J) 等於 2 的時候，運行結果較為不佳，但是在本次作業中，並不會有這種數據的出現，也不用考慮這種情況。但是當神經元個數少時，GA 算法的運行速度是相當快的。</li>
</ol>
<hr>
<h2 id="Lv-3-PSO"><a href="#Lv-3-PSO" class="headerlink" title="Lv. 3 PSO"></a>Lv. 3 PSO</h2><p>請利用Particle swarm optimization替換掉 GA 部分。</p>
<ul>
<li>AgentNum(粒子數)</li>
<li>IterationNum(疊代數),</li>
<li>MaxV(最大速度),</li>
<li>MaxX(最大值範圍),</li>
<li>Weights(兩個權重),</li>
<li>Convergent_Error(停止條件)</li>
<li>並畫出 fitness function 曲線變化 (每一次疊代的最佳fitness值)，最後訓練完成的F(x)當作規則 請跑出車子軌跡。</li>
</ul>
<h3 id="實驗分析-1"><a href="#實驗分析-1" class="headerlink" title="實驗分析"></a>實驗分析</h3><p>一開始參數為<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> sandSize = <span class="number">512</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxVelocity = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> maxXposition = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfCognition = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> weightOfSocial = <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> nearRatio = <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/hw-ci-11.png" alt="PSO 1"></p>
<p><img src="/img/hw-ci-12.png" alt="PSO 2"></p>
<ul>
<li><p>基本上 <code>maxXposition</code> 沒有用到，調整其他比例可以發現端倪。</p>
</li>
<li><p>從圖 <code>PSO 2</code> 中可以發現到，PSO 與 GA 最大的不同在於，如果 GA 調用部分突變的情況下，很高的機率會發現適應曲線是嚴格遞減的，但是在 PSO 由於會飛來飛去，有可能會來回震盪。</p>
</li>
<li><p>當所有粒子逼近最佳解時，仍會以原本的速度繼續飛行，而原本屬於最佳位置的點也會開始模仿其他粒子飛行，如此一來就會造成震盪。</p>
</li>
</ul>
<p><img src="/img/hw-ci-14.png" alt="PSO 3"></p>
<ul>
<li><p>其震盪的高低決定於鄰近模仿的權重，如果鄰近的粒子效果不好，模仿的權重高的時候，會導致整個最佳解有嚴重的偏離。由 <code>PSO 3</code> 中可以驗證這個震盪問題。</p>
</li>
<li><p>如果對於全局模仿權重調高，很容易造成處於群聚粒子不容易分離，也就是很難在早到其他的區域最佳解，會在很快的時間內進入某一個區域最佳解，從這一點中可以發現 PSO 真的具有快速收斂的性質。</p>
</li>
<li><p>設定 <code>maxVelocity</code> 是將整個向量長度 (歐幾里得距離) 壓縮，這將可以控制查找的精密度，如果設定太小會導致收斂速度明顯下降。將 <code>maxVelocity = 10</code> 時，適應函數看起來會有比較高的進展，由於會將每個參數約束，只要速度不是太小影響就不大。</p>
</li>
<li><p>當速度上限增加時，粒子碰到牆的機會也會上升，由於搜索範圍的可能性涵蓋邊界的情況增加，如果最佳解在邊界，在這樣的情況就會更好。</p>
</li>
<li><p>在代碼中，鄰近的定義為最近粒子中排名前 20% 的最佳解。如果採用對於常數長度，這種情況上不容易觀察，也就是說不能直接找到鄰近模仿的規模該定義在何處。</p>
</li>
<li><p>運行結果 J = 3, p = 3<br>( ,w1 , w2 ,.., wJ , m11, m12,.., m1p, m21, m22,.., m2p,.., mJ1, mJ2,…, mJp, σ1, σ2, …, σJ) = (0.117271 1.270048 0.000000 0.805823 15.845525 0.000000 21.613452 13.509075 0.000000 0.000000 30.000000 0.000000 10.505934 10.000000 10.000000 5.238101)</p>
</li>
</ul>
<h1 id="Github-Download"><a href="#Github-Download" class="headerlink" title="Github Download"></a>Github Download</h1><p><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">Download</a></p>
<p><a href="http://morris821028.github.io/2014/05/19/hw-computational-intelligence/">Blog</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/operating-system-hw-thread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/18/lesson/operating-system-hw-thread/" class="article-date">
  <time datetime="2014-05-18T06:58:10.000Z" itemprop="datePublished">2014-05-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/作業系統/">作業系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/18/lesson/operating-system-hw-thread/">作業系統 Thread 程式作業</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/" data-id="ciq8w97te02ak9yxc9tkqxg6o" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/18/lesson/operating-system-hw-thread/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/matrix/">matrix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/thread/">thread</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作業系統/">作業系統</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="C-Thread-練習"><a href="#C-Thread-練習" class="headerlink" title="C++ Thread 練習"></a>C++ Thread 練習</h1><h2 id="作業要求"><a href="#作業要求" class="headerlink" title="作業要求"></a>作業要求</h2><blockquote>
<p>作業一:應用 Thread 撰寫任意程式(語言不限)，繳交方式 FTP:140.115.155.192(選擇自己學號的資料夾上傳) 帳:os2014 密碼不知道者請再問助教，檔案名稱: “作業一<em>學號</em>姓名_第幾版” ex:”作業一<em>10252200x</em>林大乖_v1” 繳交內容:壓縮檔(報告word 以及 程式碼,執行檔)，截止日期:2014/05/25(日)23:59</p>
</blockquote>
<h2 id="程式功能"><a href="#程式功能" class="headerlink" title="程式功能"></a>程式功能</h2><p>兩個 <code>n*n</code> 矩陣相乘，在最基礎的 <code>O(n^3)</code> 效能上，使用 Thread 等相關技巧使其加速。</p>
<h2 id="運行"><a href="#運行" class="headerlink" title="運行"></a>運行</h2><ul>
<li><p>Mac OSX</p>
<pre><code>$ clang -pthread x.cpp -o x
</code></pre></li>
<li><p>Linux</p>
<pre><code>$ gcc -lpthread x.cpp -o x
</code></pre></li>
</ul>
<h2 id="測試效率"><a href="#測試效率" class="headerlink" title="測試效率"></a>測試效率</h2><ul>
<li>Mac OSX and Linux<pre><code>$ time ./a.out
</code></pre></li>
</ul>
<h2 id="測試結果"><a href="#測試結果" class="headerlink" title="測試結果"></a>測試結果</h2><p>測試環境為 2013 Mac Air 1.3 GHz Intel Core i5 上對 <code>1024 x 1024</code> 的矩陣進行相乘的統計結果。</p>
<ul>
<li><code>matrix.cpp</code><br>最原始的一般寫法，直接使用 <code>O(n^3)</code> 。運行時間約在 20 秒左右完成。</li>
<li><code>matrix[v2].cpp</code><br>使用轉置矩陣後，在進行運算，這種方式是加快作業系統中的快取層，速度提升至約在 4 秒左右完成。</li>
<li><code>matrix[v3].cpp</code><br>建立在 <code>matrix[v2].cpp</code> 的基礎上，使用 4 條 thread，分別對處理的 column 進行分割操作，速度約在 2 秒內完成。</li>
<li>matrix[v4].cpp<br>與 <code>matrix[v3].cpp</code> 類似，調整 thread 的數量，查看效率變化，但是速度沒有更快的趨勢。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>Thread 多不代表會比較快，而是該程式佔有 CPU 的機會比較高，使用的資源就會比較多。在整個作業系統中，Thread 多上下文切換的次數就會上升，對於作業系統整體效率是下降的，但是又不能沒有 Thread，看起來像是所有程式同時在運行，也要防止落入死機無法動彈的情況。</p>
<p>而在 thread 上面會發現，當數量達到一定程度後，速度就不會上升，有一部分是因為 CPU 超頻運作。</p>
<blockquote>
<p>超頻（英語：Overclocking）是把一個電子配件的時脈速度提升至高於廠方所定的速度運作，從而提升性能的方法，但此舉有可能導致該配件穩定性下降。</p>
</blockquote>
<p>可能是長時間閒置的 CPU 發現有大規模的工作運行，把時脈速度升起。</p>
<h1 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h1><h2 id="matrix-cpp"><a href="#matrix-cpp" class="headerlink" title="matrix.cpp"></a>matrix.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></span><br><span class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[k][j];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//clock_t start, finish;</span></span><br><span class="line">    <span class="comment">//start = clock(); // start time clock</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    multiply(A, B, C);</span><br><span class="line">    <span class="comment">//finish = clock(); // finish time clock</span></span><br><span class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="matrix-v2-cpp"><a href="#matrix-v2-cpp" class="headerlink" title="matrix[v2].cpp"></a>matrix[v2].cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1024</span></span><br><span class="line"><span class="keyword">double</span> A[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> B[MAX_N][MAX_N];</span><br><span class="line"><span class="keyword">double</span> C[MAX_N][MAX_N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trans</span><span class="params">(<span class="keyword">double</span> A[][MAX_N])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            swap(A[i][j], A[j][i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> A[][MAX_N], <span class="keyword">double</span> B[][MAX_N], <span class="keyword">double</span> C[][MAX_N])</span> </span>&#123;</span><br><span class="line">    trans(B);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//clock_t start, finish;</span></span><br><span class="line">    <span class="comment">//start = clock(); // start time clock</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    multiply(A, B, C);</span><br><span class="line">    <span class="comment">//finish = clock(); // finish time clock</span></span><br><span class="line">    <span class="comment">//printf("Time: %lf\n", (double)(finish - start)/1000);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="matrix-v3-c"><a href="#matrix-v3-c" class="headerlink" title="matrix[v3].c"></a>matrix[v3].c</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX_N 1024</span><br><span class="line">double A[MAX_N][MAX_N];</span><br><span class="line">double B[MAX_N][MAX_N];</span><br><span class="line">double C[MAX_N][MAX_N];</span><br><span class="line">void trans(double A[][MAX_N]) &#123;</span><br><span class="line">    double x;</span><br><span class="line">    int i, j;</span><br><span class="line">    for (i = 0; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        for (j = i+1; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            x = A[i][j];</span><br><span class="line">            A[i][j] = A[j][i];</span><br><span class="line">            A[j][i] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#define MAX_THREAD 4</span><br><span class="line">void *multiply(void *arg) &#123;</span><br><span class="line">    int id = *((int *)arg);</span><br><span class="line">    int st = id * MAX_N / MAX_THREAD;</span><br><span class="line">    int ed = (id + 1) * MAX_N / MAX_THREAD - 1;</span><br><span class="line">    int i, j, k;</span><br><span class="line">    for (i = st; i &lt;= ed; i++) &#123;</span><br><span class="line">        for (j = 0; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            double sum = 0;</span><br><span class="line">            for (k = 0; k &lt; MAX_N; k++) &#123;</span><br><span class="line">                sum += A[i][k] * B[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            C[i][j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return NULL;</span><br><span class="line">&#125;</span><br><span class="line">int main(void) &#123;</span><br><span class="line">    puts("Thread version");</span><br><span class="line">    //clock_t start, finish;</span><br><span class="line">    //start = clock(); // start time clock</span><br><span class="line">    int i, j;</span><br><span class="line">    for (i = 0; i &lt; MAX_N; i++) &#123;</span><br><span class="line">        for (j = 0; j &lt; MAX_N; j++) &#123;</span><br><span class="line">            A[i][j] = i;</span><br><span class="line">            B[i][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    trans(B);</span><br><span class="line">    </span><br><span class="line">    pthread_t *threads;</span><br><span class="line">    threads = (pthread_t *) malloc(MAX_THREAD * sizeof(pthread_t));</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        int *p = (int *) malloc(sizeof(int));</span><br><span class="line">        *p = i;</span><br><span class="line">        pthread_create(&amp;threads[i], NULL, multiply, (void *)(p));</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = 0; i &lt; MAX_THREAD; i++) &#123;</span><br><span class="line">        pthread_join(threads[i], NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    //finish = clock(); // finish time clock</span><br><span class="line">    //printf("Time: %lf\n", (double)(finish - start)/1000);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>雖然作業可以有其他語言的相關 Thread，在 Java 作品方面可以查看 Github。</p>
<ul>
<li><a href="https://github.com/morris821028/hw-ChatRoom" target="_blank" rel="external">聊天室 Chart Room</a></li>
<li><a href="https://github.com/morris821028/hw-FuzzySystem" target="_blank" rel="external">演化模擬</a></li>
</ul>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/學校課程/page/9/">&laquo; Prev</a><a class="page-number" href="/categories/學校課程/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/學校課程/page/8/">8</a><a class="page-number" href="/categories/學校課程/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/categories/學校課程/page/11/">11</a><a class="extend next" rel="next" href="/categories/學校課程/page/11/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">108</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">38</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">617</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">479</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/06/30/diary-201606-2/">
              
                <i class="icon-file-o"></i> 
              
            走在平行道路上－後篇</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/29/diary-201606/">
              
                <i class="icon-file-o"></i> 
              
            走在平行道路上－前篇</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10116/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10116. Fast Dynamic Programming Computing I (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10113/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10113. Longest Common Subsequence II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10112/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10112. Longest Common Subsequence (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10111/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10111. Longest Common Subsequence II (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10110/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10110. Longest Common Subsequence (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10109/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10109. Sorting (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10108/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10108. Streams and Concurrency II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10107/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10107. Sparse Matrix Multiplication (CUDA)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>