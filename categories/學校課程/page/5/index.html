<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Category: 學校課程 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/學校課程/page/5/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-rendering-realistic-camera" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/rendering-realistic-camera/" class="article-date">
  <time datetime="2016-01-21T08:35:46.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/rendering-realistic-camera/">pbrt-v2 加速結構 Realistic Camera 改寫</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/01/21/rendering-realistic-camera/" data-id="ciq1m82op00afrjxcjcfvsskf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/01/21/rendering-realistic-camera/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h3 id="Ray-Sphere-Intersection"><a href="#Ray-Sphere-Intersection" class="headerlink" title="Ray Sphere Intersection"></a>Ray Sphere Intersection</h3><p>計算射線和球體的交點，可以參照 <code>/pbrt-v2/shapes/sphere.cpp</code> 中 <code>bool Shpere::Intersect()</code> 的算法。</p>
<p>假設球體圓心座標 <span>$O$</span><!-- Has MathJax -->，射線單位向量 <span>$I$</span><!-- Has MathJax --> 的起點座標 <span>$C$</span><!-- Has MathJax -->，且最近目標交點座標 <span>$P$</span><!-- Has MathJax -->，原半徑 <span>$\mathrm{radius}$</span><!-- Has MathJax -->。射線走單位時間 <span>$t$</span><!-- Has MathJax --> 會到達球面上。</p>
<ul>
<li><span>$\overrightarrow{OC} + \overrightarrow{I} \times t = \overrightarrow{OP}$</span><!-- Has MathJax --></li>
<li><span>$|\overrightarrow{OP}| = \text{radius}$</span><!-- Has MathJax --></li>
<li><span>$|\overrightarrow{OC} + \overrightarrow{I} \times t| = |\overrightarrow{OP}|$</span><!-- Has MathJax --></li>
<li><span>$|\overrightarrow{I}|^2 t^2 + 2 \; (\overrightarrow{OC} \cdot \overrightarrow{I}) \; t + |\overrightarrow{OC}|^2 - \text{radius}^2 = 0$</span><!-- Has MathJax -->
</li>
</ul>
<p>解一元二次方程式之後可以得到 <span>$t$</span><!-- Has MathJax --> 得值，並得到交點座標 <span>$P$</span><!-- Has MathJax -->。</p>
<p><img src="http://morris821028.github.io/hw-rendering/homework2/submission/images/hw2_circle_intersect.png" alt=""></p>
<h3 id="Snell’s-Law"><a href="#Snell’s-Law" class="headerlink" title="Snell’s Law"></a>Snell’s Law</h3><p>根據物理法則斯乃爾定律計算折射的方向向量，課程中提供三種做法。</p>
<p>變數解釋：入射介面材質 <span>$\eta_1$</span><!-- Has MathJax -->，折射介面材質 <span>$\eta_2$</span><!-- Has MathJax -->，入射單位向量 <span>$\overrightarrow{I}$</span><!-- Has MathJax -->，交點面法向量 <span>$\overrightarrow{N}$</span><!-- Has MathJax -->，折射方向向量 <span>$\overrightarrow{T}$</span><!-- Has MathJax --></p>
<p>特別小心 <code>ray-&gt;d = Normalize(ray-&gt;d)</code> 的處理，Heckbert’s Method 計算維持在單位圓上，故不用做最後的正規化計算。</p>
<h4 id="Whitted’s-Method"><a href="#Whitted’s-Method" class="headerlink" title="Whitted’s Method"></a>Whitted’s Method</h4><table>
<thead>
<tr>
<th><span>$\sqrt{}$</span><!-- Has MathJax --></th>
<th><span>$/$</span><!-- Has MathJax --></th>
<th><span>$\times$</span><!-- Has MathJax --></th>
<th><span>$+$</span><!-- Has MathJax --></th>
<th>compute</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>1</td>
<td></td>
<td></td>
<td><span>$n = \eta_1 / \eta_2$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td>3</td>
<td>3</td>
<td>2</td>
<td><span>$I&apos; = I / (-I \cdot N)$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>3</td>
<td><span>$J = I&apos; + N$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>8</td>
<td>5</td>
<td><span>$\alpha = 1 / \sqrt{n^2(I&apos; \cdot I&apos;) - (J \cdot J)}$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td></td>
<td>3</td>
<td>3</td>
<td><span>$T&apos; = \alpha J - N$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td><span>$T&apos; = T&apos; / \| T&apos; \|$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>2</td>
<td>8</td>
<td>17</td>
<td>15</td>
<td>TOTAL</td>
</tr>
</tbody>
</table>
<h4 id="Heckbert’s-Method"><a href="#Heckbert’s-Method" class="headerlink" title="Heckbert’s Method"></a>Heckbert’s Method</h4><table>
<thead>
<tr>
<th><span>$\sqrt{}$</span><!-- Has MathJax --></th>
<th><span>$/$</span><!-- Has MathJax --></th>
<th><span>$\times$</span><!-- Has MathJax --></th>
<th><span>$+$</span><!-- Has MathJax --></th>
<th>compute</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>1</td>
<td></td>
<td></td>
<td><span>$\eta = \eta_1 / \eta_2$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td></td>
<td>3</td>
<td>2</td>
<td><span>$c_1 = - I \cdot N$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td></td>
<td>3</td>
<td>2</td>
<td><span>$c_2 = \sqrt{1 - \eta^2(1 - c_1^2)}$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td></td>
<td>7</td>
<td>4</td>
<td><span>$T = \eta I + (\eta c_1 - c_2) N$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>13</td>
<td>8</td>
<td>TOTAL</td>
</tr>
</tbody>
</table>
<h4 id="Other-Method"><a href="#Other-Method" class="headerlink" title="Other Method"></a>Other Method</h4><table>
<thead>
<tr>
<th><span>$\sqrt{}$</span><!-- Has MathJax --></th>
<th><span>$/$</span><!-- Has MathJax --></th>
<th><span>$\times$</span><!-- Has MathJax --></th>
<th><span>$+$</span><!-- Has MathJax --></th>
<th>compute</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>1</td>
<td></td>
<td></td>
<td><span>$n = \eta_2 / \eta_1$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td></td>
<td>3</td>
<td>2</td>
<td><span>$c_1 = - I \cdot N$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td></td>
<td>2</td>
<td>3</td>
<td><span>$\beta = c_1 \sqrt{n^2 - 1 + c_1^2}$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td></td>
<td>3</td>
<td>3</td>
<td>3</td>
<td><span>$T = (I + \beta N ) / n$</span><!-- Has MathJax --></td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>8</td>
<td>8</td>
<td>TOTAL</td>
</tr>
</tbody>
</table>
<p>其中以 Heckbert’s Method 消耗最少計算數。如果除法速度快於乘法，則使用 Other Method，原則上很少有機器運算除法比乘法快。</p>
<h3 id="RasterToCamera"><a href="#RasterToCamera" class="headerlink" title="RasterToCamera"></a>RasterToCamera</h3><p>這部分處理後得到 <code>Transform RasterToCamera</code>。若計算錯誤，會造成一片黑或者圖片顯示的大小問題。座標轉換處理細節可以參考實際的例子，如下圖所示：</p>
<p><img src="http://morris821028.github.io/hw-rendering/homework2/submission/images/cambasic1A.png" alt="http://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-generating-camera-rays/generating-camera-rays"></p>
<ul>
<li>Raster-To-NDC 轉換矩陣 <span>$A=\text{Scale}(scale, scale, 1)$</span><!-- Has MathJax -->，進行縮放。</li>
<li>NDC-To-Camera 轉換矩陣 <span>$B=\text{Translate}(Vector(0, 0, filedistance)) \times \text{Translate}(Vector(X, -Y, 0))$</span><!-- Has MathJax -->，進行位移。</li>
<li>最後得到 RasterToCamera 轉換矩陣 <span>$C= B \times A \times \text{Scale}(-1, 1, 1)$</span><!-- Has MathJax -->，最後將 x 軸顛倒以符合成像問題。</li>
</ul>
<h3 id="Ray-Weight"><a href="#Ray-Weight" class="headerlink" title="Ray Weight"></a>Ray Weight</h3><p>作業要求經過 <code>float GenerateRay()</code> 回傳 <span>$\mathrm{weight} = \frac{\cos^4 \theta&apos;}{Z^2}$</span><!-- Has MathJax -->，這麼設置會過暗，根據論文 A Realistic Camera Model for Computer Graphics 中寫道</p>
<blockquote>
<p>If the exit pupil subtends a small solid angle from <span>$x&apos;$</span><!-- Has MathJax -->, <span>$\theta&apos;$</span><!-- Has MathJax --> can be assumed to be constant and equal the angle between <span>$x&apos;$</span><!-- Has MathJax --> and the center of the disk. This allows us to simplify<br><span>$E(x&apos;) = \int_{x&apos;&apos; \in D} L(x&apos;&apos;, x&apos;) \frac{\cos \theta&apos; \cos \theta&apos;&apos;}{\| x&apos;&apos; - x&apos;\|} dA&apos;&apos;$&lt;span&gt;$to:$&lt;/span&gt;&lt;!-- Has MathJax --&gt;$E(x&CloseCurlyQuote;) = L \frac{A}{Z^2} \cos^4 \theta&CloseCurlyQuote;$</span><!-- Has MathJax --><br>where <span>$Z$</span><!-- Has MathJax --> is the axial distance from the film plane to the dist and <span>$A$</span><!-- Has MathJax --> is the area of the disk. </p>
</blockquote>
<p><img src="http://morris821028.github.io/hw-rendering/homework2/submission/images/paperfigure6.jpg" alt="A Realistic Camera Model for Computer Graphics: Figure 6"></p>
<p>因此需要額外乘上常數 <span>$A$</span><!-- Has MathJax -->，其中 <span>$A$</span><!-- Has MathJax --> 是最裡層的透鏡面積，因為我們是根據最裡層的透鏡面做均勻取樣，得到 <span>$A = \mathit{backLens.radius}^2 \pi$</span><!-- Has MathJax -->。</p>
<h3 id="Sampling"><a href="#Sampling" class="headerlink" title="Sampling"></a>Sampling</h3><p>單位圓均勻取樣方法有以下兩種，而非均勻取樣的寫法可參照 Sample 3 (錯誤的做法參照) 出來的效果看出。</p>
<h4 id="Sampling-1"><a href="#Sampling-1" class="headerlink" title="Sampling 1"></a>Sampling 1</h4><p>採用內建函數 <code>CencentricSampleDisk()</code>，採用 A Low Distortion Map Between Disk and Square 論文中提到的方案，將一個正方形壓縮到一個圓形中。參照作法如下圖所示  <img src="http://morris821028.github.io/hw-rendering/homework2/submission/images/pbrt_low_distortion.gif" alt=""></p>
<p>其中給定 <span>$a, b$</span><!-- Has MathJax --> 均勻分布 <span>$[0, 1]$</span><!-- Has MathJax -->，則得到 <span>$r = a, \; \phi = \frac{\pi}{4} \frac{b}{a}$</span><!-- Has MathJax -->，最後計算得到座標 <span>$x = r \cos \phi, \; y = r \sin \phi$</span><!-- Has MathJax -->。</p>
<h4 id="Sampling-2"><a href="#Sampling-2" class="headerlink" title="Sampling 2"></a>Sampling 2</h4><p>採用教科書上提供，其中給定 <span>$a, b$</span><!-- Has MathJax --> 均勻分布 <span>$[0, 1]$</span><!-- Has MathJax -->，令 <span>$r = \sqrt{a}, \; \phi = 2 \pi b$</span><!-- Has MathJax -->，最後計算得到座標 <span>$x = r \cos \phi, \; y = r \sin \phi$</span><!-- Has MathJax -->。</p>
<h4 id="Sampling-3"><a href="#Sampling-3" class="headerlink" title="Sampling 3"></a>Sampling 3</h4><p>分布 <span>$[0, 1]$</span><!-- Has MathJax -->，令 <span>$r = a, \; \phi = 2 \pi b$</span><!-- Has MathJax -->，最後計算得到座標 <span>$x = r \cos \phi, \; y = r \sin \phi$</span><!-- Has MathJax -->。這種寫法在相同半徑下，角度均勻分布，不同半徑下的周長與 <span>$r$</span><!-- Has MathJax --> 成正比，導致不同半徑的取樣點不均勻，越靠近中心點取樣越密集，意即容易造成中心點看起來較亮。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://blog.csdn.net/codeboycjy/article/details/6225886" target="_blank" rel="external">PBRT学习笔记：在单位圆内部均匀采样 -<br>codeboycjy的专栏</a></li>
</ul>
<h2>Final Images Rendered Compare 4 samples</h2>

<p></p><h4>Gauss Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.dgauss_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.dgauss_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.dgauss_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>

<p></p><h4>Fisheye Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.fisheye_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.fisheye_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.fisheye_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>

<p></p><h4>Telephoto Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.telephoto_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.telephoto_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.telephoto_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>


<p></p><h4>Wide-Angle Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.wide_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.wide_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.wide_4.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>

<h2>Final Images Rendered Compare 512 samples</h2>

<p></p><h4>Gauss Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/ref/dof-dragons.dgauss_512ref.jpg"><br>         <p><font><tt>Reference</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.dgauss_512.jpg"><br>        <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.dgauss_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.dgauss_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>

<p></p><h4>Fisheye Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/ref/dof-dragons.fisheye_512ref.jpg"><br>      <p><font><tt>Reference</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.fisheye_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.fisheye_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.fisheye_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>

<p></p><h4>Telephoto Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/ref/dof-dragons.telephoto_512ref.jpg"><br>      <p><font><tt>Reference</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.telephoto_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.telephoto_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.telephoto_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>


<p></p><h4>Wide-Angle Lens</h4><p></p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/ref/dof-dragons.wide_512ref.jpg"><br>      <p><font><tt>Reference</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling1/dof-dragons.wide_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 1)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling2/dof-dragons.wide_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 2)</tt></font></p><p><br>    </p></td><br>    <td width="25%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework2/submission/images/expr/sampling3/dof-dragons.wide_512.jpg"><br>      <p><font><tt>My Implementation (Sampling 3)</tt></font></p><p><br>    </p></td><br>  </tr><br></table>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-rendering-height-field" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/rendering-height-field/" class="article-date">
  <time datetime="2016-01-21T07:57:57.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/rendering-height-field/">pbrt-v2 加速結構 Height Field 改寫</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/01/21/rendering-height-field/" data-id="ciq1m82oa00a4rjxcobjzi07z" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/01/21/rendering-height-field/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h3 id="前情提要-pbrt"><a href="#前情提要-pbrt" class="headerlink" title="前情提要 pbrt"></a>前情提要 pbrt</h3><p>一套數位影像生成軟體，盡可能以物理性質為基底打造的，目前已經到了 pbrt-v3。pbrt 主要的工作在於 modeling 後，可以在場景內放置以幾何描述的物體、光源、拍攝曝光 … 等設定，藉由模擬光線走訪得到呈現在螢幕上每一個 pixel 的顏色。</p>
<h3 id="目標工作"><a href="#目標工作" class="headerlink" title="目標工作"></a>目標工作</h3><p>Height Field 是一個高度場，測資中以山脈構造為主，等間隔取樣每一平面上的每一點高度的場景，當間隔越小越接近真實場景。原生寫法是將點放置在三維空間，轉換成一堆三角網格，將其丟入 KD-tree 或者是 BVH 等加速結構，加快光線模擬找交點 (三維空間中，一射線和一多面體的交點) 的效能。而現在挑戰用 3D-DDA 的方式進行交點查找。</p>
<p>實作採用 3D-DDA 算法降至 2D Grid 上進行交點測試。Uniform Grid 將會切割成 <span>$N \times M$</span><!-- Has MathJax --> 的格子，在 2D 平面上，先找到 ray 進入的格子點，接著使用增量算法找到下一個格子，算法只測試投影到 x-y 平面上時，在 ray 鄰近的格子點做交點測試，時間複雜度 <span>$O(\sqrt{N \times M})$</span><!-- Has MathJax -->，與預設的其他算法所需要的 traversal 複雜度差不多。</p>
<p>原本預設的 Height Field 拆成好幾個 Triangle，做法類似 Triangle Mesh，接著將這幾個 Triangle 利用 BVH 或者是 KD-tree 的架構進行，原本的做法會考慮三個維度，使用投影的方式只考慮兩個維度下的情況，接著再針對有相交的格子測試，最後才進行 3D Triangle 是否與 ray 相交。</p>
<p>實作 Height Field 時，考慮快取和再計算之間的好壞，則有兩種方法</p>
<ol>
<li>預先將預處理每個 3D Triangle 座標 (消耗空間)</li>
<li>需要時，再創建 Triangle 出來測試 (消耗時間)</li>
</ol>
<p>由於要找 ray 碰度到 uniform grid 的第一個格子，需要預處理 Height Field Bound Box，計算 Bound Box 需要 <span>$O(N \times M)$</span><!-- Has MathJax -->，若不預處理會造成 3D-DDA 與暴力法 <span>$O(N \times M)$</span><!-- Has MathJax --> 無異。</p>
<p>若對 Height Field 進行 2D-DDA 好處在於一定是數個三角形構成，因此不用等到 <code>ray.maxT</code> 小於下一格交點的 <code>NextCrossingT[stepAxis]</code> 才能結束，一與三角形有交點就可以離開，因為每一格之間都有獨立性。</p>
<h4 id="實作與測試細節"><a href="#實作與測試細節" class="headerlink" title="實作與測試細節"></a>實作與測試細節</h4><h4 id="測試環境"><a href="#測試環境" class="headerlink" title="測試環境"></a>測試環境</h4><p>一開始為了熟悉 pbrt 架構環境只實作求出交點的函數，</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> Heightfield2::Intersect(<span class="keyword">const</span> Ray &amp;r, <span class="keyword">float</span> *tHit, <span class="keyword">float</span> *rayEpsilon,</span><br><span class="line">        DifferentialGeometry *dg) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="comment">// 3D DDA</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而直接忽略單純詢問交點是否存在，這會導致畫面一片黑，因為每打到一個交點會嘗試從物體表面的交點連到點光源。若下述函數恆真，則不存在光源到交點的路徑，因此產出來的圖片是一片黑。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> Heightfield2::IntersectP(<span class="keyword">const</span> Ray &amp;r) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="紋理模糊"><a href="#紋理模糊" class="headerlink" title="紋理模糊"></a>紋理模糊</h4><p>找出紋理的兩個參數 <span>$(u, v)$</span><!-- Has MathJax --> 時，從 <code>trianglemesh.cpp</code> 複製過來的 <code>class Triangle</code> 其 <code>bool Triangle::Intersect()</code> 函數得到的 <span>$u, v$</span><!-- Has MathJax --> 都是相對於三角形的 <span>$0 \le u, v \le 1$</span><!-- Has MathJax --> (直接 rendering 會看起來很多小格子點)，因此得到相對的 <span>$u, v$</span><!-- Has MathJax --> 和交點 <span>$p_{hit}$</span><!-- Has MathJax --> (Object coordinate)，則把 <span>$p_{hit}$</span><!-- Has MathJax --> 再次投影到 x-y 平面上，由於 height field 在 x-y 平面上長寬都是 1，投影到平面後得到 <span>$p_{projection}$</span><!-- Has MathJax -->，對於整個 height field <span>$u = p_{projection}.x, \; v = p_{projection}.y$</span><!-- Has MathJax -->。</p>
<blockquote>
<p>若測試 texture.pbrt 時，發生過模糊情況，其主要原因在於過多次座標轉換，如 <code>Object -&gt; World -&gt; Object -&gt; World</code>，求出來的 <span>$u, v$</span><!-- Has MathJax --> 誤差就會放大。</p>
</blockquote>
<p>將 height field 存成好幾個 triangle 可以像 <code>class TriangleMesh</code> 利用 <code>index</code> 標籤來壓縮記憶體，但實作為方便仍然每一個三角形都有實體的 <code>Point</code>，儲存三角形每一個點座標採用 object coordinate，先把 <span>$ray$</span><!-- Has MathJax --> 從 <code>WorldToObject</code> 得到 <span>$ray&apos;$</span><!-- Has MathJax -->，得到的交點 <span>$p_{hit}$</span><!-- Has MathJax --> 再進行 <code>ObjectToWorld</code>，如此一來模糊情況就會消失。</p>
<h4 id="Phong-圓滑化"><a href="#Phong-圓滑化" class="headerlink" title="Phong 圓滑化"></a>Phong 圓滑化</h4><p>Phong interpolation 方法在三角形上面操作時，需要得知三個頂點的法向量，給予 height field 的資訊，並不曉得每一個頂點的法向量為何。得到每一個頂點的法向量，採用預先處理所有頂點的法向量並儲存起來，因為不斷地正規化是很耗時間的 (<code>float sqrt(float x)</code> 儘管採用 fast inverse square root 算法，也要極力避免多餘的運算)。</p>
<p>再計算頂點法向量時，根據影像處理中常用的一次差分 (differentiation) 遮罩</p>
<p><img src="http://morris821028.github.io/hw-rendering/homework1/submission/images/hftest_1.png" alt=""></p>
<p><img src="http://morris821028.github.io/hw-rendering/homework1/submission/images/hftest_2.png" alt=""></p>
<h5 id="Case-1-邊緣"><a href="#Case-1-邊緣" class="headerlink" title="Case 1 邊緣"></a>Case 1 邊緣</h5><span>$$N_x = \begin{bmatrix}
0 &amp; 0 &amp; 0 \\
-1 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 \\
\end{bmatrix}, \;
N_y = \begin{bmatrix}
0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; -1 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<h5 id="Case-2-非邊緣"><a href="#Case-2-非邊緣" class="headerlink" title="Case 2 非邊緣"></a>Case 2 非邊緣</h5><span>$$N_x = \begin{bmatrix}
0 &amp; 0 &amp; 0 \\
-1 &amp; 0 &amp; 1 \\
0 &amp; 0 &amp; 0 \\
\end{bmatrix}, \;
N_y = \begin{bmatrix}
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 \\
0 &amp; -1 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<p>上圖矩陣的中心座標為 <span>$(x, y)$</span><!-- Has MathJax -->，將相鄰座標的高度值 <span>$z$</span><!-- Has MathJax --> 相減得到兩個方向的向量 <span>$N_x, \; N_y$</span><!-- Has MathJax -->，外積得到座標 <span>$(x, y)$</span><!-- Has MathJax --> 的法向量 <span>$N_{x, y} = \mathrm{Cross}(N_x, N_y)$</span><!-- Has MathJax -->。</p>
<p>從另一個角度來看，將 height field 三角化後，每一個頂點原則上有 6 個鄰居，可以對每一個鄰居進行差分，接著順時針或者逆時針將兩兩相臨的向量外積，得到 6 個法向量平均後得到 <span>$N_{x, y}$</span><!-- Has MathJax -->，這做法看起來比上述的差分來得穩定，但初始化消耗的時間會比較長，且撰寫的外積順序不對容易造成零向量的正規化錯誤。</p>
<p><img src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong_interpolation_1.png" alt=""></p>
<p><img src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong_interpolation_2.png" alt=""></p>
<p></p><h3>Final Images Rendered with my implementation of heightfield.cpp</h3><p></p>
<p></p><p>&nbsp;</p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/hftest_2.jpg" width="400" height="400"><br>      <p><font><tt>hftest.pbrt </tt> (without Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 0.125 seconds</font></li><br>        <li><font>My implementation: 0.130 seconds (104% original)</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/landsea-0_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-0.pbrt </tt> (without Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 0.815 seconds</font></li><br>        <li><font>My implementation: 1.050 seconds (128% original)</font></li><br>      </ul><br>    </p></td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/landsea-1_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-1.pbrt </tt> <tt> </tt> (without Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 0.850 seconds</font></li><br>        <li><font>My implementation: 1.020 seconds (120% original)</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/landsea-2_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-2.pbrt </tt> <tt> </tt> (without Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 0.780 seconds</font></li><br>        <li><font>My implementation: 0.870 seconds (115% original)</font></li><br>      </ul><br>    </p></td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/texture_2.jpg" width="400" height="400"><br>      <p><font><tt>texture.pbrt </tt> (without Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 0.450 seconds</font></li><br>        <li><font>My implementation: 0.520 seconds (120% original)</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><br>    </td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="100%" colspan="2"><br>     <img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/3ddda/landsea-big_2.jpg" width="600" height="600"><br>      <p><font><tt>landsea-big.pbrt </tt> (without Phong<br>            interpolation)</font></p><br>            <p><font>Timings:</font><br>      <ul><br>        <li><font>Original: 6.200 seconds</font></li><br>        <li><font>My implementation: 2.200 seconds (35% original)</font></li><br>      </ul><br>    </p></td><br>  </tr><br></table>

<p></p><h3>Final Images Rendered with my implementation of heightfield.cpp</h3><p></p>
<p></p><p>&nbsp;</p>
<table border="0" width="100%" cellspacing="0" cellpadding="0"><br>  <tr><br>     <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/hftest_2.jpg" width="400" height="400"><br>      <p><font><tt>hftest.pbrt </tt> (with Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>My implementation: 0.135 seconds</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/landsea-0_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-0.pbrt </tt> (with Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>My implementation: 1.100 seconds</font></li><br>      </ul><br>    </p></td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/landsea-1_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-1.pbrt </tt> <tt> </tt> (with Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>My implementation: 1.050 seconds</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/landsea-2_2.jpg" width="400" height="400"><br>      <p><font><tt>landsea-2.pbrt </tt> <tt> </tt> (with Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>My implementation: 0.900 seconds</font></li><br>      </ul><br>    </p></td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="50%"><img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/texture_2.jpg" width="400" height="400"><br>      <p><font><tt>texture.pbrt </tt> (with Phong<br>      interpolation)</font><br>      </p><p><font>Timings:</font><br>      <ul><br>        <li><font>My implementation: 0.530 seconds</font></li><br>      </ul><br>    </p></td><br>    <td width="50%"><br>    </td><br>  </tr><br>  <tr><br>    <td width="50%"></td><br>    <td width="50%"></td><br>  </tr><br>  <tr><br>    <td width="100%" colspan="2"><br>     <img border="0" src="http://morris821028.github.io/hw-rendering/homework1/submission/images/phong/landsea-big_2.jpg" width="600" height="600"><br>    <p><font><tt>landsea-big.pbrt </tt> (with Phong interpolation)</font></p><br>          <p><font>Timings:</font><br>    <ul><br>      <li><font>My implementation: 2.300 seconds</font></li><br>    </ul><br>    </p></td><br>  </tr><br></table>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-realtime-system-add-scheduler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/realtime-system-add-scheduler/" class="article-date">
  <time datetime="2016-01-21T07:27:07.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/即時系統/">即時系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/3eq7W2z.jpg" rel="gallery_ciq1m82nk009rrjxcpy7yryy5">
        <img src="http://i.imgur.com/3eq7W2z.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/realtime-system-add-scheduler/">即時系統 加入排程器</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/01/21/realtime-system-add-scheduler/" data-id="ciq1m82nk009rrjxcpy7yryy5" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/01/21/realtime-system-add-scheduler/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="目標"><a href="#目標" class="headerlink" title="目標"></a>目標</h2><p>修改 linux kernel，在 <code>kernel/sched.</code>} 相關 scheduler 部分增加 Weighted Round-Robin scheduler、Shortest Job First scheduler 以及 Rate-monotonic scheduler。最後藉由 Project 1 的練習撰寫測試程序驗證 scheduler 是否符合預期結果。</p>
<h3 id="修改檔案列表"><a href="#修改檔案列表" class="headerlink" title="修改檔案列表"></a>修改檔案列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── arch</span><br><span class="line">│   └── x86</span><br><span class="line">│       ├── include</span><br><span class="line">│       │   └── asm</span><br><span class="line">│       │       ├── unistd_32.h</span><br><span class="line">│       │       └── unistd_64.h</span><br><span class="line">│       └── kernel</span><br><span class="line">│           └── syscall_table_32.S</span><br><span class="line">├── include</span><br><span class="line">│   └── linux</span><br><span class="line">│       ├── sched.h</span><br><span class="line">│       └── syscalls.h</span><br><span class="line">└── kernel</span><br><span class="line">    ├── sched.c</span><br><span class="line">    ├── sched_fair.c</span><br><span class="line">    ├── sched_rt.c</span><br><span class="line">    └── sched_weighted_rr.c</span><br></pre></td></tr></table></figure>
<p>特別注意到，若編譯環境為 <code>x86_64</code> 則需要額外修改 <code>arch/x86/include/asm/unistd_64.h</code> 複製 <code>arch/x86/include/asm/unistd_32.h</code> 增加的 syscall。 同理，增加自己定義的 syscall 時，需要修改 <code>arch/x86</code> 下的那三個檔案 (如果發現編譯 kernel 時，出現 <code>WARNING: syscall NOT IMPLEMENTION.</code> 大多數都是這個造成)。</p>
<p>在 <code>include/linux/sched.h</code> 中，增加 task 的成員變數，提供接下來針對 task 操作需要的參數，特別的是在 <code>struct sched_rt_entity;</code> 中，相較於一般資料結構的寫法，linux 採用倒過來將節點訊息放在資料內部中，利用 <code>#define container_of(ptr, type, member)</code> 取得物件訊息，這種寫法方便解決 task 在數個 scheduler 中轉換。</p>
<p>因為 syscall 的方式設定 task weighted，增加一個全區變數 <code>int weighted_rr_time_slice;</code>，每一次 syscall 去設定這一個全區變數值，然後 task 建立時，經過 <code>sched_fork</code>，直接利用被修改全區變數作為這一個 task 的 weight。若要特別針對 task 設定 weighted round-robin，在建立前都要呼叫 syscall 設定全區變數。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> sched_rt_entity &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//+ RTS Proj2: weighted_rr</span></span><br><span class="line">    <span class="keyword">struct</span> list_head weighted_rr_list_item;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">struct</span> task_struct &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//+ RTS Proj2: weighted_rr</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> task_time_slice;</span><br><span class="line">    <span class="comment">//+ RTS Proj2: weighted_rr_prio</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> weighted_time_slice;</span><br><span class="line">    <span class="comment">//+ RTS Proj2: bonus RMS</span></span><br><span class="line">    <span class="keyword">int</span> period;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//+ RTS Proj2: weighted_rr</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> weighted_rr_time_slice;</span><br></pre></td></tr></table></figure>
<h3 id="Part-1-Weighted-Round-Robin-Scheduler"><a href="#Part-1-Weighted-Round-Robin-Scheduler" class="headerlink" title="Part 1. Weighted Round-Robin Scheduler"></a>Part 1. Weighted Round-Robin Scheduler</h3><ul>
<li><p><code>enqueue_task_weighted_rr()</code><br>函數將會給予 task 和 rq，將 task 根據 rq 的資料結構重新將 task 放入。若按照 <code>list</code> 結構，直接模擬 queue 即可，由於 linux 提供 list 本身為雙向串列，直接加入尾端只需要 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --> 時間。並且運行 <code>rq-&gt;weighted_rr.nr_running++;</code> 增加 rq 中的計數，隨後用來在回報該 scheduler 中有沒有存在 task 需要運行，方便在 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --> 時間內完成，由於 Weighted round-robin 只需要確認 list 是否為空，那麼也可以利用 linux 提供的 <code>list_empty()</code> 確認。</p>
</li>
<li><p><code>dequeue_task_weighted_rr()</code><br>當 task 完成任務時，都要呼叫 <code>update_curr_weighted_rr</code> 進行統計運行多久，並且更新與 task 相關的排程權重。接著將 task 從 rq 串列中移除，並且更新 scheduler 的 task 計數 (<code>rq-&gt;weighted_rr.nr_running--;</code>)。時間複雜度 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --></p>
</li>
<li><p><code>requeue_task_weighted_rr()</code><br>將一個 task 出列，在 Weighted round-robin 只需要直接對將 <code>task.weighted_rr_list_item</code> 移到串列最尾端，由於採用雙向串列，直接跟 scheduler 取得 list head (linux list 的 head 是不存放任何資訊) 直接加入尾端即可。時間複雜度 <span>$\mathcal{O}(1)$</span><!-- Has MathJax --></p>
</li>
<li><p><code>yield_task_weighted_rr()</code><br>直接運行 \lstinline{requeue} 即可。</p>
</li>
<li><p><code>pick_next_task_weighted_rr()</code><br>當最上層分配一段時間給 scheduler 運行，運行時會調用這個函數，並拿取要執行的 task，但並不用將其移除串列，並執行 <code>next-&gt;se.exec_start = rq-&gt;clock;</code> 紀錄 task 的開始運行時間，再呼叫 <code>void update_curr_weighted_rr(struct rq *)</code>。若不更新時間，則計算的相對運行時間會錯誤。</p>
</li>
<li><p><code>task_tick_weighted_rr()</code><br>當 scheduler 運行時，每隔一段固定的時間會呼叫此函數。若程序執行量超過 scheduler 的設定，則需要更新串列，特別注意到 <code>if (p-&gt;task_time_slice &amp;&amp; --p-&gt;task_time_slice)</code> 在原本預設是 <code>unsigned int</code> 型態，處理不當會造成 overflow，另一種情況會是一開始 quantum 設定為 0 所導致。<br>需根據不同的 task 要補充不同的量 <code>p-&gt;weighted_time_slice</code>，不只要讓這支程式重進進入串列，同時需要呼叫 <code>set_tsk_need_resched(p)</code> (參考 <code>kernel/sched_rt.c</code> 代碼)，藉以重新呼叫 <code>pick_next_task_weighted_rr(struct rq*)</code>，否則這支程序會運行到結束。</p>
</li>
</ul>
<h3 id="Part-2-Shortest-Job-First-Scheduler"><a href="#Part-2-Shortest-Job-First-Scheduler" class="headerlink" title="Part 2. Shortest Job First Scheduler"></a>Part 2. Shortest Job First Scheduler</h3><ul>
<li><p><code>enqueue_task_weighted_rr()</code><br>與 Weighted round-robin 類似，利用 list 做插入排序，可以在最慘 <span>$\mathcal{O}(n)$</span><!-- Has MathJax --> 時間內維護一個優先權由高至低的 list。需要 task 時，直接將串列的首元素移除。</p>
</li>
<li><p><code>dequeue_task_weighted_rr()</code><br>類同 Weighted round-robin。</p>
</li>
<li><p><code>requeue_task_weighted_rr()</code><br>在最短工作優先排程中，由於 task 優先權會變動，不方便確定執行過一陣子的 task 要移動到哪裡，最簡單的實作方式採用 <code>dequeue</code> 後再一次 <code>enqueue</code>。時間複雜度 <span>$\mathcal{O}(n)$</span><!-- Has MathJax --></p>
</li>
<li><p><code>yield_task_weighted_rr()</code><br>直接運行 \lstinline{requeue} 即可。</p>
</li>
<li><p><code>pick_next_task_weighted_rr()</code><br>類同 Weighted round-robin。 </p>
</li>
<li><p><code>task_tick_weighted_rr()</code><br>在最短工作優先排程中若按照 Weighted round-robin 的寫法且不補充 quantum，則會變成 non-preemptive SJF。相反地，若要實作 preemptive SJF，需要在 <code>check_preempt_curr_weighted_rr(struct rq*, struct task_struct*, int)</code> 檢查執行的程序是不是串列的首元素，意即是不是最高優先權，如果不是最高優先權，則呼叫 <code>resched_task()</code> 即可完成 (詳見 Bonus RMS 的寫法)。</p>
</li>
</ul>
<h3 id="Bonus-RMS"><a href="#Bonus-RMS" class="headerlink" title="Bonus RMS"></a>Bonus RMS</h3><p>額外增加 syscall，修改三個檔案 <code>unistd_32.h</code>, <code>unistd_64.h</code>, <code>syscall_table_32.S</code>。增加 Rate-monotonic scheduler 的額外週期 (period) 和 syscall 函數主題，修改兩個檔案 <code>sched.h</code>, <code>sched.c</code>。</p>
<h4 id="程式碼細節-sched-weighted-rr-c"><a href="#程式碼細節-sched-weighted-rr-c" class="headerlink" title="程式碼細節 sched_weighted_rr.c"></a>程式碼細節 <code>sched_weighted_rr.c</code></h4><ul>
<li><code>enqueue_task_weighted_rr</code><br>使用與最短工作優先排程相同寫法，但利用週期 (period) 進行由優先權高到低排序。</li>
<li><code>check_preempt_curr_weighted_rr</code><br>週期程式可能會搶之前正在運行程式，若發現運行程式的優先權低於要進入排程器的程式優先權，呼叫 <code>resched_task()</code> 重新排程。</li>
<li>其餘類同 SJF。</li>
</ul>
<h4 id="測試程序-test-rms-c"><a href="#測試程序-test-rms-c" class="headerlink" title="測試程序 test_rms.c"></a>測試程序 <code>test_rms.c</code></h4><p>參考 Project 1 的寫法，linux 針對每一個 thread 有各自計時的計時器，當 thread 被 context-switch 時，計時器也會隨之停止。</p>
<p>利用 main thread 產生週期性程式，<code>pthread_create</code> 並不會馬上將 thread 立即執行，迫使 main thread 的方式使用 <code>sleep(1)</code>，以秒為單位產生週期性程式。由於要考慮週期程式的執行時間，又能在輸出緩衝區觀察順序關係，利用 thread 的計時器，盡可能接近 1ms 才進行一次印出，但這也會造成幾毫秒的誤差，對於一支程序一秒大約印出 1000 個字元，測試程式中，將連續相同字元計數，若相同字元取用四捨五入到秒才進行印出，計時誤差部分就不予輸出。</p>
<h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><p><a href="https://github.com/morris821028/hw-realtime-system" target="_blank" rel="external">https://github.com/morris821028/hw-realtime-system</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-realtime-system-qemu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/realtime-system-qemu/" class="article-date">
  <time datetime="2016-01-21T07:13:45.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/即時系統/">即時系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/2sHgITS.jpg" rel="gallery_ciq1m82nf009nrjxcpjazevij">
        <img src="http://i.imgur.com/2sHgITS.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/realtime-system-qemu/">初體驗 qemu</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/01/21/realtime-system-qemu/" data-id="ciq1m82nf009nrjxcpjazevij" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/01/21/realtime-system-qemu/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>若不想在 Windows 上灌 Virtual Box 進行 kernel 修改，那麼在 Linux 上面灌 qemu，在上面測試，假設只要測試 kernel 那麼 qemu 在第一次編譯以及在部分檔案重新編譯都只需要兩三分鐘。若 Windows 上用 Virtual Box 灌 Linux，又在 Linux 上面灌 qemu，容易遭遇到記憶體不夠的窘境。</p>
<h3 id="Ubuntu-Environment"><a href="#Ubuntu-Environment" class="headerlink" title="Ubuntu Environment"></a>Ubuntu Environment</h3><p>Ubuntu 環境需要安裝下列插件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install qemu-system</span><br><span class="line">$ sudo apt-get install libncurses5-dev</span><br></pre></td></tr></table></figure>
<h3 id="Buildroot"><a href="#Buildroot" class="headerlink" title="Buildroot"></a>Buildroot</h3><p>用 busybox 建造一直失敗，轉向學長推薦的 buildroot，用別人打包好的環境替 qemu 建造 file system。</p>
<p><a href="https://buildroot.uclibc.org/download.html" target="_blank" rel="external">site</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://buildroot.uclibc.org/downloads/buildroot-2015.11.1.tar.bz2</span><br><span class="line">$ bzip2 -d FileName.bz2</span><br><span class="line">$ tar xvf FileName.tar</span><br></pre></td></tr></table></figure>
<h4 id="Compile-Config"><a href="#Compile-Config" class="headerlink" title="Compile Config"></a>Compile Config</h4><p>Buildroot 提供很多參數給予選擇</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make menuconfig</span><br></pre></td></tr></table></figure>
<p>這次作業設定，由於需要改寫 kernel 版本為 2.6.32.* 左右，因此相關的 gcc 編譯器等設定如下。同時，根據機器架構設定，助教預設在 visual box 上面，通常為 i386，而我們用實驗室 server，編 x86 64。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Target options  ---&gt;</span><br><span class="line">    Target Architecture (x86_64)  ---&gt;</span><br><span class="line">        x86_64</span><br><span class="line"></span><br><span class="line">Toolchain  ---&gt;</span><br><span class="line">    C library (glibc)  ---&gt;</span><br><span class="line">        glibc</span><br><span class="line">    Kernel Headers (Manually specified Linux version)  ---&gt;</span><br><span class="line">        custom 2.6.x</span><br><span class="line">        2.6.32.6</span><br><span class="line"></span><br><span class="line">System configuration  ---&gt;</span><br><span class="line">    [*] Enable root login with password</span><br><span class="line">    [*] remount root filesystem read-write during boot </span><br><span class="line"></span><br><span class="line">Filesystem images  ---&gt; </span><br><span class="line">    [*] ext2/3/4 root filesystem</span><br><span class="line">    [*] tar the root filesystem</span><br></pre></td></tr></table></figure>
<h4 id="Compile"><a href="#Compile" class="headerlink" title="Compile"></a>Compile</h4><p><code>make -j8</code> 用 8 個執行緒編譯，如果機器有很多個 core，那麼可以用 <code>make -j20</code> 在非常短的時間內完成。</p>
<p>接著在 <code>buildroot</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make -j8</span><br><span class="line">$ cp output/image/rootfs.ext* WORKSPACE_PATH</span><br></pre></td></tr></table></figure>
<h3 id="Linux-kernel-config"><a href="#Linux-kernel-config" class="headerlink" title="Linux kernel config"></a>Linux kernel config</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make defconfig</span><br><span class="line">$ make menuconfig</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[_] Enable loadable module support</span><br><span class="line"></span><br><span class="line">File systems  ---&gt; </span><br><span class="line">    [*] Second extended fs support</span><br><span class="line">        [*] ext2</span><br><span class="line"></span><br><span class="line">Device Drivers  ---&gt;</span><br><span class="line">    Generic Driver Options  ---&gt; </span><br><span class="line">        [*] Create a kernel maintained /dev tmpfs (EXPERIMENTAL) </span><br><span class="line">        [*] Automount devtmpfs at /dev</span><br></pre></td></tr></table></figure>
<p>create <code>arch/x86/boot/bzImage</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make -j20</span><br></pre></td></tr></table></figure>
<h3 id="Test-Flow"><a href="#Test-Flow" class="headerlink" title="Test Flow"></a>Test Flow</h3><h4 id="move-test-execute-file"><a href="#move-test-execute-file" class="headerlink" title="move test execute file"></a>move test execute file</h4><p><code>mnt.sh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mount rootfs.ext2 mnt</span><br><span class="line">sudo cp test_weighted_rr/test_weighted_rr mnt/root/</span><br><span class="line">sudo umount mnt</span><br></pre></td></tr></table></figure>
<p><code>run.sh</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-x86_64 -M pc -kernel arch/x86/boot/bzImage -hda rootfs-dirty.ext4 -netdev user,id=network0 -device e1000,netdev=network0 -nographic -append &quot;root=/dev/sda console=ttyS0&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="How-to-enlarge-the-rootfs-ext4"><a href="#How-to-enlarge-the-rootfs-ext4" class="headerlink" title="How to enlarge the rootfs.ext4"></a>How to enlarge the rootfs.ext4</h3><p><a href="http://stackoverflow.com/questions/3495854/extend-the-size-of-already-existing-ext2-image" target="_blank" rel="external">http://stackoverflow.com/questions/3495854/extend-the-size-of-already-existing-ext2-image</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dd if=/dev/zero of=foo.img count=0 bs=1M seek=2000   # assuming target size is 2000M</span><br><span class="line"># e2fsck -f foo.img</span><br><span class="line"># resize2fs foo.img</span><br></pre></td></tr></table></figure>
<h3 id="Screen-Workspace"><a href="#Screen-Workspace" class="headerlink" title="Screen Workspace"></a>Screen Workspace</h3><p><a href="http://ssorc.tw/19" target="_blank" rel="external">commond tutorial</a></p>
<p>執行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screen</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ctrl+a c</code><br>開啟新的視窗，並同時切換到這個新的視窗</li>
<li><code>ctrl+a tab</code><br>切換視窗</li>
<li><code>ctrl+a |</code><br>切割垂直視窗，並產生新的視窗。</li>
<li><code>ctrl+a k</code><br>關閉此視窗</li>
</ul>
<p>之所以用 Screen 指令，主要是因為遠端到工作站上操作 qemu，若程序掛掉，很容易遭遇到要重新連線的麻煩事。</p>
<h3 id="Speical-Thanks"><a href="#Speical-Thanks" class="headerlink" title="Speical Thanks"></a>Speical Thanks</h3><ul>
<li>蕭光宏 蕭大帥</li>
<li>Lab 332 Parallel &amp; Distributed Laboratory</li>
</ul>
<h3 id="Virtual-Box"><a href="#Virtual-Box" class="headerlink" title="Virtual Box"></a>Virtual Box</h3><h4 id="第一次運行"><a href="#第一次運行" class="headerlink" title="第一次運行"></a>第一次運行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/src</span><br><span class="line">$ sudo wget http://newslab.csie.ntu.edu.tw/course/rts2015/projects/linux-2.6.32.60.tar.gz</span><br><span class="line">$ sudo tar -zxvf linux-2.6.32.60.tar.gz</span><br><span class="line">$ cd linux-2.6.32.60</span><br><span class="line">$ sudo make mrproper</span><br><span class="line">$ sudo make menuconfig</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ scp morris1028@140.112.30.245:~/RTS/linux-2.6.32.60/arch/x86/include/asm/unistd_64.h arch/x86/include/asm/</span><br><span class="line">$ scp morris1028@140.112.30.245:~/RTS/linux-2.6.32.60/kernel/sched_weighted_rr.c kernel/</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make bzImage</span><br><span class="line">$ sudo make modules</span><br><span class="line">$ sudo make modules_install</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/default/grub</span><br><span class="line">#Add &quot;#&quot; to comment the following 2 lines</span><br><span class="line">#GRUB_HIDDEN_TIMEOUT=10</span><br><span class="line">#GRUB_HIDDEN_TIMEOUT_QUIET=true</span><br><span class="line">$ sudoupdate-grub2</span><br><span class="line">$ sudoshutdown -r now</span><br></pre></td></tr></table></figure>
<h4 id="Test-flow"><a href="#Test-flow" class="headerlink" title="Test flow"></a>Test flow</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/src/linux-2.6.32.60</span><br><span class="line">$ sudo make bzImage</span><br><span class="line">$ sudo make modules</span><br><span class="line">$ sudo make modules_install</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>
<h4 id="Debug-by-printk"><a href="#Debug-by-printk" class="headerlink" title="Debug by printk"></a>Debug by <code>printk</code></h4><p>在另一個 terminal 開啟以下代碼，並且等待執行測試 scheduler 得執行檔在 kernel 運行時所打印出的 <code>printk</code> 訊息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo more /proc/kmsg</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-realtime-system-using-scheduler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/realtime-system-using-scheduler/" class="article-date">
  <time datetime="2016-01-21T06:41:29.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/即時系統/">即時系統</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/2L6Zmwa.jpg" rel="gallery_ciq1m82ny009xrjxci4vit6uy">
        <img src="http://i.imgur.com/2L6Zmwa.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/realtime-system-using-scheduler/">即時系統 使用排程器</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/01/21/realtime-system-using-scheduler/" data-id="ciq1m82ny009xrjxci4vit6uy" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/01/21/realtime-system-using-scheduler/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h3 id="目標"><a href="#目標" class="headerlink" title="目標"></a>目標</h3><p>安裝 linux kernel 2.6.32.68、練習 pthread 設定 scheduler 相關函數以利後續修改 kernel source code。</p>
<h3 id="設定-scheduler-問題"><a href="#設定-scheduler-問題" class="headerlink" title="設定 scheduler 問題"></a>設定 scheduler 問題</h3><ul>
<li>設定 thread 可以在哪些 core 運行，由於要測試執行順序,強制讓 pthread 都在 CPU 0 運行。<br>編譯時，增加 <code>#define _GNU_SOURCE</code> 在 <code>#include &lt;pthread&gt;</code> 之前，確定 <code>cpu_set_t</code> 型別存在。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cpu_set_t</span> mask;</span><br><span class="line">CPU_ZERO(&amp;mask);</span><br><span class="line">CPU_SET(<span class="number">0</span>, &amp;mask);</span><br><span class="line">sched_setaffinity(<span class="number">0</span>, <span class="keyword">sizeof</span>(mask), &amp;mask);</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>sched_setscheduler()</code> 時，需查閱 <code>int policy</code> 相關規定去設定 <code>struct sched_param</code> 的 priority 數值。例如 <code>SCHED_FIFO</code> 的 priority 介於 1 到 99 之間,若 priority 錯誤，<code>sched_setscheduler()</code> 會發生錯誤，錯誤訊息可以藉由 <code>printf(&quot;Message␣%s\n&quot;, mid, strerror(errno));</code> 查閱。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sched_setaffinity(<span class="number">0</span>, <span class="keyword">sizeof</span>(mask), &amp;mask);</span><br><span class="line">              <span class="function"><span class="keyword">int</span> <span class="title">sched_setscheduler</span><span class="params">(pid_t pid, <span class="keyword">int</span> policy,</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">struct</span> sched_param *param)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果 pid = 0，相當於 caller 的 thread 會被設置對應的 policy 和 <code>sched_param</code>。在 policy 設定 規範中，有兩種 real time scheduler <code>SCHED_FIFO</code> 和 <code>SCHED_RR</code>。當 thread 設置 real time scheduler 時，需要用 root 權限來執行程式，否則會設置失敗。相反地，若使用 non-real time scheduler 則不需要 root 權限，如 <code>SCHED_BATCH</code>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> sched_param param;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Thread %d sched_setscheduler()\n"</span>, mid);</span><br><span class="line">param.sched_priority = sched_get_priority_max(SCHED_FIFO);</span><br><span class="line">s = sched_setscheduler(<span class="number">0</span>, SCHED_FIFO, &amp;param);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Thread %d sched after %s\n"</span>, mid, strerror(errno));</span><br></pre></td></tr></table></figure>
<h3 id="三種方法設定-pthread"><a href="#三種方法設定-pthread" class="headerlink" title="三種方法設定 pthread"></a>三種方法設定 pthread</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>各自的 <code>pthread_create()</code> 後，再呼叫 <code>sched_setscheduler()</code> 進行設定。這種寫法在本次實驗有順序問題，在 create 之後，無法保證執行 <code>sched_setscheduler()</code> 的順序，無法依靠 main thread 中執行 <code>pthread_create()</code> 的順序決定。幸運地，仍可以使用 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pthread_barrier_t</span> barrier; </span><br><span class="line">pthread_barrier_wait(&amp;barrier);</span><br><span class="line">pthread_barrier_init(&amp;barrier, <span class="literal">NULL</span>, MAX_THREAD);</span><br></pre></td></tr></table></figure>
<p>確保每一個 thread 都設置好各自的 <code>sched_setscheduler()</code> 後統一運行，運行順序取決 priority。</p>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>在 main thread 中，呼叫 <code>pthread_attr_setinheritsched(attr, PTHREAD_INHERIT_SCHED);</code> 接下來 create 出來的 pthread 都將繼承 main thread 的 scheduler 設定。這種寫法很方便，如果需要各自設置 priority 會不方便，倒不如直接用第三種寫法。</p>
<h4 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h4><p>在 main thread 中，手動設置每一個 pthread 的 scheduler。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pthread_attr_t</span> *attr = <span class="keyword">new</span> <span class="keyword">pthread_attr_t</span>;</span><br><span class="line"><span class="keyword">struct</span> sched_param *param = <span class="keyword">new</span> <span class="keyword">struct</span> sched_param;</span><br><span class="line"><span class="comment">// increasing order</span></span><br><span class="line">param-&gt;sched_priority = sched_get_priority_max(SCHED_FIFO) - i;</span><br><span class="line"><span class="comment">// set scheduler</span></span><br><span class="line">pthread_attr_setinheritsched(attr, PTHREAD_EXPLICIT_SCHED);</span><br><span class="line">pthread_attr_setschedpolicy(attr, SCHED_FIFO);</span><br><span class="line">pthread_attr_setschedparam(attr, param);</span><br><span class="line"><span class="comment">// create thread</span></span><br><span class="line">pthread_create(&amp;tid[i], attr, running_print, create_arg(i+<span class="number">1</span>, scheduler))</span><br></pre></td></tr></table></figure>
<h3 id="計時設置"><a href="#計時設置" class="headerlink" title="計時設置"></a>計時設置</h3><p>為確定每一個 thread 按照設定的 scheduler 運行，方式採用 <code>print()</code> 進行，但有可能輸出之間間隔距離過短，導致順序容易在輸出上發生無法預期的問題，適時地加入一秒間隔完成。</p>
<p>如何準確地停止一秒？不能呼叫 <code>sleep()</code> 因為這類的 system call 會產生 interrupt，此時 thread 將會降低 priority 或者進入隊列尾端。佔據 CPU time 有以下三種</p>
<h4 id="busy-work"><a href="#busy-work" class="headerlink" title="busy work"></a>busy work</h4><p>只要停留的夠久即可，下面是一種簡單的方法 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// busy 1 second</span></span><br><span class="line"><span class="keyword">double</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++)	a += <span class="number">0.1f</span>;</span><br></pre></td></tr></table></figure>
<h4 id="系統時間"><a href="#系統時間" class="headerlink" title="系統時間"></a>系統時間</h4><p>利用 critical section 抓系統時間 <code>int gettimeofday (struct timeval * tv, struct timezone * tz);</code>，這寫法會共用同一份時間，因此需要使用 mutex 完成。仍使用一個迴圈來判定時間是否超過，實際運行時間會超過一秒。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">my_clock</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> timeval t;</span><br><span class="line">    gettimeofday(&amp;t, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1e-6</span> * t.tv_usec + t.tv_sec;</span><br><span class="line">&#125;</span><br><span class="line">pthread_mutex_lock(&amp;outputlock);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">double</span> sttime = my_clock();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (my_clock() - sttime &gt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">pthread_mutex_unlock(&amp;outputlock);</span><br></pre></td></tr></table></figure>
<h4 id="執行緒運行時間"><a href="#執行緒運行時間" class="headerlink" title="執行緒運行時間"></a>執行緒運行時間</h4><p>事實上 Linux 有提供每一個 thread 各自的 clock，用來計算 thread 的執行時間。使用 <code>clock_gettime(CLOCK_THREAD_CPUTIME_ID, &amp;t)</code>，在舊版本需在編譯參數中加入 <code>-lrt</code> 才能使用。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">my_clock</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> timespec t;</span><br><span class="line">    assert(clock_gettime(CLOCK_THREAD_CPUTIME_ID, &amp;t) == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1e-9</span> * t.tv_nsec + t.tv_sec;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="輸出-console-問題"><a href="#輸出-console-問題" class="headerlink" title="輸出 console 問題"></a>輸出 console 問題</h3><p>在 <code>SCHED_FIFO</code> 這類的 real time scheduler 情況下，thread 輸出無法即時顯示在 terminal 上。</p>
<p>從 <a href="http://man7.org/linux/man-pages/man7/sched.7.html" target="_blank" rel="external">http://man7.org/linux/man-pages/man7/sched.7.html</a> 可以見到 real-time scheduler 安排工作的比例，由於 <code>print()</code> 之後的顯示處理並不是 real-time process，當 real-time process 完全用盡 95\% 的 CPU time 時，顯示處理可能沒辦法在一秒內完成，可能要用好幾秒中的 5% 來完成。這也就是造成一開始會停頓一陣子，隨後才一次輸出數行結果。(註：並不是每一種裝置都會造成這問題，跟 CPU 時脈有關。)</p>
<blockquote>
<p>The value in this file specifies how much of the period time  can be used by all real-time and deadline scheduled processes on the system.  The value in this file can range from <code>-1</code> to <code>INT_MAX-1</code>.  Specifying <code>-1</code> makes the runtime the same as the period; that is, no CPU time is set aside for non-real-time processes (which was the Linux behavior before kernel 2.6.25). The default value in this file is 950,000 (0.95 seconds), meaning that 5% of the CPU time is reserved for processes that don’t run under a real-time or deadline scheduling policy.</p>
</blockquote>
<p>解決這類的問題，可以從 kernel 設定著手，降低 real-time 最大佔有量，讓 <code>print()</code> 處理能即刻印出。這不是好的解決辦法，但可用於實驗。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// default</span><br><span class="line">$ sudo /sbin/sysctl -w kernel.sched_rt_runtime_us=950000</span><br><span class="line">// modify</span><br><span class="line">$ sudo /sbin/sysctl -w kernel.sched_rt_runtime_us=500000</span><br></pre></td></tr></table></figure>
<p>又或者採用拉大間隔，讓每一個 thread 都停止數十秒以上。</p>
<h3 id="特別感謝"><a href="#特別感謝" class="headerlink" title="特別感謝"></a>特別感謝</h3><p>蕭光宏學長</p>
<h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h3><p><a href="https://github.com/morris821028/hw-realtime-system" target="_blank" rel="external">https://github.com/morris821028/hw-realtime-system</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/23/security-notes7/" class="article-date">
  <time datetime="2015-06-23T00:06:29.000Z" itemprop="datePublished">2015-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/23/security-notes7/">近代加密 小額付費</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/23/security-notes7/" data-id="ciq1m82qf00b0rjxcvopqnuq6" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/23/security-notes7/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="關於小額付費"><a href="#關於小額付費" class="headerlink" title="關於小額付費"></a>關於小額付費</h2><p>另一個名稱為 <strong> 微支付 </strong> (Micropayment)，簡單來說提供顧客 (Consumer) - 銀行 (Broker) - 商家 (Vendor) 三方的交易。小額付費標明在交易金額小，因此交易成本也應該小，否則交易手續的計算能量就超過交易金額，更別說要扣除交易物品的成本。通常要在以下三點最小化</p>
<ul>
<li>計算資源：<br>在先前提到的加密算法中，key 的 bit-length 相當長，導致計算的能量消耗大。倘若只消費 1 元，耗電成本就佔了 1% 以上，甚至更多，那麼是划不來的。</li>
<li>儲存空間花費：<br>計算每一組交易明細所需要的空間要最小，例如記錄金額需要 32-bit，那麼 n 次交易就需要 n 個 32-bit 的空間，在其他細節中還需要紀錄額外的購買來源、 … 等。</li>
<li>管理成本：<br>第三方 (通常是銀行) 要管理顧客的金額花費、商家是否能取用顧客的錢。銀行要怎麼紀錄顧客的狀態、如何驗證商家真的有跟顧客交易 … 等。</li>
</ul>
<p>由於交易金額小，即使被破解對雙方的損失也不大。但通常破解手段需要的時間、資源往往超過交易金額，因此不太會有人去破解這個。</p>
<h2 id="應用層面"><a href="#應用層面" class="headerlink" title="應用層面"></a>應用層面</h2><h3 id="網路電子報："><a href="#網路電子報：" class="headerlink" title="網路電子報："></a>網路電子報：</h3><p>一份電子報可能有一些特別的標題內容，若要深入查閱內文，需要讀者付費觀看。這一部分更具有彈性，對於一份具有相當多面向的電子報而言，有些人只看幾個專欄就必須花費購買一整本的金額，有些時候是浪費的。</p>
<h3 id="網路期刊購買、資料庫詢問"><a href="#網路期刊購買、資料庫詢問" class="headerlink" title="網路期刊購買、資料庫詢問"></a>網路期刊購買、資料庫詢問</h3><p>網路學術期刊就跟電子報的情況一樣。資料庫詢問比較特別，花費小金額來交換資料庫服務的次數。</p>
<h3 id="廣告"><a href="#廣告" class="headerlink" title="廣告"></a>廣告</h3><p>互動式影片、廣告商為了誘拐大眾仔細觀看廣告，由廣告商付錢給觀看者。例如回答問卷回饋、機率性地抽獎回饋 … 等。</p>
<h3 id="網頁閱讀"><a href="#網頁閱讀" class="headerlink" title="網頁閱讀"></a>網頁閱讀</h3><p>類似向大眾徵文，鼓勵分享知識。徵求到的文章，由平台供應者支付。</p>
<h2 id="何時用"><a href="#何時用" class="headerlink" title="何時用"></a>何時用</h2><p>使用者付費，而非訂閱長時間的垃圾訊息或服務。在大多數的服務商中，會提供時間內無限使用或按照次數計費兩種方案，在大多數的情況下，時間內無限使用是對商家有利，可以預先得到使用者的投資，但使用者在後續時間內可能沒有去使用、或者沒時間去用。</p>
<p>不是 <strong> 按照次數計費全然好 </strong>，就如 <strong> 電話費 </strong>，打了多少通電話、講了多久，只有電信商知道，即便告訴花費相當多金額，通話明細也是由他們提供，很難證明到底花了多少，這是對使用者的不利。相較起來，小額付費比較接近投幣式的公共電話，投了多少就打多少，等到快沒有餘額時，再進行補充。</p>
<p>先付款給商家會對使用者不利，有可能取得不好的服務，後付款給商家會對商家不利，因為使用者可能沒有足夠的金額。正因為小額交易，適時地刷新狀態 (再投幣) 就能在之間達到平衡。</p>
<h2 id="數學"><a href="#數學" class="headerlink" title="數學"></a>數學</h2><p>由制定 RSA 那伙人 Rivest, Shamir 提供 Payword scheme 的方法。</p>
<p>首先，概念建立在假設不用數字儲存金額 (減少儲存空間、管理花費)，而是用運算次數來知道花費金額 (用簡單運算來完成，防止能源消耗過大)。金額花費是整數，由最小單位 1 元構成，如果是在通貨膨脹的國家，最小單位可能不一樣？</p>
<p>那麼可以建立一個儲值金額 n 元的串列如下。</p>
<span>$x_0 \leftarrow x_1 \leftarrow x_2 \leftarrow \text{ ... } \leftarrow x_{n-1} \leftarrow x_n$</span><!-- Has MathJax -->
<p>由使用者拿一個<span>$x_n$</span><!-- Has MathJax --> 初始化，接著利用 hash<span>$x_i = h(x_{i+1})$</span><!-- Has MathJax --> 得到每一個硬幣<span>$x_i$</span><!-- Has MathJax -->。用數學表示遞迴公式<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->。</p>
<p>當顧客跟商家交易時，簽一份簽章 (例如用 RSA 或者是 DSA 等方式) 給商家。簽章內容為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax -->
<p>其中 <span>$\text{Cert}$</span><!-- Has MathJax --> 是由第三方信任銀行簽署給用戶的內容 (類似銀行帳戶的確認)。最後發送給商家資訊為</p>
<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert}), \text{Merchant-ID}, x_0, \text{Cert}$</span><!-- Has MathJax -->
<p>由商人去驗證 (檢查簽證內容、拿對方的 public key 打開，再去拿銀行的 public key 驗證 <span>$\text{Cert}$</span><!-- Has MathJax -->  是否正確) 是否是可信任的顧客或者是顧客是否存在。</p>
<p>接下來交易採用最笨的方案，每一次交易 1 元，交付 i 元時，顧客就告知<span>$x_i$</span><!-- Has MathJax --> 值給商家，這裡顧客得到硬幣方法為重新計算<span>$x_i = h^{n-i}(x_n)$</span><!-- Has MathJax -->，可以不事先用記憶體儲存<span>$[x_0, x_n]$</span><!-- Has MathJax -->，保留 <span>$n$</span><!-- Has MathJax --> 和<span>$x_n$</span><!-- Has MathJax --> 即可。</p>
<p>之後商家拿著 i 元<span>$x_i$</span><!-- Has MathJax --> 和<span>$\text{Sign}_C(\text{Merchant-ID} || x_0 || \text{Cert})$</span><!-- Has MathJax --> 的資訊給銀行，銀行計算 <span>$i$</span><!-- Has MathJax --> 次 hash<span>$x_0 = h^i(x_i)$</span><!-- Has MathJax --> 查看是否正確，若檢驗沒問題，則銀行從客戶存簿撥款給商家。</p>
<h3 id="為什麼可行"><a href="#為什麼可行" class="headerlink" title="為什麼可行"></a>為什麼可行</h3><p>運算過程中使用 hash，hash 提供不可逆的操作，因此商家無法有更多金額的索取，假設從顧客手中得到<span>$x_i$</span><!-- Has MathJax -->，無法計算出<span>$x_{i+1}$</span><!-- Has MathJax --> 究竟是什麼，具有一定安全性。而顧客必須由銀行索取簽證，來表示當前的狀態是合法的，顧客沒辦法竄改自己的狀態，使得自己有更多的金錢，銀行那裏會有最新一組的簽章在？應該是吧，銀行會在商家發送驗證資訊時發生異狀檢查顧客是否竄改。</p>
<p>數學之美。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/19/security-notes6/" class="article-date">
  <time datetime="2015-06-19T07:20:52.000Z" itemprop="datePublished">2015-06-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/19/security-notes6/">近代加密 複習 續</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/19/security-notes6/" data-id="ciq1m82qb00awrjxcoh6m5oi0" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/19/security-notes6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>幾乎是密碼學基礎數論，看來也走到這了。</p>
<h2 id="亂來"><a href="#亂來" class="headerlink" title="亂來"></a>亂來</h2><p>隨便寫寫，上課不專心真是抱歉。</p>
<ol>
<li><p>Given an integer <span>$x$</span><!-- Has MathJax -->, what is the requirement to let the multiplcative inverse <span>$x^{-1}$</span><!-- Has MathJax --> exist when modulo <span>$p$</span><!-- Has MathJax -->?  if <span>$x^{-1} \mod p$</span><!-- Has MathJax --> exists, please write down the equation (based on Fermat’s theorem) used to compute <span>$x^{-1} \mod p$</span><!-- Has MathJax -->. (5%)</p>
<ol>
<li>condition: <span>$gcd(x, p) = 1$</span><!-- Has MathJax --> for multiplcative inverse <span>$x^{-1}$</span><!-- Has MathJax --> exist when modulo <span>$p$</span><!-- Has MathJax --></li>
<li>Fermat’s theorem :   <span>$x^{p-1} = 1 \mod p \Rightarrow x^{p-2} \times x = 1 \mod p$</span><!-- Has MathJax -->
<span>$x^{-1} = x^{p-2} \mod p$</span><!-- Has MathJax -->
</li>
</ol>
</li>
<li><p>What is the Euler totient function <span>$\phi(n)$</span><!-- Has MathJax -->? Please answer <span>$\phi(77) = ?$</span><!-- Has MathJax --></p>
 <span>$\phi(n)$</span><!-- Has MathJax --> 表示 1 到 n 之內的整數，有多少與 n 互質的個數。<br> <span>$\phi(77) = 77 \times (1 - 1 / 7) \times (1 - 1 / 11) = 60$</span><!-- Has MathJax -->
</li>
<li><p>Whais the discrete logarithm problem?   (5%)<br> 對於等式 <span>$y = x^a \mod p$</span><!-- Has MathJax -->，已知三整數 y, x, p，解出 a 的問題。詳見小步大步算法 baby-step-giant-step，複雜度 <span>$O(\sqrt p)$</span><!-- Has MathJax --></p>
</li>
<li><p>What is a hybrid cryptography?   (5%)<br>$<span>$\text{hybrid cryptosystem } = \text{ public-key cryptosystem } + \text{ symmetric-key cryptosystem}$</span><!-- Has MathJax -->$  </p>
<ul>
<li>public-key cryptosystem<br>提供 key encapsulation，就是 key 的安全性和簽章認證，保護 key 傳輸、保管上的問題。</li>
<li>symmetric-key cryptosystem<br>提供 data encapsulation，提供高效率的加解密效能。</li>
</ul>
</li>
<li><p>What are the two primary reasons of using a cryptographic hash before signing a signature?   (5%)<br>cryptographic hash 密碼雜湊函數，通常會計算 <span>$hash(M)$</span><!-- Has MathJax --></p>
<ul>
<li>單向不可逆<br>難以給定一個雜湊值，並且逆推得到當初輸入的數值。<ul>
<li>提供訊息修改檢查，相同的訊息進行雜湊，高機率會是不同。<br><span>$hash(M1) \neq hash(M2)$</span><!-- Has MathJax -->，如果 M1 和 M2 差異只有數個 bits 不同。</li>
<li>防止在傳輸過程中被竄改。對於簽章則更難竄改成相同雜湊值且具有 <strong> 意義 </strong> 的訊息 <span>$M&apos;$</span><!-- Has MathJax -->。</li>
</ul>
</li>
<li>容易計算<br>將一個長度很大的訊息，壓縮一個固定長度的數值，這數值方便後續算法計算用加密算法的部分。</li>
</ul>
</li>
<li><p>Please write down the RSA public key encryption and decryption process (including public key and private key generation process).   (10%)</p>
<ol>
<li><span>$N = p \times q$</span><!-- Has MathJax --></li>
<li><span>$\phi(N) = (p-1)(q-1)$</span><!-- Has MathJax --></li>
<li><span>$gcd(\phi(N), e) = 1, \phi(N) &gt; e &gt; 1$</span><!-- Has MathJax --></li>
<li><span>$d = e^{-1}, e \times d = 1 \mod &oslash;(N)$</span><!-- Has MathJax --></li>
<li>public <span>$e, N$</span><!-- Has MathJax --></li>
<li>private <span>$p, q, d$</span><!-- Has MathJax --></li>
</ol>
</li>
<li><p>Please develop a left-to-right binary exponentiation algorithm without “conditional jump” which is usually dangerous to some engineering attack. (10%)<br>Montgomery Ladder  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R[0] = 1, R[1] = p</span><br><span class="line">for i = n-1 to 0, step = -1</span><br><span class="line">    R[1-a[i]] = R[0] * R[1]</span><br><span class="line">    R[a[i]] = R[a[i]] * R[a[i]]</span><br><span class="line">return R[0]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Below is the DSA signature scheme in which <span>$p$</span><!-- Has MathJax --> is a large prime, <span>$q$</span><!-- Has MathJax --> is a 160-bit prime factor of (p - 1), <span>$g$</span><!-- Has MathJax --> is an integer of order <span>$q$</span><!-- Has MathJax --> modulo <span>$p$</span><!-- Has MathJax -->. Let <span>$x$</span><!-- Has MathJax --> be the signer’s private key and <span>$y = g^x \mod p$</span><!-- Has MathJax --> be the public key.  </p>
<ol>
<li>How to generate an integer <span>$g$</span><!-- Has MathJax --> ?   (5%)</li>
<li><p>Please complete the following nissing steps of the scheme.   (10%)</p>
</li>
<li><p>Please describe a trick for speeding up DSA’s on-line signing process. (5%)</p>
<pre><code>_______________________________________________________________________
Signing algorithm                 Verification algorithm
_______________________________________________________________________
r = (g^k mod p) mod q             w = s^-1 mod q
k is a random integer             u1 = (SHA(m) * w) mod q
s = ________________              u2 = (r * w) mod q
m is the messgae                  v = _________________
the signature is (s,r)            if v = r then the signature is correct
</code></pre></li>
</ol>
<ul>
<li><p><span>$g = h^{(p-1)/q} \mod p$</span><!-- Has MathJax --> ，其中隨機亂數 <span>$h$</span><!-- Has MathJax -->，滿足 <span>$g &gt; 1$</span><!-- Has MathJax --> 即可。<br>從費馬小定理中，有一個比較特別的計算來得到 order <span>$q$</span><!-- Has MathJax -->，所謂的 order <span>$q$</span><!-- Has MathJax --> 就是在前 <span>$q$</span><!-- Has MathJax --> 個 <span>$g^i \mod p$</span><!-- Has MathJax --> 下不會出現重複 (循環長度至少為 <span>$q$</span><!-- Has MathJax -->)，從觀察中得知循環長度 <span>$L$</span><!-- Has MathJax --> 滿足 <span>$L | p-1$</span><!-- Has MathJax -->，也就是說 <span>$L$</span><!-- Has MathJax --> 是 <span>$p-1$</span><!-- Has MathJax --> 的因數，<span>$q$</span><!-- Has MathJax --> 則是要找到一個大循環，讓攻擊者更難找到 <span>$x$</span><!-- Has MathJax -->，又因為 <span>$L$</span><!-- Has MathJax --> 是其因數，由於 <span>$q$</span><!-- Has MathJax --> 是 <span>$p-1$</span><!-- Has MathJax --> 的其中一個質因數，則保證是一個最小循環節的要求。</p>
</li>
<li><span>$s = k(SHA(m) + x \times r)$</span><!-- Has MathJax -->  
<span>$v = g^{u1} y^{u2}$</span><!-- Has MathJax -->  
</li>
<li><p>可以 offline 去預處理隨機亂數 <span>$k$</span><!-- Has MathJax -->，事先計算一堆的 <span>$r$</span><!-- Has MathJax -->、<span>$z = k^{-1}x \times r$</span><!-- Has MathJax -->，那麼計算 <span>$s$</span><!-- Has MathJax --> 可以非常的快速，<span>$s = k^{-1} SHA(M) + z \mod p$</span><!-- Has MathJax -->，假設 hash 計算快速，只動用到一次乘法和加法，相較於 RSA 的簽章方法，少了指數次方運算。</p>
</li>
</ul>
</li>
<li><p>Under the following certificate hierarchy, please provide all the details of how end user A checking the correctness of end user C’s public key by verifying a sequence of certificates. Note: User A only knows X’s public key, but does NOT have the root Z’s public key directly.   (10%)<br> 若 A 要確認 C 給的 public key 是否正確，則依循以下步驟來確認</p>
<ol>
<li>C 拿出 <code>Y&lt;&lt;C&gt;&gt;</code>，拿 Y 的 public key 進行確認 C 的 public key。</li>
<li>再檢查 Y 的 public key，Y 拿出 <code>Z&lt;&lt;Y&gt;&gt;</code>，拿 Z 的 public key 進行確認 Y 的 public key。</li>
<li>再檢查 Z 的 public key，Z 拿出 <code>X&lt;&lt;Z&gt;&gt;</code>，拿 X 的 public key 進行確認 Z 的 public key。</li>
<li>由於我們知道 X 的 public key (藉由實地臨櫃面對面確認 X 的 public key)，最後驗證 C 給的是正確的 public key。<pre><code>      Z
    ／ ＼          Notation used
   X     Y         X&lt;&lt;A&gt;&gt;:
 ／ ＼    ＼       A&apos;s certificate issued by X
A     B     C
</code></pre></li>
</ol>
</li>
<li><p>Pleasewrite down the Diffie-Hellman key exchange protocol (including the public key and private key generation process). (10%)  What is the man-in-middle (or the middle person) attack?   (5%)  </p>
<ul>
<li>共同決定一個大質數 <span>$p$</span><!-- Has MathJax --> 和一個基底 <span>$g$</span><!-- Has MathJax --> (全部人都知道)</li>
<li>每個人 A 擁有自己的 private key <span>$x_A$</span><!-- Has MathJax --> (<span>$x_A &lt; p - 1$</span><!-- Has MathJax -->)</li>
<li>每個人 A 計算自己的 public key <span>$y_A$</span><!-- Has MathJax --> (<span>$y_A = g^{x_A} \mod p$</span><!-- Has MathJax -->)</li>
</ul>
<p>假設有兩個人 A, B 要通訊，則把自己的 public key 交給對方，共同產生出一把暫時的 key <span>$K_{AB}$</span><!-- Has MathJax --> 進行通訊加密。</p>
<ul>
<li>對於 A 來說會接收到 <span>$y_B$</span><!-- Has MathJax -->，計算<span>$K_{AB} = (y_B)^{x_A} = g^{x_B \times x_A} \mod p$</span><!-- Has MathJax --></li>
<li>對於 B 來說會接收到 <span>$y_A$</span><!-- Has MathJax -->，計算<span>$K_{AB} = (y_A)^{x_B} = g^{x_A \times x_B} \mod p$</span><!-- Has MathJax --></li>
<li>由於離散對數是一個困難問題，很難藉由攔截紀錄來得到對方的 private key <span>$x_A$</span><!-- Has MathJax -->，因此有一定的安全性。</li>
</ul>
<p>假若現在要進行中間人 C 的攻擊，則會在一開始交換 <span>$K_{AB}$</span><!-- Has MathJax --> 的時候插入到其中通訊。</p>
<ul>
<li>A 發送 <span>$y_A$</span><!-- Has MathJax --> 給 B 時，受到 C 的攔截。</li>
<li>C 知道 A 想要跟 B 通訊，則把自己的 <span>$y_C$</span><!-- Has MathJax --> 發送給 B，並且也傳一份給 A。</li>
<li>B 以為是 A 要進行通訊，實質拿到 <span>$y_C$</span><!-- Has MathJax --> 而非 <span>$y_A$</span><!-- Has MathJax -->。</li>
<li>產生兩把 key<span>$K_{AC}, K_{CB}$</span><!-- Has MathJax -->，C 就偷偷在中間偷聽，並且作為中繼傳送訊息，需要解密 (拿<span>$K_{AC} \text{ or } K_{CB}$</span><!-- Has MathJax -->) 之後再進行加密<span>$K_{CB} \text{ or } K_{AC}$</span><!-- Has MathJax --> 送給另一方。</li>
</ul>
<p>如何防止中間人攻擊，大約有幾種方法，但牽涉到可信任第三方、計算速度。</p>
<ul>
<li>發送訊息上，計算時間的延遲不得超過一定限制，否則可能存在中間人攻擊。</li>
<li>藉由可信任第三方 CA (Certificate Authority) 來驗證彼此的 public key 歸屬於誰<br>由 CA 簽認<span>$Sign_{CA}(\text{public key || owner_id || expiration date || ...})$</span><!-- Has MathJax -->，如此一來如果存在 C 中間人，則轉交 <span>$y_C$</span><!-- Has MathJax --> 給 B 時，B 就會藉由 CA 驗證得到 <code>owner_id</code> 不是通訊對象 A。如果 CA 不可信任，則可以讓 C 簽一個<span>$Sign_{CA}(\text{public key C || owner_A || expiration date || ...})$</span><!-- Has MathJax --> 來欺騙 A 和 B，也就是說 CA 和 C 偷偷在私底下做了黑心勾當，那麼中間人攻擊仍是存在的。</li>
</ul>
</li>
<li><p>Both message authentication code (MAC) and digital signature can be used to provide the functionality of message origin and integrity check. Please briefly describe these two techniwues and compare percisely the difference between these two techniques.   (10%)<br>message authentication code (文件訊息鑑別) 顧名思義就是針對 message 進行驗證，確認發送者身分和資料完整性，相較於 digital signature (數位簽章) 也是做相同的事情，訊息量不同且產生出來的結果也大不相同。通常文件訊息鑑別會破壞儲存資訊，藉由雙方共享的 key 來進行身分認證，可用暫時性的 key，若採用非對稱式則需要額外的數位簽章來輔助驗證發送者。而數位簽章則是提供有效期限內的使用，這把驗證的 public key 必須存在比較長的時間。<br>數位簽章簽定時不知道對方怎麼簽，但能驗證是他簽的並且只有他簽得出來，文件訊息鑑別通常知道對方用什麼流程輸出一樣的數值。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>類型\性質</th>
<th>加密類型</th>
<th>輸出訊息</th>
<th>碰撞情況</th>
<th>重複使用</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件訊息鑑別</td>
<td>普遍上對稱式</td>
<td>不管多長都固定長度</td>
<td>存在</td>
<td>相同輸入 - 相同輸出</td>
</tr>
<tr>
<td>數位簽章</td>
<td>非對稱式</td>
<td>視情況而定</td>
<td>視情況而定</td>
<td>相同輸入 - 可能不同輸出</td>
</tr>
</tbody>
</table>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-cognitive-style-note4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/16/cognitive-style-note4/" class="article-date">
  <time datetime="2015-06-15T23:55:33.000Z" itemprop="datePublished">2015-06-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/介面設計/">介面設計</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/6c9iCJd.png" rel="gallery_ciq1m82e4001krjxcqbu8fchz">
        <img src="http://i.imgur.com/6c9iCJd.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/16/cognitive-style-note4/">遊戲問卷設計 Game Guestionnaire</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/16/cognitive-style-note4/" data-id="ciq1m82e4001krjxcqbu8fchz" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/16/cognitive-style-note4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ui/">ui</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>問卷設計跟面試方法一樣，如何了解使用者的需求與能力，如何發問、如何誘導都是相當有趣的。對於每一種人格特質，在面對不同問題的問法時，作答的難易度是有影響的，這對面試官也是相當重要的課題，因此需要了解到問題設計的方法。</p>
<h2 id="關於問卷"><a href="#關於問卷" class="headerlink" title="關於問卷"></a>關於問卷</h2><p>問卷通常會分成兩種</p>
<ul>
<li>定量分析<br>  詢問回答者的意見 <strong> 程度 </strong>，通常採用二值化，在從正到反極劃分數個單位，讓使用者選擇。</li>
<li>定性分析<br>  單純詢問使用者的 <strong> 看法 </strong>，在不給予任何提示下，讓使用者根據自身的經驗回答問題。</li>
</ul>
<p>當不知道問題的答案分布，既不是好與壞兩者，那麼定量分析就不能作為評估，採用開放式作答的定性分析，讓使用者回答它們所理解的，通常開放式有一個缺點，會導致過於雜亂的回答，很難得到期望的答案。想必很多人在不理解 <strong> 問題描述 </strong> 就會答非所問。定量分析的面向去設計，會得不到意想不到的答案，兩種方法各有優缺。</p>
<h3 id="問卷設計"><a href="#問卷設計" class="headerlink" title="問卷設計"></a>問卷設計</h3><p>按照上述的兩種情況分成 <strong> 選項 </strong> 跟 <strong> 申論 </strong> 兩種。申論題就不必說，留給使用者提出自己的看法，欄位設計就是文字欄位而非選項欄位。</p>
<p>特別介紹一下選項部分，通常會有 <strong> 是 / 否 </strong>、<strong> 喜歡 / 不喜歡 </strong>，再複雜一點就是 <strong> 非常喜歡 - 喜歡 - 沒意見 - 不喜歡 - 非常不喜歡 </strong>。如果在量表中只有偶數選項，通常是不存在中立立場，希望每個應答者都給予一個立場去回答，反之在奇數選項中，給予中立立場的應答機會，通常會得到非常多的 <strong> 沒意見 </strong> 此時有效問卷的數量相對少。</p>
<h2 id="關於面談"><a href="#關於面談" class="headerlink" title="關於面談"></a>關於面談</h2><p>面談通常會分成三種</p>
<ul>
<li>結構化<br>  封閉式對答，在已知答案中做決策。循序讓使用者回答問題。</li>
<li>半結構<br>  相較於結構化問題，不要求詢問順序性，或者是確切的答案回答。</li>
<li>非結構<br>  問題會隨著應答者回答的方式變化。</li>
</ul>
<p>通常第三者的非結構面談相當輕鬆，如果變化問題不特別刁難，面談者也會根據應答者的能力詢問相關問題。然而在結構化問題中，相當一板一眼，容易對應答者感到緊張，當問題卡住的時候，接下來的問題就會影響到應答者的狀態。半結構化則介於兩者之間。</p>
<h3 id="團體面談"><a href="#團體面談" class="headerlink" title="團體面談"></a>團體面談</h3><ul>
<li>部分應答者很容易被忽略，需要主持人去引導，觀察每個應答者在聽取其他人回答的肢體語言，適時地將每個人的意見引出。</li>
<li>很難獲得想要的資訊。</li>
<li>回答之間會相互影響。</li>
</ul>
<p>特別小心主持人不應該讓面談者們 <strong> 達到共識 </strong>，而是讓他們分享所知。誤導或誘答的情況應該避免，否則有可能會造成馬拉松領先者帶著一群人走錯方向的感覺。感覺不少情況會設下陷阱去讓面談者誤答，在問題描述上不給予明確的規範，在算法問題上也常常會這樣，至於算不算誤答就不曉得，當一個人對問題的背景認知不同時，問題本身就不一樣，能不能 <strong> 取悅 </strong> 面試官呢？</p>
<h2 id="歸納問卷"><a href="#歸納問卷" class="headerlink" title="歸納問卷"></a>歸納問卷</h2><p>回收問卷後，利用定性方式去得到的答案是最難分析，只能靠觀察去理解，對於定量方式去設計的，將要看採用的數學模型來決策，例如消頭去尾後得到的平均數、眾數、中位數 … 等。不管哪一種方案，要看應答者的文化習慣，是否會造成不願意表態，極端情況是否正常 … 等因素，適時地消去一些實驗數據進行統計。</p>
<p>問卷介面也要有所區別，通常會有數個相似領域的問題，整合在一起，並且給予一個問題大綱有助於對問題的理解，特別注意到問題設計時要確定題目是否能二極化。</p>
<h2 id="各組設計"><a href="#各組設計" class="headerlink" title="各組設計"></a>各組設計</h2><p>最奇葩的要來了，針對認知風格進行問卷調查，針對先前設計的遊戲，不同認知風格對遊戲介面的觀感。，各組提出的問卷問題如下：</p>
<h3 id="塔防遊戲"><a href="#塔防遊戲" class="headerlink" title="塔防遊戲"></a>塔防遊戲</h3><ul>
<li>遊戲中介面的引導對你有哪些幫助？</li>
<li>升級頁面的兵種介紹對你有何影響？</li>
<li>過多提示會不會扼殺你對遊戲的興趣？為什麼？</li>
<li>你覺得遊戲中哪一個功能最不直觀？為什麼？</li>
<li>是否希望一開始就解鎖所有關卡？為什麼？</li>
<li>無法順利通關時，你都如何應對？</li>
<li>升級頁面的兵種能力數值是否能幫助你理解兵種特性？如果不行，希望如何改善？</li>
<li>你覺得遊戲中哪一個功能最不直觀？為什麼？</li>
<li>你覺得遊戲中在哪個部分自由度不夠？希望如何改善？</li>
<li>你希望遊戲中哪些介面能夠讓你自行調整？</li>
</ul>
<h3 id="角色扮演"><a href="#角色扮演" class="headerlink" title="角色扮演"></a>角色扮演</h3><ul>
<li>你覺得主畫面看起來如何 (例如背景顏色、排版、標題等等)或是其他？</li>
<li>你覺得說明文件的詳細度以及對於操作的說明還有排版等恰當嗎，能助你了解遊戲怎麼進行？</li>
<li>關卡劇情有沒有讓你覺得充滿故事性、關聯性，讓你進入遊戲中？</li>
<li>遊戲的流程、難度、還有系統的圖示資訊你覺得夠完善嗎，能幫助你遊戲順利？</li>
<li>你覺得遊戲的音樂選擇跟切換時機有讓你覺得非常合理，並且具有強大代入感嗎？</li>
<li>您覺得遊戲難度是否可以自行解決？為什麼</li>
</ul>
<hr>
<p>我們組所提出的七個問題如下</p>
<ul>
<li>您覺得遊戲難度是否可以自行解決？為什麼</li>
<li>您最喜歡、討厭這遊戲哪一部分，討厭的話，想改成什麼？</li>
<li>您覺得遊戲內介面的看法如何？</li>
<li>您對於介面的動畫效果的看法如何？</li>
<li>您玩完這款遊戲後，對遊戲目標瞭解程度 (例如劇情 …)？</li>
<li>AI 擬真程度對遊戲操作的感受？</li>
<li>原本期望的效果、事物卻沒在遊戲中的是什麼？</li>
</ul>
<h3 id="解謎遊戲"><a href="#解謎遊戲" class="headerlink" title="解謎遊戲"></a>解謎遊戲</h3><ul>
<li>在遊戲進行當中在覺得最困難的部分為何？</li>
<li>如果在遊戲中加入選關模式，你有什麼看法？</li>
<li>對於遊戲介面，你認為有什麼可以改善的地方？</li>
<li>教學關卡對你學習遊戲的操作模式有什麼影響？</li>
<li>對於破關後才加入競速模式，你有什麼看法？ </li>
<li>你認為遊戲劇情有何改善空間？</li>
</ul>
<h2 id="問卷統計範例"><a href="#問卷統計範例" class="headerlink" title="問卷統計範例"></a>問卷統計範例</h2><p>本課程教學極為詭異，應該請全班人一起填，總共才七組來卻只要求自己去找 <strong> 課程班上 </strong> 十個人來填問卷，互填對方設計的遊戲問卷難道這麼困難嗎？老師應該要直接請全班來填寫吧，用鼓勵的方式，居然在畢業前一周要大家填問卷，一星期統計好並且報告，明顯地大家都在忙畢業典禮的拍照，問卷也很晚統計回來。</p>
<p>當然十個人的樣本數只能自我安慰，下什麼結論都是不具有信用的，只好按照老師的調調亂扯一通。就算遊戲做得再差，問卷回饋不如預期的對答，也許按照自己的預測方式去報告就行，問卷感覺就是裝飾用的。自己的教授自己靠北？</p>
<h3 id="問卷結果"><a href="#問卷結果" class="headerlink" title="問卷結果"></a>問卷結果</h3><p>分別對於兩個版本，非常非常少的實驗數據。</p>
<p>遊戲難度 Holist 認為難度簡單，對遊戲進行不算困難，對於 Serialist 比較有新事物認知上的起手問題。</p>
<p>在遊戲偏好上，大部份的 Holist 看到了整體的光影效果對此深感好奇，而 Serialist 不少指出遊戲說明上的困惑與扣除血量的細節。</p>
<p>在遊戲內介面上，Holist 對於道具切換、使用狀態有強烈的要求，太過簡潔的界面是介意的地方，而在 Serialist 對於顏色要求較為強烈，對於簡介的介面設計滿意。</p>
<p>在遊戲介面動畫上，Holist 比較偏向回答遊戲內部的元素動畫，而 Serislist 則比較在意流血效果和字體閱讀。在這一部分的回答可以說是有點誤導，預期是想要讓他們回應遊戲介面動畫，而非遊戲內的元素動畫。</p>
<p>在遊戲目標上，一致都朝著遊戲通關目標為基準，而非劇情走向，估計是劇情走向對遊戲進行流程不影響，所以沒有必要去注意遊戲劇情內容。</p>
<p>在人工智慧 AI 上，Holist 比較偏向滿意，對有一些與現實邏輯不合的反應介意，對於 Serialist 對於 AI 的反應比較兩極，有好有壞。</p>
<p>對於預測遊戲進行上，Holist 比較想要的是局部性改變，例如效果與道具使用上、遊戲進行邏輯、新的功能利於闖關。而 Serialist 比較喜歡全局性的擴充，如新增關卡、不同類型的通過條件、關卡成就感、角色成長的需求。</p>
<h2 id="課程意見"><a href="#課程意見" class="headerlink" title="課程意見"></a>課程意見</h2><p>請不要一堂課的結尾就喊出成績來決定一個學生的價值，若要從認知風格中挑選一種分類，老師的認知風格屬於一種衝動型，部分是需要不斷反思來接受新的資訊。不強求這門課的走向，但從做遊戲方面，可說是此次教學的創舉，既然要我們寫程式，麻煩就以資工系的方式引導，時間跟計劃不是一兩個星期前講就了事，牽涉到設計與構思，不給一個明確的方向，導致各組面向不同種遊戲，類型不同的遊戲設計出來就不能隨意說好與壞，若是要符合你們口味的網路學習，那直接說做益智遊戲即可，有些探討問題也因遊戲類型扯不上關係。</p>
<p>若要用小組程式作業、設計作為不上課的理由實在說不過去，導致這一學期很多次沒上課，起碼可以一個小時上課，後兩個小時討論的方式。而在論文上台報告卻有報告老師的同一篇論文，導致報告內容重複且冗長。上課投影片請不要用講稿模式 (兩攔筆記式，另一半的筆記欄位不知道給誰看的)，可以請助教弄全螢幕的投影片。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-vr-note4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/13/vr-note4/" class="article-date">
  <time datetime="2015-06-12T23:31:58.000Z" itemprop="datePublished">2015-06-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/13/vr-note4/">虛擬實境 建模 SVD 筆記</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/13/vr-note4/" data-id="ciq1m83c500wdrjxctae1v8mw" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/13/vr-note4/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <p>由於在選讀論文時，和上課都遇到相關問題，但一直對這 SVD 的實際感觸沒很深，了解數學計算，卻不知道特性一直很困惑我。在這裡收集一下曾經學過的內容，當初在線性代數時沒有學到這一塊，至於 <span>$LU$</span><!-- Has MathJax --> 分解有沒有上到過，我自己也深感困惑，不過看一下網路資源勉強還能理解。</p>
<p>至於 SVD 則在線性代數非常重要，在許多領域時常會遇到，如巨量資料 (massive data)？機器學習？影像處理？就我所知理解看看吧！</p>
<h2 id="SVD"><a href="#SVD" class="headerlink" title="SVD"></a>SVD</h2><p>定義從一般式</p>
<span>$$A_{m, n} = U_{m, m} \Sigma_{m, r} V_{n, r}^T$$</span><!-- Has MathJax -->
<p>得到縮減過後的相似矩陣</p>
<span>$$A_{m, n} \cong U_{m, r} \Sigma_{r, r} V_{n, r}^T$$</span><!-- Has MathJax -->
<p>給定 <span>$A$</span><!-- Has MathJax --> 矩陣，要變成三個矩陣相乘，可以壓縮儲存空間，一般來說都是拿來得到近似的 <span>$A$</span><!-- Has MathJax --> 矩陣，藉由刪除過小的 eigenvalue 來完成，eigenvalue 就是所謂的矩陣特徵值。</p>
<p>在學線性代數時，沒有仔細想過 eigenvalue 的意義所在，每一個 eigenvalue 也會對應一個 eigenvector，這些 eigenvalue 大小對應的分佈的相關性大小，而 eigenvector 則表示新的轉換軸的方向。類似最小平方法得到的結果。</p>
<p>但在巨量資料課程中我們可以知道一件事情，若是稀疏矩陣 <span>$A$</span><!-- Has MathJax -->，經過 SVD 運作後，得到 <span>$U, V$</span><!-- Has MathJax --> 矩陣都是稠密的，因此空間儲存反而划不來，因此會有另外一種解法 CUR，可以上網搜尋 massive data mining coursera 在 <a href="http://www.mmds.org/" target="_blank" rel="external">這裏</a> 可以知道關於 CUR 的資訊。</p>
<p>從課程中的例子來看，假設在電影評論系統中，則 A 矩陣表示電影對人的喜好度，則 SVD 相當於如下描述 (假想，單純的矩陣概念)</p>
<ul>
<li><span>$A(i, j)$</span><!-- Has MathJax --> 電影編號 i 對用戶 j 的好感度</li>
<li><span>$U(i, j)$</span><!-- Has MathJax --> 電影編號 i 對電影屬性 j 的成分程度</li>
<li><span>$\Sigma(i, j)$</span><!-- Has MathJax --> 電影屬性 i 跟電影屬性 j 的之間重要性。</li>
<li><span>$V(i, j)$</span><!-- Has MathJax --> 表示用戶 i 對電影屬性 j 的偏愛程度。</li>
</ul>
<p>也就是說有一些電影屬性不是很重要，可以移除掉，這樣的表示法得到一個近似的矩陣 <span>$A$</span><!-- Has MathJax -->。</p>
<p>在巨量資料中一個有趣的運用，可以用在購物推薦系統中，來達到預測相關性，跟某人對其他產品的喜好程度或者是需求性，但是在處理之前會遇到矩陣過大，但又非常稀疏，為了解決紀錄問題，就有奇奇怪怪的 Dimensionality Reduction 來完成，SVD 就是其中一種方法。</p>
<p>其他應用部分，將不重要的特徵值消除，來求得哪些元素是需要的，看到有一篇 <a href="http://www.cnblogs.com/leftnoteasy/archive/2011/01/19/svd-and-applications.html" target="_blank" rel="external">文章</a> 在做 PCA 主成份分析。</p>
<span>$$\begin{align}
&amp; A_{m, n} V_{n, r} = U_{m, r} \Sigma_{r, r} V_{n, r}^T V_{n, r} \\
&amp; \because V_{n, r}^T V_{n, r} = I \\
&amp; \therefore A_{m, n} V_{n, r} = U_{m, r} \Sigma_{r, r} \\
\end{align}$$</span><!-- Has MathJax --> 
<p>如此一來就可以知道要保留哪幾個主要資訊。</p>
<p>在虛擬實境論文中也是有這樣的處理，做的是 CT 建模，將模型的每個頂點，要計算 QEM (最小二次誤差) 的重要性，可以將其表示成一個矩陣，利用 SVD 方式得到，來決策要保留前 k 個重要性的節點，再將其他節點移除，來讓新得到節點盡可能地可以貼近真實模型。</p>
<p>之所以會這麼做，是要利用內插法來強迫得到邊緣偵測，但這樣會造成很多新頂點，為了要把過多頂點消除，使用 QEM 作為評價方法，利用 SVD 來完成大規模刪除的操作。</p>
<h2 id="Map-Reduce"><a href="#Map-Reduce" class="headerlink" title="Map-Reduce"></a>Map-Reduce</h2><p>都明白 SVD 是一個很繁複的做法，有一個 <span>$O(N^3)$</span><!-- Has MathJax --> 的算法來求得所有 eigenvalue，若要用一般電腦跑，光是得到一個大矩陣所有 eigenvalue 複雜度相當高，其複雜程度沒有細讀過。有一種迭代的方法，類似馬可夫過程，每一次迭代可以逼近一個 eigenvalue，為了得到 n 個 eigenvalue，想必要迭代非常多次。運用 Map-Reduce 分散到很多台群落電腦加快矩陣乘法，這種方法的複雜度是可以期待的。</p>
<p>詳細操作 <a href="http://infolab.stanford.edu/~ullman/mmds/ch11.pdf" target="_blank" rel="external">請參考</a></p>
<p>eigenvalue <span>$\lambda$</span><!-- Has MathJax --> 滿足</p>
<span>$Av = \lambda v$</span><!-- Has MathJax -->
<p>現在開始迭代 <span>$v$</span><!-- Has MathJax --> 讓其等式趨近於穩定</p>
<span>$A x_{i} = \lambda x_{i+1}$</span><!-- Has MathJax -->
<p>初始化<span>$x_{i} = (1, 1, ..., 1, 1)$</span><!-- Has MathJax --> ，其中<span>$|x_{i}| = 1$</span><!-- Has MathJax --> 藉由長度為 1 的向量，來求得<span>$\lambda$</span><!-- Has MathJax -->，之所以要對 <span>$x$</span><!-- Has MathJax --> 進行正規化，其一就是要求出<span>$\lambda$</span><!-- Has MathJax -->，另一個原因是要看何時穩定，當<span>$|x_{i} - x_{i+1}|$</span><!-- Has MathJax --> 差距夠小時，則表示進入穩定狀態。</p>
<p>那就可以得到矩陣 <span>$A$</span><!-- Has MathJax --> 的其中一個 eigenvalue，為了求得另外一組解，得到新的<span>$A^* = A - \lambda x x^T$</span><!-- Has MathJax -->，再對<span>$A^*$</span><!-- Has MathJax --> 找到 eigenvalue，不斷地迭代下去。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-security-notes5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/12/security-notes5/" class="article-date">
  <time datetime="2015-06-11T23:20:54.000Z" itemprop="datePublished">2015-06-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/資訊安全/">資訊安全</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/12/security-notes5/">近代加密 數位簽章 DSA 筆記</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2015/06/12/security-notes5/" data-id="ciq1m82q800aurjxczqya3cc2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2015/06/12/security-notes5/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密碼學/">密碼學</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="DSA"><a href="#DSA" class="headerlink" title="DSA"></a>DSA</h2><p>Digital Signature Standard (DSS) 數位憑證標準，而有一個 DSA 演算法來完成憑證。</p>
<p>每一次憑證傳送三個參數 <span>$(r, s, M)$</span><!-- Has MathJax -->，利用私用金鑰進行加密。讓對方使用公鑰進行驗證。</p>
<ul>
<li><span>$r = (g^k \mod p) \mod q$</span><!-- Has MathJax --></li>
<li><span>$s = k^{-1}(SHA(M) + x \times r) \mod q$</span><!-- Has MathJax -->
</li>
</ul>
<p>give receiver <span>$(r, s, M)$</span><!-- Has MathJax -->, we have random (one-time) <span>$k$</span><!-- Has MathJax --> &amp; private key <span>$x$</span><!-- Has MathJax --></p>
<p>每一次簽名時，最好使用隨機亂數 <span>$k$</span><!-- Has MathJax --> 作為簽章用途，隨用即棄，若發生重複使用，將會發生被攻擊，被攻擊者拿到私鑰後，攻擊者就能進行偽裝。</p>
<h3 id="Attack"><a href="#Attack" class="headerlink" title="Attack"></a>Attack</h3><p>if reused <span>$k$</span><!-- Has MathJax --></p>
<p>如果重複使用隨機變數 <span>$k$</span><!-- Has MathJax -->，可以藉由夾擊的方式得到，雖然不知道加密的隨機亂數 <span>$k$</span><!-- Has MathJax --> 究竟是什麼，藉由夾擊可以把 <span>$k$</span><!-- Has MathJax --> 消除，利用乘法反元素反求 <span>$x$</span><!-- Has MathJax --> 是多少，公式如下所述。</p>
<ul>
<li><span>$k = s1^{-1} (SHA(M1) + x \times r) \mod q$</span><!-- Has MathJax --> - (1)</li>
<li><span>$k = s2^{-1} (SHA(M2) + x \times r) \mod q$</span><!-- Has MathJax --> - (2)</li>
</ul>
<p>subtract (1) - (2)</p>
<ul>
<li><span>$0 = s1^{-1} SHA(M1) - s2^{-1} SHA(M2) + (s1^{-1} - s2^{-1}) x \times r \mod q$</span><!-- Has MathJax --></li>
<li><span>$s1^{-1} SHA(M1) - s2^{-1} SHA(M2) = (s2^{-1} - s1^{-1}) x \times r \mod q$</span><!-- Has MathJax --></li>
<li><span>$x = (s1^{-1} SHA(M1) - s2^{-1} SHA(M2)) \times (s2^{-1} - s1^{-1})^{-1} \times r^{-1} \mod q$</span><!-- Has MathJax -->
</li>
</ul>
<p>get private key. Dangerous !</p>
<h3 id="Verify"><a href="#Verify" class="headerlink" title="Verify"></a>Verify</h3><p>驗證的正確性與否，接收者需要計算以下四個步驟來完成驗證。</p>
<ul>
<li><span>$w = s^{-1} \mod q$</span><!-- Has MathJax --></li>
<li><span>$u1 = (SHA(M) \times w) \mod q$</span><!-- Has MathJax --></li>
<li><span>$u2 = r \times w \mod q$</span><!-- Has MathJax --></li>
<li><span>$v = g^{u1} y^{u2} \mod q$</span><!-- Has MathJax -->
</li>
</ul>
<p>test <span>$v = r$</span><!-- Has MathJax -->, why correct ?</p>
<p>理論的正確性可以參考以下證明，把公開的 <span>$y = g^x \mod p$</span><!-- Has MathJax --> 拿出來，這個安全性取決於離散對數的算法難度。</p>
<ul>
<li>known <span>$y = g^x \mod p$</span><!-- Has MathJax -->, <span>$x$</span><!-- Has MathJax --> is a private key</li>
<li>because <span>$s = k^{-1}(SHA(M) + x \times r) \mod q$</span><!-- Has MathJax --></li>
<li>then <span>$k = s^{-1}(SHA(M) + x \times r) \mod q$</span><!-- Has MathJax --></li>
</ul>
<p>want <span>$r = (g^k \mod p) \mod q$</span><!-- Has MathJax --></p>
<ul>
<li><span>$r = (g^k \mod p) \mod q = g^{s^{-1}(SHA(M) + x \times r)} \mod q$</span><!-- Has MathJax --></li>
<li><span>$r = g^{s^{-1} SHA(M)} \times g^{x (s^{-1} \times r)} \mod q$</span><!-- Has MathJax --></li>
<li><span>$r = g^{s^{-1} SHA(M)} \times g^{x^{(s^{-1} \times r)}} \mod q$</span><!-- Has MathJax --></li>
<li><span>$r = g^{s^{-1} SHA(M)} \times y^{(s^{-1} \times r)} \mod q$</span><!-- Has MathJax -->
</li>
</ul>
<p>而我們事實上就是在處理指數部分，</p>
<h2 id="離散對數"><a href="#離散對數" class="headerlink" title="離散對數"></a>離散對數</h2><p>解決問題 <span>$y = g^x \mod p$</span><!-- Has MathJax -->，當已知 <span>$y, g, p$</span><!-- Has MathJax -->，要解出 <span>$x$</span><!-- Has MathJax --> 的難度大為提升，不像國高中學的指數計算，可以藉由 <code>log()</code> 運算來完成，離散對數可以的複雜度相當高，當 <span>$p$</span><!-- Has MathJax --> 是一個相當大的整數時，通常會取用到 256 bits 以上，複雜度則會在 <span>$O(2^{100})$</span><!-- Has MathJax --> 以上。</p>
<p>實際上有一個有趣的算法 body-step, giant-step algorithm，中文翻譯為 <strong> 小步大步算法 </strong>，在 ACM-ICPC 競賽中也可以找到一些題目來玩玩，算法的時間複雜度為 <span>$O(\sqrt{p})$</span><!-- Has MathJax -->，空間複雜度也是 <span>$O(\sqrt{p})$</span><!-- Has MathJax -->。相信除了這個外，還有更好的算法可以完成。</p>
<p>小步大步算法其實很類似塊狀表的算法，分塊處理，每一塊的大小為 <span>$\sqrt{p}$</span><!-- Has MathJax -->，為了找尋答案計算其中一塊的所有資訊，每一塊就是一小步，接著就是利用數學運算，拉動數線，把這一塊往前推動 (或者反過來把目標搜尋結果相對往塊的地方推動)。因此需要走 <span>$\sqrt{p}$</span><!-- Has MathJax --> 大步完成。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/學校課程/page/4/">&laquo; Prev</a><a class="page-number" href="/categories/學校課程/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/學校課程/page/3/">3</a><a class="page-number" href="/categories/學校課程/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/categories/學校課程/page/6/">6</a><a class="page-number" href="/categories/學校課程/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/categories/學校課程/page/11/">11</a><a class="extend next" rel="next" href="/categories/學校課程/page/6/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">108</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">38</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">617</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">479</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/06/29/diary-201606/">
              
                <i class="icon-file-o"></i> 
              
            走在平行道路上－前篇</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10116/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10116. Fast Dynamic Programming Computing I (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10113/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10113. Longest Common Subsequence II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10112/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10112. Longest Common Subsequence (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10111/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10111. Longest Common Subsequence II (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10110/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10110. Longest Common Subsequence (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10109/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10109. Sorting (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10108/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10108. Streams and Concurrency II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10107/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10107. Sparse Matrix Multiplication (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10106/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10106. Multiple Device (CUDA)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>