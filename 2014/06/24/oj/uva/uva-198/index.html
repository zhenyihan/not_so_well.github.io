<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>UVa 198 - Peter&#39;s Calculator | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ProblemUnfortunately, Peter’s Calculator broke down last week. Now Peter is left with his computer, which has no calculator application, and paper and pencil, which is too tiresome for an engineer. As">
<meta property="og:type" content="article">
<meta property="og:title" content="UVa 198 - Peter's Calculator">
<meta property="og:url" content="http://morris821028.github.io/2014/06/24/oj/uva/uva-198/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description" content="ProblemUnfortunately, Peter’s Calculator broke down last week. Now Peter is left with his computer, which has no calculator application, and paper and pencil, which is too tiresome for an engineer. As">
<meta property="og:updated_time" content="2015-08-25T13:34:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UVa 198 - Peter's Calculator">
<meta name="twitter:description" content="ProblemUnfortunately, Peter’s Calculator broke down last week. Now Peter is left with his computer, which has no calculator application, and paper and pencil, which is too tiresome for an engineer. As">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main"><article id="post-oj/uva/uva-198" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/24/oj/uva/uva-198/" class="article-date">
  <time datetime="2014-06-24T10:55:25.000Z" itemprop="datePublished">2014-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      UVa 198 - Peter&#39;s Calculator
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/24/oj/uva/uva-198/" data-id="cimun1mlv02rin2xcyrasyrki" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/24/oj/uva/uva-198/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/五則運算/">五則運算</a></li></ul>

    </footer>
    <div class="article-entry " itemprop="articleBody">
      
          
              <div id="toc" class="toc-article">
              <h2 class="toc-title"><span>contents</span></h2>
              
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem"><span class="toc-number">1.</span> <span class="toc-text">Problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Input"><span class="toc-number">2.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Output"><span class="toc-number">3.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample-Input"><span class="toc-number">4.</span> <span class="toc-text">Sample Input</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample-Output"><span class="toc-number">5.</span> <span class="toc-text">Sample Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">6.</span> <span class="toc-text">Solution</span></a></li></ol>
              
              </div>
          
        
          <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Unfortunately, Peter’s Calculator broke down last week. Now Peter is left with his computer, which has no calculator application, and paper and pencil, which is too tiresome for an engineer. As one of Peter’s friends, you are asked to write him a calculator application. After talking to him, you figure out the following:</p>
<ul>
<li>Peter does only integer arithmetic. The operations he needs are addition, subtraction and multiplication.</li>
<li>He would like to use an arbitrary number of variables whose names are not longer than 50 characters.</li>
<li>His main way of doing calculations are to type in a few formulas and to assign them to variables. Some formulas are complicated expressions, which can refer to yet undefined variables, while other formulas consist of a single number. Then Peter asks for the value of some variables, i.e. he evaluates the formulas.</li>
<li>Peters wants to redefine some variables and then to reevaluate formulas that depend on these variables.  </li>
</ul>
<p>The input strictly adheres to the following syntax (given in EBNF):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file = line &#123; line &#125; &lt;EOF&gt;.</span><br><span class="line">line = [ assignment | print | reset ] &lt;CR&gt;.</span><br><span class="line">assignment = var &quot;:=&quot; expression.</span><br><span class="line">print = &quot;PRINT&quot; var.</span><br><span class="line">reset = &quot;RESET&quot;.</span><br><span class="line">expression = term &#123; addop term &#125;.</span><br><span class="line">term = factor &#123; mulop factor &#125;.</span><br><span class="line">factor = &quot;(&quot; expression &quot;)&quot; | var | number.</span><br><span class="line">addop = &quot;+&quot; | &quot;-&quot;.</span><br><span class="line">mulop = &quot;*&quot;.</span><br></pre></td></tr></table></figure>
<p>In the Extended Backus-Naur Formalism (EBNF), A = B C declares that the grammatical construct A consists of a B followed by a C . A = B | C means that A consists of a B or, alternatively, of a C . A = [ B ] defines construct A to be either a B or nothing and A = B tells you that A consists of the concatenation of any number of B’s (including none).</p>
<p>The production var stands for the name of a variable, which starts with a letter followed by up to 49 letters or digits. Letters may be uppercase or lowercase. The production number stands for a integer number. The precise syntax for these productions are given below. The case of letters is important for both variables and statements.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var = letter &#123; letter | digit &#125;.</span><br><span class="line">number = [ &quot;-&quot; ] digit &#123; digit &#125;.</span><br><span class="line">letter = &quot;A&quot; | &quot;B&quot; | ... | &quot;Z&quot; | &quot;a&quot; | &quot;b&quot; | ... | &quot;z&quot;.</span><br><span class="line">digit = &quot;0&quot; | &quot;1&quot; | ... | &quot;8&quot; | &quot;9&quot;.</span><br></pre></td></tr></table></figure>
<p>Between the parts of a grammatical construct but not within the names of variables or integer numbers, any number of spaces may appear. <eof> stands for the end of the input file and <cr> stands for the new-line character. All lines in the input file are shorter than 200 characters.</cr></eof></p>
<p>The value of a variable is said to be undefined:</p>
<ul>
<li>if it has not yet been defined or it refers to a variable, which has not yet been defined;</li>
<li>if the definition of the variable contains a cycle. </li>
</ul>
<p>Your are to write a program that implements Peter’s calculator. It should store all variable definitions and for each “PRINT” statement evaluate the specified variable based on the latest variable definitions. If your program encounters a “RESET” statement, it should delete all stored variables so that all variables become undefined.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input file contains calculations adhering to the syntax given above. Each line contains either an assignment to a variable, a “PRINT” statement, a “RESET” statement or nothing.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each “PRINT” statement found in the input file, your program should output a line containing the numerical value of the specified variable or the word “UNDEF” if the variable is undefined.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a := b + c</span><br><span class="line">b := 3</span><br><span class="line">c := 5</span><br><span class="line">PRINT d</span><br><span class="line">PRINT a</span><br><span class="line">b := 8</span><br><span class="line">PRINT a</span><br><span class="line">RESET</span><br><span class="line">PRINT a</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UNDEF</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">UNDEF</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述： </strong></p>
<p>輸入有一連串的變數函數，適時地打印出詢問的變數值，如果存在循環依靠 (無法推論) 或者是變數尚未定義，直接輸出 UNDEF。</p>
<p>後輸入的變數函數會覆蓋原先的函數。</p>
<p><strong> 題目解法： </strong></p>
<p>將每一組函數轉成後序運算式子，爾後再使用深度優先搜索走訪查看是否有環。</p>
<p>著重的問題在於負數的分析，例如 <code>0 - -50</code>, <code>(a + b) - 50</code> 等等。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">priority_op</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'('</span>:<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'+'</span>: <span class="keyword">case</span> <span class="string">'-'</span>:<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'*'</span>: <span class="keyword">case</span> <span class="string">'/'</span>:<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isoperator</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'('</span>:<span class="keyword">case</span> <span class="string">')'</span>:<span class="keyword">case</span> <span class="string">'+'</span>: <span class="keyword">case</span> <span class="string">'-'</span>:<span class="keyword">case</span> <span class="string">'*'</span>: <span class="keyword">case</span> <span class="string">'/'</span>:<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isvariable</span><span class="params">(<span class="built_in">string</span> token)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isalpha</span>(token[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trans</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *infix, <span class="keyword">char</span> buffer[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(infix), prevOp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> *ptr = buffer;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">char</span>&gt; op;</span><br><span class="line">    *ptr = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isalpha</span>(infix[i]) || <span class="built_in">isdigit</span>(infix[i]) </span><br><span class="line">            || (infix[i] == <span class="string">'-'</span> &amp;&amp; <span class="built_in">isdigit</span>(infix[i+<span class="number">1</span>]) &amp;&amp; prevOp)) &#123;</span><br><span class="line">            prevOp = <span class="number">0</span>;</span><br><span class="line">        	<span class="built_in">sprintf</span>(ptr, <span class="string">"%c"</span>, infix[i]), i++;</span><br><span class="line">        	<span class="keyword">while</span>(*ptr)    ptr++;</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">isalpha</span>(infix[i]) || <span class="built_in">isdigit</span>(infix[i])) &#123;</span><br><span class="line">            	<span class="built_in">sprintf</span>(ptr, <span class="string">"%c"</span>, infix[i]), i++;</span><br><span class="line">            	<span class="keyword">while</span>(*ptr)    ptr++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sprintf</span>(ptr, <span class="string">" "</span>), i--;</span><br><span class="line">            <span class="keyword">while</span>(*ptr)		ptr++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	prevOp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(infix[i] == <span class="string">')'</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>(!op.empty() &amp;&amp; op.top() != <span class="string">'('</span>) &#123;</span><br><span class="line">                    <span class="built_in">sprintf</span>(ptr, <span class="string">"%c "</span>, op.top()), op.pop();</span><br><span class="line">                    <span class="keyword">while</span>(*ptr) ptr++;</span><br><span class="line">                &#125;</span><br><span class="line">                op.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(infix[i] != <span class="string">'('</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>(!op.empty() &amp;&amp; priority_op(op.top()) &gt;= priority_op(infix[i])) &#123;</span><br><span class="line">                        <span class="built_in">sprintf</span>(ptr, <span class="string">"%c "</span>, op.top()), op.pop();</span><br><span class="line">                        <span class="keyword">while</span>(*ptr) ptr++;</span><br><span class="line">                    &#125;</span><br><span class="line">            	&#125;</span><br><span class="line">            	prevOp = <span class="number">1</span>;</span><br><span class="line">                op.push(infix[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!op.empty()) &#123;</span><br><span class="line">        <span class="built_in">sprintf</span>(ptr, <span class="string">"%c "</span>, op.top()), op.pop();</span><br><span class="line">        <span class="keyword">while</span>(*ptr) ptr++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trimWhiteSpace</span><span class="params">(<span class="keyword">char</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; i++)</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isspace</span>(s[i]))</span><br><span class="line">            s[j++] = s[i];</span><br><span class="line">    s[j] = <span class="string">'\0'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; VAL_exp;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt;	VAL_val;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt;	VAL_stk;</span><br><span class="line"><span class="keyword">int</span> error_FLAG;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcPostfix</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* postfix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">(<span class="built_in">string</span> VAL_name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!isvariable(VAL_name)) &#123;</span><br><span class="line">    	<span class="function"><span class="built_in">stringstream</span> <span class="title">scin</span><span class="params">(VAL_name)</span></span>;</span><br><span class="line">    	<span class="keyword">int</span> value;</span><br><span class="line">    	scin &gt;&gt; value;</span><br><span class="line">    	<span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(VAL_exp.find(VAL_name) == VAL_exp.end() || VAL_stk[VAL_name]) &#123;</span><br><span class="line">        error_FLAG = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(VAL_val.find(VAL_name) == VAL_val.end()) &#123;</span><br><span class="line">        VAL_stk[VAL_name] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//		cout &lt;&lt; "solving " &lt;&lt; VAL_name &lt;&lt; ", " &lt;&lt; VAL_exp[VAL_name] &lt;&lt; endl; </span></span><br><span class="line">        VAL_val[VAL_name] = calcPostfix(VAL_exp[VAL_name].c_str());</span><br><span class="line"><span class="comment">//		cout &lt;&lt; "solved " &lt;&lt; VAL_name &lt;&lt; ", val = " &lt;&lt; VAL_val[VAL_name] &lt;&lt; endl;</span></span><br><span class="line">        VAL_stk[VAL_name] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> VAL_val[VAL_name];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcPostfix</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* postfix)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">stringstream</span> 	<span class="title">scin</span><span class="params">(postfix)</span></span>;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; 		stk;</span><br><span class="line">    <span class="built_in">string</span>			token;</span><br><span class="line">    <span class="keyword">int</span> 			a, b;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(scin &gt;&gt; token) &#123;</span><br><span class="line">    	<span class="keyword">if</span>(token.length() == <span class="number">1</span> &amp;&amp; isoperator(token[<span class="number">0</span>])) &#123;</span><br><span class="line">            b = stk.top(), stk.pop();</span><br><span class="line">            a = stk.top(), stk.pop();</span><br><span class="line">            <span class="keyword">switch</span>(token[<span class="number">0</span>]) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'+'</span>: a = a+b;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'-'</span>: a = a-b;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'*'</span>: a = a*b;<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'/'</span>: a = a/b;<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            stk.push(a);</span><br><span class="line">    	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    		stk.push(getValue(token));</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">if</span>(error_FLAG)	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stk.top();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printVal</span><span class="params">(<span class="built_in">string</span> valName)</span> </span>&#123;</span><br><span class="line">    error_FLAG = <span class="number">0</span>;</span><br><span class="line">    VAL_val.clear();</span><br><span class="line">    VAL_stk.clear();</span><br><span class="line">    <span class="keyword">int</span> val = getValue(valName);</span><br><span class="line">    <span class="keyword">if</span>(error_FLAG)</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"UNDEF"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input.txt", "r+t", stdin);</span></span><br><span class="line"><span class="comment">//	freopen("out.txt", "w+t", stdout); </span></span><br><span class="line">    <span class="built_in">string</span> 	LHS, RHS;</span><br><span class="line">    <span class="keyword">int</span> 	pos;</span><br><span class="line">    <span class="keyword">char</span> 	postfix[<span class="number">32767</span>], lines[<span class="number">32767</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(gets(lines)) &#123;</span><br><span class="line">    	trimWhiteSpace(lines);</span><br><span class="line">    	<span class="function"><span class="built_in">string</span> <span class="title">str</span><span class="params">(lines)</span></span>;</span><br><span class="line">    	<span class="keyword">if</span>(str.find(<span class="string">":="</span>) != <span class="built_in">string</span>::npos) &#123;</span><br><span class="line">    		pos = str.find(<span class="string">":="</span>);</span><br><span class="line">    		LHS = str.substr(<span class="number">0</span>, pos);</span><br><span class="line">    		RHS = str.substr(pos + <span class="number">2</span>);</span><br><span class="line">    		trans(RHS.c_str(), postfix);</span><br><span class="line">    		VAL_exp[LHS] = postfix;</span><br><span class="line">    	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(str.find(<span class="string">"PRINT"</span>) != <span class="built_in">string</span>::npos) &#123;</span><br><span class="line">    		pos = str.find(<span class="string">"PRINT"</span>);</span><br><span class="line">    		RHS = str.substr(pos + <span class="number">5</span>);</span><br><span class="line">    		printVal(RHS);</span><br><span class="line">    	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(str.find(<span class="string">"RESET"</span>) != <span class="built_in">string</span>::npos) &#123;</span><br><span class="line">    		VAL_exp.clear();</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/06/24/oj/uva/uva-11837/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          UVa 11837 - Musical Plagiarism
        
      </div>
    </a>
  
  
    <a href="/2014/06/24/oj/uva/uva-11178/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">UVa 11178 - Morley&#39;s Theorem</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">599</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">463</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">37</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/04/10/2016-google-code-jam-qr/">
              
                <i class="icon-file-o"></i> 
              
            2016 Google Code Jam Round QR</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/23/parallel-skill-interval-partitioning/">
              
                <i class="icon-file-o"></i> 
              
            數據分割 區間分塊小技巧</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/16/jg-10085/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10085. Parallel Count (debug)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/03/16/jg-10084/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10084. Prefix Sum (pthread)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13006/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13006 - Cake cut</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13010/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13010 - Galactic taxes</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/29/uva-13014/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13014 - Keep it energized</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/08/uva-13054/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13054 - Hippo Circus</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/08/uva-13032/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13032 - Marbles in Jars</a>
          </li>
        
          <li>
            <a class="text" href="/2016/02/02/uva-13038/">
              
                <i class="icon-file-o"></i> 
              
            UVa 13038 - Directed Forest</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  var disqus_url = 'http://morris821028.github.io/2014/06/24/oj/uva/uva-198/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div>
</body>
</html>