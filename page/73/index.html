<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/page/73/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-oj/uva/uva-11291-with-yacc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/12/oj/uva/uva-11291-with-yacc/" class="article-date">
  <time datetime="2014-05-12T10:54:49.000Z" itemprop="datePublished">2014-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/12/oj/uva/uva-11291-with-yacc/">Yacc 與 Lex 練習 - UVa 11291</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/12/oj/uva/uva-11291-with-yacc/" data-id="cipz12v7v02n9t1xcr2fmf3jc" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/12/oj/uva/uva-11291-with-yacc/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Lex/">Lex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Yacc/">Yacc</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>詳細題目請參考 <a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;category=24&amp;page=show_problem&amp;problem=2266" target="_blank" rel="external">UVa 11291 - Smeech</a></p>
<p>語法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;E[x]&gt; -&gt; &lt;Integer&gt; | (p &lt;E[x]&gt; &lt;E[x]&gt;)</span><br><span class="line">&lt;Integer&gt; -&gt; #number</span><br></pre></td></tr></table></figure></p>
<p>目標計算出 <code>E[X] = p * (e1 + e2) + (1 - p) * (e1 - e2)</code></p>
<h1 id="Yacc"><a href="#Yacc" class="headerlink" title="Yacc"></a>Yacc</h1><p>Yacc 主要是根據 CFG 進行解析。</p>
<p>其中，要對於 Yacc 語法的回傳值明白操作情況。</p>
<p>對於語法回傳值，我們來個最簡單的範例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expression -&gt; LEFT_P NUMBER expression expression RIGHT_P</span><br><span class="line">    $$          $1     $2       $3         $4       $5</span><br></pre></td></tr></table></figure></p>
<p>其中 <code>$$</code> 是回傳值，其中的 <code>$1</code>、<code>$2</code> … 等，都是得到的回傳值。</p>
<p>對於 <code>yylval</code> 形態處理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%union &#123;</span><br><span class="line">    float 	floatVal;</span><br><span class="line">    int 	intVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通常使用 <code>union</code> 的方式來共用記憶體，在 lex 那邊就可以根據 <code>yylval.floatVal</code> 進行操作。</p>
<p>當然，我們也要對於每一個 <code>nonterminal</code> 定義回傳的型態</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%type &lt;floatVal&gt; NUMBER</span><br><span class="line">%type &lt;floatVal&gt; expression</span><br><span class="line">%type &lt;floatVal&gt; startsymbol</span><br></pre></td></tr></table></figure>
<p>基本上就大功告成了。</p>
<p>接著要考慮如何去完成多組測資組的問題，在這裡可以利用 kleene star 來完成。</p>
<p>但是對於輸出順序，使用 <code>input -&gt; input startsymbol</code> 跟 <code>input -&gt; startsymbol input</code> 輸出順序是不同的，如果要順著輸出，請選擇前者。</p>
<figure class="highlight cpp"><figcaption><span>file: a.y</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yylex</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span> </span>&#123;</span><br><span class="line">    ans = <span class="number">-2147483647</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Invaild format\n"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%<span class="keyword">union</span> &#123;</span><br><span class="line">    <span class="keyword">float</span> 	floatVal;</span><br><span class="line">    <span class="keyword">int</span> 	intVal;</span><br><span class="line">&#125;</span><br><span class="line">%type &lt;floatVal&gt; NUMBER</span><br><span class="line">%type &lt;floatVal&gt; expression</span><br><span class="line">%type &lt;floatVal&gt; startsymbol</span><br><span class="line"></span><br><span class="line">%token LEFT_P RIGHT_P NUMBER</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">input</span><br><span class="line">    : input startsymbol &#123;</span><br><span class="line">        ans = $<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.2f\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">    &#125;</span><br><span class="line">startsymbol</span><br><span class="line">    : expression &#123;</span><br><span class="line">        $$ = $<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ;</span><br><span class="line">expression</span><br><span class="line">    : NUMBER &#123;</span><br><span class="line">        $$ = $<span class="number">1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    | LEFT_P NUMBER expression expression RIGHT_P &#123;</span><br><span class="line">        $$ = $<span class="number">2</span> * ($<span class="number">3</span> + $<span class="number">4</span>) + (<span class="number">1.0f</span> - $<span class="number">2</span>) * ($<span class="number">3</span> - $<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ;</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    yyparse();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Lex"><a href="#Lex" class="headerlink" title="Lex"></a>Lex</h1><p>Lex 主要是扮演切出所有的 token 的角色，相當於 Scanner。同時要將值紀錄再 <code>yylval</code> 中，在 Yacc 那邊則會在 <code>$NUMBER</code> 中得到變數值。</p>
<p>在 Lex 語法上要特別小心，如果兩條的前綴 (prefix) 相同時 (解析上會產生相同的 token)，則會選擇長的那一條為優先。如果長度仍相同的話，請自行測試，這裡無法給予解答。而為什麼要這麼設計？為了保證後綴不會塞入奇怪的字符，因此可以先檢查隨後接的字符情況。</p>
<figure class="highlight cpp"><figcaption><span>file: a.l</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"a.tab.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">([-]?)[<span class="number">0</span><span class="number">-9</span>]*\.[<span class="number">0</span><span class="number">-9</span>]*		&#123;<span class="built_in">sscanf</span>(yytext, <span class="string">"%f"</span>, &amp;yylval.floatVal); <span class="keyword">return</span> NUMBER;&#125;</span><br><span class="line">([-]?)[<span class="number">0</span><span class="number">-9</span>]+				&#123;<span class="built_in">sscanf</span>(yytext, <span class="string">"%f"</span>, &amp;yylval.floatVal); <span class="keyword">return</span> NUMBER;&#125;</span><br><span class="line"><span class="string">"("</span>					&#123;<span class="keyword">return</span> LEFT_P;&#125;</span><br><span class="line"><span class="string">")"</span>					&#123;<span class="keyword">return</span> RIGHT_P;&#125;</span><br><span class="line">\n					&#123;&#125;</span><br><span class="line">.					&#123;&#125;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<h1 id="make-file"><a href="#make-file" class="headerlink" title="make file"></a>make file</h1><p>請用以下方法建造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">morris $ sh make.sh</span><br></pre></td></tr></table></figure>
<p>代碼如下<br><figure class="highlight plain"><figcaption><span>file: make.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bison -d a.y</span><br><span class="line">flex a.l</span><br><span class="line">gcc -c a.tab.c</span><br><span class="line">gcc -c lex.yy.c</span><br><span class="line">gcc lex.yy.o a.tab.o -lfl</span><br></pre></td></tr></table></figure></p>
<p>產生的結果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tree </span><br><span class="line">. ├── a.l</span><br><span class="line">  ├── a.out </span><br><span class="line">  ├── a.tab.c </span><br><span class="line">  ├── a.tab.h </span><br><span class="line">  ├── a.tab.o </span><br><span class="line">  ├── a.y </span><br><span class="line">  ├── input~ </span><br><span class="line">  ├── lex.yy.c </span><br><span class="line">  ├── lex.yy.o </span><br><span class="line">  ├── make.sh </span><br><span class="line">  ├── make.sh~ </span><br><span class="line">  ├── testdata </span><br><span class="line">  │   ├── ac_output </span><br><span class="line">  │   └── input</span><br></pre></td></tr></table></figure>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><p>執行的時候就跟標準輸入串流一樣。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">morris $ ./a.out &lt;input</span><br></pre></td></tr></table></figure></p>
<h2 id="參考範例輸入"><a href="#參考範例輸入" class="headerlink" title="參考範例輸入"></a>參考範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">(.5 3 9)</span><br><span class="line">(0.3 2 (1 1 -10))</span><br><span class="line">(1.0 (1.0 (1.0 -1 -2) (1.0 -1 -2)) (1.0 (1.0 1 2) 2))</span><br><span class="line">(0.99 82 (0.76 50 (0.85 (0.07 (0.88 28 (0.98 79 (0.09 77 51))) (0.30 (0.29 36 (0.36 (0.51 27 (0.68 (0.47 87 35) (0.25 85 59))) 31)) 64)) (0.14 (0.84 (0.77 29 71) (0.50 (0.99 (0.81 (0.78 (0.87 50 7) 71) 72) 14) (0.30 (0.50 9 37) (0.67 21 (0.73 86 (0.08 31 14)))))) (0.94 (0.96 (0.50 27 (0.94 (0.54 62 (0.63 89 29)) (0.81 24 (0.94 20 72)))) 4) (0.44 9 (0.59 (0.70 48 40) (0.64 (0.27 97 71) 43))))))))</span><br><span class="line">(0.15 12 60)</span><br><span class="line">(0.55 18 (0.95 (0.79 95 (0.97 (0.11 (0.96 (0.70 (0.38 73 66) (0.38 (0.06 (0.02 88 66) (0.39 35 37)) 69)) (0.81 3 (0.45 5 61))) (0.44 (0.67 (0.23 82 7) 38) (0.24 49 74))) 76)) (0.46 19 44)))</span><br><span class="line">(0.56 62 77)</span><br><span class="line">(0.03 (0.90 19 35) (0.17 50 (0.13 (0.96 74 (0.07 (0.51 78 (0.77 (0.78 (0.84 64 (0.41 7 59)) 21) (0.73 (0.95 (0.13 2 85) (0.08 29 50)) (0.24 (0.12 43 99) 71)))) 84)) (0.31 69 (0.82 31 24)))))</span><br><span class="line">(0.78 73 44)</span><br><span class="line">(0.09 (0.80 14 62) (0.57 (0.57 95 (0.33 94 31)) (0.70 (0.92 32 (0.13 20 (0.44 87 (0.45 83 26)))) (0.43 40 (0.51 (0.57 29 (0.65 13 (0.40 74 56))) 56)))))</span><br><span class="line">(0.96 (0.96 (0.65 (0.01 (0.98 (0.34 86 (0.68 87 21)) 27) (0.26 68 68)) (0.42 28 29)) 9) 99)</span><br><span class="line">(0.99 (0.60 53 27) (0.35 23 (0.15 (0.50 85 (0.73 56 (0.34 (0.44 (0.10 (0.62 (0.20 58 15) 56) (0.57 74 (0.23 20 78))) 62) (0.92 (0.72 (0.82 75 (0.08 35 93)) 43) (0.55 10 (0.45 (0.25 52 91) 71)))))) (0.61 39 (0.49 (0.92 87 (0.13 52 (0.69 (0.46 (0.82 27 72) 96) (0.27 51 99)))) (0.36 99 (0.60 68 (0.49 (0.25 (0.92 54 7) (0.48 47 32)) (0.08 (0.69 97 11) 34)))))))))</span><br><span class="line">(0.87 (0.32 (0.42 (0.66 69 (0.98 0 (0.46 94 (0.25 (0.57 (0.72 25 59) (0.35 91 (0.42 29 28))) 3)))) 19) 81) (0.72 (0.06 (0.66 (0.07 22 87) 44) (0.18 33 14)) 49))</span><br><span class="line">(0.72 (0.01 67 (0.13 (0.22 (0.88 11 86) (0.04 40 (0.41 (0.86 (0.81 (0.08 84 95) (0.88 19 67)) 8) 96))) 13)) (0.13 45 (0.19 (0.83 85 (0.77 (0.37 78 (0.44 44 59)) 37)) 56)))</span><br><span class="line">(0.51 (0.36 2 72) 25)</span><br><span class="line">(0.32 51 87)</span><br><span class="line">(0.06 (0.23 (0.70 93 47) (0.22 20 (0.90 (0.03 (0.48 (0.84 18 (0.29 (0.02 (0.06 52 49) 67) (0.49 (0.69 60 74) (0.59 92 0)))) 32) 80) (0.76 78 (0.66 8 94))))) 31)</span><br><span class="line">(0.29 (0.54 70 (0.64 (0.48 (0.50 25 (0.38 (0.07 (0.14 (0.44 (0.76 44 45) 67) 41) (0.15 (0.86 (0.89 87 42) (0.43 85 58)) (0.98 44 (0.48 34 28)))) (0.84 81 60))) 28) 16)) (0.84 (0.21 34 (0.78 (0.76 (0.51 82 (0.07 (0.78 (0.52 (0.65 51 58) 12) (0.05 52 (0.98 0 30))) (0.01 27 3))) (1.00 15 (0.53 (0.91 (0.38 62 (0.75 92 69)) (0.85 53 (0.84 92 83))) (0.70 (0.12 (0.24 23 83) 58) (0.62 56 38))))) 36)) (0.66 41 13)))</span><br><span class="line">(0.94 (0.47 30 56) (0.78 6 (0.45 (0.45 15 94) (0.77 (0.57 25 (0.33 66 12)) (0.66 74 (0.82 (0.14 75 50) (0.22 45 43)))))))</span><br><span class="line">(0.66 (0.58 (0.85 75 26) 45) (0.04 (0.94 82 (0.59 34 (0.02 (0.09 11 (0.31 (0.05 (0.92 (0.14 51 45) (0.47 25 46)) 6) 5)) 33))) (0.81 (0.09 15 (0.91 (0.77 (0.59 44 (0.57 (0.39 (0.81 18 75) (0.37 41 67)) 18)) (0.77 (0.68 (0.71 (0.31 87 94) 85) (0.00 35 (0.55 81 22))) 56)) 3)) (0.43 7 (0.98 94 3)))))</span><br><span class="line">(0.13 22 80)</span><br><span class="line">(0.77 45 81)</span><br><span class="line">(0.61 (0.21 (0.32 (0.32 (0.81 8 60) 78) (0.19 (0.92 68 (0.56 (0.22 79 32) (0.32 72 63))) 41)) (0.30 94 31)) (0.80 59 33))</span><br></pre></td></tr></table></figure>
<h2 id="參考範例輸出"><a href="#參考範例輸出" class="headerlink" title="參考範例輸出"></a>參考範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">7.00</span><br><span class="line">3.00</span><br><span class="line">5.60</span><br><span class="line">-1.00</span><br><span class="line">241.55</span><br><span class="line">-30.00</span><br><span class="line">32.05</span><br><span class="line">71.24</span><br><span class="line">25.80</span><br><span class="line">97.64</span><br><span class="line">-37.98</span><br><span class="line">153.38</span><br><span class="line">67.92</span><br><span class="line">35.81</span><br><span class="line">-10.21</span><br><span class="line">-17.66</span><br><span class="line">19.68</span><br><span class="line">60.84</span><br><span class="line">92.20</span><br><span class="line">30.61</span><br><span class="line">157.62</span><br><span class="line">-37.20</span><br><span class="line">88.74</span><br><span class="line">-48.46</span><br></pre></td></tr></table></figure>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://www.ibm.com/developerworks/cn/linux/sdk/lex/" target="_blank" rel="external">Yacc 与 Lex 快速入门</a></p>
<h1 id="指導"><a href="#指導" class="headerlink" title="指導"></a>指導</h1><p><a href="http://en.wikipedia.org/wiki/God" target="_blank" rel="external">Inker</a></p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-1636" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/12/oj/uva/uva-1636/" class="article-date">
  <time datetime="2014-05-12T01:15:24.000Z" itemprop="datePublished">2014-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/12/oj/uva/uva-1636/">UVa 1636 - Headshot</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/12/oj/uva/uva-1636/" data-id="cipz12wcm0357t1xcncblkqgq" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/12/oj/uva/uva-1636/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/概率/">概率</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>You have a revolver gun with a cylinder that has n chambers. Chambers are located in a circle on a cylinder. Each chamber can be empty or can contain a round. One chamber is aligned with the gun’s barrel. When trigger of the gun is pulled, the gun’s cylinder rotates, aligning the next chamber with the barrel, hammer strikes the round, making a shot by firing a bullet through the barrel. If the chamber is empty when the hammer strikes it, then there is no shot but just a <code>click</code>.</p>
<p>You have found a use for this gun. You are playing Russian Roulette with your friend. Your friend loads rounds into some chambers, randomly rotates the cylinder, aligning a random chamber with a gun’s barrel, puts the gun to his head and pulls the trigger. You hear <code>click</code> and nothing else – the chamber was empty and the gun did not shoot.</p>
<p>Now it is your turn to put the gun to your head and pull the trigger. You have a choice. You can either pull the trigger right away or you can randomly rotate the gun’s cylinder and then pull the trigger. What should you choose to maximize the chances of your survival? </p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input file contains several datasets. A dataset contains a single line with a string of n digits <code>0</code> and <code>1</code> ( 2 &lt;= n &lt;= 100). This line of digits represents the pattern of rounds that were loaded into the gun’s chambers. <code>0</code> represent an empty chamber, <code>1</code> represent a loaded one. In this representation, when cylinder rotates before a shot, the next chamber to the right gets aligned with the barrel for a shot. Since the chambers are actually located on a circle, the first chamber in this string follows the last one. There is at least one <code>0</code> in this string.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each dataset, write to the output file one of the following words (without quotes):</p>
<ul>
<li><code>SHOOT</code> – if pulling the trigger right away makes you less likely to be actually shot in the head with the bullet (more likely that the chamber will be empty).</li>
<li><code>ROTATE</code> – if randomly rotating the cylinder before pulling the trigger makes you less likely to be actually shot in the head with the bullet (more likely that the chamber will be empty).</li>
<li><code>EQUAL</code> – if both of the above choices are equal in terms of probability of being shot.</li>
</ul>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0011</span><br><span class="line">0111</span><br><span class="line">000111</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EQUAL</span><br><span class="line">ROTATE</span><br><span class="line">SHOOT</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>俄羅斯輪盤，現在與一位朋友一起玩這場遊戲，然而我們已經知道左輪手槍中的填彈資訊，剛聽到朋友按下扣板，但是沒有死。現在輪到你，請問要直接按？還是隨機轉一圈再按？</p>
<p><strong> 題目解法：</strong></p>
<p>不外乎地，我們要找到哪個機率高。</p>
<p>由於朋友按下沒死，也就是要考慮連續 2 個 <code>0</code> 的情況，下一個是 <code>0</code> 的機率為 <code>czero / zero</code></p>
<p>// 在前提為 0 的情況下，下一個為 0 的機率為何，也就是考慮 <code>00</code> 和 <code>01</code> 的情況下，<code>00</code> 的機率為何。<br>// czero 是連續為 0 的個數，zero 是 0 的個數 (同時也是 <code>00</code> <code>01</code> 的個數。)，n 是全部個數。</p>
<p>隨機轉一圈得到 <code>0</code> 的概率為 <code>zero / n</code>。</p>
<p>不小心把題目想太難，事實上這問題很簡單的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    char s[1024];</span><br><span class="line">    while(scanf(&quot;%s&quot;, s) == 1)&#123;</span><br><span class="line">        int n = strlen(s);</span><br><span class="line">        int zero = 0, one = 0, czero = 0;</span><br><span class="line">        for(int i = 0 ; i &lt; n ; i++ )&#123;</span><br><span class="line">            if(s[i] == &apos;1&apos;) </span><br><span class="line">                continue;</span><br><span class="line">            zero++;</span><br><span class="line">            if(s[(i+1)%n] == &apos;0&apos;) czero++;</span><br><span class="line">        &#125;</span><br><span class="line">        // czero - zero * (zero / n)</span><br><span class="line">        if(czero * n == zero * zero) </span><br><span class="line">            puts(&quot;EQUAL&quot;);</span><br><span class="line">        else if(czero * n &gt; zero * zero)</span><br><span class="line">            puts(&quot;SHOOT&quot;);</span><br><span class="line">        else </span><br><span class="line">            puts(&quot;ROTATE&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-1644" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/12/oj/uva/uva-1644/" class="article-date">
  <time datetime="2014-05-12T01:05:18.000Z" itemprop="datePublished">2014-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/12/oj/uva/uva-1644/">UVa 1644 - Prime Gap</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/12/oj/uva/uva-1644/" data-id="cipz12wct035bt1xcc9lss2br" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/12/oj/uva/uva-1644/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sieve/">sieve</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p> The sequence of n - 1 consecutive composite numbers (positive integers that are not prime and not equal to 1) lying between two successive prime numbers p and p + n is called a prime gap of length n . For example, 〈24, 25, 26, 27, 28〉 between 23 and 29 is a prime gap of length 6.</p>
<p>Your mission is to write a program to calculate, for a given positive integer k , the length of the prime gap that contains k . For convenience, the length is considered 0 in case no prime gap contains k .</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input is a sequence of lines each of which contains a single positive integer. Each positive integer is greater than 1 and less than or equal to the 100000th prime number, which is 1299709. The end of the input is indicated by a line containing a single zero.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>The output should be composed of lines each of which contains a single non-negative integer. It is the length of the prime gap that contains the corresponding positive integer in the input if it is a composite number, or `0’ otherwise. No other characters should occur in the output.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">10 </span><br><span class="line">11 </span><br><span class="line">27 </span><br><span class="line">2 </span><br><span class="line">492170 </span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 </span><br><span class="line">0 </span><br><span class="line">6 </span><br><span class="line">0 </span><br><span class="line">114</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>找該數字左右相鄰的兩個質數差值。</p>
<p><strong> 題目解法：</strong></p>
<p>線性篩法 (sieve)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#define LL long long</span><br><span class="line">#define maxL (1300000&gt;&gt;5)+1</span><br><span class="line">#define GET(x) (mark[x&gt;&gt;5]&gt;&gt;(x&amp;31)&amp;1)</span><br><span class="line">#define SET(x) (mark[x&gt;&gt;5] |= 1&lt;&lt;(x&amp;31))</span><br><span class="line">using namespace std;</span><br><span class="line">int mark[maxL];</span><br><span class="line">int anaP[30], at = 0;</span><br><span class="line">void sieve() &#123;</span><br><span class="line">    register int i, j, k;</span><br><span class="line">    SET(1);</span><br><span class="line">    int n = 1300000;</span><br><span class="line">    for(i = 2; i &lt; n; i++) &#123;</span><br><span class="line">        if(!GET(i)) &#123;</span><br><span class="line">            for(k = n/i, j = i*k; k &gt;= i; k--, j -= i)</span><br><span class="line">                SET(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">main() &#123;</span><br><span class="line">    sieve();</span><br><span class="line">    int n;</span><br><span class="line">    while(scanf(&quot;%d&quot;, &amp;n) == 1 &amp;&amp; n) &#123;</span><br><span class="line">    	int ret = 0;</span><br><span class="line">    	for(int i = n; GET(i); i++, ret++);</span><br><span class="line">    	for(int i = n; GET(i) &amp;&amp; i &gt; 0; i--, ret++);</span><br><span class="line">    	printf(&quot;%d\n&quot;, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-lesson/compiler-clg-ll(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/11/lesson/compiler-clg-ll(1)/" class="article-date">
  <time datetime="2014-05-11T14:36:41.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/編譯器/">編譯器</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/11/lesson/compiler-clg-ll(1)/">編譯器 Compiler CFG LL(1)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/" data-id="cipz12ug9028ct1xcgltbxuaa" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/11/lesson/compiler-clg-ll(1)/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CFG/">CFG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/First-Set/">First Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Follow-Set/">Follow Set</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LL-1/">LL(1)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/編譯器/">編譯器</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h1 id="序文"><a href="#序文" class="headerlink" title="序文"></a>序文</h1><p>相較於其他技術而言，編譯器的確不是什麼有趣的課程，在這一門領域專研的人也變少了，所以專精的人越少，將會越有機會。易見地，也越來越少大學開設這門編譯器的課程，不過在一些公司，編譯器的技術將成為私囊秘寶，如何將代碼更加地優化快速，這就是相當令人感到為之一驚的地方。</p>
<h1 id="DFA-NFA-Regular-expression"><a href="#DFA-NFA-Regular-expression" class="headerlink" title="DFA, NFA, Regular expression"></a>DFA, NFA, Regular expression</h1><p>在討論所有語法前，要明白正規表達式 ( Regular expression = RegExp ) 的運作，RegExp 運作上涵蓋的語法集合是最小的，對於一個 RegExp 來說，可以轉換成具有 n 個狀態的 NFA，而這台 NFA 可以轉換成 2<sup>n</sup> 狀態的 DFA。</p>
<p>NFA 和 DFA 最大的不同在於轉移狀態時，考慮的路徑情況，NFA 可以在不考慮輸入進行轉移，或者在相同情況下可以有很多轉移選擇。 DFA 則必須在一個輸入唯一一個轉移情況下運作。</p>
<img src="/img/500px-DFAexample.svg.png" title="DFA">
<p>如上圖 DFA 所示，邊上的內容就是根據輸入的情況進行轉移。</p>
<img src="/img/423px-NFASimpleExample.svg.png" title="NFA">
<p>如上圖 NFA 所示，會發現狀態 <code>p</code> 對於輸入 <code>1</code> 有 2 種轉移可能 (<code>p-&gt;p</code> or <code>p-&gt;q</code>)。</p>
<p>最後可以得到一個 RegExp 一定會有一台 DFA 辨識它。而一台 DFA 也一定會有一個 RegExp，這句話的含意將可以在 <code>計算理論</code> 這門課中學到如何藉由類似 <code>Floyd Algorithm</code> 內點性質依序推出 DFA 對應的 RegExp。</p>
<h1 id="CFG-Context-free-grammar"><a href="#CFG-Context-free-grammar" class="headerlink" title="CFG (Context-free grammar)"></a>CFG (Context-free grammar)</h1><p>A context-free grammar is a formal system that describes a language by specifying how any legal string (i.e., sequence of tokens) can be derived from a start symbol. It consists of a set of productions, each of which states that a given symbol can be replaced by a given sequence of symbols. </p>
<p>另一個類似的語言是 <code>Context-sensitive grammar</code>，等價性質的兄弟是 <code>Chomsky normal form</code>。</p>
<ul>
<li><p>CFG <code>G = (Vt, Vn, S, P)</code></p>
<ul>
<li>Vt: 有限的 terminal 字符集</li>
<li>Vn: 有限的 nonterminal 字符集</li>
<li>S: 一開始出發的 start symbol</li>
<li>P: 轉換的規則 (production)</li>
<li><p>來個例子</p>
<pre><code>LHS (left-hand side) -&gt; RHS (right-hand side)

&lt;E&gt;         -&gt; &lt;Prefix&gt; ( &lt;E&gt; )
&lt;E&gt;         -&gt; V &lt;Tail&gt;
&lt;Prefix&gt;    -&gt; F
&lt;Prefix&gt;    -&gt; l
&lt;Tail&gt;      -&gt; + &lt;E&gt;
&lt;Tail&gt;      -&gt; l
</code></pre><p>明顯地</p>
<ul>
<li><code>Vt = {(, ), V, F, l, +}</code></li>
<li><code>Vn = {&lt;E&gt;, &lt;Prefix&gt;, &lt;Tail&gt;}</code></li>
<li><code>S = &lt;E&gt;</code></li>
<li><code>P</code> 就是給定那六條規規則</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>名詞<ul>
<li><em>Sentential form</em><br>  If S =&gt;<sup>*</sup> β, β then is said to be <em>sentential form</em> of the CFG<br>  簡單來說，所有從 start symbol 過程中替換出來的句子都稱為 sentential form。</li>
<li><em>Handle</em> of a sentential form<br>  The handle of a sentential form is the left-most simple phrase.<br>  <img src="/img/ch07-tree-1.png" alt="img"><br>  簡單來說，就是將一個 nonterminal 根據 production 轉換成 RHS (right-hand side) 的一個步驟。</li>
</ul>
</li>
</ul>
<ul>
<li>什麼是 CFG (上下文無關語法)？<br>  簡單來說，還真的是上下文無關，例如 <code>S -&gt; AB</code> 可以見到 S 轉換時，不會因為前文或後文是什麼內容而影響，而在 <code>Context-sensitive grammar</code> (上下文敏感) 可以見到 <code>aSb -&gt; AB</code> 會因為前面跟後面所受到的影響。</li>
</ul>
<blockquote>
<p>這裡使用大寫為 nontermainl，其他字符為 terminal。</p>
</blockquote>
<h2 id="First-Set"><a href="#First-Set" class="headerlink" title="First Set"></a>First Set</h2><ul>
<li>First(A)<ul>
<li>The set of all the <em>terminal</em> symbols that can <em>begin</em> a sentential form <em>derivable from</em> A. <code>A =&gt;* aB</code><pre><code>First(A) = {
    a in Vt | A =&gt;* aB, and
    Λ in Vt | A =&gt;* Λ
}
</code></pre></li>
<li>簡單地說，從這個 nonterminal 開始，第一個不能被替換的 terminal 就會在 First set 中。</li>
</ul>
</li>
<li>計算 <code>First(A)</code> 前，必須先建出這個 nonterminal 有沒有可能推出 Λ，即 <code>A =&gt;* Λ</code>。<br>這邊相當有意思，使用迭代更新，如果發現 <code>B =&gt;* Λ</code> 和 <code>C =&gt;* Λ</code> 則對於 Production <code>A =&gt; BC</code> 來說，可以得到 <code>A =&gt;* Λ</code> 就這麼依序推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
<li>計算 <code>First(A)</code> 時，掃描規則 <code>LHS =&gt; RHS</code>，找到 <code>First(RHS)</code> 並且 <code>First(LHS).insert(First(RHS))</code>，依樣使用迭代更新推出所有情況，時間複雜度應該在 <code>O(n^2)</code>。</li>
</ul>
<h2 id="Follow-Set"><a href="#Follow-Set" class="headerlink" title="Follow Set"></a>Follow Set</h2><ul>
<li>Follow(A)<ul>
<li><em>A</em> is any nonterminal</li>
<li>Follow(A) is <em>the set of terminals</em> that may follow <em>A</em> in some sentential form. <code>S =&gt;* ... Aabc ...</code>follow set。<pre><code>Follow(A) = {
    a in Vt | S =&gt;* ... Aa ..., and
    Λ in Vt | S =&gt;* aA
}
</code></pre></li>
<li>請切記，一定要從 start symbol 開始替換的所有句子，而在這個 nonterminal 隨後可能跟著的 termainl 就會屬於它的。</li>
</ul>
</li>
<li>計算 <code>Follow(A)</code> 前，請先把 First set 都算完，接著也是用迭代更新，掃描規則 <code>A -&gt; a B b</code><br>對於 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if Λ not in First(b)</span><br><span class="line">    Follow(B).insert(First(b))</span><br><span class="line">else</span><br><span class="line">    Follow(B).insert(First(b) - Λ)</span><br><span class="line">    Follow(B).insert(Follow(A))</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">## Predict Set ##</span><br><span class="line"></span><br><span class="line">* Given the productions</span><br><span class="line">* During a (leftmost) derivation, Deciding which production to match, Using lookahead symbols</span><br><span class="line">* 相較於 First set 和 Follow set，Predict Set 是根據 Production 產生的，也就是說一條 production 會有一個對應的 predict set，而 First set 和 Follow set 都是根據 nonterminal 產生一對一對應的集合，用來預測這一條規則的第一個 terminal 會有哪些。</span><br><span class="line"></span><br><span class="line">對於 production : `A -&gt; X1 X2 ... Xm`</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>if Λ in First(X1 X2 … Xm)<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm) - Λ);<br>    Predict(A -&gt; X1 X2 … Xm).insert(Follow(A));<br>else<br>    Predict(A -&gt; X1 X2 … Xm).insert(First(X1 X2 … Xm));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">對於第一判斷情況在于 `... AE = ... X1 X2 ... Xm E`，明顯地可以從 `Follow(A)` 得到第一個字符為何。</span><br><span class="line"></span><br><span class="line">## LL(1) Table ##</span><br><span class="line">&gt; 尚未撰寫</span><br><span class="line"></span><br><span class="line">C++ code</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">## 資料規格 ##</span><br><span class="line"></span><br><span class="line">以下代碼實作 CFG 的 First Set, Follow Set, Predict Set 和 LL(1) Table。</span><br><span class="line"></span><br><span class="line">用字符 `l` 代替 lambda</span><br><span class="line"></span><br><span class="line">## 資料範例 ##</span><br><span class="line"></span><br><span class="line">* 本課程簡易範例輸入</span><br></pre></td></tr></table></figure></p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>A-&gt;BaAb<br>A-&gt;cC<br>B-&gt;d<br>B-&gt;l<br>C-&gt;eA<br>C-&gt;l</p>
<p>A-&gt;aAd<br>A-&gt;B<br>B-&gt;bBd<br>B-&gt;C<br>C-&gt;cCd<br>C-&gt;l</p>
<p>E-&gt;TX<br>X-&gt;+E<br>X-&gt;#<br>T-&gt;(E)<br>T-&gt;intY<br>Y-&gt;*T<br>Y-&gt;#</p>
<p>E-&gt;P(E)<br>E-&gt;vT<br>P-&gt;f<br>P-&gt;l<br>T-&gt;+E<br>T-&gt;l</p>
<p>S-&gt;aSe<br>S-&gt;B<br>B-&gt;bBe<br>B-&gt;C<br>C-&gt;cCe<br>C-&gt;d</p>
<p>S-&gt;ABc<br>A-&gt;a<br>A-&gt;l<br>B-&gt;b<br>B-&gt;l</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 本課程簡易範例輸出</span><br></pre></td></tr></table></figure>
<p>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,c,d<br>B:d,l<br>C:e,l<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,b,c,l<br>B:b,c,l<br>C:c,l<br>a:a<br>b:b<br>c:c<br>d:d</p>
<p>#:#<br>(:(<br>):)<br><em>:</em><br>+:+<br>E:(,i<br>T:(,i<br>X:#,+<br>Y:#,*<br>i:i<br>n:n<br>t:t<br>(:(<br>):)<br>+:+<br>E:(,f,v<br>P:f,l<br>T:+,l<br>f:f<br>v:v<br>B:b,c,d<br>C:c,d<br>S:a,b,c,d<br>a:a<br>b:b<br>c:c<br>d:d<br>e:e<br>A:a,l<br>B:b,l<br>S:a,b,c<br>a:a<br>b:b<br>c:c<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- - - - -</span><br><span class="line"></span><br><span class="line">* HTML 格式範例輸入</span><br></pre></td></tr></table></figure></p>
<p> <program>            -&gt; begin <statement_list> end<br> <statement_list>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; <statement> <statement_tail><br> <statement_tail>    -&gt; l<br> <statement>        -&gt; ID := <expression> ;<br> <statement>        -&gt; read ( <id_list> ) ;<br> <statement>        -&gt; write ( <expr_list> ) ;<br> <id_list>            -&gt; ID <id_tail><br> <id_tail>            -&gt; , ID <id_tail><br> <id_tail>            -&gt; l<br> <expr_list>        -&gt; <expression> <expr_tail><br> <expr_tail>        -&gt; , <expression> <expr_tail><br> <expr_tail>        -&gt; l<br> <expression>        -&gt; <primary> <primary_tail><br> <primary_tail>        -&gt; <add_op>    <primary> <primary_tail><br> <primary_tail>        -&gt; l<br> <primary>            -&gt; ( <expression> )<br> <primary>            -&gt; ID<br> <primary>            -&gt; INTLIT<br> <add_op>            -&gt; +<br> <add_op>            -&gt; -<br> <system_goal>        -&gt; <program> $</program></system_goal></add_op></add_op></primary></primary></expression></primary></primary_tail></primary_tail></primary></add_op></primary_tail></primary_tail></primary></expression></expr_tail></expr_tail></expression></expr_tail></expr_tail></expression></expr_list></id_tail></id_tail></id_tail></id_tail></id_list></expr_list></statement></id_list></statement></expression></statement></statement_tail></statement_tail></statement></statement_tail></statement_tail></statement></statement_list></statement_list></program></p>
<p> begin ID := ID - INTLIT + ID ; end $<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* HTML 格式範例輸出</span><br></pre></td></tr></table></figure></p>
<p>+—————-+—– First set —–+<br>|$               | { $ }<br>|(               | { ( }<br>|)               | { ) }<br>|+               | { + }<br>|,               | { , }<br>|-               | { - }<br>|:=              | { := }<br>|;               | { ; }<br>|<add_op>        | { + - }<br>|<expr_list>     | { ( ID INTLIT }<br>|<expr_tail>     | { , l }<br>|<expression>    | { ( ID INTLIT }<br>|<id_list>       | { ID }<br>|<id_tail>       | { , l }<br>|<primary>       | { ( ID INTLIT }<br>|<primary_tail>  | { + - l }<br>|<program>       | { begin }<br>|<statement>     | { ID read write }<br>|<statement_list>| { ID read write }<br>|<statement_tail>| { ID l read write }<br>|<system_goal>   | { begin }<br>|ID              | { ID }<br>|INTLIT          | { INTLIT }<br>|begin           | { begin }<br>|end             | { end }<br>|read            | { read }<br>|write           | { write }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– Follow set —–+<br>|<add_op>        | { ( ID INTLIT }<br>|<expr_list>     | { ) }<br>|<expr_tail>     | { ) }<br>|<expression>    | { ) , ; }<br>|<id_list>       | { ) }<br>|<id_tail>       | { ) }<br>|<primary>       | { ) + , - ; }<br>|<primary_tail>  | { ) , ; }<br>|<program>       | { $ }<br>|<statement>     | { ID end read write }<br>|<statement_list>| { end }<br>|<statement_tail>| { end }<br>|<system_goal>   | { l }<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>+—————-+—– LL(1) table —–+<br>|                |     $|     (|     )|     +|     ,|     -|    :=|     ;|    ID|INTLIT| begin|   end|  read| write|<br>|<add_op>        |      |      |      |    20|      |    21|      |      |      |      |      |      |      |      |<br>|<expr_list>     |      |    11|      |      |      |      |      |      |    11|    11|      |      |      |      |<br>|<expr_tail>     |      |      |    13|      |    12|      |      |      |      |      |      |      |      |      |<br>|<expression>    |      |    14|      |      |      |      |      |      |    14|    14|      |      |      |      |<br>|<id_list>       |      |      |      |      |      |      |      |      |     8|      |      |      |      |      |<br>|<id_tail>       |      |      |    10|      |     9|      |      |      |      |      |      |      |      |      |<br>|<primary>       |      |    17|      |      |      |      |      |      |    18|    19|      |      |      |      |<br>|<primary_tail>  |      |      |    16|    15|    16|    15|      |    16|      |      |      |      |      |      |<br>|<program>       |      |      |      |      |      |      |      |      |      |      |     1|      |      |      |<br>|<statement>     |      |      |      |      |      |      |      |      |     5|      |      |      |     6|     7|<br>|<statement_list>|      |      |      |      |      |      |      |      |     2|      |      |      |     2|     2|<br>|<statement_tail>|      |      |      |      |      |      |      |      |     3|      |      |     4|     3|     3|<br>|<system_goal>   |      |      |      |      |      |      |      |      |      |      |    22|      |      |      |<br>+—————-+———————+</system_goal></statement_tail></statement_list></statement></program></primary_tail></primary></id_tail></id_list></expression></expr_tail></expr_list></add_op></p>
<p>Process syntax accept</p>
<p>```</p>
<h2 id="代碼"><a href="#代碼" class="headerlink" title="代碼"></a>代碼</h2><p>2014/6/1 修正 parsing 時的 lambda 問題。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt; </span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;map&gt;</span><br><span class="line">#include &lt;set&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;stack&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">#define HTMLProduction</span><br><span class="line"></span><br><span class="line">class Production &#123;</span><br><span class="line">    public:</span><br><span class="line">        string 			LHS;</span><br><span class="line">        vector&lt;string&gt; 	RHS;</span><br><span class="line">        int 			label;</span><br><span class="line">        </span><br><span class="line">        Production(string L = "", vector&lt;string&gt; R = vector&lt;string&gt;()) &#123;</span><br><span class="line">            LHS = L;</span><br><span class="line">            RHS = R;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        void print() &#123;</span><br><span class="line">            printf("%s -&gt; ", LHS.c_str());</span><br><span class="line">            for(size_t i = 0; i &lt; RHS.size(); i++)</span><br><span class="line">                printf("%s", RHS[i].c_str());</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line">class Grammar &#123;</span><br><span class="line">    public:</span><br><span class="line">        static const string 		lambda;</span><br><span class="line">        string 						start_symbol;</span><br><span class="line">        vector&lt;Production&gt; 			rules;</span><br><span class="line">        map&lt;string, set&lt;string&gt; &gt; 	first_set;</span><br><span class="line">        map&lt;string, set&lt;string&gt; &gt; 	follow_set;</span><br><span class="line">        map&lt;string, bool&gt; 			derives_lambda;</span><br><span class="line">        map&lt;string, map&lt;string, Production&gt; &gt;	lltable;</span><br><span class="line">        </span><br><span class="line">        map&lt;string, bool&gt; mark_lambda();</span><br><span class="line">        void fill_first_set();</span><br><span class="line">        void fill_follow_set();</span><br><span class="line">        bool isNonterminal(string token);</span><br><span class="line">        set&lt;string&gt; compute_first(vector&lt;string&gt; rhs);</span><br><span class="line">        set&lt;string&gt; get_predict_set(Production p);</span><br><span class="line">        void fill_lltable();</span><br><span class="line">        void lldriver(queue&lt;string&gt; tokens);</span><br><span class="line">&#125;;</span><br><span class="line">const string Grammar::lambda("l");</span><br><span class="line"></span><br><span class="line">set&lt;string&gt; Grammar::compute_first(vector&lt;string&gt; rhs) &#123;</span><br><span class="line">    set&lt;string&gt; result;</span><br><span class="line">    size_t i;</span><br><span class="line">    </span><br><span class="line">    if(rhs.size() == 0 || rhs[0] == Grammar::lambda) &#123;</span><br><span class="line">        result.insert(Grammar::lambda);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        result = first_set[rhs[0]];</span><br><span class="line">        for(i = 1; i &lt; rhs.size() &amp;&amp; </span><br><span class="line">            first_set[rhs[i-1]].find(Grammar::lambda) != first_set[rhs[i-1]].end(); i++) &#123;</span><br><span class="line">            set&lt;string&gt; f = first_set[rhs[i]];</span><br><span class="line">            f.erase(Grammar::lambda);</span><br><span class="line">            result.insert(f.begin(), f.end());	</span><br><span class="line">        &#125;</span><br><span class="line">        if(i == rhs.size() </span><br><span class="line">            &amp;&amp; first_set[rhs[i-1]].find(Grammar::lambda) != first_set[rhs[i-1]].end()) &#123;</span><br><span class="line">            result.insert(Grammar::lambda);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            result.erase(Grammar::lambda);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125; </span><br><span class="line">/*</span><br><span class="line"> * please call get_predict_set() after fill_follow_set() and fill_first_set()</span><br><span class="line"> */</span><br><span class="line">set&lt;string&gt; Grammar::get_predict_set(Production p) &#123;</span><br><span class="line">    set&lt;string&gt; result;</span><br><span class="line">    set&lt;string&gt; rfirst;</span><br><span class="line">    </span><br><span class="line">    rfirst = compute_first(p.RHS);</span><br><span class="line">    if(rfirst.find(Grammar::lambda) != rfirst.end()) &#123;</span><br><span class="line">        rfirst.erase(Grammar::lambda);</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">        rfirst = follow_set[p.LHS];</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        result.insert(rfirst.begin(), rfirst.end());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">void Grammar::fill_lltable() &#123;</span><br><span class="line">    string		A; // nonterminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        p = rules[i];</span><br><span class="line">        A = p.LHS;</span><br><span class="line">        set&lt;string&gt; predict_set = get_predict_set(p);</span><br><span class="line">        </span><br><span class="line">        for(set&lt;string&gt;::iterator it = predict_set.begin();</span><br><span class="line">            it != predict_set.end(); it++) &#123;</span><br><span class="line">            assert(lltable[A].find(*it) == lltable[A].end());</span><br><span class="line">            lltable[A][*it] = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">bool Grammar::isNonterminal(string token) &#123;</span><br><span class="line"></span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">    if(token == Grammar::lambda)</span><br><span class="line">        return false;</span><br><span class="line">    if(token[0] == '&lt;' &amp;&amp; token[token.length() - 1] == '&gt;')</span><br><span class="line">        return true;</span><br><span class="line">    return false;</span><br><span class="line">#else</span><br><span class="line">    if(token == Grammar::lambda)</span><br><span class="line">        return false;</span><br><span class="line">    for(size_t i = 0; i &lt; token.length(); i++) &#123;</span><br><span class="line">        if(isupper(token[i]))</span><br><span class="line">            return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br><span class="line">map&lt;string, bool&gt; Grammar::mark_lambda() &#123;</span><br><span class="line">    bool 				rhs_derives_lambda;</span><br><span class="line">    bool 				changes;</span><br><span class="line">    Production 			p;</span><br><span class="line">    </span><br><span class="line">    derives_lambda.clear();</span><br><span class="line">    </span><br><span class="line">    /* initially, nothing is marked. */</span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        derives_lambda[rules[i].LHS] = false;</span><br><span class="line">    &#125;</span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            p = rules[i];</span><br><span class="line">            if(!derives_lambda[p.LHS]) &#123;</span><br><span class="line">                if(p.RHS.size() == 0 || p.RHS[0] == Grammar::lambda) &#123;</span><br><span class="line">                    changes = derives_lambda[p.LHS] = true;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                /* does each part of RHS derive lambda ? */</span><br><span class="line">                rhs_derives_lambda = derives_lambda[string(p.RHS[0])];</span><br><span class="line">                for(size_t j = 1; j &lt; p.RHS.size(); j++) &#123;</span><br><span class="line">                    rhs_derives_lambda &amp;= derives_lambda[p.RHS[j]];</span><br><span class="line">                &#125;</span><br><span class="line">                if(rhs_derives_lambda) &#123;</span><br><span class="line">                    changes = true;</span><br><span class="line">                    derives_lambda[p.LHS] = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">    return derives_lambda;</span><br><span class="line">&#125;</span><br><span class="line">void Grammar::fill_first_set() &#123;</span><br><span class="line">    </span><br><span class="line">    string 		A; // nonterminal</span><br><span class="line">    string 		a; // terminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    bool 		changes;</span><br><span class="line">        </span><br><span class="line">    mark_lambda();</span><br><span class="line">    first_set.clear();</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        A = rules[i].LHS;</span><br><span class="line">        if(derives_lambda[A])</span><br><span class="line">            first_set[A].insert(Grammar::lambda);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        for(size_t j = 0; j &lt; rules[i].RHS.size(); j++) &#123;</span><br><span class="line">            a = rules[i].RHS[j];</span><br><span class="line">            if(!isNonterminal(a)) &#123;</span><br><span class="line">                if(a != Grammar::lambda)</span><br><span class="line">                    first_set[a].insert(a);</span><br><span class="line">                if(j == 0) &#123; // A -&gt; aXX</span><br><span class="line">                    first_set[rules[i].LHS].insert(a);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            p = rules[i];</span><br><span class="line">            set&lt;string&gt; rfirst = compute_first(p.RHS);</span><br><span class="line">            size_t oldsize = first_set[p.LHS].size();</span><br><span class="line">            first_set[p.LHS].insert(rfirst.begin(), rfirst.end());</span><br><span class="line">            size_t newsize = first_set[p.LHS].size();</span><br><span class="line">            if(oldsize != newsize)</span><br><span class="line">                changes = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">void Grammar::fill_follow_set() &#123;</span><br><span class="line">    string 	A, B; // nonterminal</span><br><span class="line">    Production 	p;</span><br><span class="line">    bool 	changes;</span><br><span class="line">    </span><br><span class="line">    for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">        A = rules[i].LHS;</span><br><span class="line">        follow_set[A].clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    follow_set[start_symbol].insert(Grammar::lambda);</span><br><span class="line">        </span><br><span class="line">    do &#123;</span><br><span class="line">        changes = false;</span><br><span class="line">        for(size_t i = 0; i &lt; rules.size(); i++) &#123;</span><br><span class="line">            /* A -&gt; a B b</span><br><span class="line">             * I.e. for each production and each occurrence</span><br><span class="line">             * of a nonterminal in its right-hand side. </span><br><span class="line">             */</span><br><span class="line">            p = rules[i];</span><br><span class="line">            A = p.LHS;</span><br><span class="line">            for(size_t j = 0; j &lt; p.RHS.size(); j++) &#123;</span><br><span class="line">                B = p.RHS[j];</span><br><span class="line">                if(isNonterminal(B)) &#123;</span><br><span class="line">                    vector&lt;string&gt; beta(p.RHS.begin() + j + 1, p.RHS.end());</span><br><span class="line">                    set&lt;string&gt; rfirst = compute_first(beta);</span><br><span class="line">                    size_t oldsize = follow_set[B].size();</span><br><span class="line">                    </span><br><span class="line">                    if(rfirst.find(Grammar::lambda) == rfirst.end()) &#123;</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        rfirst.erase(Grammar::lambda);</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());	</span><br><span class="line">                        rfirst = follow_set[A];</span><br><span class="line">                        follow_set[B].insert(rfirst.begin(), rfirst.end());</span><br><span class="line">                    &#125;</span><br><span class="line">                    size_t newsize = follow_set[B].size();			</span><br><span class="line">                    if(oldsize != newsize)</span><br><span class="line">                        changes = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while(changes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Grammar::lldriver(queue&lt;string&gt; tokens) &#123;</span><br><span class="line">    stack&lt;string&gt; 	stk;</span><br><span class="line">    string 			X;</span><br><span class="line">    string			a;</span><br><span class="line">    Production		p;</span><br><span class="line">    /* Push the Start Symbol onto an empty stack */</span><br><span class="line">    stk.push(start_symbol);</span><br><span class="line">    </span><br><span class="line">    while(!stk.empty() &amp;&amp; !tokens.empty()) &#123;</span><br><span class="line">        X = stk.top();</span><br><span class="line">        a = tokens.front();</span><br><span class="line">        // cout &lt;&lt; X &lt;&lt; " " &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">        if(isNonterminal(X) &amp;&amp; lltable[X].find(a) != lltable[X].end()) &#123;</span><br><span class="line">            p = lltable[X][a];</span><br><span class="line">            stk.pop();</span><br><span class="line">            for(int i = p.RHS.size() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">                if(p.RHS[i] == Grammar::lambda)</span><br><span class="line">                    continue;</span><br><span class="line">                stk.push(p.RHS[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if(X == a) &#123;</span><br><span class="line">            stk.pop();</span><br><span class="line">            tokens.pop();</span><br><span class="line">        &#125; else if(lltable[X].find(Grammar::lambda) != lltable[X].end()) &#123;</span><br><span class="line">            stk.pop();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            /* Process syntax error. */</span><br><span class="line">            puts("Bad!");</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while(!stk.empty()) &#123;</span><br><span class="line">        X = stk.top();</span><br><span class="line">        if(lltable[X].find(Grammar::lambda) != lltable[X].end())</span><br><span class="line">            stk.pop();</span><br><span class="line">        else</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if(tokens.size() == 0 &amp;&amp; stk.size() == 0)</span><br><span class="line">        puts("Good");</span><br><span class="line">    else</span><br><span class="line">        puts("Bad!");</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">queue&lt;string&gt; getTokens(char s[]) &#123;</span><br><span class="line">    stringstream 	sin(s);</span><br><span class="line">    queue&lt;string&gt; 	tokens;</span><br><span class="line">    string			token;</span><br><span class="line">    while(sin &gt;&gt; token)</span><br><span class="line">        tokens.push(token);</span><br><span class="line">    return tokens;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void parsingProduction(string r, Grammar &amp;g) &#123;</span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">    static int 		production_label = 0;</span><br><span class="line">    stringstream 	sin(r);</span><br><span class="line">    string 			lhs, foo;</span><br><span class="line">    vector&lt;string&gt; 	tokens;</span><br><span class="line">    sin &gt;&gt; lhs &gt;&gt; foo;</span><br><span class="line">    while(sin &gt;&gt; foo)</span><br><span class="line">        tokens.push_back(foo);</span><br><span class="line">    Production p(lhs, tokens);</span><br><span class="line">    p.label = ++production_label;</span><br><span class="line">    g.rules.push_back(p);</span><br><span class="line">#else</span><br><span class="line">    string div("-&gt;");</span><br><span class="line">    size_t found = r.find(div);</span><br><span class="line">    if(found != std::string::npos) &#123;</span><br><span class="line">        string rhs = r.substr(found + div.length());</span><br><span class="line">        vector&lt;string&gt; tokens;</span><br><span class="line">        for(size_t i = 0; i &lt; rhs.size(); i++)</span><br><span class="line">            tokens.push_back(rhs.substr(i, 1));</span><br><span class="line">        Production p(r.substr(0, found), tokens);</span><br><span class="line">        g.rules.push_back(p);</span><br><span class="line">    &#125;</span><br><span class="line">#endif</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    </span><br><span class="line">    //freopen("input.txt", "r+t", stdin);</span><br><span class="line">    //freopen("output.txt", "w+t", stdout); </span><br><span class="line">    </span><br><span class="line">    char in[1024];</span><br><span class="line">    while(gets(in)) &#123;</span><br><span class="line">        Grammar g;</span><br><span class="line">        parsingProduction(in, g);</span><br><span class="line">        while(gets(in) &amp;&amp; in[0] != '\0') &#123;</span><br><span class="line">            parsingProduction(in, g);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">        g.start_symbol = "&lt;system_goal&gt;";</span><br><span class="line">#else</span><br><span class="line">        g.start_symbol = "S";</span><br><span class="line">#endif</span><br><span class="line">        </span><br><span class="line">        g.fill_first_set();</span><br><span class="line">        g.fill_follow_set();</span><br><span class="line">        g.fill_lltable();</span><br><span class="line">        </span><br><span class="line">        puts("+----------------+----- First set -----+");</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator it = g.first_set.begin();</span><br><span class="line">            it != g.first_set.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s| &#123;", it-&gt;first.c_str());</span><br><span class="line">            for(set&lt;string&gt;::iterator jt = it-&gt;second.begin();</span><br><span class="line">                jt != it-&gt;second.end(); jt++) &#123;</span><br><span class="line">                cout &lt;&lt; " " &lt;&lt; *jt;</span><br><span class="line">            &#125;</span><br><span class="line">            puts(" &#125;");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">        puts("+----------------+----- Follow set -----+");</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator it = g.follow_set.begin();</span><br><span class="line">            it != g.follow_set.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s| &#123;", it-&gt;first.c_str());</span><br><span class="line">            for(set&lt;string&gt;::iterator jt = it-&gt;second.begin();</span><br><span class="line">                jt != it-&gt;second.end(); jt++) &#123;</span><br><span class="line">                cout &lt;&lt; " " &lt;&lt; *jt;</span><br><span class="line">            &#125;</span><br><span class="line">            puts(" &#125;");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">        puts("+----------------+----- LL(1) table -----+");</span><br><span class="line">        printf("|%-16s|", "");			</span><br><span class="line">        for(map&lt;string, set&lt;string&gt; &gt;::iterator jt = g.first_set.begin();</span><br><span class="line">                jt != g.first_set.end(); jt++) &#123;</span><br><span class="line">            string A = jt-&gt;first;</span><br><span class="line">            if(g.isNonterminal(A))</span><br><span class="line">                continue;</span><br><span class="line">            printf("%6s|", A.c_str());</span><br><span class="line">        &#125;</span><br><span class="line">        puts("");</span><br><span class="line">        for(map&lt;string, map&lt;string, Production&gt; &gt;::iterator it = g.lltable.begin();</span><br><span class="line">            it != g.lltable.end(); it++) &#123;</span><br><span class="line">            printf("|%-16s|", it-&gt;first.c_str());</span><br><span class="line">            for(map&lt;string, set&lt;string&gt; &gt;::iterator jt = g.first_set.begin();</span><br><span class="line">                jt != g.first_set.end(); jt++) &#123;</span><br><span class="line">                string A = jt-&gt;first;</span><br><span class="line">                if(g.isNonterminal(A))</span><br><span class="line">                    continue;</span><br><span class="line">                if(it-&gt;second.find(A) == it-&gt;second.end()) </span><br><span class="line">                    printf("%6s|", "");</span><br><span class="line">                else</span><br><span class="line">                    printf("%6d|", it-&gt;second[A].label);</span><br><span class="line">            &#125;</span><br><span class="line">            puts("");</span><br><span class="line">        &#125;</span><br><span class="line">        puts("+----------------+---------------------+\n");</span><br><span class="line">#ifdef HTMLProduction</span><br><span class="line">        gets(in);</span><br><span class="line">        g.lldriver(getTokens(in));</span><br><span class="line">#endif</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h1><p>要學會更多，請修 <code>計算理論</code> 這門課程。</p>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10378" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/10/oj/uva/uva-10378/" class="article-date">
  <time datetime="2014-05-10T06:28:27.000Z" itemprop="datePublished">2014-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/10/oj/uva/uva-10378/">UVa 10378 - Complex Numbers</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/10/oj/uva/uva-10378/" data-id="cipz12v0k02jpt1xcsaoj0mnz" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/10/oj/uva/uva-10378/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/複數/">複數</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Numbers of the form a±bi are called complex numbers (Where i = √(-1)). In this problem you will have to find all the values of (a±bi)<sup>1/n</sup>. </p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input file contains several lines of input. Each line has two parts. The first part will contain a complex number of the form a±bi and the second part will contain an integer n (0 &lt; n &lt;=100). Here a and b are integer numbers and 0 &lt;= |a|, |b|&lt;100. Input is terminated by end of file.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each line of input you should produce n+2 lines of output. The description of output for each line of input is given in the next paragraph:</p>
<p>First line contains the case number as shown in the sample output. Next n lines should contain the n-th roots of the input complex number. The printed complex numbers should be of the form x±yi, where x and y are floating point numbers rounded upto three digits after the decimal point. Note that there is no space between the operators and operands. The roots are sorted according to descending order of their real part and then according to the descending order of their imaginary part. When the printed value of x or y is 0.000, it should be interpreted as positive zero. So you should never print something like “-0.000”. After all these outputs print a blank line. </p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3+4i 2</span><br><span class="line">5-4i 3</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Case 1:</span><br><span class="line">2.000+1.000i</span><br><span class="line">-2.000-1.000i</span><br><span class="line"></span><br><span class="line">Case 2:</span><br><span class="line">1.810-0.414i</span><br><span class="line">-0.546+1.775i</span><br><span class="line">-1.264-1.361i</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述： </strong></p>
<p>問虛數 <code>a+bi</code> 的 n 次根號的結果，並且根據實數由大至小、虛數由大至小的字典順序輸出。</p>
<p><strong> 題目解法： </strong></p>
<p>先算出 <code>a+bi</code> 所占有的角度 <code>theta</code>，得到 <code>(theta + 2 * pi * i / n)</code> 是每一個根的角度，因為根據角度疊加原理得到 <code>(theta + 2 * pi * i / n) ^ n = theta + 2 * pi * i ＝ theta</code>，但是這題的困難是在於 如何避免 <code>-0.000</code> 的輸出。</p>
<p>原本錯誤排序的寫法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bool cmp(Point a, Point b) &#123;</span><br><span class="line">    if(fabs(a.x - b.x) &gt; eps)</span><br><span class="line">        return a.x &lt; b.x;</span><br><span class="line">    return a.y &lt; b.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>應更正為如下代碼，如果要問我為什麼，現在還沒有仔細地理解，照理來說應該是差不多的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bool cmp(Point a, Point b) &#123;</span><br><span class="line">    if(fabs(a.x - b.x) &gt; eps)</span><br><span class="line">        return a.x &lt; b.x;</span><br><span class="line">    if(fabs(a.y - b.y) &gt; eps)</span><br><span class="line">        return a.y &lt; b.y;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前是想利用 <code>sprintf(buffer, &quot;%+.3lf%+.3lf&quot;, a, b);</code> 去檢查 <code>+0.000</code> 和 <code>-0.000</code>，這種寫法有點太過了，不過應該也是可行的。</p>
<figure class="highlight plain"><figcaption><span>lang: cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">#define eps 1e-6</span><br><span class="line">bool cmp(pair&lt;double, double&gt; a, pair&lt;double, double&gt; b) &#123;</span><br><span class="line">    if(fabs(a.first - b.first) &gt; eps)</span><br><span class="line">        return a.first &gt; b.first;</span><br><span class="line">    if(fabs(a.second - b.second) &lt; eps)</span><br><span class="line">        return false;</span><br><span class="line">    return a.second &gt; b.second;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    char s[50];</span><br><span class="line">    const double pi = acos(-1);</span><br><span class="line">    int n, i, cases = 0;</span><br><span class="line">    double a, b;</span><br><span class="line">    while(scanf(&quot;%s %d&quot;, s, &amp;n) == 2) &#123;</span><br><span class="line">        if(sscanf(s, &quot;%lf+%lfi&quot;, &amp;a, &amp;b) == 2)</span><br><span class="line">            &#123;&#125;</span><br><span class="line">        else</span><br><span class="line">            sscanf(s, &quot;%lf-%lfi&quot;, &amp;a, &amp;b), b = -b;</span><br><span class="line">        double theta = atan2(b, a);</span><br><span class="line">        double k = pow(sqrt(a*a+b*b), 1.0/n);</span><br><span class="line">        double px, py;</span><br><span class="line">        pair&lt;double, double&gt; D[128];</span><br><span class="line">        for(i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            px = k*cos((theta + i*2*pi)/n);</span><br><span class="line">            py = k*sin((theta + i*2*pi)/n);</span><br><span class="line">            D[i] = make_pair(px, py);</span><br><span class="line">        &#125;</span><br><span class="line">        sort(D, D+n, cmp);</span><br><span class="line">        printf(&quot;Case %d:\n&quot;, ++cases);</span><br><span class="line">        for(i = 0; i &lt; n; i++) &#123;</span><br><span class="line">        	if(fabs(D[i].first) &lt; 0.0005)	D[i].first = 0;</span><br><span class="line">        	if(fabs(D[i].second) &lt; 0.0005)	D[i].second = 0;</span><br><span class="line">        	printf(&quot;%.3lf%+.3lfi\n&quot;, D[i].first, D[i].second);</span><br><span class="line">        &#125;</span><br><span class="line">        puts(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-1572" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/07/oj/uva/uva-1572/" class="article-date">
  <time datetime="2014-05-06T23:46:52.000Z" itemprop="datePublished">2014-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/07/oj/uva/uva-1572/">UVa 1572 - Self-Assembly</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/07/oj/uva/uva-1572/" data-id="cipz12w9x0341t1xcxeftbvd6" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/07/oj/uva/uva-1572/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/環/">環</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Automatic Chemical Manufacturing is experimenting with a process called self-assembly. In this process, molecules with natural asonity for each other are mixed together in a solution and allowed to spon-taneously assemble themselves into larger structures. But there is one problem: sometimes molecules assemble themselves into a structure of unbounded size, which gums up the machinery.</p>
<p>You must write a program to decide whether a given collection of molecules can be assembled into a structure of unbounded size. You should make two simplifying assumptions: 1) the problem is restricted to two dimensions, and 2) each molecule in the collection is represented as a square. The four edges of the square represent the surfaces on which the molecule can connect to other compatible molecules.</p>
<p>In each test case, you will be given a set of molecule descriptions. Each type of molecule is described by four two-character connector labels that indicate how its edges can connect to the edges of other molecules. There are two types of connector labels:</p>
<ul>
<li>An uppercase letter ( A, …, Z ) followed by <code>+</code> or <code>.</code> Two edges are compatible if their labels have the same letter but different signs. For example, <code>A+</code> is compatible with <code>A</code> but is not compatible with <code>A+</code> or <code>B</code>. </li>
<li>Two zero digits <code>00</code>. An edge with this label is not compatible with any edge (not even with<br>another edge labeled <code>00</code>).</li>
</ul>
<p>Assume there is an unlimited supply of molecules of each type, which may be rotated and reected.<br>As the molecules assemble themselves into larger structures, the edges of two molecules may be adjacent to each other only if they are compatible. It is permitted for an edge, regardless of its connector label, to be connected to nothing (no adjacent molecule on that edge). Figure A.1 shows an example of three molecule types and a structure of bounded size that can be assembled from them (other bounded structures are also possible with this set of molecules).</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input consists of several test cases. A test case consists of two lines. The rst contains an integer n (1 &lt; n &lt; 40000) indicating the number of molecule types. The second line contains n eight-character strings, each describing a single type of molecule, separated by single spaces. Each string consists of four two-character connector labels representing the four edges of the molecule in clockwise order.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case, display the word <code>unbounded</code> if the set of molecule types can generate a structure of unbounded size. Otherwise, display the word <code>bounded</code>.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">A+00A+A+ 00B+D+A- B-C+00C+</span><br><span class="line">1</span><br><span class="line">K+K-Q+Q-</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bounded</span><br><span class="line">unbounded</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>分定數種分子，每一種分子有無限多個，問會不會產生無邊界的化合物，也就是可以一直串一直串下去。</p>
<p><strong> 題目解法：</strong></p>
<p>鏡射和旋轉不用去理會，對於建圖並沒有影響，而題目圖片中看起來是平面，但是事實上可以螺旋疊起。</p>
<p><img src="/img/uva1572sol.PNG" alt="img"></p>
<p>如上圖片所示，使用這種建照方式去找環，只要有環的情況就會有無邊界的化合物。</p>
<p>不考慮找到每一個化合物間的關係，這關係過於龐大，只考慮接口連接的關係。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int g[64][64];</span><br><span class="line">int node(char a, char b) &#123;</span><br><span class="line">    return (a - &apos;A&apos;) + (b == &apos;+&apos; ? 0 : 26);</span><br><span class="line">&#125;</span><br><span class="line">int rnode(char a, char b) &#123;</span><br><span class="line">    return (a - &apos;A&apos;) + (b == &apos;+&apos; ? 26 : 0);</span><br><span class="line">&#125;</span><br><span class="line">int exist_cycle;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int n;</span><br><span class="line">    char s[50];</span><br><span class="line">    while(scanf(&quot;%d&quot;, &amp;n) == 1) &#123;</span><br><span class="line">        memset(g, 0, sizeof(g));</span><br><span class="line">        for(int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            scanf(&quot;%s&quot;, s);</span><br><span class="line">            for(int j = 0; j &lt; 4; j++)	 &#123;</span><br><span class="line">                for(int k = 0; k &lt; 4; k++) &#123;</span><br><span class="line">                    if(j == k || s[2 * j] == &apos;0&apos; || s[2 * k] == &apos;0&apos;)</span><br><span class="line">                        continue;</span><br><span class="line">                    int x = node(s[2 * j], s[2 * j + 1]);</span><br><span class="line">                    int y = rnode(s[2 * k], s[2 * k + 1]);</span><br><span class="line">                    g[x][y] = 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        exist_cycle = 0;</span><br><span class="line">        n = 52;</span><br><span class="line">        for(int k = 0; k &lt; n; k++) &#123;</span><br><span class="line">            for(int i = 0; i &lt; n; i++)</span><br><span class="line">                for(int j = 0; j &lt; n; j++)</span><br><span class="line">                    g[i][j] |= g[i][k]&amp;g[k][j];</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i = 0; i &lt; n; i++)</span><br><span class="line">            exist_cycle |= g[i][i];</span><br><span class="line">        puts(exist_cycle ? &quot;unbounded&quot; : &quot;bounded&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">3</span><br><span class="line">A+00A+A+ 00B+D+A- B-C+00C+</span><br><span class="line">1</span><br><span class="line">K+K-Q+Q-</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/poj/poj-1166" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/06/oj/poj/poj-1166/" class="article-date">
  <time datetime="2014-05-06T00:34:56.000Z" itemprop="datePublished">2014-05-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/06/oj/poj/poj-1166/">POJ 1166 - The Clocks</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/06/oj/poj/poj-1166/" data-id="cipz12uth02g9t1xc030fuvez" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/06/oj/poj/poj-1166/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bfs/">bfs</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">|-------|    |-------|    |-------|</span><br><span class="line">|       |    |       |    |   |   |</span><br><span class="line">|---O   |    |---O   |    |   O   |</span><br><span class="line">|       |    |       |    |       |</span><br><span class="line">|-------|    |-------|    |-------|</span><br><span class="line"></span><br><span class="line">    A            B            C    </span><br><span class="line"></span><br><span class="line">|-------|    |-------|    |-------|</span><br><span class="line">|       |    |       |    |       |</span><br><span class="line">|   O   |    |   O   |    |   O   |</span><br><span class="line">|   |   |    |   |   |    |   |   |</span><br><span class="line">|-------|    |-------|    |-------|</span><br><span class="line"></span><br><span class="line">    D            E            F    </span><br><span class="line"></span><br><span class="line">|-------|    |-------|    |-------|</span><br><span class="line">|       |    |       |    |       |</span><br><span class="line">|   O   |    |   O---|    |   O   |</span><br><span class="line">|   |   |    |       |    |   |   |</span><br><span class="line">|-------|    |-------|    |-------|</span><br><span class="line"></span><br><span class="line">    G            H            I</span><br></pre></td></tr></table></figure>
<p>(Figure 1)</p>
<p>There are nine clocks in a 3*3 array (figure 1). The goal is to return all the dials to 12 o’clock with as few moves as possible. There are nine different allowed ways to turn the dials on the clocks. Each such way is called a move. Select for each move a number 1 to 9. That number will turn the dials 90’ (degrees) clockwise on those clocks which are affected according to figure 2 below.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Move</th>
<th style="text-align:left">Affected clocks </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:left">ABDE        </td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:left">ABC         </td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:left">BCEF        </td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:left">ADG         </td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:left">BDEFH       </td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:left">CFI         </td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:left">DEGH        </td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:left">GHI         </td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:left">EFHI        </td>
</tr>
</tbody>
</table>
<p>   (Figure 2)</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>Your program is to read from standard input. Nine numbers give the start positions of the dials. 0=12 o’clock, 1=3 o’clock, 2=6 o’clock, 3=9 o’clock.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>Your program is to write to standard output. Output a shortest sorted sequence of moves (numbers), which returns all the dials to 12 o’clock. You are convinced that the answer is unique.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3 3 0</span><br><span class="line">2 2 2</span><br><span class="line">2 1 2</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 5 8 9</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>原來之前寫過這一題，請參閱 <a href="http://zerojudge.tw/ShowProblem?problemid=d730" target="_blank" rel="external">d730: 升旗典礼 ——加强版</a></p>
<p>用 BFS 從 <code>0 0 0 0 0 0 0 0 0</code> 開始倒推回去，在 mark 的部份，用 4 進制 bitmask。</p>
<p>這題在 POJ 似乎只有一組測資，在 Zerojudge 則有非常多筆測資。</p>
<p>而事實上網路上還有另外一個高斯消去法，先預求反矩陣，之後直接帶入計算即可。沒有仔細去研究，不過聽說那解法限定一定有合法解，如何判定不合法解又是另外一個問題。總之，用了 BFS 過了就沒仔細去探討其他解法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">char mark[1&lt;&lt;18] = &#123;&#125;, ans[1&lt;&lt;18], best[1&lt;&lt;18];</span><br><span class="line">char dirp[4] = &#123;-3, 1, 1, 1&#125;;</span><br><span class="line">int next[1&lt;&lt;18] = &#123;&#125;;</span><br><span class="line">int pow4[10] = &#123;1&#125;;</span><br><span class="line">int move[10][7] = &#123; &#123;&#125;,</span><br><span class="line">                 	&#123;1, 2, 4, 5, 0&#125;,</span><br><span class="line">                 	&#123;1, 2, 3, 0&#125;,</span><br><span class="line">                 	&#123;2, 3, 5, 6, 0&#125;,</span><br><span class="line">                 	&#123;1, 4, 7, 0&#125;,</span><br><span class="line">                 	&#123;2, 4, 5, 6, 8, 0&#125;,</span><br><span class="line">                 	&#123;3, 6, 9, 0&#125;,</span><br><span class="line">                 	&#123;4, 5, 7, 8, 0&#125;,</span><br><span class="line">                 	&#123;7, 8, 9, 0&#125;,</span><br><span class="line">                 	&#123;5, 6, 8, 9, 0&#125;</span><br><span class="line">                   &#125;;</span><br><span class="line">void trans(int N, char s[]) &#123;</span><br><span class="line">    int i = 0;</span><br><span class="line">    while(N) &#123;</span><br><span class="line">        s[i++] = N%4, N /= 4;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void build() &#123;</span><br><span class="line">    int a, b, c, qt = 0, t, p;</span><br><span class="line">    queue&lt;int&gt; Q;</span><br><span class="line">    best[0] = 0, mark[0] = 1;</span><br><span class="line">    Q.push(0);</span><br><span class="line">    while(!Q.empty()) &#123;</span><br><span class="line">    	int state = Q.front();</span><br><span class="line">    	Q.pop();</span><br><span class="line">    	char buf[10] = &#123;&#125;;</span><br><span class="line">    	trans(state, buf);</span><br><span class="line">    	for(int i = 1; i &lt; 10; i++) &#123;</span><br><span class="line">    		int nstate = state;</span><br><span class="line">    		for(int j = 0; move[i][j]; j++)</span><br><span class="line">    			nstate -= pow4[move[i][j] - 1] * dirp[buf[move[i][j] - 1]];</span><br><span class="line">    		if(mark[nstate] == 0) &#123;</span><br><span class="line">    			mark[nstate] = 1;</span><br><span class="line">    			next[nstate] = state;</span><br><span class="line">                best[nstate] = best[state] + 1;</span><br><span class="line">                ans[nstate] = i + &apos;0&apos;;</span><br><span class="line">    			Q.push(nstate);</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int print_f = 0;</span><br><span class="line">void Print(int state) &#123;</span><br><span class="line">    if(state) &#123;</span><br><span class="line">        Print(next[state]);</span><br><span class="line">        if(print_f)</span><br><span class="line">            putchar(&apos; &apos;);</span><br><span class="line">        print_f = 1;</span><br><span class="line">        putchar(ans[state]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    for(int i = 1; i &lt; 10; i++)</span><br><span class="line">        pow4[i] = pow4[i-1] * 4;</span><br><span class="line">    build();</span><br><span class="line">    while(true) &#123;</span><br><span class="line">    	int state = 0, x;</span><br><span class="line">        for(int i = 0; i &lt; 9; i++) &#123;</span><br><span class="line">            if(scanf(&quot;%d&quot;, &amp;x) != 1)</span><br><span class="line">            	return 0;</span><br><span class="line">            state |= x * pow4[i];</span><br><span class="line">        &#125;</span><br><span class="line">        print_f = 0;</span><br><span class="line">        Print(state);</span><br><span class="line">        puts(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10040" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/06/oj/uva/uva-10040/" class="article-date">
  <time datetime="2014-05-06T00:01:21.000Z" itemprop="datePublished">2014-05-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/06/oj/uva/uva-10040/">UVa 10040 - Ouroboros Snake</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/06/oj/uva/uva-10040/" data-id="cipz12uxg02i3t1xcfmhf6hqz" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/06/oj/uva/uva-10040/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/尤拉迴路/">尤拉迴路</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最小表示法/">最小表示法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/遞迴改寫/">遞迴改寫</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Ouroboros was a mythical snake in Ancient Egypt. It has its tail inside its mouth and continuously devours itself.</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Ouroboros numbers are binary numbers of 2n bits that have the property of generating the whole set of numbers from 0 to 2n-1 as follows: To produce all of them we place the 2n bits wrapped in a circle so that the last bit goes before the first one. Then we can denote all 2n different strings with n bits starting each time with the next bit in the circle.</p>
<p>For example, for n=2 there are only four Ouroboros numbers. These are 0011, 0110, 1100 and 1001. For 0011, the following diagram and table depicts the process of finding all the bitstrings:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k 	00110011... 	o(n=2,k)</span><br><span class="line">0 	00 	0</span><br><span class="line">1 	 01 	1</span><br><span class="line">2 	  11 	3</span><br><span class="line">3 	   10 	2</span><br></pre></td></tr></table></figure>
<p>Your program will compute the function o(n,k), where n &gt; 0 and <span>$0 \leq k &lt; 2^n$</span><!-- Has MathJax -->. This function calculates the k-th number inside the smallest Ouroboros number of size n-bits.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input starts with a line containing the number of test cases. For each test case you will be given a line with two integers n (0 &lt; n &lt;22) and k ( 0 &lt;= k &lt; 2^n).</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For every test case your output must evaluate the function o(n,k) and print the result on a line by itself.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 </span><br><span class="line">2 0</span><br><span class="line">2 1</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><strong> 題目描述：</strong></p>
<p>有一個 <code>2^n</code> 個 bits 的環，而這個環恰好任取連續 n 個會湊滿 <code>[0, 2^n - 1]</code>，現在找一個字典順序最小的環，接著詢問這個環的某一個位置開始的數值。</p>
<p><strong> 題目解法：</strong></p>
<p>當詢問 n bits 的結果時，可以把圖建成 <code>2^(n-1)</code> 個節點，每一個節點有兩條邊，邊上分別為 0, 1，也就是說只要繞過所有的邊，相當於產生所有 <code>2^n</code> 個數字。</p>
<p>由於每一個點的 <code>indegree = outdegree</code> 一定存在尤拉迴路，接著在有向圖中找到一條尤拉迴路即可。</p>
<p>至於找字典順序最小環，使用 <code>周源最小表示法</code> 來找，如果可以的話希望能在搜尋時順便找到字典順序最小的。這裡就沒有系不去探究了。</p>
<p>以下是一個最簡單的版本，但這個版本在生成尤拉迴路時會遭遇到 stackoverflow。</p>
<figure class="highlight plain"><figcaption><span>TLE version because of stack overflow</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">char g[1&lt;&lt;21][2] = &#123;&#125;;</span><br><span class="line">int n, mask, highbit;</span><br><span class="line">char order[2][1&lt;&lt;21], *p;</span><br><span class="line">void dfs(int node) &#123;</span><br><span class="line">    int prefix = node;</span><br><span class="line">    prefix &lt;&lt;= 1;</span><br><span class="line">    for(int i = 0; i &lt; 2; i++) &#123;</span><br><span class="line">        if(g[node][i]) &#123;</span><br><span class="line">            g[node][i]--;</span><br><span class="line">            dfs((prefix|i)&amp;mask);</span><br><span class="line">    		*p = (i) +&apos;0&apos;, p++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int MinExp(const char *s, const int slen) &#123;</span><br><span class="line">    int i = 0, j = 1, k = 0, x, y, tmp;</span><br><span class="line">    while(i &lt; slen &amp;&amp; j &lt; slen &amp;&amp; k &lt; slen) &#123;</span><br><span class="line">        x = i + k;</span><br><span class="line">        y = j + k;</span><br><span class="line">        if(x &gt;= slen)    x -= slen;</span><br><span class="line">        if(y &gt;= slen)    y -= slen;</span><br><span class="line">        if(s[x] == s[y]) &#123;</span><br><span class="line">            k++;</span><br><span class="line">        &#125; else if(s[x] &gt; s[y]) &#123;</span><br><span class="line">            i = j+1 &gt; i+k+1 ? j+1 : i+k+1;</span><br><span class="line">            k = 0;</span><br><span class="line">            tmp = i, i = j, j = tmp;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            j = i+1 &gt; j+k+1 ? i+1 : j+k+1;</span><br><span class="line">            k = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return i;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int testcase, K;</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;testcase);</span><br><span class="line">    while(testcase--) &#123;</span><br><span class="line">        scanf(&quot;%d %d&quot;, &amp;n, &amp;K);</span><br><span class="line">        mask = (1&lt;&lt;(n-1)) - 1;</span><br><span class="line">        for(int i = (1&lt;&lt;(n-1)) - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">            g[i][0]++;</span><br><span class="line">            g[i][1]++;</span><br><span class="line">        &#125;</span><br><span class="line">        p = order[0];</span><br><span class="line">        dfs(0);</span><br><span class="line">        *p = &apos;\0&apos;, p++;</span><br><span class="line">        int len = strlen(order[0]);</span><br><span class="line">        for(int i = len - 1, j = 0; i &gt;= 0; i--, j++)</span><br><span class="line">            order[1][i] = order[0][j];</span><br><span class="line">        order[1][len] = &apos;\0&apos;;</span><br><span class="line">        int o1 = MinExp(order[0], len);</span><br><span class="line">        int o2 = MinExp(order[1], len);</span><br><span class="line">        int f = 0;</span><br><span class="line">        for(int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            if(order[0][(o1 + i)%len] != order[1][(o2 + i)%len]) &#123;</span><br><span class="line">                f = order[0][(o1 + i)%len] &gt; order[1][(o2 + i)%len];</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        int ret = 0;</span><br><span class="line">        for(int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            ret = ret &lt;&lt; 1;</span><br><span class="line">            if(f == 0) &#123;</span><br><span class="line">                ret |= order[0][(o1 + i + K)%len] - &apos;0&apos;;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ret |= order[1][(o2 + i + K)%len] - &apos;0&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%d\n&quot;, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由於上述程式在走訪尤拉迴路時，由於深度過深而造成 <code>stackoverflow</code> 因此需要局部改寫成手動的 stack。通常主機只支持 10 萬到 20 萬之間的深度，這題最慘會到 100 萬。</p>
<p>並且將答案預建出來，如果沒有預建表會導致 <code>Time limit</code>，我以為只有少數幾筆，真是大錯特錯了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stack&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">char g[1&lt;&lt;21][2] = &#123;&#125;;</span><br><span class="line">int n, mask;</span><br><span class="line">char order[2][1&lt;&lt;21], *p;</span><br><span class="line">char ouroboros[22][1&lt;&lt;21];</span><br><span class="line">int olen[22];</span><br><span class="line">void dfs(int node) &#123;</span><br><span class="line">    stack&lt; pair&lt;int, int&gt; &gt; stk;</span><br><span class="line">    pair&lt;int, int&gt; state;</span><br><span class="line">    int line;	</span><br><span class="line">    stk.push(make_pair(node, 0));</span><br><span class="line">    while(!stk.empty()) &#123;</span><br><span class="line">        state = stk.top(), stk.pop();</span><br><span class="line">        node = state.first, line = state.second&amp;3;</span><br><span class="line">        if(line == 0) &#123;</span><br><span class="line">            int prefix = node &lt;&lt; 1;</span><br><span class="line">            if(g[node][0]) &#123;</span><br><span class="line">                g[node][0]--;</span><br><span class="line">                stk.push(make_pair(node, 1|8));</span><br><span class="line">                stk.push(make_pair((prefix|0)&amp;mask, 0));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                stk.push(make_pair(node, 1));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if(line == 1) &#123;</span><br><span class="line">            if(state.second&amp;8) &#123;</span><br><span class="line">    			*p = (0) +&apos;0&apos;, p++;</span><br><span class="line">            &#125;</span><br><span class="line">            int prefix = node &lt;&lt; 1;</span><br><span class="line">            if(g[node][1]) &#123;</span><br><span class="line">                g[node][1]--;</span><br><span class="line">                stk.push(make_pair(node, 2|8));</span><br><span class="line">                stk.push(make_pair((prefix|1)&amp;mask, 0));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                stk.push(make_pair(node, 2));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if(state.second&amp;8) &#123;</span><br><span class="line">    			*p = (1) +&apos;0&apos;, p++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int MinExp(const char *s, const int slen) &#123;</span><br><span class="line">    int i = 0, j = 1, k = 0, x, y, tmp;</span><br><span class="line">    while(i &lt; slen &amp;&amp; j &lt; slen &amp;&amp; k &lt; slen) &#123;</span><br><span class="line">        x = i + k;</span><br><span class="line">        y = j + k;</span><br><span class="line">        if(x &gt;= slen)    x -= slen;</span><br><span class="line">        if(y &gt;= slen)    y -= slen;</span><br><span class="line">        if(s[x] == s[y]) &#123;</span><br><span class="line">            k++;</span><br><span class="line">        &#125; else if(s[x] &gt; s[y]) &#123;</span><br><span class="line">            i = j+1 &gt; i+k+1 ? j+1 : i+k+1;</span><br><span class="line">            k = 0;</span><br><span class="line">            tmp = i, i = j, j = tmp;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            j = i+1 &gt; j+k+1 ? i+1 : j+k+1;</span><br><span class="line">            k = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return i;</span><br><span class="line">&#125;</span><br><span class="line">void build() &#123;</span><br><span class="line">    for(int n = 1; n &lt; 22; n++) &#123;</span><br><span class="line">        mask = (1&lt;&lt;(n-1)) - 1;</span><br><span class="line">        for(int i = (1&lt;&lt;(n-1)) - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">            g[i][0]++;</span><br><span class="line">            g[i][1]++;</span><br><span class="line">        &#125;</span><br><span class="line">        p = order[0];</span><br><span class="line">        dfs(0);</span><br><span class="line">        *p = &apos;\0&apos;, p++;</span><br><span class="line">        int len = strlen(order[0]);</span><br><span class="line">        for(int i = len - 1, j = 0; i &gt;= 0; i--, j++)</span><br><span class="line">            order[1][i] = order[0][j];</span><br><span class="line">        order[1][len] = &apos;\0&apos;;</span><br><span class="line">        int o1 = MinExp(order[0], len);</span><br><span class="line">        int o2 = MinExp(order[1], len);</span><br><span class="line">        int f = 0;</span><br><span class="line">        for(int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            if(order[0][(o1 + i)%len] != order[1][(o2 + i)%len]) &#123;</span><br><span class="line">                f = order[0][(o1 + i)%len] &gt; order[1][(o2 + i)%len];</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            if(f == 0) &#123;</span><br><span class="line">                ouroboros[n][i] = order[0][(o1 + i)%len];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ouroboros[n][i] = order[1][(o2 + i)%len];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        olen[n] = len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int testcase, K;</span><br><span class="line">    build();</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;testcase);</span><br><span class="line">    while(testcase--) &#123;</span><br><span class="line">        scanf(&quot;%d %d&quot;, &amp;n, &amp;K);</span><br><span class="line">        int ret = 0;</span><br><span class="line">        for(int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            ret = ret &lt;&lt; 1;</span><br><span class="line">            ret |= ouroboros[n][(i + K)%olen[n]] - &apos;0&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%d\n&quot;, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10089" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/05/oj/uva/uva-10089/" class="article-date">
  <time datetime="2014-05-05T00:20:01.000Z" itemprop="datePublished">2014-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/img/1399189276434.jpg" rel="gallery_cipz12uya02iht1xc1g2f7qqi">
        <img src="/img/1399189276434.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/05/oj/uva/uva-10089/">UVa 10089 - Repackaging</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/05/oj/uva/uva-10089/" data-id="cipz12uya02iht1xc1g2f7qqi" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/05/oj/uva/uva-10089/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/方程轉換/">方程轉換</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/極角排序/">極角排序</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <div class="video-container"><iframe src="//www.youtube.com/embed/2k39aeS7qhg" frameborder="0" allowfullscreen></iframe></div>
<p>儘管如此世界依舊美麗 (Still world is beautiful それでもせかいはうつくしい 插曲) ，比預期中的還要好看，可能是人物屬性的關係讓我欲罷不能啊！順帶附了劇中歌曲，詳細請等待 OST，</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Coffee cups of three different sizes (identified as size 1, size 2 and size 3 cups) are produced in factories under ACM (Association of Cup Makers) and are sold in various packages. Each type of package is identified by three positive integers (S1, S2, S3) where Si (1 &lt;= i &lt;= 3) denotes the number of size i cups included in the package. There is no package with S1 = S2 = S3.</p>
<p>But recently it has been discovered that there is a great demand for packages containing equal number cups of all three sizes. So, as an emergency step to meet the demand ACM has decided to unpack the cups from some of the packages stored in its (unlimited) stock of unsold products and repack them in packages having equal number of cups of all three sizes. For example, suppose ACM has the following four types of packages in its stock: (1, 2, 3), (1, 11, 5), (9, 4, 3) and (2, 3, 2). So, one can unpack three (1, 2, 3) packages, one (9, 4, 3) package and two (2, 3, 2) packages and repack the cups to produce sixteen (1, 1, 1) packages. One can even produce eight (2, 2, 2) packages or four (4, 4, 4) packages or two (8, 8, 8) packages or one (16, 16, 16) package or even different combination of packages each containing equal number of size 1, size 2 and size 3 cups. Note that all the unpacked cups are used to produce the new packages, i.e., no unpacked cup is wasted.</p>
<p>ACM has hired you to write a program that will decide whether it is possible to produce packages containing equal number of all three types of cups using all the cups that can be found by unpacking any combination of existing packages in the stock.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input may contain multiple test cases. Each test case begins with a line containing an integer N (3 &lt;= N &lt;= 1000) indicating the number of different types of packages that can be found in the stock. Each of the next N lines contains three positive integers denoting respectively the number of size 1, size 2 and size 3 cups in a package. No two packages in a test case will have the same specification.</p>
<p>A test case containing a zero for N in the first line terminates the input.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case in the input print a line containing “Yes” if packages can be produced as desired, print “No” otherwise.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 2 3</span><br><span class="line">1 11 5</span><br><span class="line">9 4 3</span><br><span class="line">2 3 2</span><br><span class="line">4</span><br><span class="line">1 3 3</span><br><span class="line">1 11 5</span><br><span class="line">9 4 3</span><br><span class="line">2 3 2</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes</span><br><span class="line">No</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>咖啡杯有三種不同大小，出售的時候每一包三者都有不同個數，表示成 (S1, S2, S3) = (小, 中, 大)。</p>
<p>現在要將其重新包裝，每一種包假設有無限個數，問有沒有拆包的方式，滿足</p>
<p><code>x1 * (a1, b1, c1) + ... + xn * (an, bn, cn) = (k, k, k)</code></p>
<p>其中 <code>x[i] &gt;= 0 的非負整數, k 為非負整數</code>，也就是重新包裝後要產生 k 個 (1, 1, 1)，以方便出售。</p>
<p><strong> 題目解法：</strong></p>
<p>整數線性規劃就別來了，畢竟連 <code>k</code> 都沒有確定，解方程也不曉得解集合是否符合條件。</p>
<p>最後，重新考量 (S1, S2, S3)，如果以 S1 為基準，則產生 (S2 - S1, S3 - S1) 的向量。(因為最後還是要跟 S1 的總個數去計算，利用相對數量方式去降維。)，轉換原本的滿足方程 </p>
<p><code>x1 * (y1, z1) + ... + xn * (yn, zn) = (0, 0)</code></p>
<ul>
<li>如果兩個二維向量 <code>(a, b)</code> 和 <code>(c, d)</code>，對於任意 <code>p (a, b) + q (c, d)</code> 的結果可以產生兩個向量間任意角度(&lt;= 180 deg)的向量 (不考慮向量長度，p, q 是非負整數)。</li>
</ul>
<p>明白了上述條件後，將所有包分配至以原點拉出的向量，只要能產生兩個反向向量就可以相消找到 <code>(0, 0)</code> 向量。相消的條件很簡單，使用極角排序，相鄰兩個角度差全小於 <code>pi</code> 即有存在相消情況。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt; </span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int n, S1, S2, S3;</span><br><span class="line">    const double pi = acos(-1);</span><br><span class="line">    while(scanf(&quot;%d&quot;, &amp;n) == 1 &amp;&amp; n) &#123;</span><br><span class="line">        double A[1024];</span><br><span class="line">        for(int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            scanf(&quot;%d %d %d&quot;, &amp;S1, &amp;S2, &amp;S3);</span><br><span class="line">            A[i] = atan2(S2 - S1, S3 - S1);</span><br><span class="line">        &#125;</span><br><span class="line">        sort(A, A + n);</span><br><span class="line">        double gap = 0;</span><br><span class="line">        for(int i = 1; i &lt; n; i++) &#123;</span><br><span class="line">            gap = max(gap, A[i] - A[i-1]);</span><br><span class="line">        &#125;</span><br><span class="line">        gap = max(gap, 2 * pi - (A[n-1] - A[0]));</span><br><span class="line">        puts(gap &gt; pi ? &quot;No&quot; : &quot;Yes&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12544" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/05/oj/uva/uva-12544/" class="article-date">
  <time datetime="2014-05-05T00:03:30.000Z" itemprop="datePublished">2014-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/05/oj/uva/uva-12544/">UVa 12544 - Beehives</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/05/05/oj/uva/uva-12544/" data-id="cipz12vtq02x8t1xcmlmd8czi" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/05/05/oj/uva/uva-12544/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bfs/">bfs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/floyd/">floyd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最小成本環/">最小成本環</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Bees are one of the most industrious insects. Since they collect nectarand pollen from owers, they have to rely on the trees in the forest. For simplicity they numbered the n trees from 0 to n - 1. Instead of roaming around all over the forest, they use a particular list of paths. A path is based on two trees, and they can move either way i.e. from one tree to another in straight line. They don’t use paths thatare not in their list.</p>
<p>As technology has been improved a lot, they also changed their working strategy. Instead of hovering over all the trees in the forest, they are targeting particular trees, mainly trees with lots of owers. So, they planned that they will build some new hives in some targeted trees. After that they will only collect their foods from these trees. They will also remove some paths from their list so that they don’t have to go to a tree with no hive in it.</p>
<p>Now, they want to build the hives such that if one of the paths in their new list go down (some<br>birds or animals disturbs them in that path) it’s still possible to go from any hive to another using the existing paths. </p>
<p>They don’t want to choose less than two trees and as hive-building requires a lot of work, they need to keep the number of hives as low as possible. Now you are given the trees with the paths they use, your task is to propose a new bee hive colony for them.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>Input starts with an integer T( T &lt; 50), denoting the number of test cases.</p>
<p>Each case starts with a blank line. Next line contains two integers n (2 &lt;= n &lt;= 500) and m (0 &lt; m&lt; 20000), where n denotes the number of trees and m denotes the number of paths. Each of the next m lines contains two integers uv (0 &lt; u , v &lt; n), u = v) meaning that there is a path between tree u and v. Assume that there can be at most one path between tree u to v, and needless to say that a path will not be given more than once in the input. </p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each case, print the case number and the number of beehives in the proposed colony or <code>impossible</code> if its impossible to find such a colony.<br>NOTE:<br>Dataset is huge. Use faster I/O methods.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3 3</span><br><span class="line">0 1</span><br><span class="line">1 2</span><br><span class="line">2 0</span><br><span class="line">2 1</span><br><span class="line">0 1</span><br><span class="line">5 6</span><br><span class="line">0 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">2 3</span><br><span class="line">0 4</span><br><span class="line">3 4</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Case 1: 3</span><br><span class="line">Case 2: impossible</span><br><span class="line">Case 3: 3</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong> 題目描述：</strong></p>
<p>在一個無向圖中，找到一個成本最小環。</p>
<p><strong> 題目解法：</strong></p>
<p>Floyd 解法：<br>先來附一個錯誤版本，可以在 <code>O(n^3)</code> 解決，核心思路在於討論路徑上經過編號小於等於 k 時，同時探討最小環上經過編號 k 個所有環。但由於 <code>n = 500</code> 在此題中效率不好，但也不知道為什麼拿了 <code>Runtime Error</code> </p>
<figure class="highlight cpp"><figcaption><span>TLE version</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> g[<span class="number">512</span>][<span class="number">512</span>], w[<span class="number">512</span>][<span class="number">512</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> n, m, x, y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span>(testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">                g[i][j] = w[i][j] = <span class="number">0xf3f3f3f</span>;</span><br><span class="line">        <span class="keyword">while</span>(m--) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</span><br><span class="line">            w[x][y] = w[y][x] = g[x][y] = g[y][x] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0xf3f3f3f</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(i != j)</span><br><span class="line">                        ret = min(ret, w[k][i] + g[i][j] + w[j][k]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">                    g[i][j] = min(g[i][j], g[i][k] + g[k][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: "</span>, ++cases);</span><br><span class="line">        <span class="keyword">if</span>(ret == <span class="number">0xf3f3f3f</span>)</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"impossible"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BFS 作法：<br>Floyd 用在成本不同的路徑上是有效的，但是在成本都是 1 的時候就有點太過了，使用 BFS 對於每一個點進行最短路徑，查看路徑樹上是否有 <code>back edge</code>。整體可以在 <code>O(n^2)</code> 完成，這個 <code>back edge</code> 可能會造成有重複走過點的環，但是不影響我們去找到最小成本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt; </span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;algorithm&gt; </span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">vector&lt;int&gt; g[512];</span><br><span class="line">int dist[512], parent[512];</span><br><span class="line">int bfs(int st, int &amp;ret) &#123;</span><br><span class="line">    memset(dist, 0, sizeof(dist));</span><br><span class="line">    dist[st] = 1, parent[st] = -1;</span><br><span class="line">    queue&lt;int&gt; Q;</span><br><span class="line">    Q.push(st);</span><br><span class="line">    while(!Q.empty()) &#123;</span><br><span class="line">        int u = Q.front();</span><br><span class="line">        Q.pop();</span><br><span class="line">        for(int i = 0; i &lt; g[u].size(); i++) &#123;</span><br><span class="line">            int v = g[u][i];</span><br><span class="line">            if(v == parent[u])	continue;</span><br><span class="line">            if(dist[v] == 0) &#123;</span><br><span class="line">                dist[v] = dist[u] + 1;</span><br><span class="line">                parent[v] = u;</span><br><span class="line">                Q.push(v);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ret = min(ret, dist[u] + dist[v] - 1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int testcase, cases = 0;</span><br><span class="line">    int n, m, x, y;</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;testcase);</span><br><span class="line">    while(testcase--) &#123;</span><br><span class="line">        scanf(&quot;%d %d&quot;, &amp;n, &amp;m);</span><br><span class="line">        for(int i = 0; i &lt; n; i++)</span><br><span class="line">            g[i].clear();</span><br><span class="line">        while(m--) &#123;</span><br><span class="line">            scanf(&quot;%d %d&quot;, &amp;x, &amp;y);</span><br><span class="line">            g[x].push_back(y);</span><br><span class="line">            g[y].push_back(x);</span><br><span class="line">        &#125;</span><br><span class="line">        int ret = n + 1;</span><br><span class="line">        for(int i = 0; i &lt; n; i++)</span><br><span class="line">            bfs(i, ret);</span><br><span class="line">        printf(&quot;Case %d: &quot;, ++cases);</span><br><span class="line">        if(ret == n + 1)</span><br><span class="line">            puts(&quot;impossible&quot;);</span><br><span class="line">        else</span><br><span class="line">            printf(&quot;%d\n&quot;, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/72/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/71/">71</a><a class="page-number" href="/page/72/">72</a><span class="page-number current">73</span><a class="page-number" href="/page/74/">74</a><a class="page-number" href="/page/75/">75</a><span class="space">&hellip;</span><a class="page-number" href="/page/77/">77</a><a class="extend next" rel="next" href="/page/74/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">107</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">37</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">617</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">479</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10113/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10113. Longest Common Subsequence II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10112/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10112. Longest Common Subsequence (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10111/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10111. Longest Common Subsequence II (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10110/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10110. Longest Common Subsequence (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10109/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10109. Sorting (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10108/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10108. Streams and Concurrency II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10107/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10107. Sparse Matrix Multiplication (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10106/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10106. Multiple Device (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10104/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10104. Streams and Concurrency (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10103/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10103. Advanced Matrix Calculator (CUDA)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>