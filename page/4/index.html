<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/page/4/index.html">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description">
<link rel="publisher" href="108158678174364350000">
  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="shortcut icon" href="/img/f.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-uva-13015" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13015/" class="article-date">
  <time datetime="2016-06-24T05:30:03.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13015/">UVa 13015 - Promotions</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13015/" data-id="cipz12tge00ojt1xcc5pfbham" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13015/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DAG/">DAG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/拓撲/">拓撲</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>有 <span>$N$</span><!-- Has MathJax --> 名員工，他們彼此之間會推薦、相互提拔對方，因此站在公司的角度來看，提拔順序不能違反這張圖的上下關係，亦即若要提拔某人，其推薦他的人全部都要被提拔。請問若要提拔 $A$ 個人，有哪些人一定會被提拔，同樣的，回答提拔 $B$ 個人的情況，最後回答，若提拔 $B$ 個人，誰一定不會被提拔？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">3  4  7  8</span><br><span class="line">0  4</span><br><span class="line">1  2</span><br><span class="line">1  5</span><br><span class="line">5  2</span><br><span class="line">6  4</span><br><span class="line">0  1</span><br><span class="line">2  3</span><br><span class="line">4  5</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">4</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>一定是張 DAG，否則不能處理。對於輸入多存一張反向圖，接著每一次都去找其下屬節點有多少個，藉此構造出任何提拔方案中，最好和最差排名為多少。處理全部排名計算 <span>$\mathcal{O}(V^2 E)$</span><!-- Has MathJax --></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// O(VE)</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5005</span>;</span><br><span class="line"><span class="keyword">int</span> A, B, E, P;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXN], invG[MAXN];</span><br><span class="line"><span class="keyword">int</span> used[MAXN] = &#123;&#125;, cases = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; g[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (used[u] == cases)	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    used[u] = cases;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : g[u])</span><br><span class="line">        ret += dfs(v, g);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;A, &amp;B, &amp;E, &amp;P) == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++)</span><br><span class="line">            G[i].clear(), invG[i].clear();</span><br><span class="line">        <span class="comment">// Must DAG</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; P; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;x, &amp;y);</span><br><span class="line">            G[x].push_back(y), invG[y].push_back(x);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> retA = <span class="number">0</span>, retB = <span class="number">0</span>, retN = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> worst, best;</span><br><span class="line">            cases++;</span><br><span class="line">            worst = E - dfs(i, G) + <span class="number">1</span>;</span><br><span class="line">            cases++;</span><br><span class="line">            best = dfs(i, invG);</span><br><span class="line">            <span class="keyword">if</span> (worst &lt;= A)	retA++;</span><br><span class="line">            <span class="keyword">if</span> (worst &lt;= B)	retB++;</span><br><span class="line">            <span class="keyword">if</span> (best &gt; B)	retN++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n%d\n%d\n"</span>, retA, retB, retN);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13024" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13024/" class="article-date">
  <time datetime="2016-06-24T04:02:04.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13024/">UVa 13024 - Saint John Festival</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13024/" data-id="cipz12tgr00oqt1xciy4gq333" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13024/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分/">二分</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/凸包/">凸包</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給予 <span>$N$</span><!-- Has MathJax --> 個大天燈的所在位置，隨後有 <span>$Q$</span><!-- Has MathJax --> 個小天燈位置，施放天燈後，請問有多少小天燈處於任三個天燈構成的三角形內部？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">3  4</span><br><span class="line">2  8</span><br><span class="line">5  4</span><br><span class="line">1  8</span><br><span class="line">4  7</span><br><span class="line">3  10</span><br><span class="line">11  2</span><br><span class="line">7  3</span><br><span class="line">6</span><br><span class="line">5  12</span><br><span class="line">3  7</span><br><span class="line">3  3</span><br><span class="line">4  5</span><br><span class="line">0  4</span><br><span class="line">2  6</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>由於只詢問任意三個點構成的三角形內部，貪心就能想到一定是挑選凸包上的三點，只需要判定某點是不是在凸包內部，由於所有天燈已經給定，只需要跑一次 <span>$\mathcal{O}(N \log N)$</span><!-- Has MathJax --> 凸包算法，接著詢問一點是否在凸包內，只需要 <span>$\mathcal{O}(\log N)$</span><!-- Has MathJax -->。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">#define eps 1e-10</span><br><span class="line">struct Pt &#123;</span><br><span class="line">    double x, y;</span><br><span class="line">    Pt(double a = 0, double b = 0):</span><br><span class="line">    x(a), y(b) &#123;&#125;</span><br><span class="line">    bool operator&lt;(const Pt &amp;a) const &#123;</span><br><span class="line">        if (fabs(x-a.x) &gt; eps)	return x &lt; a.x;</span><br><span class="line">        return y &lt; a.y;</span><br><span class="line">    &#125;</span><br><span class="line">    bool operator==(const Pt &amp;a) const &#123;</span><br><span class="line">        return fabs(x-a.x) &lt; eps &amp;&amp; fabs(y-a.y) &lt; eps;</span><br><span class="line">    &#125;</span><br><span class="line">    Pt operator+(const Pt &amp;a) const &#123;</span><br><span class="line">        return Pt(x + a.x, y + a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt operator-(const Pt &amp;a) const &#123;</span><br><span class="line">        return Pt(x - a.x, y - a.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt operator/(const double val) const &#123;</span><br><span class="line">        return Pt(x / val, y / val);</span><br><span class="line">    &#125;</span><br><span class="line">    Pt operator*(const double val) const &#123;</span><br><span class="line">        return Pt(x * val, y * val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">double cross(Pt o, Pt a, Pt b) &#123;</span><br><span class="line">    return (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</span><br><span class="line">&#125;</span><br><span class="line">int monotone(int n, Pt p[], Pt ch[]) &#123;</span><br><span class="line">    sort(p, p+n);</span><br><span class="line">    int i, m = 0, t;</span><br><span class="line">    for (i = 0; i &lt; n; i++) &#123;</span><br><span class="line">        while(m &gt;= 2 &amp;&amp; cross(ch[m-2], ch[m-1], p[i]) &lt;= 0)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i = n-1, t = m+1; i &gt;= 0; i--) &#123;</span><br><span class="line">        while(m &gt;= t &amp;&amp; cross(ch[m-2], ch[m-1], p[i]) &lt;= 0)</span><br><span class="line">            m--;</span><br><span class="line">        ch[m++] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return m-1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">double g(Pt a, Pt b, double x) &#123;</span><br><span class="line">    Pt vab = b - a;</span><br><span class="line">    return a.y + vab.y * (x - a.x) / vab.x;</span><br><span class="line">&#125;</span><br><span class="line">int inside_convex(const Pt &amp;p, Pt ch[], int n) &#123;</span><br><span class="line">    if (n &lt; 3)</span><br><span class="line">        return false;</span><br><span class="line">    if (cross(ch[0], p, ch[1]) &gt; eps)</span><br><span class="line">        return false;</span><br><span class="line">    if (cross(ch[0], p, ch[n-1]) &lt; -eps)</span><br><span class="line">        return false;</span><br><span class="line">    </span><br><span class="line">    int l = 2, r = n-1;</span><br><span class="line">    int line = -1;</span><br><span class="line">    while (l &lt;= r) &#123;</span><br><span class="line">        int mid = (l + r)&gt;&gt;1;</span><br><span class="line">        if (cross(ch[0],p, ch[mid]) &gt; -eps) &#123;</span><br><span class="line">            line = mid;</span><br><span class="line">            r = mid - 1;</span><br><span class="line">        &#125; else l = mid + 1;</span><br><span class="line">    &#125;</span><br><span class="line">    return cross(ch[line-1], p, ch[line]) &lt; eps;</span><br><span class="line">&#125;</span><br><span class="line">Pt D[131072], ch[262144];</span><br><span class="line">int main() &#123;</span><br><span class="line">    int testcase, n, m;</span><br><span class="line">    double x, y;</span><br><span class="line">    while (scanf("%d", &amp;n) == 1) &#123;</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            scanf("%lf %lf", &amp;x, &amp;y);</span><br><span class="line">            D[i] = Pt(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">        n = monotone(n, D, ch);</span><br><span class="line">        scanf("%d", &amp;m);</span><br><span class="line">        int ret = 0;</span><br><span class="line">        for (int i = 0; i &lt; m; i++) &#123;</span><br><span class="line">            scanf("%lf %lf", &amp;x, &amp;y);</span><br><span class="line">            int f = inside_convex(Pt(x, y), ch, n);</span><br><span class="line">            ret += f;</span><br><span class="line">        &#125;        </span><br><span class="line">        printf("%d\n", ret);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13029" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13029/" class="article-date">
  <time datetime="2016-06-24T03:46:12.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13029/">UVa 13029 - Emoticons</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13029/" data-id="cipz12tgy00oxt1xcdri4f2pm" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13029/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>給一個由 <code>^</code>, <code>_</code> 構成的字串，請湊出最多的 <code>^_^</code> 子字串。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">_^^_^^_</span><br><span class="line">^__^__^</span><br><span class="line">______</span><br><span class="line">^^__^^</span><br><span class="line">^_^^_^</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Case 1: 1</span><br><span class="line">Case 2: 1</span><br><span class="line">Case 3: 0</span><br><span class="line">Case 4: 2</span><br><span class="line">Case 5: 2</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>從左掃瞄到右邊，貪心著手容易得到兩種狀態</p>
<ul>
<li><span>$h1$</span><!-- Has MathJax -->: <code>^</code> 的個數。</li>
<li><span>$h2$</span><!-- Has MathJax -->: 湊成 <code>^???_</code> 的個數，可以從 <span>$h1$</span><!-- Has MathJax --> 合併 <code>_</code> 構成。</li>
</ul>
<p>然而有一些特殊案例 <code>^_^_^^</code>，需要重新排列，他們之間有巢狀關係 <code>(^_(^_^)^)</code>，因此建立狀態 <span>$h3$</span><!-- Has MathJax --> 為 <code>^_^???_</code>，若遇到下一個 <code>^</code> 貪心拆解成 <code>(^_(^_^)???)</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> s[<span class="number">131072</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</span><br><span class="line">        <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> h1 = <span class="number">0</span>, h2 = <span class="number">0</span>, h3 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">'^'</span> &amp;&amp; h2) &#123;</span><br><span class="line">                h2--, ret++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">'^'</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (h3 &amp;&amp; ret)</span><br><span class="line">                    h2++, h3--;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    h1++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">'_'</span> &amp;&amp; h1) &#123;</span><br><span class="line">                h1--, h2++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">'_'</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ret &gt; h3)</span><br><span class="line">                    h3++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case %d: %d\n"</span>, ++cases, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13017" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13017/" class="article-date">
  <time datetime="2016-06-24T03:21:27.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13017/">UVa 13017 - Canvas Painting</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13017/" data-id="cipz12tgo00omt1xcf36pp88b" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13017/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/霍夫曼編碼/">霍夫曼編碼</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>有 $N$ 塊畫布排成一列，並且目標將每一塊畫布變成不同顏色，每一次可以將一個區間塗成相同顏色，花費便是區間 <span>$C_i$</span><!-- Has MathJax --> 總和，請問最少花費為何。</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br><span class="line">7  4  7</span><br><span class="line">4</span><br><span class="line">5  3  7  5</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">29</span><br><span class="line">40</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>每一次最多完成一個不同顏色的畫布，那麼著色解法看來就是二元樹，每一個畫布處於葉節點，因此最少花費就相當於編碼長度乘上葉權重最少。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// Huffman Coding, Greedy</span></span><br><span class="line"><span class="comment">// input A[1...n]</span></span><br><span class="line"><span class="comment">// minimum \sum A[i]*code[i]</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> testcase;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</span><br><span class="line">    <span class="keyword">while</span> (testcase--) &#123;</span><br><span class="line">        <span class="keyword">int</span> n, x;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> t;</span><br><span class="line">        <span class="built_in">multiset</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; S;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), S.insert(x);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a, b;</span><br><span class="line">            a = *S.begin();</span><br><span class="line">            S.erase(S.begin());</span><br><span class="line">            b = *S.begin();</span><br><span class="line">            S.erase(S.begin());</span><br><span class="line">            ret += a+b;</span><br><span class="line">            S.insert(a+b);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-uva-13079" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/uva-13079/" class="article-date">
  <time datetime="2016-06-24T03:11:55.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/uva-13079/">UVa 13079 - On the beach</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/uva-13079/" data-id="cipz12thf00pkt1xcotgcqpjl" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/uva-13079/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/貪心/">貪心</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>在炎炎夏日的海邊，需要建立地下通道，把所有海岸飯店聯通在一起，請問最少地下通道個數為何？</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1  4</span><br><span class="line">6  15</span><br><span class="line">2  10</span><br><span class="line">12  20</span><br><span class="line">2</span><br><span class="line">1  4</span><br><span class="line">4  8</span><br><span class="line">2</span><br><span class="line">1  4</span><br><span class="line">3  8</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>把這些區間排序，根據左端點由小到大開始貪心，可行解若看成一個區間，隨著區間加入，右端點會逐漸地靠近左端點，若產生無解，勢必要建立一個新通道。不斷地貪心，最後可得到最少通道個數。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span> &amp;&amp; N) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; A;</span><br><span class="line">        <span class="keyword">int</span> L, R;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;L, &amp;R);</span><br><span class="line">            A.push_back(make_pair(L, R));</span><br><span class="line">        &#125;</span><br><span class="line">        sort(A.begin(), A.end());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> PQ = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> line_x = A[i].first;</span><br><span class="line">            <span class="keyword">if</span> (PQ != INT_MAX &amp;&amp; PQ &lt;= line_x) &#123;</span><br><span class="line">                ret++;</span><br><span class="line">                PQ = INT_MAX;</span><br><span class="line">            &#125;</span><br><span class="line">            PQ = min(PQ, A[i].second);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (PQ != INT_MAX)</span><br><span class="line">            ret++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10038" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/jg-10038/" class="article-date">
  <time datetime="2016-06-24T02:28:47.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a>
  </div>

  </div>
  <div class="article-inner ">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="http://i.imgur.com/fR0IDd3.jpg" rel="gallery_cipz12szn003tt1xcdkzox18y">
        <img src="http://i.imgur.com/fR0IDd3.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/jg-10038/">批改娘 10038. Fast Covering Problem</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/06/24/jg-10038/" data-id="cipz12szn003tt1xcdkzox18y" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/06/24/jg-10038/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DLX/">DLX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/branch-and-reduce-algorithm/">branch-and-reduce algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最少重複覆蓋/">最少重複覆蓋</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/最少點集覆蓋/">最少點集覆蓋</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目背景"><a href="#題目背景" class="headerlink" title="題目背景"></a>題目背景</h2><p>終於把所有練習題都放上 Judge Girl，測資都已經確認過一遍，某 M 打算離開一陣子。「反正是個令人唾棄的助教吧 …」</p>
<h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>考試出題總很難讓所有人滿意，老師決定給予學生們選擇考試出題方向，但每一個人只能提出兩種意見，接著老師會出一套方案滿足每一位學生的其中一種意見。由於出一套題步驟繁瑣，把數個意見出在同一題非常困難，最後每一種意見將單獨被出成一道題。</p>
<p>由於助教們要負責出測資、檢驗測資正確與可行性，希望題目數量越少越好，否則助教會忙翻天。現在要找到最少題目來滿足所有學生的需求。</p>
<p>例如 :</p>
<ul>
<li>現在有 4 名學生的意見</li>
<li>四名學生分別提案 $(0, 1), (100, 1), (100, 0), (100, 200)$</li>
<li>如果選擇 ${ 0, 100 }$ 或者是 ${ 1, 100 }$ 都是最好的選擇，助教只需要完成 2 題的檢驗。相反地，如果 ${0, 100, 200 }$ 雖然可以滿足所有學生，但需要出成 3 道題目。</li>
</ul>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>只有一組測資，每組第一行會有一個整數 $N$，表示有多少位學生，接下來會有 $N$ 行，每 $i$ 行上會有兩個整數 $A_i, B_i$ 表示第 $i$ 個學生的出題意見。</p>
<ul>
<li>$0 &lt; N \le 1000$</li>
<li>$0 \le A_i, \; B_i \le 10000$</li>
<li>意見類型總數不超過 100 種</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每一組測資輸出一行，表示最少要準備的方案數量能滿足所有學生。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">0 1</span><br><span class="line">100 1</span><br><span class="line">100 0</span><br><span class="line">100 200</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>DLX </p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>當年在 NCPC 搞不出來的 Problem I Christmas Gifts (NP-hard)，在賽後用 DLX 運行效果不錯，在啟發函數加上延遲標記更是屹立排名前數位已久。最近又因為平行把題目挖回來討論，在去年釣到大一學弟來解，便以飛快的速度擊破測資，最後達到加速 20x。再把當初需要跑 30 秒的測資來運行，現在只需要短短的 50ms。</p>
<blockquote>
<p>原本要拿來出平行題目，看到這麼驚人的速度，想必就不要出題。</p>
</blockquote>
<p>通用解法 DLX 加上啟發式函數就能解決最少重複覆蓋，然而在圖論的最少點集覆蓋問題中，性質又變得更加強烈。當不選某一個點時，必然與其相連的邊為了要覆蓋，另一端必然成為必選點。這時候搜索空間大幅度地下降。若在一般 DLX 算法中提及的最少可能的列中，窮舉某行來覆蓋一些列，那麼就很難看到搜索空間下降的性質。</p>
<p>因此，步驟簡單分成下列步驟：</p>
<ol>
<li>將圖轉換成某行可以覆蓋哪幾列，轉換成 Dancing Links 的格式</li>
<li>找到可以覆蓋最多尚未覆蓋列最多的那一行<ol>
<li>選擇這一行，並且移除這一行所有覆蓋列，遞迴窮舉。</li>
<li>移除這一行，選擇必選行，並嘗試移除等價行。</li>
</ol>
</li>
</ol>
<hr>
<p>附錄：和交通大學謝旻錚(Min-Zheng Shieh) 教練的討論</p>
<blockquote>
<p>在想確實能用 dancing links 來搞，還要搭配維護 degree order，不過這算法吳邦一老師是說 worst case 為 3 regular graph。<br>另外先前找過日本人 iwi 的論文，他也搞了個高級 VC solver 並做了測試，詳見論文 Branch-and-reduce exponential/FPT algorithms in practice: A case study of vertex cover, Takuya Akiba, Yoichi Iwata </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXNODE 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXCOL 5005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 5005</span></span><br><span class="line"><span class="keyword">struct</span> DancingNode &#123;</span><br><span class="line">    <span class="keyword">int</span> left, right, up, down;</span><br><span class="line">    <span class="keyword">int</span> ch, rh;</span><br><span class="line">&#125; DL[MAXNODE];</span><br><span class="line"><span class="keyword">struct</span> HelperNode &#123;</span><br><span class="line">    <span class="keyword">int</span> head, size, next, prev;</span><br><span class="line">&#125; HN[MAXNODE];</span><br><span class="line"><span class="keyword">int</span> help_head;</span><br><span class="line"><span class="keyword">int</span> s[MAXCOL];</span><br><span class="line"><span class="keyword">int</span> head, size, Ans, Dep;</span><br><span class="line"><span class="keyword">int</span> markStk[MAXNODE], markIdx = <span class="number">-1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</span><br><span class="line">    		HN[DL[i].rh].head = DL[i].left;</span><br><span class="line">    	HN[DL[i].rh].size--;</span><br><span class="line">        DL[DL[i].right].left = DL[i].left;</span><br><span class="line">        DL[DL[i].left].right = DL[i].right;</span><br><span class="line">        s[DL[i].ch]--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Resume</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (HN[DL[i].rh].head == i)</span><br><span class="line">    		HN[DL[i].rh].head = DL[i].right;</span><br><span class="line">    	HN[DL[i].rh].size++;</span><br><span class="line">        DL[DL[i].right].left = i;</span><br><span class="line">        DL[DL[i].left].right = i;</span><br><span class="line">        s[DL[i].ch]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reduce</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = DL[i].rh;</span><br><span class="line">    HN[HN[t].next].prev = HN[t].prev;</span><br><span class="line">    HN[HN[t].prev].next = HN[t].next;</span><br><span class="line">    s[DL[i].ch]--;</span><br><span class="line">    DL[DL[i].down].up = DL[i].up;</span><br><span class="line">    DL[DL[i].up].down = DL[i].down;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</span><br><span class="line">        DL[DL[k].down].up = DL[k].up;</span><br><span class="line">        DL[DL[k].up].down = DL[k].down;</span><br><span class="line">        s[DL[k].ch]--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Recover</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = DL[i].rh;</span><br><span class="line">    HN[HN[t].next].prev = t;</span><br><span class="line">    HN[HN[t].prev].next = t;</span><br><span class="line">    s[DL[i].ch]++;</span><br><span class="line">    DL[DL[i].down].up = i;</span><br><span class="line">    DL[DL[i].up].down = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[i].right; k != i; k = DL[k].right) &#123;</span><br><span class="line">        DL[DL[k].down].up = k;</span><br><span class="line">        DL[DL[k].up].down = k;</span><br><span class="line">        s[DL[k].ch]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Select</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = DL[i].rh;</span><br><span class="line">    HN[HN[s].next].prev = HN[s].prev;</span><br><span class="line">    HN[HN[s].prev].next = HN[s].next;</span><br><span class="line">    Remove(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</span><br><span class="line">        Remove(j);</span><br><span class="line">    Dep++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cancel</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = DL[i].rh;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</span><br><span class="line">        Resume(j);</span><br><span class="line">    Resume(i);    </span><br><span class="line">    HN[HN[s].next].prev = s;</span><br><span class="line">    HN[HN[s].prev].next = s;</span><br><span class="line">    Dep--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Decision</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> has = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="number">1</span>) &#123;</span><br><span class="line">            Select(DL[i].down);</span><br><span class="line">            markStk[++markIdx] = DL[i].down;</span><br><span class="line">            has = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> has;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Subset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;	<span class="comment">// 0: x in y, 1: y in x </span></span><br><span class="line">    assert(DL[x].ch == DL[y].ch);</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (i = DL[x].right, j = DL[y].right; i != x &amp;&amp; j != y; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DL[i].ch == DL[j].ch)</span><br><span class="line">            i = DL[i].right, j = DL[j].right;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (DL[i].ch &lt; DL[j].ch)</span><br><span class="line">            i = DL[i].right, a = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            j = DL[j].right, b = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (a &amp;&amp; b)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i != x)    a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (j != y)    b = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> a || b ? (a - b) : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Duplicate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> has = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].down; j != i; j = DL[j].down) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = DL[j].down; k != j &amp;&amp; k != i; k = DL[k].down) &#123;</span><br><span class="line">                <span class="keyword">int</span> cmp = Subset(j, k);</span><br><span class="line">                <span class="keyword">if</span> (cmp == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (cmp == <span class="number">1</span>) &#123;</span><br><span class="line">                	markStk[++markIdx] = j;</span><br><span class="line">                	Select(j);</span><br><span class="line">            	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            		markStk[++markIdx] = k;</span><br><span class="line">                	Select(k);</span><br><span class="line">                &#125;</span><br><span class="line">                has = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> has;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">H</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c, ret, i, j, time = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> used[MAXCOL] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (c = DL[head].right, ++time, ret = <span class="number">0</span>; c != head; c = DL[c].right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (used[c] == time)</span><br><span class="line">        	<span class="keyword">continue</span>;</span><br><span class="line">    	ret ++, used[c] = time;</span><br><span class="line">    	<span class="keyword">if</span> (ret &gt;= limit)	<span class="keyword">return</span> ret;</span><br><span class="line">        <span class="keyword">for</span> (i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = DL[i].right; j != i; j = DL[j].right)</span><br><span class="line">            	used[DL[j].ch] = time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> hval = H(Ans - Dep);</span><br><span class="line">    <span class="keyword">if</span> (DL[head].right == head &amp;&amp; Dep &lt; Ans)</span><br><span class="line">    	Ans = Dep;</span><br><span class="line">    <span class="keyword">if</span> (Dep + hval &gt;= Ans)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> cover_max = <span class="number">-1</span>, cover_idx = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = HN[help_head].next; i != help_head; i = HN[i].next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (HN[i].size &gt; cover_max) &#123;</span><br><span class="line">            cover_max = HN[i].size;</span><br><span class="line">            cover_idx = HN[i].head;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Select(cover_idx);</span><br><span class="line">    DFS();</span><br><span class="line">    Cancel(cover_idx);</span><br><span class="line">    </span><br><span class="line">    Reduce(cover_idx);</span><br><span class="line">    <span class="keyword">int</span> markEsp = markIdx;</span><br><span class="line">    <span class="keyword">while</span> (!Decision() &amp;&amp; !Duplicate());</span><br><span class="line">    DFS();</span><br><span class="line">    <span class="keyword">while</span> (markIdx &gt; markEsp)</span><br><span class="line">        Cancel(markStk[markIdx--]);</span><br><span class="line">    Recover(cover_idx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">new_node</span><span class="params">(<span class="keyword">int</span> up, <span class="keyword">int</span> down, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    DL[size].up = up, DL[size].down = down;</span><br><span class="line">    DL[size].left = left, DL[size].right = right;</span><br><span class="line">    DL[up].down = DL[down].up = DL[left].right = DL[right].left = size;</span><br><span class="line">    <span class="keyword">return</span> size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">new_row</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> Row[], <span class="keyword">int</span> rh)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r, row = <span class="number">-1</span>, k;</span><br><span class="line">    <span class="keyword">int</span> h = size;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        r = Row[i];</span><br><span class="line">        DL[size].ch = r, s[r]++;</span><br><span class="line">        DL[size].rh = rh;</span><br><span class="line">        <span class="keyword">if</span> (row == <span class="number">-1</span>) &#123;</span><br><span class="line">            row = new_node(DL[DL[r].ch].up, DL[r].ch, size, size);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            k = new_node(DL[DL[r].ch].up, DL[r].ch, DL[row].left, row);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    HN[rh].size = n;</span><br><span class="line">    HN[rh].head = h;</span><br><span class="line">    HN[rh].next = HN[help_head].next;</span><br><span class="line">    HN[rh].prev = help_head;</span><br><span class="line">    HN[HN[help_head].next].prev = rh;</span><br><span class="line">    HN[help_head].next = rh;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    help_head = <span class="number">0</span>, HN[help_head].next = HN[help_head].prev = help_head;</span><br><span class="line">    head = new_node(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        new_node(i, i, DL[head].left, head);</span><br><span class="line">        DL[i].ch = i, s[i] = <span class="number">0</span>;</span><br><span class="line">        DL[i].rh = <span class="number">0</span>;	<span class="comment">// important pointer (fail pointer)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) == <span class="number">1</span> &amp;&amp; n) &#123;</span><br><span class="line">    	<span class="keyword">int</span> A[MAXN], B[MAXN];</span><br><span class="line">        <span class="keyword">int</span> toy[<span class="number">10005</span>] = &#123;&#125;, R[MAXCOL];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;A[i], &amp;B[i]);</span><br><span class="line">            toy[A[i]]++, toy[B[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        init(n);</span><br><span class="line">        <span class="keyword">int</span> run_id = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> nt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (A[j] == i || B[j] == i)</span><br><span class="line">                    R[nt++] = j;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nt) &#123;</span><br><span class="line">                run_id++;</span><br><span class="line">                new_row(nt, R, run_id);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Ans = n;</span><br><span class="line">        Dep = <span class="number">0</span>, markIdx = <span class="number">-1</span>;</span><br><span class="line">        Decision();</span><br><span class="line">        DFS();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, Ans);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10093" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10093/" class="article-date">
  <time datetime="2016-04-30T07:07:14.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10093/">批改娘 10093. Fast Matrix Chain Multiplication (OpenMP)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10093/" data-id="cipz12t0u0052t1xcpvn13wua" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10093/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>計算矩陣鏈乘積 <span>$A_{r_1, c_1} B_{r_2, c_2} \cdots$</span><!-- Has MathJax --> 的值。</p>
<h3 id="sample-c"><a href="#sample-c" class="headerlink" title="sample.c"></a>sample.c</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generate matrix, row-major</span></span><br><span class="line"><span class="keyword">uint32_t</span>* rand_gen(<span class="keyword">uint32_t</span> seed, <span class="keyword">int</span> R, <span class="keyword">int</span> C) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *m = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * R*C);</span><br><span class="line">    <span class="keyword">uint32_t</span> x = <span class="number">2</span>, n = R*C;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; C; j++) &#123;</span><br><span class="line">            x = (x * x + seed + i + j)%n;</span><br><span class="line">            m[i*C + j] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> hash(<span class="keyword">uint32_t</span> x) &#123;</span><br><span class="line">    <span class="keyword">return</span> (x * <span class="number">2654435761L</span>U);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="keyword">uint32_t</span> signature(<span class="keyword">uint32_t</span> *A, <span class="keyword">int</span> r, <span class="keyword">int</span> c) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</span><br><span class="line">            h = hash(h + A[i*c + j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>有多組測資，每組第一行會有一個整數 $N$ 表示矩陣鏈上有 $N$ 個矩陣，第二行上會有 $N+1$ 個整數 $Z_i$，表示矩陣鏈的每一個行列大小，例如當 $N = 3$ 時，輸入 <code>10 30 5 60</code> 表示矩陣 <span>$A_{10, 30} B_{30, 5} C_{5, 60}$</span><!-- Has MathJax --> 相乘。第三行會有 $N$ 個整數，第 $i$ 個整數 <span>$S_i$</span><!-- Has MathJax --> 為第 $i$ 個矩陣生成種子。</p>
<ul>
<li>$1 \le N \le 100$</li>
<li><span>$1 \le Z_i \le 1000$</span><!-- Has MathJax --></li>
<li><span>$0 \le S_i \le 32767$</span><!-- Has MathJax -->
</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每組測資輸出一行，將最後的矩陣結果輸出雜湊值。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">2 2 2</span><br><span class="line">2 5</span><br><span class="line"></span><br><span class="line">3</span><br><span class="line">10 30 5 60</span><br><span class="line">0 0 0</span><br><span class="line"></span><br><span class="line">3</span><br><span class="line">1 5 20 1</span><br><span class="line">0 0 0</span><br><span class="line"></span><br><span class="line">3</span><br><span class="line">5 10 20 35</span><br><span class="line">0 0 0 </span><br><span class="line"></span><br><span class="line">6</span><br><span class="line">30 35 15 5 10 20 25</span><br><span class="line">0 0 0 0 0 0</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">573770929</span><br><span class="line">1762797124</span><br><span class="line">1738984832</span><br><span class="line">354147713</span><br><span class="line">3544048495</span><br></pre></td></tr></table></figure>
<h2 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h2><blockquote>
<p>輸出請用 <code>printf(&quot;%u&quot;, answer);</code>，計算 Dynamic Programming 時，請使用 64-bit 型態紀錄，因為最慘情況下會超過 32-bit 所能容納的範圍。</p>
</blockquote>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>充分地運用當初在演算法學到的，計算矩陣鍊乘積的最少乘法數，接著再針對優化後的乘法順序進行平行。平行可以從單純矩陣乘法，又或者針對可以同時進行矩陣乘法操作開始。甚至可以套用編譯器學到的最少暫存器算法，想辦法從少量的空間換取好的快取效果。</p>
<p>下述程式只針對矩陣乘法計算平行，而非兩個乘法同時進行，其一原因在於很難保證 load balance。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 128</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOOP_UNROLL 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF (1LL&lt;&lt;60)</span></span><br><span class="line"><span class="keyword">int</span> N, SZ[MAXN], SEED[MAXN];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[MAXN][MAXN] = &#123;&#125;;</span><br><span class="line"><span class="keyword">int</span> argdp[MAXN][MAXN];</span><br><span class="line"><span class="keyword">uint32_t</span>* rand_gen(<span class="keyword">uint32_t</span> c, <span class="keyword">int</span> R, <span class="keyword">int</span> C) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *m = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * R*C);</span><br><span class="line">    assert(m != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">uint32_t</span> x = <span class="number">2</span>, n = R*C;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; C; j++) &#123;</span><br><span class="line">            x = (x * x + c + i + j)%n;</span><br><span class="line">            m[i*C + j] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span>* multiplyAndDel(<span class="keyword">uint32_t</span> *A, <span class="keyword">uint32_t</span> *B, <span class="keyword">int</span> r, <span class="keyword">int</span> rc, <span class="keyword">int</span> c) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * r * c);</span><br><span class="line">    <span class="keyword">uint32_t</span> *tB = (<span class="keyword">uint32_t</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>) * rc * c);</span><br><span class="line">    assert(C != <span class="literal">NULL</span>);</span><br><span class="line">    assert(tB != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rc; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</span><br><span class="line">            tB[j*rc + i] = B[i*c + j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(B);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = r<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = c<span class="number">-1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">uint32_t</span> *a = &amp;A[i*rc], *b = &amp;tB[j*rc];</span><br><span class="line">            <span class="keyword">int</span> k = rc;</span><br><span class="line">            <span class="keyword">switch</span> (k % LOOP_UNROLL) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">do</span> &#123; sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: sum += *a * *b, a++, b++;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((k -= LOOP_UNROLL) &gt; <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            C[i*c + j] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(A), <span class="built_in">free</span>(tB);</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> hash(<span class="keyword">uint32_t</span> x) &#123;</span><br><span class="line">    <span class="keyword">return</span> (x * <span class="number">2654435761L</span>U);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> signatureAndDel(<span class="keyword">uint32_t</span> *A, <span class="keyword">int</span> r, <span class="keyword">int</span> c) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; c; j++)</span><br><span class="line">            h = hash(h + A[i*c + j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(A);</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span>* dfs(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> *mR, <span class="keyword">int</span> *mC) &#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        *mR = SZ[l], *mC = SZ[l+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> rand_gen(SEED[l], *mR, *mC);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> split = argdp[l][r];</span><br><span class="line">    <span class="keyword">int</span> r1, r2, c1, c2;</span><br><span class="line">    <span class="keyword">uint32_t</span> *A, *B;</span><br><span class="line">    A = dfs(l, split, &amp;r1, &amp;c1);</span><br><span class="line">    B = dfs(split+<span class="number">1</span>, r, &amp;r2, &amp;c2);</span><br><span class="line">    assert(c1 == r2);</span><br><span class="line">    *mR = r1, *mC = c2;</span><br><span class="line">    <span class="keyword">return</span> multiplyAndDel(A, B, r1, c1, c2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;SZ[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;SEED[i]);</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j+i &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> l = j, r = j+i;</span><br><span class="line">                dp[l][r] = INF;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = l; k &lt; r; k++) &#123;</span><br><span class="line">                    <span class="keyword">long</span> <span class="keyword">long</span> t = dp[l][k] + dp[k+<span class="number">1</span>][r] + (<span class="keyword">long</span> <span class="keyword">long</span>) SZ[l] * SZ[k+<span class="number">1</span>] * SZ[r+<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span> (t &lt; dp[l][r])</span><br><span class="line">                        dp[l][r] = t, argdp[l][r] = k;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> retR, retC;</span><br><span class="line">        <span class="keyword">uint32_t</span> *retM;</span><br><span class="line">        <span class="keyword">uint32_t</span> hval;</span><br><span class="line">        retM = dfs(<span class="number">0</span>, N<span class="number">-1</span>, &amp;retR, &amp;retC);</span><br><span class="line">        hval = signatureAndDel(retM, retR, retC);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hval);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> test = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">            test += SZ[<span class="number">0</span>] * SZ[i] * SZ[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"best %lld, origin %lld, %lf\n"</span>, dp[<span class="number">0</span>][N<span class="number">-1</span>], test, dp[<span class="number">0</span>][N<span class="number">-1</span>]*<span class="number">1.f</span> / test);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10094" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10094/" class="article-date">
  <time datetime="2016-04-30T06:54:49.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10094/">批改娘 10094. Fast 0/1 Knapsack Problem</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10094/" data-id="cipz12t0r004zt1xcfn19ur9t" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10094/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>有 $N$ 個重量和價值分別為 $W_i, V_i$ 的物品，現在要從這些物品中選出總重量不超過 $M$ 的物品，求所有挑選方案中的總價值最大值為何。</p>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>輸入只有一組測資，第一行會有兩個整數 $N, M$ 分別表示物品數量和背包能容大的最大重量 $M$。接下來會有 $N$ 行，第 $i$ 行上會有兩個整數 $W_i, V_i$，分別為物品 $i$ 的重量和價值。</p>
<ul>
<li>$1 \le N \le 10000$</li>
<li>$1 \le M \le 1000000$</li>
<li>$1 \le W_i, \; V_i \le 100000$</li>
</ul>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>輸出一行整數，挑選方案中的最大價值 $B$。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 5</span><br><span class="line">2 3</span><br><span class="line">1 2 </span><br><span class="line">3 4</span><br><span class="line">2 2</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>遞迴公式</p>
<span>$$\begin{align*}
f(i, j) = \max(f(i-1, j-w)+v, f(i-1, j))
\end{align*}$$</span><!-- Has MathJax -->
<p>最單純採用滾動數組完成，也就是所謂的 double buffer 的技巧，可以大幅度節省記憶體，但先決條件是他們的相依關係必須獨立。</p>
<p>在平行處理上的另一種解法，就是分成前 $N/2$ 個物品和後 $N/2$ 物品分開計算，之後再藉由 $\mathcal{O}(M)$ 合併答案，由於算法的限制，最多拆分兩組。而不像滾動數組的平行於最內層的迴圈，平行度有限，但在較少核心的處理上非常快速，其一原因是空間使用比較有效率。</p>
<ul>
<li>Server (32 cores)<ul>
<li>分組合併: Accepted (768 ms, 8320 KB)</li>
<li>滾動數組: Accepted (380 ms, 8 MB)</li>
</ul>
</li>
<li>PC (4 cores)<ul>
<li>分組合併: 600ms</li>
<li>滾動數組: 900ms</li>
</ul>
</li>
</ul>
<h3 id="滾動數組"><a href="#滾動數組" class="headerlink" title="滾動數組"></a>滾動數組</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXM 1000005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 10005</span></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][MAXM];</span><br><span class="line"><span class="keyword">int</span> W[MAXN], V[MAXN];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max(a, b) (a &gt; b ? a : b)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W[i], &amp;V[i]);</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> q = <span class="number">1</span> - p;</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> pp = p, qq = q;</span><br><span class="line">                <span class="keyword">int</span> v = V[i], w = W[i];</span><br><span class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp for</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt;= M; i++)</span><br><span class="line">                    dp[qq][i] = max(dp[pp][i-w]+v, dp[pp][i]);</span><br><span class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp for</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">                    dp[qq][i] = dp[pp][i];</span><br><span class="line">            &#125;</span><br><span class="line">            p = <span class="number">1</span> - p;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dp[p][M]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分組合併"><a href="#分組合併" class="headerlink" title="分組合併"></a>分組合併</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">subKnapsack</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m, <span class="keyword">int</span> w[], <span class="keyword">int</span> v[], <span class="keyword">int</span> dp[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp[<span class="number">0</span>]) * (m+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> vv = v[i], ww = w[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = m; j &gt;= ww; j--)</span><br><span class="line">            dp[j] = max(dp[j], dp[j-ww]+vv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXM 1000005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 100005</span></span><br><span class="line"><span class="keyword">int</span> W[MAXN], V[MAXN];</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][MAXM];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;N, &amp;M) == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;W[i], &amp;V[i]);</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line"> </span><br><span class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel sections</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp section</span></span><br><span class="line">            subKnapsack(N/<span class="number">2</span>, M, W, V, dp[<span class="number">0</span>]);</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp section</span></span><br><span class="line">            subKnapsack(N-N/<span class="number">2</span>, M, W+N/<span class="number">2</span>, V+N/<span class="number">2</span>, dp[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = M, j = <span class="number">0</span>, mx = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            mx = max(mx, dp[<span class="number">1</span>][j]), j++;</span><br><span class="line">            ret = max(ret, dp[<span class="number">0</span>][i] + mx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10027" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10027/" class="article-date">
  <time datetime="2016-04-30T06:30:07.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10027/">批改娘 10027. Fast Sudoku</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10027/" data-id="cipz12szj003pt1xceti1bauf" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10027/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDA/">IDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><img src="http://i.imgur.com/PHbnGMp.png" alt="不過，還想做得更好"></p>
<p>但這個世界卻要求神通廣大、無所不知，那不聰明的我又該何去何從 …</p>
<h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>給一張 $9 \times 9$ 數獨，必須滿足每行每列的 1 到 9 的數字不重複，同時在九個 $3 \times 3$ 方格內的 1 到 9 數字也不重複。請計算可填入的方法數。</p>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>測資只有一筆，共有九行，每一行上有九個整數，第 $i$ 行上的第 $j$ 個整數表示 $\text{grid}[i][j]$ 填入的數字，若 $\text{grid}[i][j] = 0$ 表示尚未填入。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>對於每一組測資輸出一行一個整數，表示數獨共有幾種填法。</p>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0 6 0 0 0 4 0 5 0</span><br><span class="line">0 0 8 3 0 5 6 0 0</span><br><span class="line">2 0 0 0 0 0 0 0 1</span><br><span class="line">8 0 0 4 0 7 0 0 6</span><br><span class="line">0 0 6 0 0 0 3 0 0</span><br><span class="line">7 0 0 9 0 1 0 0 4</span><br><span class="line">5 0 0 0 0 0 0 0 2</span><br><span class="line">0 0 7 2 0 6 9 0 0</span><br><span class="line">0 4 0 5 0 8 0 7 0</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>
<h2 id="範例輸入-2"><a href="#範例輸入-2" class="headerlink" title="範例輸入 2"></a>範例輸入 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0 0 0 0 0 0 0 0 0</span><br><span class="line">0 0 3 6 0 0 0 0 0</span><br><span class="line">0 7 0 0 9 0 2 0 0</span><br><span class="line">0 5 0 0 0 7 0 0 0</span><br><span class="line">0 0 0 0 4 5 7 0 0</span><br><span class="line">0 0 0 1 0 0 0 3 0</span><br><span class="line">0 0 1 0 0 0 0 6 8</span><br><span class="line">0 0 8 5 0 0 0 1 0</span><br><span class="line">0 9 0 0 0 0 4 0 0</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出-2"><a href="#範例輸出-2" class="headerlink" title="範例輸出 2"></a>範例輸出 2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">292</span><br></pre></td></tr></table></figure>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>牽涉到 load balance 問題，大部分都要先廣度搜尋一次，把狀態展開後，再利用 dynamic scheduling 進行分配工作，效果會好上許多。為了解決狀態展開而後不浪費記憶體空間，IDA* 會是一種好的選擇。當然在 OpenMP 3.0 以上有提供 task 來幫忙做到類似的事情，但搜索展開會變成寫死，估計上會比較困難。</p>
<ul>
<li>IDA: Accepted (946 ms, 10752 KB)</li>
<li>OpenMP task: Accepted (1321 ms, 2560 KB)</li>
<li>DLX: Accepted (1208 ms, 56940 KB)</li>
</ul>
<p>當然 DLX 在建表處理會變得很討厭，overhead 相較於其他的算法都高出許多，因此狀態展開不可以太多，因為他本身就搜得非常快，撰寫這一類搜索問題時，特別小心 <code>#pragma omp private()</code> 的使用，複製操作原則上都是根據 <code>sizeof()</code> 決定複製空間大小。因此若複製目標為函數參數，很容易只有複製到指標。</p>
<h3 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> C[<span class="number">81</span>][<span class="number">2</span>], N;</span><br><span class="line"><span class="keyword">int</span> R[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;, P[MAXN*<span class="number">9</span>][<span class="number">9</span>][<span class="number">3</span>], Pidx;</span><br><span class="line"><span class="keyword">int</span> ida_dep;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDA</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx == ida_dep) &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(P[Pidx], state, <span class="keyword">sizeof</span>(P[<span class="number">0</span>])), Pidx++;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</span><br><span class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</span><br><span class="line">                (state[c][<span class="number">2</span>]&amp;mask))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        state[x][<span class="number">0</span>] |= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] |= mask;</span><br><span class="line">        state[c][<span class="number">2</span>] |= mask;</span><br><span class="line">        IDA(idx+<span class="number">1</span>, state);</span><br><span class="line">        state[x][<span class="number">0</span>] ^= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] ^= mask;</span><br><span class="line">        state[c][<span class="number">2</span>] ^= mask;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx == N)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>, sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</span><br><span class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</span><br><span class="line">                (state[c][<span class="number">2</span>]&amp;mask))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        state[x][<span class="number">0</span>] |= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] |= mask;</span><br><span class="line">        state[c][<span class="number">2</span>] |= mask;</span><br><span class="line">        sum += dfs(idx+<span class="number">1</span>, state);</span><br><span class="line">        state[c][<span class="number">2</span>] ^= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] ^= mask;</span><br><span class="line">        state[x][<span class="number">0</span>] ^= mask;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (ida_dep = <span class="number">1</span>; ida_dep &lt;= N; ida_dep++) &#123;</span><br><span class="line">        Pidx = <span class="number">0</span>;</span><br><span class="line">        IDA(<span class="number">0</span>, R);</span><br><span class="line">        <span class="keyword">if</span> (Pidx &gt;= MAXN)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ida_dep == N+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> Pidx;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(guided) reduction(+: ret) </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Pidx; i++)</span><br><span class="line">        ret += dfs(ida_dep, P[i]);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</span><br><span class="line">    N = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(R, <span class="number">0</span>, <span class="keyword">sizeof</span>(R));</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">             <span class="keyword">if</span> (g[i][j]) &#123;</span><br><span class="line">                 g[i][j]--;</span><br><span class="line">                 R[i][<span class="number">0</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">                 R[j][<span class="number">1</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">                 R[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][<span class="number">2</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 C[N][<span class="number">0</span>] = i, C[N][<span class="number">1</span>] = j;</span><br><span class="line">                 N++;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">int</span> ret = incomplete_bfs();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> C[<span class="number">81</span>][<span class="number">2</span>], N;</span><br><span class="line"><span class="keyword">int</span> R[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;;</span><br><span class="line"><span class="keyword">int</span> threadcount = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> omp threadprivate(threadcount)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_serial</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx == N) &#123;</span><br><span class="line">        threadcount++;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</span><br><span class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</span><br><span class="line">                (state[c][<span class="number">2</span>]&amp;mask)) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        state[x][<span class="number">0</span>] |= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] |= mask;</span><br><span class="line">        state[c][<span class="number">2</span>] |= mask;</span><br><span class="line">        dfs_serial(idx+<span class="number">1</span>, state);</span><br><span class="line">        state[c][<span class="number">2</span>] ^= mask;</span><br><span class="line">        state[y][<span class="number">1</span>] ^= mask;</span><br><span class="line">        state[x][<span class="number">0</span>] ^= mask;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> state[][<span class="number">3</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx == N) &#123;</span><br><span class="line">        threadcount++;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> x = C[idx][<span class="number">0</span>], y = C[idx][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> c = x/<span class="number">3</span>*<span class="number">3</span> + y/<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp task untied</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mask = <span class="number">1</span>&lt;&lt;i;</span><br><span class="line">        <span class="keyword">if</span> ((state[x][<span class="number">0</span>]&amp;mask) || (state[y][<span class="number">1</span>]&amp;mask) ||</span><br><span class="line">                (state[c][<span class="number">2</span>]&amp;mask)) &#123;</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> S[<span class="number">9</span>][<span class="number">3</span>] = &#123;&#125;;</span><br><span class="line">            <span class="built_in">memcpy</span>(S, state, <span class="keyword">sizeof</span>(S));</span><br><span class="line"><span class="comment">//            int (*S)[3] = malloc(sizeof(int)*9*3);</span></span><br><span class="line"><span class="comment">//            memcpy(S, state, sizeof(int)*9*3);</span></span><br><span class="line">            S[x][<span class="number">0</span>] |= mask;</span><br><span class="line">            S[y][<span class="number">1</span>] |= mask;</span><br><span class="line">            S[c][<span class="number">2</span>] |= mask;</span><br><span class="line">            <span class="keyword">if</span> (idx &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">                dfs_serial(idx+<span class="number">1</span>, S);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dfs(idx+<span class="number">1</span>, S);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp taskwait</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp single</span></span><br><span class="line">        &#123;</span><br><span class="line">            dfs(<span class="number">0</span>, R);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp critical</span></span><br><span class="line">            ret += threadcount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</span><br><span class="line">    N = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(R, <span class="number">0</span>, <span class="keyword">sizeof</span>(R));</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">             <span class="keyword">if</span> (g[i][j]) &#123;</span><br><span class="line">                 g[i][j]--;</span><br><span class="line">                 R[i][<span class="number">0</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">                 R[j][<span class="number">1</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">                 R[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][<span class="number">2</span>] |= <span class="number">1</span>&lt;&lt;g[i][j];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 C[N][<span class="number">0</span>] = i, C[N][<span class="number">1</span>] = j;</span><br><span class="line">                 N++;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">int</span> ret = incomplete_bfs();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DLX"><a href="#DLX" class="headerlink" title="DLX"></a>DLX</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 65536</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXR 1024</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> byte;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> left, right, up, down;</span><br><span class="line">    <span class="keyword">int</span> ch;</span><br><span class="line">&#125; Node;</span><br><span class="line"><span class="comment">// DLX header</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> (* <span class="keyword">const</span> sudoku) (byte [][<span class="number">9</span>]);</span><br><span class="line">&#125; DLX_namespace;</span><br><span class="line"><span class="comment">// DLX body begin</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_remove</span><span class="params">(<span class="keyword">int</span> c, Node DL[], <span class="keyword">int</span> s[])</span> </span>&#123;</span><br><span class="line">    DL[DL[c].right].left = DL[c].left;</span><br><span class="line">    DL[DL[c].left].right = DL[c].right;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right) &#123;</span><br><span class="line">            DL[DL[j].down].up = DL[j].up;</span><br><span class="line">            DL[DL[j].up].down = DL[j].down;</span><br><span class="line">            s[DL[j].ch]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_resume</span><span class="params">(<span class="keyword">int</span> c, Node DL[], <span class="keyword">int</span> s[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].left; j != i; j = DL[j].left) &#123;</span><br><span class="line">            DL[DL[j].down].up = j;</span><br><span class="line">            DL[DL[j].up].down = j;</span><br><span class="line">            s[DL[j].ch]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    DL[DL[c].right].left = c;</span><br><span class="line">    DL[DL[c].left].right = c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_dfs</span><span class="params">(<span class="keyword">int</span> k, Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DL[head].right == head)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> t = INT_MAX, c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[head].right; i != head; i = DL[i].right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] &lt; t) &#123;</span><br><span class="line">            t = s[i], c = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    DLX_remove(c, DL, s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = DL[c].down; i != c; i = DL[i].down) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].right; j != i; j = DL[j].right)</span><br><span class="line">            DLX_remove(DL[j].ch, DL, s);</span><br><span class="line">        ans += DLX_dfs(k+<span class="number">1</span>, DL, s, head);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = DL[i].left; j != i; j = DL[j].left)</span><br><span class="line">            DLX_resume(DL[j].ch, DL, s);</span><br><span class="line">    &#125;</span><br><span class="line">    DLX_resume(c, DL, s);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_newnode</span><span class="params">(<span class="keyword">int</span> up, <span class="keyword">int</span> down, <span class="keyword">int</span> left, <span class="keyword">int</span> right, Node DL[], <span class="keyword">int</span> *size)</span> </span>&#123;</span><br><span class="line">    DL[*size].up = up, DL[*size].down = down;</span><br><span class="line">    DL[*size].left = left, DL[*size].right = right;</span><br><span class="line">    DL[up].down = DL[down].up = DL[left].right = DL[right].left = *size;</span><br><span class="line">    assert(*size &lt; MAXN);</span><br><span class="line">    <span class="keyword">return</span> (*size)++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_newrow</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> Row[], Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> *size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, r, row = <span class="number">-1</span>, k;</span><br><span class="line">    <span class="keyword">for</span> (a = <span class="number">0</span>; a &lt; n; a++) &#123;</span><br><span class="line">        r = Row[a];</span><br><span class="line">        DL[*size].ch = r, s[r]++;</span><br><span class="line">        <span class="keyword">if</span> (row == <span class="number">-1</span>) &#123;</span><br><span class="line">            row = DLX_newnode(DL[DL[r].ch].up, DL[r].ch, *size, *size, DL, size);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            k = DLX_newnode(DL[DL[r].ch].up, DL[r].ch, DL[row].left, row, DL, size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DLX_init</span><span class="params">(<span class="keyword">int</span> m, Node DL[], <span class="keyword">int</span> s[], <span class="keyword">int</span> *size, <span class="keyword">int</span> *head)</span> </span>&#123;</span><br><span class="line">    *size = <span class="number">0</span>;</span><br><span class="line">    *head = DLX_newnode(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, DL, size);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        DLX_newnode(i, i, DL[*head].left, *head, DL, size);</span><br><span class="line">        DL[i].ch = i, s[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DLX_sudoku</span><span class="params">(byte g[][<span class="number">9</span>])</span> </span>&#123;</span><br><span class="line">    Node DL[MAXN + MAXR];</span><br><span class="line">    <span class="keyword">int</span> s[MAXR], head, size;</span><br><span class="line">    <span class="keyword">int</span> row[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> used[<span class="number">4</span>][<span class="number">10</span>][<span class="number">10</span>] = &#123;&#125;, isValid = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">9</span>, tn = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (g[i][j]) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = g[i][j];</span><br><span class="line">                <span class="keyword">int</span> y = i/<span class="number">3</span>*<span class="number">3</span> + j/<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">1</span>][i][x])    isValid = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">2</span>][j][x])    isValid = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">3</span>][y][x])    isValid = <span class="number">0</span>;</span><br><span class="line">                used[<span class="number">0</span>][i][j] = <span class="number">1</span>;</span><br><span class="line">                used[<span class="number">1</span>][i][x] = used[<span class="number">2</span>][j][x] = used[<span class="number">3</span>][y][x] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isValid)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> OFF[<span class="number">4</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> label[<span class="number">4</span>][<span class="number">10</span>][<span class="number">10</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (used[<span class="number">0</span>][i][j] == <span class="number">0</span>)</span><br><span class="line">                label[<span class="number">0</span>][i][j] = ++OFF[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">        OFF[k] = OFF[k<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (used[k][i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                    label[k][i][j] = ++OFF[k];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    DLX_init(OFF[<span class="number">3</span>], DL, s, &amp;size, &amp;head);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (g[i][j])    <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; k++) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = k;</span><br><span class="line">                <span class="keyword">int</span> y = i/<span class="number">3</span>*<span class="number">3</span> + j/<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">1</span>][i][x])    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">2</span>][j][x])    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (used[<span class="number">3</span>][y][x])    <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">                row[<span class="number">0</span>] = label[<span class="number">0</span>][i][j];</span><br><span class="line">                row[<span class="number">1</span>] = label[<span class="number">1</span>][i][k];</span><br><span class="line">                row[<span class="number">2</span>] = label[<span class="number">2</span>][j][k];</span><br><span class="line">                row[<span class="number">3</span>] = label[<span class="number">3</span>][y][k];</span><br><span class="line">                DLX_newrow(<span class="number">4</span>, row, DL, s, &amp;size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DLX_dfs(<span class="number">0</span>, DL, s, head);</span><br><span class="line">&#125;</span><br><span class="line">DLX_namespace <span class="keyword">const</span> DLX = &#123;DLX_sudoku&#125;;</span><br><span class="line"><span class="comment">// DLX body end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// parallel utils</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    byte b[<span class="number">9</span>][<span class="number">9</span>];    <span class="comment">// board</span></span><br><span class="line">    <span class="keyword">bool</span> r[<span class="number">9</span>][<span class="number">9</span>], c[<span class="number">9</span>][<span class="number">9</span>], g[<span class="number">9</span>][<span class="number">9</span>];    <span class="comment">// row, column, grid</span></span><br><span class="line">&#125; Board;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">gridID</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x / <span class="number">3</span> * <span class="number">3</span> + y / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">board_init</span><span class="params">(Board *b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="keyword">sizeof</span>(Board));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">board_test</span><span class="params">(<span class="keyword">const</span> Board *b, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b-&gt;b[x][y] == <span class="number">0</span> &amp;&amp; b-&gt;r[x][v<span class="number">-1</span>] == <span class="number">0</span> &amp;&amp; b-&gt;c[y][v<span class="number">-1</span>] == <span class="number">0</span> &amp;&amp; b-&gt;g[gridID(x, y)][v<span class="number">-1</span>] == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">board_fill</span><span class="params">(Board *b, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    b-&gt;b[x][y] = v;</span><br><span class="line">    b-&gt;r[x][v<span class="number">-1</span>] = b-&gt;c[y][v<span class="number">-1</span>] = b-&gt;g[gridID(x, y)][v<span class="number">-1</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">incomplete_bfs</span><span class="params">(<span class="keyword">int</span> g[][<span class="number">9</span>])</span> </span>&#123;</span><br><span class="line">    Board origin;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">81</span>][<span class="number">2</span>], m = <span class="number">0</span>;</span><br><span class="line">    board_init(&amp;origin);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (g[i][j]) &#123;</span><br><span class="line">                board_fill(&amp;origin, i, j, g[i][j]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                A[m][<span class="number">0</span>] = i, A[m][<span class="number">1</span>] = j, m++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXQMEM 8192</span></span><br><span class="line">    <span class="keyword">static</span> Board Q[<span class="number">2</span>][MAXQMEM*<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">int</span> Qcnt[<span class="number">2</span>] = &#123;&#125;, Qflag = <span class="number">0</span>;</span><br><span class="line">    Q[Qflag][Qcnt[Qflag]] = origin, Qcnt[Qflag]++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> it = <span class="number">0</span>; it &lt; m; it++) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> x = A[it][<span class="number">0</span>], y = A[it][<span class="number">1</span>];</span><br><span class="line">        Qcnt[!Qflag] = <span class="number">0</span>;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qcnt[Qflag]; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!board_test(&amp;Q[Qflag][i], x, y, j))</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> pIdx;</span><br><span class="line">                <span class="meta">#<span class="meta-keyword">pragma</span> omp critical</span></span><br><span class="line">                &#123;</span><br><span class="line">                    pIdx = Qcnt[!Qflag]++;</span><br><span class="line">                &#125;</span><br><span class="line">                Q[!Qflag][pIdx] = Q[Qflag][i];</span><br><span class="line">                board_fill(&amp;Q[!Qflag][pIdx], x, y, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Qcnt[!Qflag] &gt;= MAXQMEM) &#123;</span><br><span class="line">            <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+:ret)</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Qcnt[Qflag]; i++) &#123;</span><br><span class="line">                ret += DLX.sudoku(Q[Qflag][i].b);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        Qflag = !Qflag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Qcnt[Qflag];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">9</span>][<span class="number">9</span>], n = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;g[i][j]);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> ret = incomplete_bfs(g);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-jg-10087" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/30/jg-10087/" class="article-date">
  <time datetime="2016-04-30T05:52:42.000Z" itemprop="datePublished">2016-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/學校課程/">學校課程</a>►<a class="article-category-link" href="/categories/學校課程/平行程式/">平行程式</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/30/jg-10087/">批改娘 10087. Sparse Matrix Multiplication (OpenMP)</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2016/04/30/jg-10087/" data-id="cipz12t09004it1xca3h9t7x2" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2016/04/30/jg-10087/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenMP/">OpenMP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/批改娘/">批改娘</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="題目描述"><a href="#題目描述" class="headerlink" title="題目描述"></a>題目描述</h2><p>稀疏矩陣為大部份元素皆為零的矩陣，在科學與工程領域中求解線性模型時經常出現大型的稀疏矩陣。現在給予最常見的 Coordinate Format (簡稱 COO 格式)，請問兩個矩陣相乘結果為何。</p>
<p>給予矩陣 <span>$A_{n, m}$</span><!-- Has MathJax --> 和 <span>$B_{m, r}$</span><!-- Has MathJax -->，請計算稀疏矩陣相乘。</p>
<span>$$A_{4,4} = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
5 &amp; 8 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 3 &amp; 0 \\
0 &amp; 6 &amp; 0 &amp; 0 \\
\end{bmatrix}, \qquad
B_{4,4} = \begin{bmatrix}
0 &amp; 0 &amp; 1 &amp; 3 \\
0 &amp; 5 &amp; 2 &amp; 0 \\
3 &amp; 5 &amp; 0 &amp; 0 \\
0 &amp; 2 &amp; 0 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<p>根據 COO 格式，分別轉換矩陣 $A$ 和 $B$ 的所有非零元素，如下表所示</p>
<h3 id="COO-of-Matrix-A"><a href="#COO-of-Matrix-A" class="headerlink" title="COO of Matrix $A$"></a>COO of Matrix $A$</h3><table>
<thead>
<tr>
<th><code>row_index</code></th>
<th><code>col_index</code></th>
<th><code>value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>6</td>
</tr>
</tbody>
</table>
<h3 id="COO-of-Matrix-B"><a href="#COO-of-Matrix-B" class="headerlink" title="COO of Matrix $B$"></a>COO of Matrix $B$</h3><table>
<thead>
<tr>
<th><code>row_index</code></th>
<th><code>col_index</code></th>
<th><code>value</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>5</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<h2 id="輸入格式"><a href="#輸入格式" class="headerlink" title="輸入格式"></a>輸入格式</h2><p>測資只有一組，第一行會有三個整數 $N, \; M, \; R$，分別表示矩陣 $A, \; B$ 的大小。下一行會有兩個整數 $N_A, \; N_B$，接下來會有 $N_A$ 行，每一行表示矩陣 $A$ 的 COO 格式，隨後會有 $N_B$ 行，每一行表示矩陣 $B$ 的 COO 格式。</p>
<ul>
<li>$0 &lt; N, \; M, \; R \le 10^6$</li>
<li>$0 &lt; N_A, \; N_B \le 10^6$</li>
</ul>
<p>給予 COO 格式時，先按照 <code>row_index</code> 由小到大，相同情況由 <code>col_index</code> 由小到大的方式給定，保證不會有重複，每一個元素值 $v$ 介於 $1$ 到 $2^{31}-1$ 之間。</p>
<h2 id="輸出格式"><a href="#輸出格式" class="headerlink" title="輸出格式"></a>輸出格式</h2><p>輸出 <span>$C_{n, r} = A_{n, m} \times B_{m, r}$</span><!-- Has MathJax --> 的雜湊值。</p>
<p>定義 <span>$\mathit{hash}(C_{n, r}) = \sum\nolimits_{e_{i, j} \in C \text{ and } e_{i, j} \neq 0} \mathit{encrypt}((i+1)*(j+1), e_{i, j})$</span><!-- Has MathJax -->，實際運作的 <strong>流程</strong> 可參考以下作法，當然你沒辦法宣告 $N \times M$ 的空間使用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(uint32_t x, uint32_t n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(uint32_t m, uint32_t key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1024</span></span><br><span class="line"><span class="keyword">uint32_t</span> A[MAXN][MAXN], B[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, v;</span><br><span class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;v), A[x][y] = v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;v), B[x][y] = v;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</span><br><span class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; M; k++)</span><br><span class="line">                sum += A[i][k] * B[k][j];</span><br><span class="line">            <span class="keyword">if</span> (sum)</span><br><span class="line">                hash += encrypt((i+<span class="number">1</span>)*(j+<span class="number">1</span>), sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="範例輸入"><a href="#範例輸入" class="headerlink" title="範例輸入"></a>範例輸入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">4 4 4</span><br><span class="line">4 7</span><br><span class="line"></span><br><span class="line">1 0 5</span><br><span class="line">1 1 8</span><br><span class="line">2 2 3</span><br><span class="line">3 1 6</span><br><span class="line"></span><br><span class="line">0 2 1</span><br><span class="line">0 3 3</span><br><span class="line">1 1 5</span><br><span class="line">1 2 2</span><br><span class="line">2 0 3</span><br><span class="line">2 1 5</span><br><span class="line">3 1 2</span><br></pre></td></tr></table></figure>
<h2 id="範例輸出"><a href="#範例輸出" class="headerlink" title="範例輸出"></a>範例輸出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13093438</span><br></pre></td></tr></table></figure>
<h2 id="範例解釋"><a href="#範例解釋" class="headerlink" title="範例解釋"></a>範例解釋</h2><span>$$A_{n, m} \times B_{m, r} = C_{4,4}=\begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 40 &amp; 21 &amp; 15 \\
9 &amp; 15 &amp; 0 &amp; 0 \\
0 &amp; 30 &amp; 12 &amp; 0 \\
\end{bmatrix}$$</span><!-- Has MathJax -->
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ul>
<li>傳統處理 Array of Structure: Accepted (14964 ms, 29104 KB)</li>
<li>傳統處理 Structure of Array: Accepted (12537 ms, 45568 KB)</li>
<li>額外空間 Array of Structure: Accepted (5711 ms, 29152 KB)</li>
<li>額外空間 Structure of Array: Accepted (5202 ms, 29056 KB)</li>
</ul>
<p>Array of Structure 簡稱 AOS，而 Structure of Array 簡稱 SOA，這兩種寫法的差異在於運用 structure 時的寫法，根據 cache line 的設計，有時候一個 struct 下會有很多變數，然而我們只需要使用部分的變數，這時候沒有使用的變數仍會跟著一起進入 cache，很容易造成 cache 效率偏低，因此回歸原始寫出 SOA 的版本。</p>
<h3 id="傳統處理"><a href="#傳統處理" class="headerlink" title="傳統處理"></a>傳統處理</h3><p>如果是兩個稀疏方陣，用 COO 格式需要先對後面那個矩陣轉置，接著在三欄 $(i, j, v)$ 的表格下，按照字典順序排序。此時會有兩個三欄 $A(i, j, v), \; B(i, j, v)$ (別忘記 $B$ 矩陣已經轉置過)，要計算 $A \times B = C$，為得到 <span>$C_{i, j}$</span><!-- Has MathJax -->，<span>$C_{i, j} = \sum A(i, k, v) B(j, k, v)$</span><!-- Has MathJax -->，由於已經排序好，那麼找到共同的 $k$ 不是難事，按照合併排序的手法，能在 $\mathcal{O}(N)$ 完成。</p>
<p>因此在最稠密的矩陣下，仍需要 $\mathcal{O}(N^3)$ 才能完成。</p>
<h4 id="AOS"><a href="#AOS" class="headerlink" title="AOS"></a>AOS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL (MAXN&lt;&lt;2)</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(uint32_t x, uint32_t n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(uint32_t m, uint32_t key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> ELE &#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">uint32_t</span> v;</span><br><span class="line">&#125; ELE;</span><br><span class="line">ELE LA[MAXL], LB[MAXL];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE LA[], <span class="keyword">int</span> na, ELE LB[], <span class="keyword">int</span> nb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>, mb = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN], boff[MAXN];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LA[i].i != p)</span><br><span class="line">            aoff[ma++] = i, p = LA[i].i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; nb; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LB[i].i != p)</span><br><span class="line">            boff[mb++] = i, p = LB[i].i;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</span><br><span class="line">    aoff[ma] = na, boff[mb] = nb;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+: hash)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mb; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> idx1 = aoff[i], idx2 = boff[j];</span><br><span class="line">            <span class="keyword">int</span> top1 = aoff[i+<span class="number">1</span>], top2 = boff[j+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> r = LA[idx1].i, c = LB[idx2].i;</span><br><span class="line">            <span class="keyword">while</span> (idx1 &lt; top1 &amp;&amp; idx2 &lt; top2) &#123;</span><br><span class="line">                <span class="keyword">if</span> (LA[idx1].j == LB[idx2].j)</span><br><span class="line">                    sum += LA[idx1].v * LB[idx2].v, idx1++, idx2++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (LA[idx1].j &lt; LB[idx2].j)</span><br><span class="line">                    idx1++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    idx2++;                    </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (sum)</span><br><span class="line">                hash += encrypt((r+<span class="number">1</span>)*(c+<span class="number">1</span>), sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> ELE &amp;a, <span class="keyword">const</span> ELE &amp;b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.i != b.i)</span><br><span class="line">        <span class="keyword">return</span> a.i &lt; b.i;</span><br><span class="line">    <span class="keyword">return</span> a.j &lt; b.j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA[i].i, &amp;LA[i].j, &amp;LA[i].v);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB[i].j, &amp;LB[i].i, &amp;LB[i].v);</span><br><span class="line">        sort(LB, LB+nB, cmp);</span><br><span class="line">        SpMV(N, M, R, LA, nA, LB, nB);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SOA"><a href="#SOA" class="headerlink" title="SOA"></a>SOA</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL (MAXN&lt;&lt;2)</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(uint32_t x, uint32_t n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(uint32_t m, uint32_t key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> ELE &#123;</span><br><span class="line">    <span class="keyword">int</span> i[MAXL], j[MAXL];</span><br><span class="line">    <span class="keyword">uint32_t</span> v[MAXL];</span><br><span class="line">&#125; ELE;</span><br><span class="line">ELE LA, LB, LT;</span><br><span class="line"><span class="keyword">int</span> D[MAXL];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE &amp;LA, <span class="keyword">int</span> na, ELE &amp;LB, <span class="keyword">int</span> nb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>, mb = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN], boff[MAXN];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LA.i[i] != p)</span><br><span class="line">            aoff[ma++] = i, p = LA.i[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; nb; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LB.i[i] != p)</span><br><span class="line">            boff[mb++] = i, p = LB.i[i];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</span><br><span class="line">    aoff[ma] = na, boff[mb] = nb;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for reduction(+: hash)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mb; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> idx1 = aoff[i], idx2 = boff[j];</span><br><span class="line">            <span class="keyword">int</span> top1 = aoff[i+<span class="number">1</span>], top2 = boff[j+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> r = LA.i[idx1], c = LB.i[idx2];</span><br><span class="line">            <span class="keyword">while</span> (idx1 &lt; top1 &amp;&amp; idx2 &lt; top2) &#123;</span><br><span class="line">                <span class="keyword">if</span> (LA.j[idx1] &lt; LB.j[idx2])</span><br><span class="line">                    idx1++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (LA.j[idx1] &gt; LB.j[idx2])</span><br><span class="line">                    idx2++;                    </span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    sum += LA.v[idx1] * LB.v[idx2], idx1++, idx2++;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (sum)</span><br><span class="line">                hash += encrypt((r+<span class="number">1</span>)*(c+<span class="number">1</span>), sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (LT.i[a] != LT.i[b])</span><br><span class="line">        <span class="keyword">return</span> LT.i[a] &lt; LT.i[b];</span><br><span class="line">    <span class="keyword">return</span> LT.j[a] &lt; LT.j[b];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, M, R, nA, nB;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA.i[i], &amp;LA.j[i], &amp;LA.v[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &lt;.j[i], &lt;.i[i], &lt;.v[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            D[i] = i;</span><br><span class="line">        sort(D, D+nB, cmp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            LB.i[i] = LT.i[D[i]], LB.j[i] = LT.j[D[i]], LB.v[i] = LT.v[D[i]];</span><br><span class="line">        SpMV(N, M, R, LA, nA, LB, nB);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="額外空間"><a href="#額外空間" class="headerlink" title="額外空間"></a>額外空間</h3><p>若採用額外空間處理，一開始就不用對 $B$ 轉置，<span>$C_{i, j} = \sum A(i, k, v) B(k, j, v)$</span><!-- Has MathJax -->。每一次解決 $C$ 的第 $i$ 列上的所有元素值，此時 $A(i, k, v)$ 按照 $k$ 遞增排列，$B(k, j, v)$ 要配對 $A(i, k, v)$，會恰好掃描完整的 $B$，累加元素值會不按照順序累加到 <span>$C_{i, j}$</span><!-- Has MathJax -->。</p>
<p>因此在最稠密的矩陣下，仍需要 $\mathcal{O}(N^3)$ 才能完成。</p>
<h4 id="AOS-1"><a href="#AOS-1" class="headerlink" title="AOS"></a>AOS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(uint32_t x, uint32_t n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(uint32_t m, uint32_t key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL 1048576</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> ELE &#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">uint32_t</span> v;</span><br><span class="line">&#125; ELE;</span><br><span class="line">ELE LA[MAXL], LB[MAXL];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE LA[], <span class="keyword">int</span> na, ELE LB[], <span class="keyword">int</span> nb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LA[i].i != p)</span><br><span class="line">            aoff[ma++] = i, p = LA[i].i;</span><br><span class="line">    &#125;</span><br><span class="line">    aoff[ma] = na;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> chunk = <span class="number">8</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(dynamic, chunk) reduction(+: hash)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> idx1 = aoff[i], top1 = aoff[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> r = LA[idx1].i;</span><br><span class="line">        <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">calloc</span>(R, <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx2 = <span class="number">0</span>; idx2 &lt; nb &amp;&amp; idx1 &lt; top1; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (LA[idx1].j == LB[idx2].i) &#123;</span><br><span class="line">                C[LB[idx2].j] += LA[idx1].v * LB[idx2].v;</span><br><span class="line">                idx2++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (idx2 &lt; nb &amp;&amp; LA[idx1].j != LB[idx2].i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (LA[idx1].j &lt; LB[idx2].i)</span><br><span class="line">                    idx1++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    idx2++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (C[j])</span><br><span class="line">                hash += encrypt((r+<span class="number">1</span>)*(j+<span class="number">1</span>), C[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(C);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> N, M, R, nA, nB;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA[i].i, &amp;LA[i].j, &amp;LA[i].v);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB[i].i, &amp;LB[i].j, &amp;LB[i].v);</span><br><span class="line">        SpMV(N, M, R, LA, nA, LB, nB);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SOA-1"><a href="#SOA-1" class="headerlink" title="SOA"></a>SOA</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">rotate_left</span><span class="params">(uint32_t x, uint32_t n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <span class="title">encrypt</span><span class="params">(uint32_t m, uint32_t key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rotate_left(m, key&amp;<span class="number">31</span>) + key)^key;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 1048576</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXL 1048576</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> ELE &#123;</span><br><span class="line">    <span class="keyword">int</span> i[MAXL], j[MAXL];</span><br><span class="line">    <span class="keyword">uint32_t</span> v[MAXL];</span><br><span class="line">&#125; ELE;</span><br><span class="line">ELE LA, LB;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SpMV</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> M, <span class="keyword">int</span> R, ELE &amp;LA, <span class="keyword">int</span> na, ELE &amp;LB, <span class="keyword">int</span> nb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ma = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> aoff[MAXN];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, p = <span class="number">-1</span>; i &lt; na; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LA.i[i] != p)</span><br><span class="line">            aoff[ma++] = i, p = LA.i[i];</span><br><span class="line">    &#125;</span><br><span class="line">    aoff[ma] = na;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">uint32_t</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> chunk = <span class="number">8</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel for schedule(dynamic, chunk) reduction(+: hash)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ma; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> idx1 = aoff[i], top1 = aoff[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> r = LA.i[idx1];</span><br><span class="line">        <span class="keyword">uint32_t</span> *C = (<span class="keyword">uint32_t</span> *) <span class="built_in">calloc</span>(R, <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx2 = <span class="number">0</span>; idx2 &lt; nb &amp;&amp; idx1 &lt; top1; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (LA.j[idx1] == LB.i[idx2]) &#123;</span><br><span class="line">                C[LB.j[idx2]] += LA.v[idx1] * LB.v[idx2];</span><br><span class="line">                idx2++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (idx2 &lt; nb &amp;&amp; LA.j[idx1] != LB.i[idx2]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (LA.j[idx1] &lt; LB.i[idx2])</span><br><span class="line">                    idx1++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    idx2++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; R; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (C[j])</span><br><span class="line">                hash += encrypt((r+<span class="number">1</span>)*(j+<span class="number">1</span>), C[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(C);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, hash);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> N, M, R, nA, nB;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;M, &amp;R) == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;nA, &amp;nB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nA; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LA.i[i], &amp;LA.j[i], &amp;LA.v[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nB; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;LB.i[i], &amp;LB.j[i], &amp;LB.v[i]);</span><br><span class="line">        SpMV(N, M, R, LA, nA, LB, nB);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/77/">77</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">107</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/介面設計/">介面設計</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/即時系統/">即時系統</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/平行程式/">平行程式</a><span class="category-list-count">37</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/數位影像生成/">數位影像生成</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/虛擬實境/">虛擬實境</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">617</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">479</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10113/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10113. Longest Common Subsequence II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10112/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10112. Longest Common Subsequence (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10111/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10111. Longest Common Subsequence II (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10110/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10110. Longest Common Subsequence (OpenMP)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10109/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10109. Sorting (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10108/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10108. Streams and Concurrency II (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10107/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10107. Sparse Matrix Multiplication (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10106/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10106. Multiple Device (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10104/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10104. Streams and Concurrency (CUDA)</a>
          </li>
        
          <li>
            <a class="text" href="/2016/06/28/jg-10103/">
              
                <i class="icon-file-o"></i> 
              
            批改娘 10103. Advanced Matrix Calculator (CUDA)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮可"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="http://tyan.io/" title=""><i class="icon-github-alt"></i> Tyan Blog</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>
          
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2016 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class=icon-home ></i>&nbsp&nbspHome</a>
  
    <a href="/about" class="mobile-nav-link"><i class=icon-user ></i>&nbsp&nbspAbout</a>
  
    <a href="/archives" class="mobile-nav-link"><i class=icon-archive ></i>&nbsp&nbspArchives</a>
  
    <a href="/tags" class="mobile-nav-link"><i class=icon-tags ></i>&nbsp&nbspTags</a>
  
    <a href="/picture" class="mobile-nav-link"><i class=icon-camera ></i>&nbsp&nbspPictures</a>
  
    <a href="/works" class="mobile-nav-link"><i class=icon-trophy ></i>&nbsp&nbspWorks</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/jquery.lazyload.js"></script>
<script src="/js/jquery.als-1.6.js"></script>

<script src="/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>